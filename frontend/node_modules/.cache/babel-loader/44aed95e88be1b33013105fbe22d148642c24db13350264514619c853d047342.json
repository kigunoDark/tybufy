{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\VideoExportModal.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤–∏–¥–µ–æ —Å –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–º –∫–æ–º–ø–æ–∑–∏—Ç–∏–Ω–≥–æ–º\nexport const createAdvancedVideoExporter = (timeline, settings, onProgress) => {\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞\n  const state = {\n    canvas: null,\n    ctx: null,\n    mediaCache: new Map(),\n    audioContext: null,\n    audioMixer: null,\n    isRendering: false,\n    totalDuration: 0\n  };\n\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas\n  const initializeCanvas = () => {\n    state.canvas = document.createElement(\"canvas\");\n    state.ctx = state.canvas.getContext(\"2d\");\n    const [width, height] = settings.resolution.split(\"x\").map(Number);\n    state.canvas.width = width;\n    state.canvas.height = height;\n\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞\n    state.ctx.imageSmoothingEnabled = true;\n    state.ctx.imageSmoothingQuality = 'high';\n  };\n\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–∞\n  const getMediaType = item => {\n    if (item.type === 'video' || item.trackType === 'main') return 'video';\n    if (item.type === 'audio' || item.trackType === 'audio') return 'audio';\n    if (item.type === 'image' || item.trackType === 'overlay') return 'image';\n    if (item.type === 'text') return 'text';\n    if (item.type === 'effect') return 'effect';\n\n    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ URL\n    const url = item.url || item.src || '';\n    if (/\\.(mp4|webm|mov|avi)$/i.test(url)) return 'video';\n    if (/\\.(mp3|wav|ogg|m4a)$/i.test(url)) return 'audio';\n    if (/\\.(jpg|jpeg|png|gif|webp|svg)$/i.test(url)) return 'image';\n    return 'unknown';\n  };\n\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞\n  const prepareVideoElement = async item => {\n    const video = document.createElement(\"video\");\n    video.crossOrigin = \"anonymous\";\n    video.muted = true;\n    video.preload = \"metadata\";\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        console.warn(`‚è∞ –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${item.name}`);\n        resolve(null);\n      }, 15000);\n      video.onloadedmetadata = () => {\n        clearTimeout(timeout);\n        console.log(`üé• –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name} (${video.duration.toFixed(1)}—Å)`);\n        resolve(video);\n      };\n      video.onerror = () => {\n        clearTimeout(timeout);\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${item.name}`);\n        resolve(null);\n      };\n      video.src = item.url || item.src;\n    });\n  };\n\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  const prepareImageElement = async item => {\n    const img = new Image();\n    img.crossOrigin = \"anonymous\";\n    return new Promise(resolve => {\n      const timeout = setTimeout(() => {\n        console.warn(`‚è∞ –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${item.name}`);\n        resolve(null);\n      }, 10000);\n      img.onload = () => {\n        clearTimeout(timeout);\n        console.log(`üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name}`);\n        resolve(img);\n      };\n      img.onerror = () => {\n        clearTimeout(timeout);\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${item.name}`);\n        resolve(null);\n      };\n      img.src = item.url || item.src;\n    });\n  };\n\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–∞\n  const prepareAudioElement = async item => {\n    if (!state.audioContext) {\n      state.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n    }\n    try {\n      const response = await fetch(item.url || item.src);\n      const arrayBuffer = await response.arrayBuffer();\n      const audioBuffer = await state.audioContext.decodeAudioData(arrayBuffer);\n      console.log(`üéµ –ê—É–¥–∏–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ: ${item.name} (${audioBuffer.duration.toFixed(1)}—Å)`);\n      return audioBuffer;\n    } catch (error) {\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∞—É–¥–∏–æ ${item.name}:`, error);\n      return null;\n    }\n  };\n\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n  const prepareAllMedia = async () => {\n    console.log('üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤...');\n    const preparations = timeline.map(async item => {\n      const mediaType = getMediaType(item);\n      let mediaElement = null;\n      switch (mediaType) {\n        case 'video':\n          mediaElement = await prepareVideoElement(item);\n          break;\n        case 'image':\n          mediaElement = await prepareImageElement(item);\n          break;\n        case 'audio':\n          mediaElement = await prepareAudioElement(item);\n          break;\n        default:\n          console.warn(`‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –º–µ–¥–∏–∞: ${mediaType} –¥–ª—è ${item.name}`);\n      }\n      if (mediaElement) {\n        state.mediaCache.set(item.id, {\n          element: mediaElement,\n          type: mediaType,\n          item: item\n        });\n      }\n    });\n    await Promise.all(preparations);\n    console.log(`‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ${state.mediaCache.size} –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);\n  };\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Ç—Ä–µ–∫–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏\n  const createTimelineComposition = () => {\n    // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å\n    state.totalDuration = Math.max(...timeline.map(item => (item.startTime || 0) + (item.duration || 0)));\n    console.log(`‚è±Ô∏è –û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏: ${state.totalDuration.toFixed(2)}—Å`);\n\n    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ —Ç—Ä–µ–∫–∞–º/—Å–ª–æ—è–º\n    const tracks = {\n      background: [],\n      // –§–æ–Ω–æ–≤—ã–π —Å–ª–æ–π\n      main: [],\n      // –û—Å–Ω–æ–≤–Ω—ã–µ –≤–∏–¥–µ–æ\n      overlay: [],\n      // –ù–∞–ª–æ–∂–µ–Ω–∏—è (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç)\n      audio: [],\n      // –ê—É–¥–∏–æ —Ç—Ä–µ–∫–∏\n      effects: [] // –≠—Ñ—Ñ–µ–∫—Ç—ã\n    };\n    timeline.forEach(item => {\n      const mediaType = getMediaType(item);\n      const trackType = item.trackType || mediaType;\n      switch (trackType) {\n        case 'main':\n        case 'video':\n          tracks.main.push(item);\n          break;\n        case 'overlay':\n        case 'image':\n        case 'text':\n          tracks.overlay.push(item);\n          break;\n        case 'audio':\n          tracks.audio.push(item);\n          break;\n        case 'effect':\n          tracks.effects.push(item);\n          break;\n        default:\n          tracks.main.push(item);\n      }\n    });\n    return tracks;\n  };\n\n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ –º–∏–∫—à–µ—Ä–∞\n  const setupAudioMixer = async tracks => {\n    if (!state.audioContext || tracks.audio.length === 0) {\n      console.log('üîá –ù–µ—Ç –∞—É–¥–∏–æ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');\n      return null;\n    }\n    console.log('üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ –º–∏–∫—à–µ—Ä–∞...');\n\n    // –°–æ–∑–¥–∞–µ–º destination –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏–æ\n    const destination = state.audioContext.createMediaStreamDestination();\n    const gainNode = state.audioContext.createGain();\n    gainNode.connect(destination);\n\n    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏\n    const audioSources = tracks.audio.map(item => {\n      const cached = state.mediaCache.get(item.id);\n      if (!cached || !cached.element) return null;\n      return {\n        buffer: cached.element,\n        startTime: item.startTime || 0,\n        duration: item.duration || cached.element.duration,\n        volume: item.volume || 1,\n        item: item\n      };\n    }).filter(Boolean);\n    state.audioMixer = {\n      destination,\n      gainNode,\n      sources: audioSources\n    };\n    return state.audioMixer;\n  };\n\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏\n  const getActiveItemsAtTime = (currentTime, tracks) => {\n    const activeItems = {\n      background: [],\n      main: [],\n      overlay: [],\n      effects: []\n    };\n    Object.keys(tracks).forEach(trackType => {\n      if (trackType === 'audio') return; // –ê—É–¥–∏–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ\n\n      tracks[trackType].forEach(item => {\n        const startTime = item.startTime || 0;\n        const duration = item.duration || state.totalDuration;\n        const endTime = startTime + duration;\n        if (currentTime >= startTime && currentTime < endTime) {\n          const relativeTime = currentTime - startTime;\n          activeItems[trackType].push({\n            ...item,\n            relativeTime,\n            progress: relativeTime / duration\n          });\n        }\n      });\n    });\n    return activeItems;\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞\n  const renderFrame = async (currentTime, tracks) => {\n    // –û—á–∏—â–∞–µ–º canvas\n    state.ctx.fillStyle = settings.backgroundColor || \"#000000\";\n    state.ctx.fillRect(0, 0, state.canvas.width, state.canvas.height);\n\n    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã\n    const activeItems = getActiveItemsAtTime(currentTime, tracks);\n    try {\n      // –†–µ–Ω–¥–µ—Ä–∏–º —Å–ª–æ–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ\n      await renderBackgroundLayer(activeItems.background);\n      await renderMainLayer(activeItems.main);\n      await renderOverlayLayer(activeItems.overlay);\n      await renderEffectsLayer(activeItems.effects, currentTime);\n    } catch (error) {\n      console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–¥—Ä–∞ –≤ ${currentTime.toFixed(2)}—Å:`, error);\n      renderErrorFrame(currentTime, error.message);\n    }\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Å–ª–æ—è\n  const renderBackgroundLayer = async backgroundItems => {\n    if (backgroundItems.length === 0) return;\n    for (const item of backgroundItems) {\n      const cached = state.mediaCache.get(item.id);\n      if (!cached) continue;\n      await renderMediaElement(cached.element, cached.type, item);\n    }\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≤–∏–¥–µ–æ —Å–ª–æ—è\n  const renderMainLayer = async mainItems => {\n    if (mainItems.length === 0) return;\n\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ z-index –∏–ª–∏ –ø–æ—Ä—è–¥–∫—É\n    const sortedItems = mainItems.sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n    for (const item of sortedItems) {\n      const cached = state.mediaCache.get(item.id);\n      if (!cached) continue;\n      await renderMediaElement(cached.element, cached.type, item);\n    }\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ª–æ—è –Ω–∞–ª–æ–∂–µ–Ω–∏–π\n  const renderOverlayLayer = async overlayItems => {\n    if (overlayItems.length === 0) return;\n\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ z-index\n    const sortedItems = overlayItems.sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n    for (const item of sortedItems) {\n      const cached = state.mediaCache.get(item.id);\n      if (!cached) continue;\n      state.ctx.save();\n\n      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\n      applyTransformations(item);\n      await renderMediaElement(cached.element, cached.type, item);\n      state.ctx.restore();\n    }\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\n  const renderEffectsLayer = async (effectItems, currentTime) => {\n    for (const effect of effectItems) {\n      await applyEffect(effect, currentTime);\n    }\n  };\n\n  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (–ø–æ–∑–∏—Ü–∏—è, –º–∞—Å—à—Ç–∞–±, –ø–æ–≤–æ—Ä–æ—Ç)\n  const applyTransformations = item => {\n    const centerX = state.canvas.width / 2;\n    const centerY = state.canvas.height / 2;\n\n    // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const x = item.x || 0;\n    const y = item.y || 0;\n    state.ctx.translate(x, y);\n\n    // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const scaleX = item.scaleX || item.scale || 1;\n    const scaleY = item.scaleY || item.scale || 1;\n    state.ctx.scale(scaleX, scaleY);\n\n    // –ü–æ–≤–æ—Ä–æ—Ç\n    const rotation = (item.rotation || 0) * Math.PI / 180;\n    if (rotation !== 0) {\n      state.ctx.translate(centerX, centerY);\n      state.ctx.rotate(rotation);\n      state.ctx.translate(-centerX, -centerY);\n    }\n\n    // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å\n    state.ctx.globalAlpha = item.opacity || 1;\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–∞\n  const renderMediaElement = async (element, type, item) => {\n    switch (type) {\n      case 'video':\n        await renderVideo(element, item);\n        break;\n      case 'image':\n        renderImage(element, item);\n        break;\n      case 'text':\n        renderText(item);\n        break;\n      default:\n        renderPlaceholder(item.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç');\n    }\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ\n  const renderVideo = async (video, item) => {\n    if (!video || video.readyState < 2) {\n      renderPlaceholder('–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...');\n      return;\n    }\n    try {\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –≤–∏–¥–µ–æ\n      const targetTime = Math.max(0, Math.min(item.relativeTime, video.duration));\n      if (Math.abs(video.currentTime - targetTime) > 0.1) {\n        video.currentTime = targetTime;\n\n        // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞–¥—Ä–∞\n        await waitForVideoFrame(video);\n      }\n      drawScaledMedia(video, item);\n    } catch (error) {\n      console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤–∏–¥–µ–æ:`, error);\n      renderPlaceholder('–û—à–∏–±–∫–∞ –≤–∏–¥–µ–æ');\n    }\n  };\n\n  // –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ –∫–∞–¥—Ä–∞\n  const waitForVideoFrame = (video, maxAttempts = 5) => {\n    return new Promise(resolve => {\n      let attempts = 0;\n      const checkFrame = () => {\n        if (video.readyState >= 2 || attempts >= maxAttempts) {\n          resolve();\n          return;\n        }\n        attempts++;\n        setTimeout(checkFrame, 10);\n      };\n      checkFrame();\n    });\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n  const renderImage = (img, item) => {\n    if (!img || !img.complete || img.naturalWidth === 0) {\n      renderPlaceholder('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');\n      return;\n    }\n    try {\n      drawScaledMedia(img, item);\n    } catch (error) {\n      console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:`, error);\n      renderPlaceholder('–û—à–∏–±–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');\n    }\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞\n  const renderText = item => {\n    const text = item.text || item.content || '–¢–µ–∫—Å—Ç';\n    const fontSize = item.fontSize || 32;\n    const fontFamily = item.fontFamily || 'Arial';\n    const color = item.color || '#ffffff';\n    const strokeColor = item.strokeColor || '#000000';\n    const strokeWidth = item.strokeWidth || 0;\n    state.ctx.font = `${fontSize}px ${fontFamily}`;\n    state.ctx.textAlign = item.textAlign || 'center';\n    state.ctx.textBaseline = 'middle';\n    const x = item.textX || state.canvas.width / 2;\n    const y = item.textY || state.canvas.height / 2;\n\n    // –û–±–≤–æ–¥–∫–∞\n    if (strokeWidth > 0) {\n      state.ctx.strokeStyle = strokeColor;\n      state.ctx.lineWidth = strokeWidth;\n      state.ctx.strokeText(text, x, y);\n    }\n\n    // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç\n    state.ctx.fillStyle = color;\n    state.ctx.fillText(text, x, y);\n  };\n\n  // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–µ–¥–∏–∞\n  const drawScaledMedia = (element, item) => {\n    const elementWidth = element.videoWidth || element.naturalWidth || element.width;\n    const elementHeight = element.videoHeight || element.naturalHeight || element.height;\n    if (!elementWidth || !elementHeight) return;\n\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –ø–æ–∑–∏—Ü–∏—é\n    let drawX = item.x || 0;\n    let drawY = item.y || 0;\n    let drawWidth = item.width || elementWidth;\n    let drawHeight = item.height || elementHeight;\n\n    // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π\n    if (!item.width && !item.height) {\n      const canvasRatio = state.canvas.width / state.canvas.height;\n      const elementRatio = elementWidth / elementHeight;\n      if (item.fitMode === 'cover') {\n        // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–µ—Å—å canvas\n        if (elementRatio > canvasRatio) {\n          drawHeight = state.canvas.height;\n          drawWidth = state.canvas.height * elementRatio;\n          drawX = (state.canvas.width - drawWidth) / 2;\n        } else {\n          drawWidth = state.canvas.width;\n          drawHeight = state.canvas.width / elementRatio;\n          drawY = (state.canvas.height - drawHeight) / 2;\n        }\n      } else {\n        // –°–æ–¥–µ—Ä–∂–∏–º –≤ canvas (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)\n        if (elementRatio > canvasRatio) {\n          drawWidth = state.canvas.width;\n          drawHeight = state.canvas.width / elementRatio;\n          drawY = (state.canvas.height - drawHeight) / 2;\n        } else {\n          drawHeight = state.canvas.height;\n          drawWidth = state.canvas.height * elementRatio;\n          drawX = (state.canvas.width - drawWidth) / 2;\n        }\n      }\n    }\n\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—Ä–µ–∑–∫—É –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞\n    if (item.cropX || item.cropY || item.cropWidth || item.cropHeight) {\n      const sx = item.cropX || 0;\n      const sy = item.cropY || 0;\n      const sw = item.cropWidth || elementWidth;\n      const sh = item.cropHeight || elementHeight;\n      state.ctx.drawImage(element, sx, sy, sw, sh, drawX, drawY, drawWidth, drawHeight);\n    } else {\n      state.ctx.drawImage(element, drawX, drawY, drawWidth, drawHeight);\n    }\n  };\n\n  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\n  const applyEffect = async (effect, currentTime) => {\n    const effectType = effect.effectType || effect.type;\n    switch (effectType) {\n      case 'fade':\n        applyFadeEffect(effect, currentTime);\n        break;\n      case 'blur':\n        applyBlurEffect(effect);\n        break;\n      case 'sepia':\n        applySepiaEffect();\n        break;\n      case 'grayscale':\n        applyGrayscaleEffect();\n        break;\n      default:\n        console.warn(`‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: ${effectType}`);\n    }\n  };\n\n  // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è\n  const applyFadeEffect = (effect, currentTime) => {\n    const progress = effect.progress || 0;\n    const fadeType = effect.fadeType || 'in';\n    let alpha = 1;\n    if (fadeType === 'in') {\n      alpha = Math.min(1, progress * 2);\n    } else if (fadeType === 'out') {\n      alpha = Math.max(0, 1 - (progress * 2 - 1));\n    }\n    state.ctx.globalAlpha *= alpha;\n  };\n\n  // –†–∞–∑–º—ã—Ç–∏–µ\n  const applyBlurEffect = effect => {\n    const blurAmount = effect.blurAmount || 5;\n    state.ctx.filter = `blur(${blurAmount}px)`;\n  };\n\n  // –°–µ–ø–∏—è\n  const applySepiaEffect = () => {\n    state.ctx.filter = 'sepia(100%)';\n  };\n\n  // –ß–µ—Ä–Ω–æ-–±–µ–ª—ã–π\n  const applyGrayscaleEffect = () => {\n    state.ctx.filter = 'grayscale(100%)';\n  };\n\n  // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è –æ—à–∏–±–æ–∫\n  const renderPlaceholder = text => {\n    state.ctx.fillStyle = \"rgba(64, 64, 64, 0.8)\";\n    state.ctx.fillRect(10, 10, state.canvas.width - 20, 60);\n    state.ctx.fillStyle = \"#ffffff\";\n    state.ctx.font = `${Math.min(24, state.canvas.width / 40)}px Arial`;\n    state.ctx.textAlign = \"left\";\n    state.ctx.textBaseline = \"middle\";\n    state.ctx.fillText(text, 20, 40);\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—à–∏–±–∫–∏\n  const renderErrorFrame = (currentTime, errorMessage) => {\n    state.ctx.fillStyle = \"#ff0000\";\n    state.ctx.fillRect(0, 0, state.canvas.width, state.canvas.height);\n    state.ctx.fillStyle = \"#ffffff\";\n    state.ctx.font = `${Math.min(24, state.canvas.width / 40)}px Arial`;\n    state.ctx.textAlign = \"center\";\n    state.ctx.textBaseline = \"middle\";\n    const x = state.canvas.width / 2;\n    const y = state.canvas.height / 2;\n    state.ctx.fillText(`–û–®–ò–ë–ö–ê –ö–ê–î–†–ê`, x, y - 30);\n    state.ctx.fillText(`–í—Ä–µ–º—è: ${currentTime.toFixed(1)}—Å`, x, y);\n    state.ctx.fillText(errorMessage.substring(0, 50), x, y + 30);\n  };\n\n  // –ó–∞–ø—É—Å–∫ –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\n  const startAudioSources = () => {\n    if (!state.audioMixer || !state.audioContext) return;\n    console.log('‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏...');\n    if (state.audioContext.state === 'suspended') {\n      state.audioContext.resume();\n    }\n    state.audioMixer.sources.forEach(({\n      buffer,\n      startTime,\n      duration,\n      volume\n    }) => {\n      try {\n        const source = state.audioContext.createBufferSource();\n        const gainNode = state.audioContext.createGain();\n        source.buffer = buffer;\n        gainNode.gain.value = volume;\n        source.connect(gainNode);\n        gainNode.connect(state.audioMixer.gainNode);\n        const when = state.audioContext.currentTime + startTime;\n        const sourceDuration = Math.min(duration, buffer.duration);\n        source.start(when, 0, sourceDuration);\n        console.log(`üéµ –ó–∞–ø—É—â–µ–Ω–æ –∞—É–¥–∏–æ –≤ ${startTime}—Å –Ω–∞ ${sourceDuration}—Å`);\n      } catch (error) {\n        console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞—É–¥–∏–æ:`, error);\n      }\n    });\n  };\n\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ MIME —Ç–∏–ø–∞\n  const getSupportedMimeType = () => {\n    const formats = ['video/webm;codecs=vp9,opus', 'video/webm;codecs=vp8,opus', 'video/mp4;codecs=h264,aac', 'video/webm;codecs=vp9', 'video/webm;codecs=vp8', 'video/webm'];\n    for (const format of formats) {\n      if (MediaRecorder.isTypeSupported(format)) {\n        return format;\n      }\n    }\n    return 'video/webm';\n  };\n\n  // –ó–∞–ø–∏—Å—å –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –≤ –≤–∏–¥–µ–æ —Ñ–∞–π–ª\n  const recordComposition = async tracks => {\n    console.log('üé• –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏...');\n\n    // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫\n    const stream = state.canvas.captureStream(settings.fps);\n\n    // –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –µ—Å–ª–∏ –µ—Å—Ç—å\n    if (state.audioMixer) {\n      const audioTracks = state.audioMixer.destination.stream.getAudioTracks();\n      audioTracks.forEach(track => stream.addTrack(track));\n    }\n\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø–∏—Å–∏\n    const mimeType = getSupportedMimeType();\n    const options = {\n      mimeType: mimeType,\n      videoBitsPerSecond: settings.bitrate * 1000\n    };\n    if (state.audioMixer) {\n      options.audioBitsPerSecond = 128000;\n    }\n    const mediaRecorder = new MediaRecorder(stream, options);\n    const chunks = [];\n    return new Promise((resolve, reject) => {\n      mediaRecorder.ondataavailable = event => {\n        if (event.data.size > 0) {\n          chunks.push(event.data);\n        }\n      };\n      mediaRecorder.onstop = () => {\n        const blob = new Blob(chunks, {\n          type: `video/${settings.format}`\n        });\n        console.log(`üéâ –ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${(blob.size / 1024 / 1024).toFixed(2)} –ú–ë`);\n        resolve(blob);\n      };\n      mediaRecorder.onerror = error => {\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', error);\n        reject(error);\n      };\n\n      // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å\n      mediaRecorder.start(100);\n\n      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ\n      startAudioSources();\n\n      // –†–µ–Ω–¥–µ—Ä–∏–º –≤—Å–µ –∫–∞–¥—Ä—ã\n      renderAllFrames(tracks).then(() => {\n        setTimeout(() => {\n          if (mediaRecorder.state === 'recording') {\n            mediaRecorder.stop();\n          }\n        }, 500);\n      }).catch(reject);\n    });\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∫–∞–¥—Ä–æ–≤\n  const renderAllFrames = async tracks => {\n    const frameCount = Math.ceil(state.totalDuration * settings.fps);\n    const frameDuration = 1 / settings.fps;\n    console.log(`üéûÔ∏è –†–µ–Ω–¥–µ—Ä–∏–º ${frameCount} –∫–∞–¥—Ä–æ–≤ (${settings.fps} FPS)`);\n    for (let frame = 0; frame < frameCount; frame++) {\n      const currentTime = frame * frameDuration;\n      try {\n        await renderFrame(currentTime, tracks);\n\n        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å\n        const progress = 40 + Math.round(frame / frameCount * 50);\n        onProgress === null || onProgress === void 0 ? void 0 : onProgress(progress);\n\n        // –ü–∞—É–∑–∞ –¥–ª—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏\n        if (frame % 10 === 0) {\n          await new Promise(resolve => setTimeout(resolve, 1));\n        }\n      } catch (error) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–¥—Ä–∞ ${frame}:`, error);\n        renderErrorFrame(currentTime, error.message);\n      }\n    }\n    console.log('‚úÖ –í—Å–µ –∫–∞–¥—Ä—ã –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã');\n  };\n\n  // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤\n  const cleanup = () => {\n    console.log('üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...');\n\n    // –û—á–∏—â–∞–µ–º –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç—ã\n    state.mediaCache.forEach(({\n      element\n    }) => {\n      if (element && element.src && element.src.startsWith('blob:')) {\n        URL.revokeObjectURL(element.src);\n      }\n    });\n\n    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç\n    if (state.audioContext && state.audioContext.state !== 'closed') {\n      state.audioContext.close();\n    }\n\n    // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n    state.mediaCache.clear();\n    state.audioMixer = null;\n    state.isRendering = false;\n  };\n\n  // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞\n  const exportVideo = async () => {\n    try {\n      console.log('üé¨ –ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–µ–æ');\n      state.isRendering = true;\n\n      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è\n      initializeCanvas();\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(5);\n\n      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ–¥–∏–∞\n      await prepareAllMedia();\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(25);\n\n      // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏\n      const tracks = createTimelineComposition();\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(35);\n\n      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ\n      await setupAudioMixer(tracks);\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(40);\n\n      // –ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ\n      const videoBlob = await recordComposition(tracks);\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(100);\n      return videoBlob;\n    } catch (error) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);\n      throw error;\n    } finally {\n      cleanup();\n    }\n  };\n\n  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º API —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞\n  return {\n    exportVideo,\n    cleanup,\n    getState: () => state,\n    isRendering: () => state.isRendering\n  };\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ\nexport const useAdvancedVideoExporter = () => {\n  _s();\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportProgress, setExportProgress] = useState(0);\n  const exportVideo = async (timeline, settings) => {\n    setIsExporting(true);\n    setExportProgress(0);\n    try {\n      const exporter = createAdvancedVideoExporter(timeline, settings, setExportProgress);\n      const videoBlob = await exporter.exportVideo();\n      return videoBlob;\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);\n      throw error;\n    } finally {\n      setIsExporting(false);\n      setExportProgress(0);\n    }\n  };\n  return {\n    exportVideo,\n    isExporting,\n    exportProgress\n  };\n};\n\n// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ\n_s(useAdvancedVideoExporter, \"7Ug3l7f7Y84/xNaokxf35iLSpWM=\");\nexport const ExampleUsage = () => {\n  _s2();\n  const {\n    exportVideo,\n    isExporting,\n    exportProgress\n  } = useAdvancedVideoExporter();\n  const handleExport = async () => {\n    // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Ç–∞–π–º–ª–∞–π–Ω–∞\n    const timeline = [{\n      id: 'video1',\n      type: 'video',\n      trackType: 'main',\n      name: '–û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ',\n      url: 'path/to/video.mp4',\n      startTime: 0,\n      duration: 10,\n      x: 0,\n      y: 0,\n      scale: 1,\n      opacity: 1\n    }, {\n      id: 'image1',\n      type: 'image',\n      trackType: 'overlay',\n      name: '–õ–æ–≥–æ—Ç–∏–ø',\n      url: 'path/to/logo.png',\n      startTime: 2,\n      duration: 5,\n      x: 50,\n      y: 50,\n      scale: 0.5,\n      opacity: 0.8,\n      zIndex: 10\n    }, {\n      id: 'audio1',\n      type: 'audio',\n      trackType: 'audio',\n      name: '–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞',\n      url: 'path/to/music.mp3',\n      startTime: 0,\n      duration: 10,\n      volume: 0.5\n    }, {\n      id: 'text1',\n      type: 'text',\n      trackType: 'overlay',\n      name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',\n      text: '–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!',\n      startTime: 1,\n      duration: 3,\n      fontSize: 48,\n      color: '#ffffff',\n      strokeColor: '#000000',\n      strokeWidth: 2,\n      textAlign: 'center',\n      zIndex: 20\n    }];\n    const settings = {\n      resolution: '1920x1080',\n      fps: 30,\n      bitrate: 5000,\n      format: 'mp4',\n      backgroundColor: '#000000'\n    };\n    try {\n      const videoBlob = await exportVideo(timeline, settings);\n\n      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª\n      const url = URL.createObjectURL(videoBlob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `exported_video_${Date.now()}.mp4`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      console.log('‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!');\n    } catch (error) {\n      console.error('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);\n      alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleExport,\n      disabled: isExporting,\n      className: \"bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50\",\n      children: isExporting ? `–≠–∫—Å–ø–æ—Ä—Ç... ${exportProgress}%` : '–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 944,\n      columnNumber: 7\n    }, this), isExporting && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full bg-gray-200 rounded-full h-2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-blue-600 h-2 rounded-full transition-all duration-300\",\n          style: {\n            width: `${exportProgress}%`\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 955,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 954,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-sm text-gray-600 mt-1\",\n        children: [\"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E: \", exportProgress, \"%\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 960,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 953,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 943,\n    columnNumber: 5\n  }, this);\n};\n\n// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–ª–∞–π–Ω–æ–º\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\n_s2(ExampleUsage, \"njflVIrw4s1skN6OYeDXwdUSXyM=\", false, function () {\n  return [useAdvancedVideoExporter];\n});\n_c = ExampleUsage;\nexport const validateTimeline = timeline => {\n  const errors = [];\n  if (!Array.isArray(timeline) || timeline.length === 0) {\n    errors.push('–¢–∞–π–º–ª–∞–π–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç');\n    return {\n      valid: false,\n      errors\n    };\n  }\n  timeline.forEach((item, index) => {\n    if (!item.id) {\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID`);\n    }\n    if (!item.type && !item.trackType) {\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∏–ø`);\n    }\n    if (item.startTime < 0) {\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –∏–º–µ–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞`);\n    }\n    if (item.duration <= 0) {\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –∏–º–µ–µ—Ç –Ω–µ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`);\n    }\n    if ((item.type === 'video' || item.type === 'image' || item.type === 'audio') && !item.url && !item.src) {\n      errors.push(`–ú–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å URL`);\n    }\n  });\n  return {\n    valid: errors.length === 0,\n    errors\n  };\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\nexport const calculateTimelineDuration = timeline => {\n  if (!timeline || timeline.length === 0) return 0;\n  return Math.max(...timeline.map(item => (item.startTime || 0) + (item.duration || 0)));\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\nexport const optimizeTimeline = timeline => {\n  return timeline\n  // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –Ω—É–ª–µ–≤–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é\n  .filter(item => (item.duration || 0) > 0)\n  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞\n  .sort((a, b) => (a.startTime || 0) - (b.startTime || 0))\n  // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID\n  .filter((item, index, arr) => arr.findIndex(i => i.id === item.id) === index);\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é –∫–∞–¥—Ä–∞\nexport const createFramePreview = async (timeline, settings, timePosition) => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  const [width, height] = settings.resolution.split('x').map(Number);\n\n  // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é\n  const previewScale = 0.25;\n  canvas.width = width * previewScale;\n  canvas.height = height * previewScale;\n  ctx.scale(previewScale, previewScale);\n\n  // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞\n  const exporter = createAdvancedVideoExporter(timeline, settings, () => {});\n  try {\n    await exporter.prepareAllMedia();\n    const tracks = exporter.createTimelineComposition();\n    await exporter.renderFrame(timePosition, tracks);\n    return canvas.toDataURL('image/jpeg', 0.8);\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é:', error);\n    return null;\n  } finally {\n    exporter.cleanup();\n  }\n};\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\nexport const analyzeTimelineComplexity = timeline => {\n  const analysis = {\n    totalElements: timeline.length,\n    videoElements: 0,\n    imageElements: 0,\n    audioElements: 0,\n    textElements: 0,\n    effectElements: 0,\n    overlayLayers: 0,\n    maxConcurrentElements: 0,\n    estimatedRenderTime: 0,\n    complexity: 'low'\n  };\n\n  // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n  timeline.forEach(item => {\n    const type = item.type || item.trackType;\n    switch (type) {\n      case 'video':\n      case 'main':\n        analysis.videoElements++;\n        break;\n      case 'image':\n      case 'overlay':\n        analysis.imageElements++;\n        if (item.trackType === 'overlay') analysis.overlayLayers++;\n        break;\n      case 'audio':\n        analysis.audioElements++;\n        break;\n      case 'text':\n        analysis.textElements++;\n        break;\n      case 'effect':\n        analysis.effectElements++;\n        break;\n    }\n  });\n\n  // –í—ã—á–∏—Å–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n  const duration = calculateTimelineDuration(timeline);\n  const samplePoints = Math.min(100, Math.ceil(duration * 10)); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 0.1 —Å–µ–∫\n\n  for (let i = 0; i < samplePoints; i++) {\n    const time = i / samplePoints * duration;\n    const activeCount = timeline.filter(item => {\n      const start = item.startTime || 0;\n      const end = start + (item.duration || 0);\n      return time >= start && time < end;\n    }).length;\n    analysis.maxConcurrentElements = Math.max(analysis.maxConcurrentElements, activeCount);\n  }\n\n  // –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è)\n  const baseTime = duration * 0.1; // 10% –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∫ –±–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è\n  const complexityMultiplier = 1 + analysis.videoElements * 0.2 + analysis.overlayLayers * 0.1 + analysis.effectElements * 0.3 + analysis.maxConcurrentElements * 0.05;\n  analysis.estimatedRenderTime = Math.ceil(baseTime * complexityMultiplier);\n\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏\n  if (analysis.maxConcurrentElements <= 2 && analysis.effectElements === 0) {\n    analysis.complexity = 'low';\n  } else if (analysis.maxConcurrentElements <= 5 && analysis.effectElements <= 2) {\n    analysis.complexity = 'medium';\n  } else {\n    analysis.complexity = 'high';\n  }\n  return analysis;\n};\nvar _c;\n$RefreshReg$(_c, \"ExampleUsage\");","map":{"version":3,"names":["createAdvancedVideoExporter","timeline","settings","onProgress","state","canvas","ctx","mediaCache","Map","audioContext","audioMixer","isRendering","totalDuration","initializeCanvas","document","createElement","getContext","width","height","resolution","split","map","Number","imageSmoothingEnabled","imageSmoothingQuality","getMediaType","item","type","trackType","url","src","test","prepareVideoElement","video","crossOrigin","muted","preload","Promise","resolve","reject","timeout","setTimeout","console","warn","name","onloadedmetadata","clearTimeout","log","duration","toFixed","onerror","error","prepareImageElement","img","Image","onload","prepareAudioElement","window","AudioContext","webkitAudioContext","response","fetch","arrayBuffer","audioBuffer","decodeAudioData","prepareAllMedia","preparations","mediaType","mediaElement","set","id","element","all","size","createTimelineComposition","Math","max","startTime","tracks","background","main","overlay","audio","effects","forEach","push","setupAudioMixer","length","destination","createMediaStreamDestination","gainNode","createGain","connect","audioSources","cached","get","buffer","volume","filter","Boolean","sources","getActiveItemsAtTime","currentTime","activeItems","Object","keys","endTime","relativeTime","progress","renderFrame","fillStyle","backgroundColor","fillRect","renderBackgroundLayer","renderMainLayer","renderOverlayLayer","renderEffectsLayer","renderErrorFrame","message","backgroundItems","renderMediaElement","mainItems","sortedItems","sort","a","b","zIndex","overlayItems","save","applyTransformations","restore","effectItems","effect","applyEffect","centerX","centerY","x","y","translate","scaleX","scale","scaleY","rotation","PI","rotate","globalAlpha","opacity","renderVideo","renderImage","renderText","renderPlaceholder","readyState","targetTime","min","abs","waitForVideoFrame","drawScaledMedia","maxAttempts","attempts","checkFrame","complete","naturalWidth","text","content","fontSize","fontFamily","color","strokeColor","strokeWidth","font","textAlign","textBaseline","textX","textY","strokeStyle","lineWidth","strokeText","fillText","elementWidth","videoWidth","elementHeight","videoHeight","naturalHeight","drawX","drawY","drawWidth","drawHeight","canvasRatio","elementRatio","fitMode","cropX","cropY","cropWidth","cropHeight","sx","sy","sw","sh","drawImage","effectType","applyFadeEffect","applyBlurEffect","applySepiaEffect","applyGrayscaleEffect","fadeType","alpha","blurAmount","errorMessage","substring","startAudioSources","resume","source","createBufferSource","gain","value","when","sourceDuration","start","getSupportedMimeType","formats","format","MediaRecorder","isTypeSupported","recordComposition","stream","captureStream","fps","audioTracks","getAudioTracks","track","addTrack","mimeType","options","videoBitsPerSecond","bitrate","audioBitsPerSecond","mediaRecorder","chunks","ondataavailable","event","data","onstop","blob","Blob","renderAllFrames","then","stop","catch","frameCount","ceil","frameDuration","frame","round","cleanup","startsWith","URL","revokeObjectURL","close","clear","exportVideo","videoBlob","getState","useAdvancedVideoExporter","_s","isExporting","setIsExporting","useState","exportProgress","setExportProgress","exporter","ExampleUsage","_s2","handleExport","createObjectURL","href","download","Date","now","body","appendChild","click","removeChild","alert","_jsxDEV","children","onClick","disabled","className","fileName","_jsxFileName","lineNumber","columnNumber","style","_c","validateTimeline","errors","Array","isArray","valid","index","calculateTimelineDuration","optimizeTimeline","arr","findIndex","i","createFramePreview","timePosition","previewScale","toDataURL","analyzeTimelineComplexity","analysis","totalElements","videoElements","imageElements","audioElements","textElements","effectElements","overlayLayers","maxConcurrentElements","estimatedRenderTime","complexity","samplePoints","time","activeCount","end","baseTime","complexityMultiplier","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/VideoExportModal.jsx"],"sourcesContent":["// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤–∏–¥–µ–æ —Å –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–º –∫–æ–º–ø–æ–∑–∏—Ç–∏–Ω–≥–æ–º\r\nexport const createAdvancedVideoExporter = (timeline, settings, onProgress) => {\r\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞\r\n  const state = {\r\n    canvas: null,\r\n    ctx: null,\r\n    mediaCache: new Map(),\r\n    audioContext: null,\r\n    audioMixer: null,\r\n    isRendering: false,\r\n    totalDuration: 0\r\n  };\r\n\r\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas\r\n  const initializeCanvas = () => {\r\n    state.canvas = document.createElement(\"canvas\");\r\n    state.ctx = state.canvas.getContext(\"2d\");\r\n    const [width, height] = settings.resolution.split(\"x\").map(Number);\r\n    state.canvas.width = width;\r\n    state.canvas.height = height;\r\n    \r\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞\r\n    state.ctx.imageSmoothingEnabled = true;\r\n    state.ctx.imageSmoothingQuality = 'high';\r\n  };\r\n\r\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–∞\r\n  const getMediaType = (item) => {\r\n    if (item.type === 'video' || item.trackType === 'main') return 'video';\r\n    if (item.type === 'audio' || item.trackType === 'audio') return 'audio';\r\n    if (item.type === 'image' || item.trackType === 'overlay') return 'image';\r\n    if (item.type === 'text') return 'text';\r\n    if (item.type === 'effect') return 'effect';\r\n    \r\n    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ URL\r\n    const url = item.url || item.src || '';\r\n    if (/\\.(mp4|webm|mov|avi)$/i.test(url)) return 'video';\r\n    if (/\\.(mp3|wav|ogg|m4a)$/i.test(url)) return 'audio';\r\n    if (/\\.(jpg|jpeg|png|gif|webp|svg)$/i.test(url)) return 'image';\r\n    \r\n    return 'unknown';\r\n  };\r\n\r\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞\r\n  const prepareVideoElement = async (item) => {\r\n    const video = document.createElement(\"video\");\r\n    video.crossOrigin = \"anonymous\";\r\n    video.muted = true;\r\n    video.preload = \"metadata\";\r\n    \r\n    return new Promise((resolve, reject) => {\r\n      const timeout = setTimeout(() => {\r\n        console.warn(`‚è∞ –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${item.name}`);\r\n        resolve(null);\r\n      }, 15000);\r\n\r\n      video.onloadedmetadata = () => {\r\n        clearTimeout(timeout);\r\n        console.log(`üé• –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name} (${video.duration.toFixed(1)}—Å)`);\r\n        resolve(video);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        clearTimeout(timeout);\r\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${item.name}`);\r\n        resolve(null);\r\n      };\r\n      \r\n      video.src = item.url || item.src;\r\n    });\r\n  };\r\n\r\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\r\n  const prepareImageElement = async (item) => {\r\n    const img = new Image();\r\n    img.crossOrigin = \"anonymous\";\r\n    \r\n    return new Promise((resolve) => {\r\n      const timeout = setTimeout(() => {\r\n        console.warn(`‚è∞ –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${item.name}`);\r\n        resolve(null);\r\n      }, 10000);\r\n\r\n      img.onload = () => {\r\n        clearTimeout(timeout);\r\n        console.log(`üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name}`);\r\n        resolve(img);\r\n      };\r\n      \r\n      img.onerror = () => {\r\n        clearTimeout(timeout);\r\n        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${item.name}`);\r\n        resolve(null);\r\n      };\r\n      \r\n      img.src = item.url || item.src;\r\n    });\r\n  };\r\n\r\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–∞\r\n  const prepareAudioElement = async (item) => {\r\n    if (!state.audioContext) {\r\n      state.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(item.url || item.src);\r\n      const arrayBuffer = await response.arrayBuffer();\r\n      const audioBuffer = await state.audioContext.decodeAudioData(arrayBuffer);\r\n      \r\n      console.log(`üéµ –ê—É–¥–∏–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ: ${item.name} (${audioBuffer.duration.toFixed(1)}—Å)`);\r\n      return audioBuffer;\r\n    } catch (error) {\r\n      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∞—É–¥–∏–æ ${item.name}:`, error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤\r\n  const prepareAllMedia = async () => {\r\n    console.log('üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤...');\r\n    \r\n    const preparations = timeline.map(async (item) => {\r\n      const mediaType = getMediaType(item);\r\n      let mediaElement = null;\r\n\r\n      switch (mediaType) {\r\n        case 'video':\r\n          mediaElement = await prepareVideoElement(item);\r\n          break;\r\n        case 'image':\r\n          mediaElement = await prepareImageElement(item);\r\n          break;\r\n        case 'audio':\r\n          mediaElement = await prepareAudioElement(item);\r\n          break;\r\n        default:\r\n          console.warn(`‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –º–µ–¥–∏–∞: ${mediaType} –¥–ª—è ${item.name}`);\r\n      }\r\n\r\n      if (mediaElement) {\r\n        state.mediaCache.set(item.id, {\r\n          element: mediaElement,\r\n          type: mediaType,\r\n          item: item\r\n        });\r\n      }\r\n    });\r\n\r\n    await Promise.all(preparations);\r\n    console.log(`‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ${state.mediaCache.size} –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);\r\n  };\r\n\r\n  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Ç—Ä–µ–∫–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏\r\n  const createTimelineComposition = () => {\r\n    // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å\r\n    state.totalDuration = Math.max(\r\n      ...timeline.map(item => (item.startTime || 0) + (item.duration || 0))\r\n    );\r\n\r\n    console.log(`‚è±Ô∏è –û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏: ${state.totalDuration.toFixed(2)}—Å`);\r\n\r\n    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ —Ç—Ä–µ–∫–∞–º/—Å–ª–æ—è–º\r\n    const tracks = {\r\n      background: [], // –§–æ–Ω–æ–≤—ã–π —Å–ª–æ–π\r\n      main: [],       // –û—Å–Ω–æ–≤–Ω—ã–µ –≤–∏–¥–µ–æ\r\n      overlay: [],    // –ù–∞–ª–æ–∂–µ–Ω–∏—è (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç)\r\n      audio: [],      // –ê—É–¥–∏–æ —Ç—Ä–µ–∫–∏\r\n      effects: []     // –≠—Ñ—Ñ–µ–∫—Ç—ã\r\n    };\r\n\r\n    timeline.forEach(item => {\r\n      const mediaType = getMediaType(item);\r\n      const trackType = item.trackType || mediaType;\r\n\r\n      switch (trackType) {\r\n        case 'main':\r\n        case 'video':\r\n          tracks.main.push(item);\r\n          break;\r\n        case 'overlay':\r\n        case 'image':\r\n        case 'text':\r\n          tracks.overlay.push(item);\r\n          break;\r\n        case 'audio':\r\n          tracks.audio.push(item);\r\n          break;\r\n        case 'effect':\r\n          tracks.effects.push(item);\r\n          break;\r\n        default:\r\n          tracks.main.push(item);\r\n      }\r\n    });\r\n\r\n    return tracks;\r\n  };\r\n\r\n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ –º–∏–∫—à–µ—Ä–∞\r\n  const setupAudioMixer = async (tracks) => {\r\n    if (!state.audioContext || tracks.audio.length === 0) {\r\n      console.log('üîá –ù–µ—Ç –∞—É–¥–∏–æ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');\r\n      return null;\r\n    }\r\n\r\n    console.log('üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ –º–∏–∫—à–µ—Ä–∞...');\r\n\r\n    // –°–æ–∑–¥–∞–µ–º destination –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏–æ\r\n    const destination = state.audioContext.createMediaStreamDestination();\r\n    const gainNode = state.audioContext.createGain();\r\n    gainNode.connect(destination);\r\n\r\n    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏\r\n    const audioSources = tracks.audio.map(item => {\r\n      const cached = state.mediaCache.get(item.id);\r\n      if (!cached || !cached.element) return null;\r\n\r\n      return {\r\n        buffer: cached.element,\r\n        startTime: item.startTime || 0,\r\n        duration: item.duration || cached.element.duration,\r\n        volume: item.volume || 1,\r\n        item: item\r\n      };\r\n    }).filter(Boolean);\r\n\r\n    state.audioMixer = {\r\n      destination,\r\n      gainNode,\r\n      sources: audioSources\r\n    };\r\n\r\n    return state.audioMixer;\r\n  };\r\n\r\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏\r\n  const getActiveItemsAtTime = (currentTime, tracks) => {\r\n    const activeItems = {\r\n      background: [],\r\n      main: [],\r\n      overlay: [],\r\n      effects: []\r\n    };\r\n\r\n    Object.keys(tracks).forEach(trackType => {\r\n      if (trackType === 'audio') return; // –ê—É–¥–∏–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ\r\n\r\n      tracks[trackType].forEach(item => {\r\n        const startTime = item.startTime || 0;\r\n        const duration = item.duration || state.totalDuration;\r\n        const endTime = startTime + duration;\r\n\r\n        if (currentTime >= startTime && currentTime < endTime) {\r\n          const relativeTime = currentTime - startTime;\r\n          activeItems[trackType].push({\r\n            ...item,\r\n            relativeTime,\r\n            progress: relativeTime / duration\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    return activeItems;\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞\r\n  const renderFrame = async (currentTime, tracks) => {\r\n    // –û—á–∏—â–∞–µ–º canvas\r\n    state.ctx.fillStyle = settings.backgroundColor || \"#000000\";\r\n    state.ctx.fillRect(0, 0, state.canvas.width, state.canvas.height);\r\n\r\n    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã\r\n    const activeItems = getActiveItemsAtTime(currentTime, tracks);\r\n\r\n    try {\r\n      // –†–µ–Ω–¥–µ—Ä–∏–º —Å–ª–æ–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ\r\n      await renderBackgroundLayer(activeItems.background);\r\n      await renderMainLayer(activeItems.main);\r\n      await renderOverlayLayer(activeItems.overlay);\r\n      await renderEffectsLayer(activeItems.effects, currentTime);\r\n    } catch (error) {\r\n      console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–¥—Ä–∞ –≤ ${currentTime.toFixed(2)}—Å:`, error);\r\n      renderErrorFrame(currentTime, error.message);\r\n    }\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Å–ª–æ—è\r\n  const renderBackgroundLayer = async (backgroundItems) => {\r\n    if (backgroundItems.length === 0) return;\r\n\r\n    for (const item of backgroundItems) {\r\n      const cached = state.mediaCache.get(item.id);\r\n      if (!cached) continue;\r\n\r\n      await renderMediaElement(cached.element, cached.type, item);\r\n    }\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≤–∏–¥–µ–æ —Å–ª–æ—è\r\n  const renderMainLayer = async (mainItems) => {\r\n    if (mainItems.length === 0) return;\r\n\r\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ z-index –∏–ª–∏ –ø–æ—Ä—è–¥–∫—É\r\n    const sortedItems = mainItems.sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\r\n\r\n    for (const item of sortedItems) {\r\n      const cached = state.mediaCache.get(item.id);\r\n      if (!cached) continue;\r\n\r\n      await renderMediaElement(cached.element, cached.type, item);\r\n    }\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ª–æ—è –Ω–∞–ª–æ–∂–µ–Ω–∏–π\r\n  const renderOverlayLayer = async (overlayItems) => {\r\n    if (overlayItems.length === 0) return;\r\n\r\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ z-index\r\n    const sortedItems = overlayItems.sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\r\n\r\n    for (const item of sortedItems) {\r\n      const cached = state.mediaCache.get(item.id);\r\n      if (!cached) continue;\r\n\r\n      state.ctx.save();\r\n      \r\n      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\r\n      applyTransformations(item);\r\n      \r\n      await renderMediaElement(cached.element, cached.type, item);\r\n      \r\n      state.ctx.restore();\r\n    }\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\r\n  const renderEffectsLayer = async (effectItems, currentTime) => {\r\n    for (const effect of effectItems) {\r\n      await applyEffect(effect, currentTime);\r\n    }\r\n  };\r\n\r\n  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (–ø–æ–∑–∏—Ü–∏—è, –º–∞—Å—à—Ç–∞–±, –ø–æ–≤–æ—Ä–æ—Ç)\r\n  const applyTransformations = (item) => {\r\n    const centerX = state.canvas.width / 2;\r\n    const centerY = state.canvas.height / 2;\r\n\r\n    // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\r\n    const x = item.x || 0;\r\n    const y = item.y || 0;\r\n    state.ctx.translate(x, y);\r\n\r\n    // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ\r\n    const scaleX = item.scaleX || item.scale || 1;\r\n    const scaleY = item.scaleY || item.scale || 1;\r\n    state.ctx.scale(scaleX, scaleY);\r\n\r\n    // –ü–æ–≤–æ—Ä–æ—Ç\r\n    const rotation = (item.rotation || 0) * Math.PI / 180;\r\n    if (rotation !== 0) {\r\n      state.ctx.translate(centerX, centerY);\r\n      state.ctx.rotate(rotation);\r\n      state.ctx.translate(-centerX, -centerY);\r\n    }\r\n\r\n    // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å\r\n    state.ctx.globalAlpha = item.opacity || 1;\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–∞\r\n  const renderMediaElement = async (element, type, item) => {\r\n    switch (type) {\r\n      case 'video':\r\n        await renderVideo(element, item);\r\n        break;\r\n      case 'image':\r\n        renderImage(element, item);\r\n        break;\r\n      case 'text':\r\n        renderText(item);\r\n        break;\r\n      default:\r\n        renderPlaceholder(item.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç');\r\n    }\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ\r\n  const renderVideo = async (video, item) => {\r\n    if (!video || video.readyState < 2) {\r\n      renderPlaceholder('–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –≤–∏–¥–µ–æ\r\n      const targetTime = Math.max(0, Math.min(item.relativeTime, video.duration));\r\n      \r\n      if (Math.abs(video.currentTime - targetTime) > 0.1) {\r\n        video.currentTime = targetTime;\r\n        \r\n        // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞–¥—Ä–∞\r\n        await waitForVideoFrame(video);\r\n      }\r\n\r\n      drawScaledMedia(video, item);\r\n    } catch (error) {\r\n      console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤–∏–¥–µ–æ:`, error);\r\n      renderPlaceholder('–û—à–∏–±–∫–∞ –≤–∏–¥–µ–æ');\r\n    }\r\n  };\r\n\r\n  // –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ –∫–∞–¥—Ä–∞\r\n  const waitForVideoFrame = (video, maxAttempts = 5) => {\r\n    return new Promise((resolve) => {\r\n      let attempts = 0;\r\n      const checkFrame = () => {\r\n        if (video.readyState >= 2 || attempts >= maxAttempts) {\r\n          resolve();\r\n          return;\r\n        }\r\n        attempts++;\r\n        setTimeout(checkFrame, 10);\r\n      };\r\n      checkFrame();\r\n    });\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\r\n  const renderImage = (img, item) => {\r\n    if (!img || !img.complete || img.naturalWidth === 0) {\r\n      renderPlaceholder('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      drawScaledMedia(img, item);\r\n    } catch (error) {\r\n      console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:`, error);\r\n      renderPlaceholder('–û—à–∏–±–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');\r\n    }\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞\r\n  const renderText = (item) => {\r\n    const text = item.text || item.content || '–¢–µ–∫—Å—Ç';\r\n    const fontSize = item.fontSize || 32;\r\n    const fontFamily = item.fontFamily || 'Arial';\r\n    const color = item.color || '#ffffff';\r\n    const strokeColor = item.strokeColor || '#000000';\r\n    const strokeWidth = item.strokeWidth || 0;\r\n\r\n    state.ctx.font = `${fontSize}px ${fontFamily}`;\r\n    state.ctx.textAlign = item.textAlign || 'center';\r\n    state.ctx.textBaseline = 'middle';\r\n\r\n    const x = item.textX || state.canvas.width / 2;\r\n    const y = item.textY || state.canvas.height / 2;\r\n\r\n    // –û–±–≤–æ–¥–∫–∞\r\n    if (strokeWidth > 0) {\r\n      state.ctx.strokeStyle = strokeColor;\r\n      state.ctx.lineWidth = strokeWidth;\r\n      state.ctx.strokeText(text, x, y);\r\n    }\r\n\r\n    // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç\r\n    state.ctx.fillStyle = color;\r\n    state.ctx.fillText(text, x, y);\r\n  };\r\n\r\n  // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–µ–¥–∏–∞\r\n  const drawScaledMedia = (element, item) => {\r\n    const elementWidth = element.videoWidth || element.naturalWidth || element.width;\r\n    const elementHeight = element.videoHeight || element.naturalHeight || element.height;\r\n    \r\n    if (!elementWidth || !elementHeight) return;\r\n\r\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏ –ø–æ–∑–∏—Ü–∏—é\r\n    let drawX = item.x || 0;\r\n    let drawY = item.y || 0;\r\n    let drawWidth = item.width || elementWidth;\r\n    let drawHeight = item.height || elementHeight;\r\n\r\n    // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π\r\n    if (!item.width && !item.height) {\r\n      const canvasRatio = state.canvas.width / state.canvas.height;\r\n      const elementRatio = elementWidth / elementHeight;\r\n      \r\n      if (item.fitMode === 'cover') {\r\n        // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–µ—Å—å canvas\r\n        if (elementRatio > canvasRatio) {\r\n          drawHeight = state.canvas.height;\r\n          drawWidth = state.canvas.height * elementRatio;\r\n          drawX = (state.canvas.width - drawWidth) / 2;\r\n        } else {\r\n          drawWidth = state.canvas.width;\r\n          drawHeight = state.canvas.width / elementRatio;\r\n          drawY = (state.canvas.height - drawHeight) / 2;\r\n        }\r\n      } else {\r\n        // –°–æ–¥–µ—Ä–∂–∏–º –≤ canvas (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)\r\n        if (elementRatio > canvasRatio) {\r\n          drawWidth = state.canvas.width;\r\n          drawHeight = state.canvas.width / elementRatio;\r\n          drawY = (state.canvas.height - drawHeight) / 2;\r\n        } else {\r\n          drawHeight = state.canvas.height;\r\n          drawWidth = state.canvas.height * elementRatio;\r\n          drawX = (state.canvas.width - drawWidth) / 2;\r\n        }\r\n      }\r\n    }\r\n\r\n    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—Ä–µ–∑–∫—É –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞\r\n    if (item.cropX || item.cropY || item.cropWidth || item.cropHeight) {\r\n      const sx = item.cropX || 0;\r\n      const sy = item.cropY || 0;\r\n      const sw = item.cropWidth || elementWidth;\r\n      const sh = item.cropHeight || elementHeight;\r\n      \r\n      state.ctx.drawImage(element, sx, sy, sw, sh, drawX, drawY, drawWidth, drawHeight);\r\n    } else {\r\n      state.ctx.drawImage(element, drawX, drawY, drawWidth, drawHeight);\r\n    }\r\n  };\r\n\r\n  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\r\n  const applyEffect = async (effect, currentTime) => {\r\n    const effectType = effect.effectType || effect.type;\r\n    \r\n    switch (effectType) {\r\n      case 'fade':\r\n        applyFadeEffect(effect, currentTime);\r\n        break;\r\n      case 'blur':\r\n        applyBlurEffect(effect);\r\n        break;\r\n      case 'sepia':\r\n        applySepiaEffect();\r\n        break;\r\n      case 'grayscale':\r\n        applyGrayscaleEffect();\r\n        break;\r\n      default:\r\n        console.warn(`‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: ${effectType}`);\r\n    }\r\n  };\r\n\r\n  // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è\r\n  const applyFadeEffect = (effect, currentTime) => {\r\n    const progress = effect.progress || 0;\r\n    const fadeType = effect.fadeType || 'in';\r\n    \r\n    let alpha = 1;\r\n    if (fadeType === 'in') {\r\n      alpha = Math.min(1, progress * 2);\r\n    } else if (fadeType === 'out') {\r\n      alpha = Math.max(0, 1 - (progress * 2 - 1));\r\n    }\r\n    \r\n    state.ctx.globalAlpha *= alpha;\r\n  };\r\n\r\n  // –†–∞–∑–º—ã—Ç–∏–µ\r\n  const applyBlurEffect = (effect) => {\r\n    const blurAmount = effect.blurAmount || 5;\r\n    state.ctx.filter = `blur(${blurAmount}px)`;\r\n  };\r\n\r\n  // –°–µ–ø–∏—è\r\n  const applySepiaEffect = () => {\r\n    state.ctx.filter = 'sepia(100%)';\r\n  };\r\n\r\n  // –ß–µ—Ä–Ω–æ-–±–µ–ª—ã–π\r\n  const applyGrayscaleEffect = () => {\r\n    state.ctx.filter = 'grayscale(100%)';\r\n  };\r\n\r\n  // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è –æ—à–∏–±–æ–∫\r\n  const renderPlaceholder = (text) => {\r\n    state.ctx.fillStyle = \"rgba(64, 64, 64, 0.8)\";\r\n    state.ctx.fillRect(10, 10, state.canvas.width - 20, 60);\r\n    \r\n    state.ctx.fillStyle = \"#ffffff\";\r\n    state.ctx.font = `${Math.min(24, state.canvas.width / 40)}px Arial`;\r\n    state.ctx.textAlign = \"left\";\r\n    state.ctx.textBaseline = \"middle\";\r\n    state.ctx.fillText(text, 20, 40);\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—à–∏–±–∫–∏\r\n  const renderErrorFrame = (currentTime, errorMessage) => {\r\n    state.ctx.fillStyle = \"#ff0000\";\r\n    state.ctx.fillRect(0, 0, state.canvas.width, state.canvas.height);\r\n    \r\n    state.ctx.fillStyle = \"#ffffff\";\r\n    state.ctx.font = `${Math.min(24, state.canvas.width / 40)}px Arial`;\r\n    state.ctx.textAlign = \"center\";\r\n    state.ctx.textBaseline = \"middle\";\r\n    \r\n    const x = state.canvas.width / 2;\r\n    const y = state.canvas.height / 2;\r\n    \r\n    state.ctx.fillText(`–û–®–ò–ë–ö–ê –ö–ê–î–†–ê`, x, y - 30);\r\n    state.ctx.fillText(`–í—Ä–µ–º—è: ${currentTime.toFixed(1)}—Å`, x, y);\r\n    state.ctx.fillText(errorMessage.substring(0, 50), x, y + 30);\r\n  };\r\n\r\n  // –ó–∞–ø—É—Å–∫ –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\r\n  const startAudioSources = () => {\r\n    if (!state.audioMixer || !state.audioContext) return;\r\n\r\n    console.log('‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏...');\r\n    \r\n    if (state.audioContext.state === 'suspended') {\r\n      state.audioContext.resume();\r\n    }\r\n    \r\n    state.audioMixer.sources.forEach(({ buffer, startTime, duration, volume }) => {\r\n      try {\r\n        const source = state.audioContext.createBufferSource();\r\n        const gainNode = state.audioContext.createGain();\r\n        \r\n        source.buffer = buffer;\r\n        gainNode.gain.value = volume;\r\n        \r\n        source.connect(gainNode);\r\n        gainNode.connect(state.audioMixer.gainNode);\r\n        \r\n        const when = state.audioContext.currentTime + startTime;\r\n        const sourceDuration = Math.min(duration, buffer.duration);\r\n        \r\n        source.start(when, 0, sourceDuration);\r\n        console.log(`üéµ –ó–∞–ø—É—â–µ–Ω–æ –∞—É–¥–∏–æ –≤ ${startTime}—Å –Ω–∞ ${sourceDuration}—Å`);\r\n      } catch (error) {\r\n        console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞—É–¥–∏–æ:`, error);\r\n      }\r\n    });\r\n  };\r\n\r\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ MIME —Ç–∏–ø–∞\r\n  const getSupportedMimeType = () => {\r\n    const formats = [\r\n      'video/webm;codecs=vp9,opus',\r\n      'video/webm;codecs=vp8,opus', \r\n      'video/mp4;codecs=h264,aac',\r\n      'video/webm;codecs=vp9',\r\n      'video/webm;codecs=vp8',\r\n      'video/webm'\r\n    ];\r\n    \r\n    for (const format of formats) {\r\n      if (MediaRecorder.isTypeSupported(format)) {\r\n        return format;\r\n      }\r\n    }\r\n    \r\n    return 'video/webm';\r\n  };\r\n\r\n  // –ó–∞–ø–∏—Å—å –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –≤ –≤–∏–¥–µ–æ —Ñ–∞–π–ª\r\n  const recordComposition = async (tracks) => {\r\n    console.log('üé• –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏...');\r\n\r\n    // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫\r\n    const stream = state.canvas.captureStream(settings.fps);\r\n    \r\n    // –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –µ—Å–ª–∏ –µ—Å—Ç—å\r\n    if (state.audioMixer) {\r\n      const audioTracks = state.audioMixer.destination.stream.getAudioTracks();\r\n      audioTracks.forEach(track => stream.addTrack(track));\r\n    }\r\n\r\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø–∏—Å–∏\r\n    const mimeType = getSupportedMimeType();\r\n    const options = {\r\n      mimeType: mimeType,\r\n      videoBitsPerSecond: settings.bitrate * 1000,\r\n    };\r\n\r\n    if (state.audioMixer) {\r\n      options.audioBitsPerSecond = 128000;\r\n    }\r\n\r\n    const mediaRecorder = new MediaRecorder(stream, options);\r\n    const chunks = [];\r\n\r\n    return new Promise((resolve, reject) => {\r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          chunks.push(event.data);\r\n        }\r\n      };\r\n\r\n      mediaRecorder.onstop = () => {\r\n        const blob = new Blob(chunks, { type: `video/${settings.format}` });\r\n        console.log(`üéâ –ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${(blob.size / 1024 / 1024).toFixed(2)} –ú–ë`);\r\n        resolve(blob);\r\n      };\r\n\r\n      mediaRecorder.onerror = (error) => {\r\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', error);\r\n        reject(error);\r\n      };\r\n\r\n      // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å\r\n      mediaRecorder.start(100);\r\n      \r\n      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ\r\n      startAudioSources();\r\n      \r\n      // –†–µ–Ω–¥–µ—Ä–∏–º –≤—Å–µ –∫–∞–¥—Ä—ã\r\n      renderAllFrames(tracks)\r\n        .then(() => {\r\n          setTimeout(() => {\r\n            if (mediaRecorder.state === 'recording') {\r\n              mediaRecorder.stop();\r\n            }\r\n          }, 500);\r\n        })\r\n        .catch(reject);\r\n    });\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∫–∞–¥—Ä–æ–≤\r\n  const renderAllFrames = async (tracks) => {\r\n    const frameCount = Math.ceil(state.totalDuration * settings.fps);\r\n    const frameDuration = 1 / settings.fps;\r\n    \r\n    console.log(`üéûÔ∏è –†–µ–Ω–¥–µ—Ä–∏–º ${frameCount} –∫–∞–¥—Ä–æ–≤ (${settings.fps} FPS)`);\r\n\r\n    for (let frame = 0; frame < frameCount; frame++) {\r\n      const currentTime = frame * frameDuration;\r\n      \r\n      try {\r\n        await renderFrame(currentTime, tracks);\r\n        \r\n        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å\r\n        const progress = 40 + Math.round((frame / frameCount) * 50);\r\n        onProgress?.(progress);\r\n        \r\n        // –ü–∞—É–∑–∞ –¥–ª—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏\r\n        if (frame % 10 === 0) {\r\n          await new Promise(resolve => setTimeout(resolve, 1));\r\n        }\r\n      } catch (error) {\r\n        console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–¥—Ä–∞ ${frame}:`, error);\r\n        renderErrorFrame(currentTime, error.message);\r\n      }\r\n    }\r\n\r\n    console.log('‚úÖ –í—Å–µ –∫–∞–¥—Ä—ã –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã');\r\n  };\r\n\r\n  // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤\r\n  const cleanup = () => {\r\n    console.log('üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...');\r\n    \r\n    // –û—á–∏—â–∞–µ–º –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç—ã\r\n    state.mediaCache.forEach(({ element }) => {\r\n      if (element && element.src && element.src.startsWith('blob:')) {\r\n        URL.revokeObjectURL(element.src);\r\n      }\r\n    });\r\n\r\n    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç\r\n    if (state.audioContext && state.audioContext.state !== 'closed') {\r\n      state.audioContext.close();\r\n    }\r\n\r\n    // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ\r\n    state.mediaCache.clear();\r\n    state.audioMixer = null;\r\n    state.isRendering = false;\r\n  };\r\n\r\n  // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n  const exportVideo = async () => {\r\n    try {\r\n      console.log('üé¨ –ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–µ–æ');\r\n      state.isRendering = true;\r\n      \r\n      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è\r\n      initializeCanvas();\r\n      onProgress?.(5);\r\n      \r\n      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–µ–¥–∏–∞\r\n      await prepareAllMedia();\r\n      onProgress?.(25);\r\n      \r\n      // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏\r\n      const tracks = createTimelineComposition();\r\n      onProgress?.(35);\r\n      \r\n      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ\r\n      await setupAudioMixer(tracks);\r\n      onProgress?.(40);\r\n      \r\n      // –ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ\r\n      const videoBlob = await recordComposition(tracks);\r\n      onProgress?.(100);\r\n      \r\n      return videoBlob;\r\n    } catch (error) {\r\n      console.error('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);\r\n      throw error;\r\n    } finally {\r\n      cleanup();\r\n    }\r\n  };\r\n\r\n  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º API —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞\r\n  return {\r\n    exportVideo,\r\n    cleanup,\r\n    getState: () => state,\r\n    isRendering: () => state.isRendering\r\n  };\r\n};\r\n\r\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ\r\nexport const useAdvancedVideoExporter = () => {\r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [exportProgress, setExportProgress] = useState(0);\r\n\r\n  const exportVideo = async (timeline, settings) => {\r\n    setIsExporting(true);\r\n    setExportProgress(0);\r\n\r\n    try {\r\n      const exporter = createAdvancedVideoExporter(timeline, settings, setExportProgress);\r\n      const videoBlob = await exporter.exportVideo();\r\n      return videoBlob;\r\n    } catch (error) {\r\n      console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);\r\n      throw error;\r\n    } finally {\r\n      setIsExporting(false);\r\n      setExportProgress(0);\r\n    }\r\n  };\r\n\r\n  return {\r\n    exportVideo,\r\n    isExporting,\r\n    exportProgress\r\n  };\r\n};\r\n\r\n// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ\r\nexport const ExampleUsage = () => {\r\n  const { exportVideo, isExporting, exportProgress } = useAdvancedVideoExporter();\r\n\r\n  const handleExport = async () => {\r\n    // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Ç–∞–π–º–ª–∞–π–Ω–∞\r\n    const timeline = [\r\n      {\r\n        id: 'video1',\r\n        type: 'video',\r\n        trackType: 'main',\r\n        name: '–û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ',\r\n        url: 'path/to/video.mp4',\r\n        startTime: 0,\r\n        duration: 10,\r\n        x: 0,\r\n        y: 0,\r\n        scale: 1,\r\n        opacity: 1\r\n      },\r\n      {\r\n        id: 'image1', \r\n        type: 'image',\r\n        trackType: 'overlay',\r\n        name: '–õ–æ–≥–æ—Ç–∏–ø',\r\n        url: 'path/to/logo.png',\r\n        startTime: 2,\r\n        duration: 5,\r\n        x: 50,\r\n        y: 50,\r\n        scale: 0.5,\r\n        opacity: 0.8,\r\n        zIndex: 10\r\n      },\r\n      {\r\n        id: 'audio1',\r\n        type: 'audio', \r\n        trackType: 'audio',\r\n        name: '–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞',\r\n        url: 'path/to/music.mp3',\r\n        startTime: 0,\r\n        duration: 10,\r\n        volume: 0.5\r\n      },\r\n      {\r\n        id: 'text1',\r\n        type: 'text',\r\n        trackType: 'overlay',\r\n        name: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',\r\n        text: '–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!',\r\n        startTime: 1,\r\n        duration: 3,\r\n        fontSize: 48,\r\n        color: '#ffffff',\r\n        strokeColor: '#000000',\r\n        strokeWidth: 2,\r\n        textAlign: 'center',\r\n        zIndex: 20\r\n      }\r\n    ];\r\n\r\n    const settings = {\r\n      resolution: '1920x1080',\r\n      fps: 30,\r\n      bitrate: 5000,\r\n      format: 'mp4',\r\n      backgroundColor: '#000000'\r\n    };\r\n\r\n    try {\r\n      const videoBlob = await exportVideo(timeline, settings);\r\n      \r\n      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª\r\n      const url = URL.createObjectURL(videoBlob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `exported_video_${Date.now()}.mp4`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n      \r\n      console.log('‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!');\r\n    } catch (error) {\r\n      console.error('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);\r\n      alert(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <button \r\n        onClick={handleExport} \r\n        disabled={isExporting}\r\n        className=\"bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50\"\r\n      >\r\n        {isExporting ? `–≠–∫—Å–ø–æ—Ä—Ç... ${exportProgress}%` : '–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ'}\r\n      </button>\r\n      \r\n      {isExporting && (\r\n        <div className=\"mt-4\">\r\n          <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n            <div \r\n              className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${exportProgress}%` }}\r\n            />\r\n          </div>\r\n          <p className=\"text-sm text-gray-600 mt-1\">\r\n            –≠–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–µ–æ: {exportProgress}%\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–ª–∞–π–Ω–æ–º\r\n\r\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\r\nexport const validateTimeline = (timeline) => {\r\n  const errors = [];\r\n  \r\n  if (!Array.isArray(timeline) || timeline.length === 0) {\r\n    errors.push('–¢–∞–π–º–ª–∞–π–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç');\r\n    return { valid: false, errors };\r\n  }\r\n\r\n  timeline.forEach((item, index) => {\r\n    if (!item.id) {\r\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID`);\r\n    }\r\n    \r\n    if (!item.type && !item.trackType) {\r\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∏–ø`);\r\n    }\r\n    \r\n    if (item.startTime < 0) {\r\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –∏–º–µ–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞`);\r\n    }\r\n    \r\n    if (item.duration <= 0) {\r\n      errors.push(`–≠–ª–µ–º–µ–Ω—Ç ${index} –∏–º–µ–µ—Ç –Ω–µ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`);\r\n    }\r\n\r\n    if ((item.type === 'video' || item.type === 'image' || item.type === 'audio') && !item.url && !item.src) {\r\n      errors.push(`–ú–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç ${index} –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å URL`);\r\n    }\r\n  });\r\n\r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n};\r\n\r\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—â–µ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\r\nexport const calculateTimelineDuration = (timeline) => {\r\n  if (!timeline || timeline.length === 0) return 0;\r\n  \r\n  return Math.max(\r\n    ...timeline.map(item => (item.startTime || 0) + (item.duration || 0))\r\n  );\r\n};\r\n\r\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\r\nexport const optimizeTimeline = (timeline) => {\r\n  return timeline\r\n    // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –Ω—É–ª–µ–≤–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é\r\n    .filter(item => (item.duration || 0) > 0)\r\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞\r\n    .sort((a, b) => (a.startTime || 0) - (b.startTime || 0))\r\n    // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID\r\n    .filter((item, index, arr) => \r\n      arr.findIndex(i => i.id === item.id) === index\r\n    );\r\n};\r\n\r\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é –∫–∞–¥—Ä–∞\r\nexport const createFramePreview = async (timeline, settings, timePosition) => {\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d');\r\n  const [width, height] = settings.resolution.split('x').map(Number);\r\n  \r\n  // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é\r\n  const previewScale = 0.25;\r\n  canvas.width = width * previewScale;\r\n  canvas.height = height * previewScale;\r\n  ctx.scale(previewScale, previewScale);\r\n\r\n  // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–∞–¥—Ä–∞\r\n  const exporter = createAdvancedVideoExporter(timeline, settings, () => {});\r\n  \r\n  try {\r\n    await exporter.prepareAllMedia();\r\n    const tracks = exporter.createTimelineComposition();\r\n    await exporter.renderFrame(timePosition, tracks);\r\n    \r\n    return canvas.toDataURL('image/jpeg', 0.8);\r\n  } catch (error) {\r\n    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é:', error);\r\n    return null;\r\n  } finally {\r\n    exporter.cleanup();\r\n  }\r\n};\r\n\r\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ç–∞–π–º–ª–∞–π–Ω–∞\r\nexport const analyzeTimelineComplexity = (timeline) => {\r\n  const analysis = {\r\n    totalElements: timeline.length,\r\n    videoElements: 0,\r\n    imageElements: 0, \r\n    audioElements: 0,\r\n    textElements: 0,\r\n    effectElements: 0,\r\n    overlayLayers: 0,\r\n    maxConcurrentElements: 0,\r\n    estimatedRenderTime: 0,\r\n    complexity: 'low'\r\n  };\r\n\r\n  // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤\r\n  timeline.forEach(item => {\r\n    const type = item.type || item.trackType;\r\n    switch (type) {\r\n      case 'video':\r\n      case 'main':\r\n        analysis.videoElements++;\r\n        break;\r\n      case 'image':\r\n      case 'overlay':\r\n        analysis.imageElements++;\r\n        if (item.trackType === 'overlay') analysis.overlayLayers++;\r\n        break;\r\n      case 'audio':\r\n        analysis.audioElements++;\r\n        break;\r\n      case 'text':\r\n        analysis.textElements++;\r\n        break;\r\n      case 'effect':\r\n        analysis.effectElements++;\r\n        break;\r\n    }\r\n  });\r\n\r\n  // –í—ã—á–∏—Å–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤\r\n  const duration = calculateTimelineDuration(timeline);\r\n  const samplePoints = Math.min(100, Math.ceil(duration * 10)); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 0.1 —Å–µ–∫\r\n  \r\n  for (let i = 0; i < samplePoints; i++) {\r\n    const time = (i / samplePoints) * duration;\r\n    const activeCount = timeline.filter(item => {\r\n      const start = item.startTime || 0;\r\n      const end = start + (item.duration || 0);\r\n      return time >= start && time < end;\r\n    }).length;\r\n    \r\n    analysis.maxConcurrentElements = Math.max(analysis.maxConcurrentElements, activeCount);\r\n  }\r\n\r\n  // –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è)\r\n  const baseTime = duration * 0.1; // 10% –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∫ –±–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è\r\n  const complexityMultiplier = 1 + \r\n    (analysis.videoElements * 0.2) +\r\n    (analysis.overlayLayers * 0.1) +\r\n    (analysis.effectElements * 0.3) +\r\n    (analysis.maxConcurrentElements * 0.05);\r\n  \r\n  analysis.estimatedRenderTime = Math.ceil(baseTime * complexityMultiplier);\r\n\r\n  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏\r\n  if (analysis.maxConcurrentElements <= 2 && analysis.effectElements === 0) {\r\n    analysis.complexity = 'low';\r\n  } else if (analysis.maxConcurrentElements <= 5 && analysis.effectElements <= 2) {\r\n    analysis.complexity = 'medium';\r\n  } else {\r\n    analysis.complexity = 'high';\r\n  }\r\n\r\n  return analysis;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}