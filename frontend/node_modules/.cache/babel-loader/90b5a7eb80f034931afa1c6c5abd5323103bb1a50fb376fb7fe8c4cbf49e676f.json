{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\Timeline\\\\Timeline.jsx\",\n  _s = $RefreshSig$();\n// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π TimelineHeader —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —ç–∫—Å–ø–æ—Ä—Ç–∞\nimport { Download, Film, Plus, Music, Scissors, Copy, Trash2, ZoomIn, ZoomOut, RotateCcw } from \"lucide-react\";\nimport { HelpButtonWithTooltip } from \"./HelpButtonWithTooltip\";\nexport const TimelineHeader = ({\n  draggedItem,\n  isDragging,\n  isTimelineDragging,\n  isResizing,\n  dropPreview,\n  draggedTimelineItem,\n  resizeItem,\n  resizeHandle,\n  copiedItem,\n  timelineZoom,\n  selectedTimelineItem,\n  onOpenExportModal,\n  // –ù–æ–≤—ã–π –ø—Ä–æ–ø –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞\n  addOverlayTrack,\n  addAudioTrack,\n  addToTimelineAtCurrentTime,\n  splitTimelineItem,\n  copyTimelineItem,\n  pasteTimelineItem,\n  deleteSelectedItem,\n  zoomIn,\n  zoomOut,\n  resetZoom\n}) => {\n  const getStatusMessage = () => {\n    if (draggedItem) {\n      const trackType = draggedItem.type === \"video\" ? \"Main Video\" : draggedItem.type === \"audio\" || draggedItem.type === \"music\" ? \"Audio\" : \"Overlay\";\n      return `- –ì–æ—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å: \"${draggedItem.name}\" –Ω–∞ ${trackType} –¥–æ—Ä–æ–∂–∫—É`;\n    }\n    if (isDragging && dropPreview) {\n      return `- Adding \"${draggedItem === null || draggedItem === void 0 ? void 0 : draggedItem.name}\" ${dropPreview.shouldRipple ? \"‚ö° ripple\" : \"üìç exact\"}`;\n    }\n    if (isTimelineDragging && dropPreview) {\n      return `- Moving \"${draggedTimelineItem === null || draggedTimelineItem === void 0 ? void 0 : draggedTimelineItem.name}\" ${dropPreview.shouldRipple ? \"‚ö° push blocks\" : \"üìç exact\"}`;\n    }\n    if (isResizing && resizeItem) {\n      return `- Trimming \"${resizeItem.name}\" (${resizeHandle} edge)`;\n    }\n    if (copiedItem) {\n      return `- \"${copiedItem.name}\" copied (Ctrl+V to paste)`;\n    }\n    return \"\";\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-gray-50 p-4 border-b border-gray-200 space-y-3\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-between\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        className: \"text-gray-800 font-semibold flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(Film, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Timeline Pro\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onOpenExportModal,\n          className: \"p-2 rounded-full hover:bg-blue-100 text-blue-600 hover:text-blue-700 transition-colors group relative\",\n          title: \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E\",\n          children: [/*#__PURE__*/_jsxDEV(Download, {\n            size: 20\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity animate-pulse\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-blue-600 text-sm\",\n          children: getStatusMessage()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-3\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2 bg-white rounded-xl p-2 border border-gray-200\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: zoomOut,\n            className: \"p-1 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: \"Zoom Out (-)\",\n            children: /*#__PURE__*/_jsxDEV(ZoomOut, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-xs text-gray-500 min-w-12 text-center\",\n            children: [(timelineZoom * 100).toFixed(0), \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: zoomIn,\n            className: \"p-1 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: \"Zoom In (+), or Ctrl+Wheel\",\n            children: /*#__PURE__*/_jsxDEV(ZoomIn, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 93,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: resetZoom,\n            className: \"p-1 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: \"Reset Zoom (0)\",\n            children: /*#__PURE__*/_jsxDEV(RotateCcw, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(HelpButtonWithTooltip, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TimelineControls, {\n      draggedItem: draggedItem,\n      selectedTimelineItem: selectedTimelineItem,\n      copiedItem: copiedItem,\n      addOverlayTrack: addOverlayTrack,\n      addAudioTrack: addAudioTrack,\n      addToTimelineAtCurrentTime: addToTimelineAtCurrentTime,\n      splitTimelineItem: splitTimelineItem,\n      copyTimelineItem: copyTimelineItem,\n      pasteTimelineItem: pasteTimelineItem,\n      deleteSelectedItem: deleteSelectedItem\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n};\n\n// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π Timeline –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º\n_c = TimelineHeader;\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { VideoExportModal, useVideoExporter } from \"./VideoExportModal\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const Timeline = ({\n  timelineItems,\n  setTimelineItems,\n  currentTime,\n  videoDuration,\n  setVideoDuration,\n  selectedTimelineItem,\n  setSelectedTimelineItem,\n  timelineZoom,\n  setTimelineZoom,\n  tracks,\n  setTracks,\n  draggedItem,\n  draggedTimelineItem,\n  setDraggedTimelineItem,\n  dropPreview,\n  setDropPreview,\n  isDragging,\n  isTimelineDragging,\n  setIsTimelineDragging,\n  isResizing,\n  setIsResizing,\n  copiedItem,\n  formatTime,\n  seekTo,\n  splitTimelineItem,\n  copyTimelineItem,\n  pasteTimelineItem,\n  deleteSelectedItem,\n  addToTimeline,\n  insertWithRipple,\n  applyRippleEffect,\n  removeFromTimeline,\n  onSmartAddToTimeline\n}) => {\n  _s();\n  // –•—É–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\n  const {\n    isExportModalOpen,\n    openExportModal,\n    closeExportModal\n  } = useVideoExporter();\n\n  // –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ refs –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è...\n  const timelineRef = useRef(null);\n  const timelineScrollRef = useRef(null);\n  const trackLabelsRef = useRef(null);\n  const autoScrollIntervalRef = useRef(null);\n  const [dragOffset, setDragOffset] = useState(0);\n  const [resizeHandle, setResizeHandle] = useState(null);\n  const [resizeItem, setResizeItem] = useState(null);\n  const [originalItemData, setOriginalItemData] = useState(null);\n\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\n  const prepareExportData = useCallback(() => {\n    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Ç–∞–π–º–ª–∞–π–Ω–∞\n    const enrichedTimelineItems = timelineItems.map(item => {\n      const enrichedItem = {\n        ...item\n      };\n\n      // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç\n      if (item.type === 'video' && item.src) {\n        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º video —ç–ª–µ–º–µ–Ω—Ç\n        enrichedItem.videoElement = document.querySelector(`video[src=\"${item.src}\"]`) || createVideoElement(item.src);\n      } else if (item.type === 'image' && item.src) {\n        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º image —ç–ª–µ–º–µ–Ω—Ç\n        enrichedItem.imageElement = document.querySelector(`img[src=\"${item.src}\"]`) || createImageElement(item.src);\n      } else if ((item.type === 'audio' || item.type === 'music') && item.src) {\n        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º audio —ç–ª–µ–º–µ–Ω—Ç\n        enrichedItem.audioElement = document.querySelector(`audio[src=\"${item.src}\"]`) || createAudioElement(item.src);\n      }\n      return enrichedItem;\n    });\n    return enrichedTimelineItems;\n  }, [timelineItems]);\n\n  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n  const createVideoElement = src => {\n    const video = document.createElement('video');\n    video.src = src;\n    video.crossOrigin = 'anonymous';\n    video.muted = true; // –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å autoplay\n    return video;\n  };\n  const createImageElement = src => {\n    const img = document.createElement('img');\n    img.src = src;\n    img.crossOrigin = 'anonymous';\n    return img;\n  };\n  const createAudioElement = src => {\n    const audio = document.createElement('audio');\n    audio.src = src;\n    audio.crossOrigin = 'anonymous';\n    return audio;\n  };\n\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞\n  const handleExportStart = useCallback(async exportSettings => {\n    try {\n      console.log('–ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:', exportSettings);\n\n      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n      const enrichedItems = prepareExportData();\n\n      // –°–æ–∑–¥–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä\n      const videoExporter = new VideoExporter({\n        timelineItems: enrichedItems,\n        tracks,\n        videoDuration,\n        settings: exportSettings\n      });\n\n      // –ó–∞–ø—É—Å–∫–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç\n      const exportedBlob = await videoExporter.render();\n\n      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª\n      downloadVideo(exportedBlob, exportSettings.format);\n      console.log('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');\n    } catch (error) {\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);\n      throw error;\n    }\n  }, [prepareExportData, tracks, videoDuration]);\n  const downloadVideo = (blob, format) => {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `edited_video_${Date.now()}.${format}`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ...\n  // (–∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª, drag&drop, resize, zoom –∏ —Ç.–¥.)\n\n  const stopAutoScroll = useCallback(() => {\n    if (autoScrollIntervalRef.current) {\n      clearInterval(autoScrollIntervalRef.current);\n      autoScrollIntervalRef.current = null;\n    }\n  }, []);\n  const startAutoScroll = useCallback((direction, speed = 1) => {\n    stopAutoScroll();\n    autoScrollIntervalRef.current = setInterval(() => {\n      if (timelineScrollRef.current) {\n        const scrollAmount = 15 * speed;\n        const currentScrollLeft = timelineScrollRef.current.scrollLeft;\n        const maxScroll = timelineScrollRef.current.scrollWidth - timelineScrollRef.current.clientWidth;\n        if (direction === \"left\" && currentScrollLeft > 0) {\n          timelineScrollRef.current.scrollLeft = Math.max(0, currentScrollLeft - scrollAmount);\n        } else if (direction === \"right\" && currentScrollLeft < maxScroll) {\n          timelineScrollRef.current.scrollLeft = Math.min(maxScroll, currentScrollLeft + scrollAmount);\n        }\n      }\n    }, 16);\n  }, [stopAutoScroll]);\n  const checkAutoScroll = useCallback(clientX => {\n    if (!timelineScrollRef.current) return;\n    const rect = timelineScrollRef.current.getBoundingClientRect();\n    const scrollZoneWidth = 120;\n    const relativeX = clientX - rect.left;\n    if (relativeX < scrollZoneWidth && timelineScrollRef.current.scrollLeft > 0) {\n      const speed = (scrollZoneWidth - relativeX) / scrollZoneWidth * 3;\n      startAutoScroll(\"left\", speed);\n    } else if (relativeX > rect.width - scrollZoneWidth) {\n      const maxScroll = timelineScrollRef.current.scrollWidth - timelineScrollRef.current.clientWidth;\n      if (timelineScrollRef.current.scrollLeft < maxScroll) {\n        const speed = (relativeX - (rect.width - scrollZoneWidth)) / scrollZoneWidth * 3;\n        startAutoScroll(\"right\", speed);\n      }\n    } else {\n      stopAutoScroll();\n    }\n  }, [startAutoScroll, stopAutoScroll]);\n\n  // –£—Ç–∏–ª–∏—Ç—ã\n  const getTimelineWidth = () => {\n    const baseWidth = videoDuration * 50 * timelineZoom;\n    return Math.max(baseWidth, 2000);\n  };\n  const getPixelsPerSecond = () => {\n    return 50 * timelineZoom;\n  };\n  const getTrackColor = trackType => {\n    switch (trackType) {\n      case \"overlay\":\n        return \"bg-purple-500 border-purple-400\";\n      case \"main\":\n        return \"bg-blue-500 border-blue-400\";\n      case \"audio\":\n        return \"bg-green-500 border-green-400\";\n      default:\n        return \"bg-gray-500 border-gray-400\";\n    }\n  };\n  const getTimelineItemStyle = item => {\n    const allTracks = [...tracks.overlays, ...tracks.main, ...tracks.audio];\n    const trackIndex = allTracks.findIndex(track => track.id === item.trackId);\n    const pixelsPerSecond = getPixelsPerSecond();\n    return {\n      left: `${item.startTime * pixelsPerSecond}px`,\n      width: `${item.duration * pixelsPerSecond}px`,\n      top: `${trackIndex * 60 + 10}px`\n    };\n  };\n  const getDropPreviewStyle = () => {\n    if (!dropPreview) return {};\n    const allTracks = [...tracks.overlays, ...tracks.main, ...tracks.audio];\n    const trackIndex = allTracks.findIndex(track => track.id === dropPreview.trackId);\n    const pixelsPerSecond = getPixelsPerSecond();\n    return {\n      left: `${dropPreview.time * pixelsPerSecond}px`,\n      width: `${dropPreview.duration * pixelsPerSecond}px`,\n      top: `${trackIndex * 60 + 10}px`\n    };\n  };\n\n  // Zoom —Ñ—É–Ω–∫—Ü–∏–∏\n  const zoomIn = () => setTimelineZoom(prev => Math.min(20, prev * 1.5));\n  const zoomOut = () => setTimelineZoom(prev => Math.max(0.1, prev / 1.5));\n  const resetZoom = () => setTimelineZoom(1);\n\n  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤\n  const addOverlayTrack = () => {\n    const newTrackId = `overlay-${Date.now()}`;\n    setTracks(prev => ({\n      ...prev,\n      overlays: [...prev.overlays, {\n        id: newTrackId,\n        name: `Overlay ${prev.overlays.length + 1}`,\n        type: \"overlay\"\n      }]\n    }));\n  };\n  const addAudioTrack = () => {\n    const newTrackId = `audio-${Date.now()}`;\n    setTracks(prev => ({\n      ...prev,\n      audio: [...prev.audio, {\n        id: newTrackId,\n        name: `Audio ${prev.audio.length + 1}`,\n        type: \"audio\"\n      }]\n    }));\n  };\n\n  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ...\n  // (handleTimelineClick, handleDragOver, handleDrop –∏ —Ç.–¥.)\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `h-80 bg-white rounded-2xl shadow-sm border-2 transition-all duration-200 overflow-hidden flex flex-col flex-shrink-0 ${isDragging || isTimelineDragging || isResizing ? \"border-blue-400 bg-blue-50/20\" : \"border-gray-200\"}`,\n      children: [/*#__PURE__*/_jsxDEV(TimelineHeader, {\n        draggedItem: draggedItem,\n        isDragging: isDragging,\n        isTimelineDragging: isTimelineDragging,\n        isResizing: isResizing,\n        dropPreview: dropPreview,\n        draggedTimelineItem: draggedTimelineItem,\n        resizeItem: resizeItem,\n        resizeHandle: resizeHandle,\n        copiedItem: copiedItem,\n        timelineZoom: timelineZoom,\n        selectedTimelineItem: selectedTimelineItem,\n        onOpenExportModal: openExportModal // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏\n        ,\n        addOverlayTrack: addOverlayTrack,\n        addAudioTrack: addAudioTrack,\n        addToTimelineAtCurrentTime: () => {} // implement\n        ,\n        splitTimelineItem: splitTimelineItem,\n        copyTimelineItem: copyTimelineItem,\n        pasteTimelineItem: pasteTimelineItem,\n        deleteSelectedItem: deleteSelectedItem,\n        zoomIn: zoomIn,\n        zoomOut: zoomOut,\n        resetZoom: resetZoom\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 flex min-h-0\",\n        children: [/*#__PURE__*/_jsxDEV(TrackLabels, {\n          tracks: tracks,\n          trackLabelsRef: trackLabelsRef,\n          onScroll: () => {} // implement\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TimelineCanvas, {\n          timelineRef: timelineRef,\n          timelineScrollRef: timelineScrollRef,\n          tracks: tracks,\n          timelineItems: timelineItems,\n          selectedTimelineItem: selectedTimelineItem,\n          draggedTimelineItem: draggedTimelineItem,\n          copiedItem: copiedItem,\n          dropPreview: dropPreview,\n          getTimelineWidth: getTimelineWidth,\n          getPixelsPerSecond: getPixelsPerSecond,\n          getTrackColor: getTrackColor,\n          getTimelineItemStyle: getTimelineItemStyle,\n          getDropPreviewStyle: getDropPreviewStyle,\n          videoDuration: videoDuration,\n          timelineZoom: timelineZoom,\n          currentTime: currentTime,\n          formatTime: formatTime,\n          onScroll: () => {} // implement\n          ,\n          onDragOver: () => {} // implement\n          ,\n          onDrop: () => {} // implement\n          ,\n          onDragLeave: () => {} // implement\n          ,\n          onClick: () => {} // implement\n          ,\n          onDoubleClick: () => {} // implement\n          ,\n          onTimelineItemSelect: setSelectedTimelineItem,\n          onTimelineItemDragStart: () => {} // implement\n          ,\n          onTimelineItemDragEnd: () => {} // implement\n          ,\n          onResizeStart: () => {} // implement\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 433,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(VideoExportModal, {\n      isOpen: isExportModalOpen,\n      onClose: closeExportModal,\n      timelineItems: prepareExportData(),\n      tracks: tracks,\n      videoDuration: videoDuration,\n      onExport: handleExportStart\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 505,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n// –£–ª—É—á—à–µ–Ω–Ω—ã–π VideoExporter –∫–ª–∞—Å—Å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WebCodecs API\n_s(Timeline, \"q+zPcVe0qefTQMl+cEYgY7imJXg=\", false, function () {\n  return [useVideoExporter];\n});\n_c2 = Timeline;\nclass VideoExporter {\n  constructor({\n    timelineItems,\n    tracks,\n    videoDuration,\n    settings\n  }) {\n    this.timelineItems = timelineItems;\n    this.tracks = tracks;\n    this.videoDuration = videoDuration;\n    this.settings = settings;\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É WebCodecs API\n    this.useWebCodecs = 'VideoEncoder' in window && 'VideoFrame' in window;\n    this.canvas = document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n\n    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas\n    const [width, height] = settings.resolution.split('x').map(Number);\n    this.canvas.width = width;\n    this.canvas.height = height;\n  }\n  async render() {\n    if (this.useWebCodecs) {\n      return await this.renderWithWebCodecs();\n    } else {\n      return await this.renderWithMediaRecorder();\n    }\n  }\n  async renderWithWebCodecs() {\n    // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å WebCodecs API (Chrome 94+)\n    const chunks = [];\n    const videoEncoder = new VideoEncoder({\n      output: chunk => {\n        chunks.push(chunk);\n      },\n      error: error => {\n        console.error('Video encoding error:', error);\n      }\n    });\n    videoEncoder.configure({\n      codec: 'avc1.42001E',\n      // H.264 Baseline\n      width: this.canvas.width,\n      height: this.canvas.height,\n      bitrate: this.settings.bitrate * 1000,\n      framerate: this.settings.fps\n    });\n    const frameCount = Math.ceil(this.videoDuration * this.settings.fps);\n    const frameDuration = 1000000 / this.settings.fps; // –≤ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö\n\n    for (let frame = 0; frame < frameCount; frame++) {\n      const currentTime = frame / this.settings.fps;\n      await this.renderFrame(currentTime);\n      const videoFrame = new VideoFrame(this.canvas, {\n        timestamp: frame * frameDuration\n      });\n      videoEncoder.encode(videoFrame, {\n        keyFrame: frame % 30 === 0\n      });\n      videoFrame.close();\n    }\n    await videoEncoder.flush();\n    videoEncoder.close();\n\n    // –°–æ–∑–¥–∞–µ–º MP4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)\n    return new Blob(chunks, {\n      type: `video/${this.settings.format}`\n    });\n  }\n  async renderWithMediaRecorder() {\n    // –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± —Å MediaRecorder (–±–æ–ª—å—à–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)\n    const stream = this.canvas.captureStream(this.settings.fps);\n    const options = {\n      mimeType: this.getMimeType(),\n      videoBitsPerSecond: this.settings.bitrate * 1000\n    };\n    const mediaRecorder = new MediaRecorder(stream, options);\n    const chunks = [];\n    mediaRecorder.ondataavailable = event => {\n      if (event.data.size > 0) {\n        chunks.push(event.data);\n      }\n    };\n    return new Promise((resolve, reject) => {\n      mediaRecorder.onstop = () => {\n        const blob = new Blob(chunks, {\n          type: `video/${this.settings.format}`\n        });\n        resolve(blob);\n      };\n      mediaRecorder.onerror = reject;\n      mediaRecorder.start();\n      this.renderFrames().then(() => {\n        mediaRecorder.stop();\n      }).catch(reject);\n    });\n  }\n  getMimeType() {\n    const formats = {\n      mp4: 'video/mp4;codecs=h264',\n      webm: 'video/webm;codecs=vp9',\n      mov: 'video/mp4;codecs=h264'\n    };\n    return formats[this.settings.format] || formats.mp4;\n  }\n  async renderFrames() {\n    const frameCount = Math.ceil(this.videoDuration * this.settings.fps);\n    const frameDuration = 1 / this.settings.fps;\n    for (let frame = 0; frame < frameCount; frame++) {\n      const currentTime = frame * frameDuration;\n      await this.renderFrame(currentTime);\n\n      // –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä\n      await new Promise(resolve => requestAnimationFrame(resolve));\n    }\n  }\n  async renderFrame(currentTime) {\n    // –û—á–∏—â–∞–µ–º canvas —á–µ—Ä–Ω—ã–º —Ñ–æ–Ω–æ–º\n    this.ctx.fillStyle = '#000000';\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ —Å–ª–æ—è–º\n    const sortedItems = [...this.timelineItems].sort((a, b) => {\n      const order = {\n        main: 1,\n        audio: 2,\n        overlay: 3\n      };\n      return order[a.trackType] - order[b.trackType];\n    });\n\n    // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\n    for (const item of sortedItems) {\n      if (this.isItemActiveAtTime(item, currentTime)) {\n        const relativeTime = currentTime - item.startTime;\n        await this.renderItem(item, relativeTime);\n      }\n    }\n  }\n  isItemActiveAtTime(item, currentTime) {\n    return currentTime >= item.startTime && currentTime < item.startTime + item.duration;\n  }\n  async renderItem(item, relativeTime) {\n    switch (item.type) {\n      case 'video':\n        await this.renderVideo(item, relativeTime);\n        break;\n      case 'image':\n        await this.renderImage(item);\n        break;\n      case 'text':\n        await this.renderText(item);\n        break;\n      // –ê—É–¥–∏–æ –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ\n    }\n  }\n  async renderVideo(item, relativeTime) {\n    if (!item.videoElement) return;\n    try {\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è\n      item.videoElement.currentTime = relativeTime;\n\n      // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–¥—Ä–∞\n      await this.waitForVideoFrame(item.videoElement);\n\n      // –†–µ–Ω–¥–µ—Ä–∏–º —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n      this.drawScaledMedia(item.videoElement);\n    } catch (error) {\n      console.warn('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤–∏–¥–µ–æ:', error);\n    }\n  }\n  async renderImage(item) {\n    if (!item.imageElement) return;\n    try {\n      await this.waitForImageLoad(item.imageElement);\n      this.drawScaledMedia(item.imageElement);\n    } catch (error) {\n      console.warn('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);\n    }\n  }\n  async renderText(item) {\n    if (!item.text) return;\n    this.ctx.fillStyle = item.color || '#ffffff';\n    this.ctx.font = `${item.fontSize || 24}px ${item.fontFamily || 'Arial'}`;\n    this.ctx.textAlign = item.textAlign || 'center';\n    const x = this.canvas.width / 2;\n    const y = this.canvas.height / 2;\n    this.ctx.fillText(item.text, x, y);\n  }\n  drawScaledMedia(mediaElement) {\n    // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ —Ä–∞–∑–º–µ—Ä canvas\n    const canvasAspect = this.canvas.width / this.canvas.height;\n    const mediaAspect = mediaElement.videoWidth || mediaElement.naturalWidth || mediaElement.width;\n    const mediaHeight = mediaElement.videoHeight || mediaElement.naturalHeight || mediaElement.height;\n    const mediaAspectRatio = mediaAspect / mediaHeight;\n    let drawWidth, drawHeight, drawX, drawY;\n    if (mediaAspectRatio > canvasAspect) {\n      // –ú–µ–¥–∏–∞ —à–∏—Ä–µ canvas\n      drawWidth = this.canvas.width;\n      drawHeight = this.canvas.width / mediaAspectRatio;\n      drawX = 0;\n      drawY = (this.canvas.height - drawHeight) / 2;\n    } else {\n      // –ú–µ–¥–∏–∞ –≤—ã—à–µ canvas\n      drawHeight = this.canvas.height;\n      drawWidth = this.canvas.height * mediaAspectRatio;\n      drawX = (this.canvas.width - drawWidth) / 2;\n      drawY = 0;\n    }\n    this.ctx.drawImage(mediaElement, drawX, drawY, drawWidth, drawHeight);\n  }\n  async waitForVideoFrame(videoElement) {\n    return new Promise(resolve => {\n      const checkReady = () => {\n        if (videoElement.readyState >= 2) {\n          resolve();\n        } else {\n          requestAnimationFrame(checkReady);\n        }\n      };\n      checkReady();\n    });\n  }\n  async waitForImageLoad(imageElement) {\n    return new Promise((resolve, reject) => {\n      if (imageElement.complete) {\n        resolve();\n      } else {\n        imageElement.onload = resolve;\n        imageElement.onerror = reject;\n      }\n    });\n  }\n}\nvar _c, _c2;\n$RefreshReg$(_c, \"TimelineHeader\");\n$RefreshReg$(_c2, \"Timeline\");","map":{"version":3,"names":["Download","Film","Plus","Music","Scissors","Copy","Trash2","ZoomIn","ZoomOut","RotateCcw","HelpButtonWithTooltip","TimelineHeader","draggedItem","isDragging","isTimelineDragging","isResizing","dropPreview","draggedTimelineItem","resizeItem","resizeHandle","copiedItem","timelineZoom","selectedTimelineItem","onOpenExportModal","addOverlayTrack","addAudioTrack","addToTimelineAtCurrentTime","splitTimelineItem","copyTimelineItem","pasteTimelineItem","deleteSelectedItem","zoomIn","zoomOut","resetZoom","getStatusMessage","trackType","type","name","shouldRipple","_jsxDEV","className","children","size","fileName","_jsxFileName","lineNumber","columnNumber","onClick","title","toFixed","TimelineControls","_c","useState","useRef","useEffect","useCallback","VideoExportModal","useVideoExporter","jsxDEV","Fragment","_Fragment","Timeline","timelineItems","setTimelineItems","currentTime","videoDuration","setVideoDuration","setSelectedTimelineItem","setTimelineZoom","tracks","setTracks","setDraggedTimelineItem","setDropPreview","setIsTimelineDragging","setIsResizing","formatTime","seekTo","addToTimeline","insertWithRipple","applyRippleEffect","removeFromTimeline","onSmartAddToTimeline","_s","isExportModalOpen","openExportModal","closeExportModal","timelineRef","timelineScrollRef","trackLabelsRef","autoScrollIntervalRef","dragOffset","setDragOffset","setResizeHandle","setResizeItem","originalItemData","setOriginalItemData","prepareExportData","enrichedTimelineItems","map","item","enrichedItem","src","videoElement","document","querySelector","createVideoElement","imageElement","createImageElement","audioElement","createAudioElement","video","createElement","crossOrigin","muted","img","audio","handleExportStart","exportSettings","console","log","enrichedItems","videoExporter","VideoExporter","settings","exportedBlob","render","downloadVideo","format","error","blob","url","URL","createObjectURL","a","href","download","Date","now","body","appendChild","click","removeChild","revokeObjectURL","stopAutoScroll","current","clearInterval","startAutoScroll","direction","speed","setInterval","scrollAmount","currentScrollLeft","scrollLeft","maxScroll","scrollWidth","clientWidth","Math","max","min","checkAutoScroll","clientX","rect","getBoundingClientRect","scrollZoneWidth","relativeX","left","width","getTimelineWidth","baseWidth","getPixelsPerSecond","getTrackColor","getTimelineItemStyle","allTracks","overlays","main","trackIndex","findIndex","track","id","trackId","pixelsPerSecond","startTime","duration","top","getDropPreviewStyle","time","prev","newTrackId","length","TrackLabels","onScroll","TimelineCanvas","onDragOver","onDrop","onDragLeave","onDoubleClick","onTimelineItemSelect","onTimelineItemDragStart","onTimelineItemDragEnd","onResizeStart","isOpen","onClose","onExport","_c2","constructor","useWebCodecs","window","canvas","ctx","getContext","height","resolution","split","Number","renderWithWebCodecs","renderWithMediaRecorder","chunks","videoEncoder","VideoEncoder","output","chunk","push","configure","codec","bitrate","framerate","fps","frameCount","ceil","frameDuration","frame","renderFrame","videoFrame","VideoFrame","timestamp","encode","keyFrame","close","flush","Blob","stream","captureStream","options","mimeType","getMimeType","videoBitsPerSecond","mediaRecorder","MediaRecorder","ondataavailable","event","data","Promise","resolve","reject","onstop","onerror","start","renderFrames","then","stop","catch","formats","mp4","webm","mov","requestAnimationFrame","fillStyle","fillRect","sortedItems","sort","b","order","overlay","isItemActiveAtTime","relativeTime","renderItem","renderVideo","renderImage","renderText","waitForVideoFrame","drawScaledMedia","warn","waitForImageLoad","text","color","font","fontSize","fontFamily","textAlign","x","y","fillText","mediaElement","canvasAspect","mediaAspect","videoWidth","naturalWidth","mediaHeight","videoHeight","naturalHeight","mediaAspectRatio","drawWidth","drawHeight","drawX","drawY","drawImage","checkReady","readyState","complete","onload","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/Timeline/Timeline.jsx"],"sourcesContent":["// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π TimelineHeader —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —ç–∫—Å–ø–æ—Ä—Ç–∞\r\nimport { Download, Film, Plus, Music, Scissors, Copy, Trash2, ZoomIn, ZoomOut, RotateCcw } from \"lucide-react\";\r\nimport { HelpButtonWithTooltip } from \"./HelpButtonWithTooltip\";\r\n\r\nexport const TimelineHeader = ({\r\n  draggedItem,\r\n  isDragging,\r\n  isTimelineDragging,\r\n  isResizing,\r\n  dropPreview,\r\n  draggedTimelineItem,\r\n  resizeItem,\r\n  resizeHandle,\r\n  copiedItem,\r\n  timelineZoom,\r\n  selectedTimelineItem,\r\n  onOpenExportModal, // –ù–æ–≤—ã–π –ø—Ä–æ–ø –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n  addOverlayTrack,\r\n  addAudioTrack,\r\n  addToTimelineAtCurrentTime,\r\n  splitTimelineItem,\r\n  copyTimelineItem,\r\n  pasteTimelineItem,\r\n  deleteSelectedItem,\r\n  zoomIn,\r\n  zoomOut,\r\n  resetZoom\r\n}) => {\r\n  const getStatusMessage = () => {\r\n    if (draggedItem) {\r\n      const trackType = draggedItem.type === \"video\" \r\n        ? \"Main Video\"\r\n        : draggedItem.type === \"audio\" || draggedItem.type === \"music\"\r\n        ? \"Audio\"\r\n        : \"Overlay\";\r\n      return `- –ì–æ—Ç–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å: \"${draggedItem.name}\" –Ω–∞ ${trackType} –¥–æ—Ä–æ–∂–∫—É`;\r\n    }\r\n    \r\n    if (isDragging && dropPreview) {\r\n      return `- Adding \"${draggedItem?.name}\" ${dropPreview.shouldRipple ? \"‚ö° ripple\" : \"üìç exact\"}`;\r\n    }\r\n    \r\n    if (isTimelineDragging && dropPreview) {\r\n      return `- Moving \"${draggedTimelineItem?.name}\" ${dropPreview.shouldRipple ? \"‚ö° push blocks\" : \"üìç exact\"}`;\r\n    }\r\n    \r\n    if (isResizing && resizeItem) {\r\n      return `- Trimming \"${resizeItem.name}\" (${resizeHandle} edge)`;\r\n    }\r\n    \r\n    if (copiedItem) {\r\n      return `- \"${copiedItem.name}\" copied (Ctrl+V to paste)`;\r\n    }\r\n    \r\n    return \"\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-gray-50 p-4 border-b border-gray-200 space-y-3\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h4 className=\"text-gray-800 font-semibold flex items-center space-x-2\">\r\n          <Film size={18} />\r\n          <span>Timeline Pro</span>\r\n          {/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ */}\r\n          <button\r\n            onClick={onOpenExportModal}\r\n            className=\"p-2 rounded-full hover:bg-blue-100 text-blue-600 hover:text-blue-700 transition-colors group relative\"\r\n            title=\"–≠–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–µ–æ\"\r\n          >\r\n            <Download size={20} />\r\n            <span className=\"absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity animate-pulse\"></span>\r\n          </button>\r\n          <span className=\"text-blue-600 text-sm\">{getStatusMessage()}</span>\r\n        </h4>\r\n\r\n        <div className=\"flex items-center space-x-3\">\r\n          <div className=\"flex items-center space-x-2 bg-white rounded-xl p-2 border border-gray-200\">\r\n            <button\r\n              onClick={zoomOut}\r\n              className=\"p-1 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title=\"Zoom Out (-)\"\r\n            >\r\n              <ZoomOut size={16} />\r\n            </button>\r\n            <span className=\"text-xs text-gray-500 min-w-12 text-center\">\r\n              {(timelineZoom * 100).toFixed(0)}%\r\n            </span>\r\n            <button\r\n              onClick={zoomIn}\r\n              className=\"p-1 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title=\"Zoom In (+), or Ctrl+Wheel\"\r\n            >\r\n              <ZoomIn size={16} />\r\n            </button>\r\n            <button\r\n              onClick={resetZoom}\r\n              className=\"p-1 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title=\"Reset Zoom (0)\"\r\n            >\r\n              <RotateCcw size={16} />\r\n            </button>\r\n            <HelpButtonWithTooltip />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <TimelineControls\r\n        draggedItem={draggedItem}\r\n        selectedTimelineItem={selectedTimelineItem}\r\n        copiedItem={copiedItem}\r\n        addOverlayTrack={addOverlayTrack}\r\n        addAudioTrack={addAudioTrack}\r\n        addToTimelineAtCurrentTime={addToTimelineAtCurrentTime}\r\n        splitTimelineItem={splitTimelineItem}\r\n        copyTimelineItem={copyTimelineItem}\r\n        pasteTimelineItem={pasteTimelineItem}\r\n        deleteSelectedItem={deleteSelectedItem}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π Timeline –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { VideoExportModal, useVideoExporter } from \"./VideoExportModal\";\r\n\r\nexport const Timeline = ({\r\n  timelineItems,\r\n  setTimelineItems,\r\n  currentTime,\r\n  videoDuration,\r\n  setVideoDuration,\r\n  selectedTimelineItem,\r\n  setSelectedTimelineItem,\r\n  timelineZoom,\r\n  setTimelineZoom,\r\n  tracks,\r\n  setTracks,\r\n  draggedItem,\r\n  draggedTimelineItem,\r\n  setDraggedTimelineItem,\r\n  dropPreview,\r\n  setDropPreview,\r\n  isDragging,\r\n  isTimelineDragging,\r\n  setIsTimelineDragging,\r\n  isResizing,\r\n  setIsResizing,\r\n  copiedItem,\r\n  formatTime,\r\n  seekTo,\r\n  splitTimelineItem,\r\n  copyTimelineItem,\r\n  pasteTimelineItem,\r\n  deleteSelectedItem,\r\n  addToTimeline,\r\n  insertWithRipple,\r\n  applyRippleEffect,\r\n  removeFromTimeline,\r\n  onSmartAddToTimeline,\r\n}) => {\r\n  // –•—É–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n  const { \r\n    isExportModalOpen, \r\n    openExportModal, \r\n    closeExportModal \r\n  } = useVideoExporter();\r\n\r\n  // –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ refs –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è...\r\n  const timelineRef = useRef(null);\r\n  const timelineScrollRef = useRef(null);\r\n  const trackLabelsRef = useRef(null);\r\n  const autoScrollIntervalRef = useRef(null);\r\n\r\n  const [dragOffset, setDragOffset] = useState(0);\r\n  const [resizeHandle, setResizeHandle] = useState(null);\r\n  const [resizeItem, setResizeItem] = useState(null);\r\n  const [originalItemData, setOriginalItemData] = useState(null);\r\n\r\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n  const prepareExportData = useCallback(() => {\r\n    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Ç–∞–π–º–ª–∞–π–Ω–∞\r\n    const enrichedTimelineItems = timelineItems.map(item => {\r\n      const enrichedItem = { ...item };\r\n\r\n      // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç\r\n      if (item.type === 'video' && item.src) {\r\n        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º video —ç–ª–µ–º–µ–Ω—Ç\r\n        enrichedItem.videoElement = document.querySelector(`video[src=\"${item.src}\"]`) || \r\n          createVideoElement(item.src);\r\n      } else if (item.type === 'image' && item.src) {\r\n        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º image —ç–ª–µ–º–µ–Ω—Ç\r\n        enrichedItem.imageElement = document.querySelector(`img[src=\"${item.src}\"]`) || \r\n          createImageElement(item.src);\r\n      } else if ((item.type === 'audio' || item.type === 'music') && item.src) {\r\n        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º audio —ç–ª–µ–º–µ–Ω—Ç\r\n        enrichedItem.audioElement = document.querySelector(`audio[src=\"${item.src}\"]`) || \r\n          createAudioElement(item.src);\r\n      }\r\n\r\n      return enrichedItem;\r\n    });\r\n\r\n    return enrichedTimelineItems;\r\n  }, [timelineItems]);\r\n\r\n  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤\r\n  const createVideoElement = (src) => {\r\n    const video = document.createElement('video');\r\n    video.src = src;\r\n    video.crossOrigin = 'anonymous';\r\n    video.muted = true; // –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å autoplay\r\n    return video;\r\n  };\r\n\r\n  const createImageElement = (src) => {\r\n    const img = document.createElement('img');\r\n    img.src = src;\r\n    img.crossOrigin = 'anonymous';\r\n    return img;\r\n  };\r\n\r\n  const createAudioElement = (src) => {\r\n    const audio = document.createElement('audio');\r\n    audio.src = src;\r\n    audio.crossOrigin = 'anonymous';\r\n    return audio;\r\n  };\r\n\r\n  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n  const handleExportStart = useCallback(async (exportSettings) => {\r\n    try {\r\n      console.log('–ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:', exportSettings);\r\n      \r\n      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ\r\n      const enrichedItems = prepareExportData();\r\n      \r\n      // –°–æ–∑–¥–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä\r\n      const videoExporter = new VideoExporter({\r\n        timelineItems: enrichedItems,\r\n        tracks,\r\n        videoDuration,\r\n        settings: exportSettings\r\n      });\r\n\r\n      // –ó–∞–ø—É—Å–∫–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç\r\n      const exportedBlob = await videoExporter.render();\r\n      \r\n      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª\r\n      downloadVideo(exportedBlob, exportSettings.format);\r\n      \r\n      console.log('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');\r\n    } catch (error) {\r\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);\r\n      throw error;\r\n    }\r\n  }, [prepareExportData, tracks, videoDuration]);\r\n\r\n  const downloadVideo = (blob, format) => {\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `edited_video_${Date.now()}.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ...\r\n  // (–∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª, drag&drop, resize, zoom –∏ —Ç.–¥.)\r\n\r\n  const stopAutoScroll = useCallback(() => {\r\n    if (autoScrollIntervalRef.current) {\r\n      clearInterval(autoScrollIntervalRef.current);\r\n      autoScrollIntervalRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const startAutoScroll = useCallback(\r\n    (direction, speed = 1) => {\r\n      stopAutoScroll();\r\n      autoScrollIntervalRef.current = setInterval(() => {\r\n        if (timelineScrollRef.current) {\r\n          const scrollAmount = 15 * speed;\r\n          const currentScrollLeft = timelineScrollRef.current.scrollLeft;\r\n          const maxScroll =\r\n            timelineScrollRef.current.scrollWidth -\r\n            timelineScrollRef.current.clientWidth;\r\n\r\n          if (direction === \"left\" && currentScrollLeft > 0) {\r\n            timelineScrollRef.current.scrollLeft = Math.max(\r\n              0,\r\n              currentScrollLeft - scrollAmount\r\n            );\r\n          } else if (direction === \"right\" && currentScrollLeft < maxScroll) {\r\n            timelineScrollRef.current.scrollLeft = Math.min(\r\n              maxScroll,\r\n              currentScrollLeft + scrollAmount\r\n            );\r\n          }\r\n        }\r\n      }, 16);\r\n    },\r\n    [stopAutoScroll]\r\n  );\r\n\r\n  const checkAutoScroll = useCallback(\r\n    (clientX) => {\r\n      if (!timelineScrollRef.current) return;\r\n\r\n      const rect = timelineScrollRef.current.getBoundingClientRect();\r\n      const scrollZoneWidth = 120;\r\n      const relativeX = clientX - rect.left;\r\n\r\n      if (\r\n        relativeX < scrollZoneWidth &&\r\n        timelineScrollRef.current.scrollLeft > 0\r\n      ) {\r\n        const speed = ((scrollZoneWidth - relativeX) / scrollZoneWidth) * 3;\r\n        startAutoScroll(\"left\", speed);\r\n      } else if (relativeX > rect.width - scrollZoneWidth) {\r\n        const maxScroll =\r\n          timelineScrollRef.current.scrollWidth -\r\n          timelineScrollRef.current.clientWidth;\r\n        if (timelineScrollRef.current.scrollLeft < maxScroll) {\r\n          const speed =\r\n            ((relativeX - (rect.width - scrollZoneWidth)) / scrollZoneWidth) *\r\n            3;\r\n          startAutoScroll(\"right\", speed);\r\n        }\r\n      } else {\r\n        stopAutoScroll();\r\n      }\r\n    },\r\n    [startAutoScroll, stopAutoScroll]\r\n  );\r\n\r\n  // –£—Ç–∏–ª–∏—Ç—ã\r\n  const getTimelineWidth = () => {\r\n    const baseWidth = videoDuration * 50 * timelineZoom;\r\n    return Math.max(baseWidth, 2000);\r\n  };\r\n\r\n  const getPixelsPerSecond = () => {\r\n    return 50 * timelineZoom;\r\n  };\r\n\r\n  const getTrackColor = (trackType) => {\r\n    switch (trackType) {\r\n      case \"overlay\":\r\n        return \"bg-purple-500 border-purple-400\";\r\n      case \"main\":\r\n        return \"bg-blue-500 border-blue-400\";\r\n      case \"audio\":\r\n        return \"bg-green-500 border-green-400\";\r\n      default:\r\n        return \"bg-gray-500 border-gray-400\";\r\n    }\r\n  };\r\n\r\n  const getTimelineItemStyle = (item) => {\r\n    const allTracks = [...tracks.overlays, ...tracks.main, ...tracks.audio];\r\n    const trackIndex = allTracks.findIndex(\r\n      (track) => track.id === item.trackId\r\n    );\r\n    const pixelsPerSecond = getPixelsPerSecond();\r\n\r\n    return {\r\n      left: `${item.startTime * pixelsPerSecond}px`,\r\n      width: `${item.duration * pixelsPerSecond}px`,\r\n      top: `${trackIndex * 60 + 10}px`,\r\n    };\r\n  };\r\n\r\n  const getDropPreviewStyle = () => {\r\n    if (!dropPreview) return {};\r\n\r\n    const allTracks = [...tracks.overlays, ...tracks.main, ...tracks.audio];\r\n    const trackIndex = allTracks.findIndex(\r\n      (track) => track.id === dropPreview.trackId\r\n    );\r\n    const pixelsPerSecond = getPixelsPerSecond();\r\n\r\n    return {\r\n      left: `${dropPreview.time * pixelsPerSecond}px`,\r\n      width: `${dropPreview.duration * pixelsPerSecond}px`,\r\n      top: `${trackIndex * 60 + 10}px`,\r\n    };\r\n  };\r\n\r\n  // Zoom —Ñ—É–Ω–∫—Ü–∏–∏\r\n  const zoomIn = () => setTimelineZoom((prev) => Math.min(20, prev * 1.5));\r\n  const zoomOut = () => setTimelineZoom((prev) => Math.max(0.1, prev / 1.5));\r\n  const resetZoom = () => setTimelineZoom(1);\r\n\r\n  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤\r\n  const addOverlayTrack = () => {\r\n    const newTrackId = `overlay-${Date.now()}`;\r\n    setTracks((prev) => ({\r\n      ...prev,\r\n      overlays: [\r\n        ...prev.overlays,\r\n        {\r\n          id: newTrackId,\r\n          name: `Overlay ${prev.overlays.length + 1}`,\r\n          type: \"overlay\",\r\n        },\r\n      ],\r\n    }));\r\n  };\r\n\r\n  const addAudioTrack = () => {\r\n    const newTrackId = `audio-${Date.now()}`;\r\n    setTracks((prev) => ({\r\n      ...prev,\r\n      audio: [\r\n        ...prev.audio,\r\n        {\r\n          id: newTrackId,\r\n          name: `Audio ${prev.audio.length + 1}`,\r\n          type: \"audio\",\r\n        },\r\n      ],\r\n    }));\r\n  };\r\n\r\n  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ...\r\n  // (handleTimelineClick, handleDragOver, handleDrop –∏ —Ç.–¥.)\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        className={`h-80 bg-white rounded-2xl shadow-sm border-2 transition-all duration-200 overflow-hidden flex flex-col flex-shrink-0 ${\r\n          isDragging || isTimelineDragging || isResizing\r\n            ? \"border-blue-400 bg-blue-50/20\"\r\n            : \"border-gray-200\"\r\n        }`}\r\n      >\r\n        <TimelineHeader\r\n          draggedItem={draggedItem}\r\n          isDragging={isDragging}\r\n          isTimelineDragging={isTimelineDragging}\r\n          isResizing={isResizing}\r\n          dropPreview={dropPreview}\r\n          draggedTimelineItem={draggedTimelineItem}\r\n          resizeItem={resizeItem}\r\n          resizeHandle={resizeHandle}\r\n          copiedItem={copiedItem}\r\n          timelineZoom={timelineZoom}\r\n          selectedTimelineItem={selectedTimelineItem}\r\n          onOpenExportModal={openExportModal} // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏\r\n          addOverlayTrack={addOverlayTrack}\r\n          addAudioTrack={addAudioTrack}\r\n          addToTimelineAtCurrentTime={() => {}} // implement\r\n          splitTimelineItem={splitTimelineItem}\r\n          copyTimelineItem={copyTimelineItem}\r\n          pasteTimelineItem={pasteTimelineItem}\r\n          deleteSelectedItem={deleteSelectedItem}\r\n          zoomIn={zoomIn}\r\n          zoomOut={zoomOut}\r\n          resetZoom={resetZoom}\r\n        />\r\n\r\n        <div className=\"flex-1 flex min-h-0\">\r\n          <TrackLabels\r\n            tracks={tracks}\r\n            trackLabelsRef={trackLabelsRef}\r\n            onScroll={() => {}} // implement\r\n          />\r\n\r\n          <TimelineCanvas\r\n            timelineRef={timelineRef}\r\n            timelineScrollRef={timelineScrollRef}\r\n            tracks={tracks}\r\n            timelineItems={timelineItems}\r\n            selectedTimelineItem={selectedTimelineItem}\r\n            draggedTimelineItem={draggedTimelineItem}\r\n            copiedItem={copiedItem}\r\n            dropPreview={dropPreview}\r\n            getTimelineWidth={getTimelineWidth}\r\n            getPixelsPerSecond={getPixelsPerSecond}\r\n            getTrackColor={getTrackColor}\r\n            getTimelineItemStyle={getTimelineItemStyle}\r\n            getDropPreviewStyle={getDropPreviewStyle}\r\n            videoDuration={videoDuration}\r\n            timelineZoom={timelineZoom}\r\n            currentTime={currentTime}\r\n            formatTime={formatTime}\r\n            onScroll={() => {}} // implement\r\n            onDragOver={() => {}} // implement\r\n            onDrop={() => {}} // implement\r\n            onDragLeave={() => {}} // implement\r\n            onClick={() => {}} // implement\r\n            onDoubleClick={() => {}} // implement\r\n            onTimelineItemSelect={setSelectedTimelineItem}\r\n            onTimelineItemDragStart={() => {}} // implement\r\n            onTimelineItemDragEnd={() => {}} // implement\r\n            onResizeStart={() => {}} // implement\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ */}\r\n      <VideoExportModal\r\n        isOpen={isExportModalOpen}\r\n        onClose={closeExportModal}\r\n        timelineItems={prepareExportData()}\r\n        tracks={tracks}\r\n        videoDuration={videoDuration}\r\n        onExport={handleExportStart}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\n// –£–ª—É—á—à–µ–Ω–Ω—ã–π VideoExporter –∫–ª–∞—Å—Å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WebCodecs API\r\nclass VideoExporter {\r\n  constructor({ timelineItems, tracks, videoDuration, settings }) {\r\n    this.timelineItems = timelineItems;\r\n    this.tracks = tracks;\r\n    this.videoDuration = videoDuration;\r\n    this.settings = settings;\r\n    \r\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É WebCodecs API\r\n    this.useWebCodecs = 'VideoEncoder' in window && 'VideoFrame' in window;\r\n    \r\n    this.canvas = document.createElement('canvas');\r\n    this.ctx = this.canvas.getContext('2d');\r\n    \r\n    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas\r\n    const [width, height] = settings.resolution.split('x').map(Number);\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n  }\r\n\r\n  async render() {\r\n    if (this.useWebCodecs) {\r\n      return await this.renderWithWebCodecs();\r\n    } else {\r\n      return await this.renderWithMediaRecorder();\r\n    }\r\n  }\r\n\r\n  async renderWithWebCodecs() {\r\n    // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å WebCodecs API (Chrome 94+)\r\n    const chunks = [];\r\n    \r\n    const videoEncoder = new VideoEncoder({\r\n      output: (chunk) => {\r\n        chunks.push(chunk);\r\n      },\r\n      error: (error) => {\r\n        console.error('Video encoding error:', error);\r\n      }\r\n    });\r\n\r\n    videoEncoder.configure({\r\n      codec: 'avc1.42001E', // H.264 Baseline\r\n      width: this.canvas.width,\r\n      height: this.canvas.height,\r\n      bitrate: this.settings.bitrate * 1000,\r\n      framerate: this.settings.fps\r\n    });\r\n\r\n    const frameCount = Math.ceil(this.videoDuration * this.settings.fps);\r\n    const frameDuration = 1000000 / this.settings.fps; // –≤ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö\r\n\r\n    for (let frame = 0; frame < frameCount; frame++) {\r\n      const currentTime = frame / this.settings.fps;\r\n      await this.renderFrame(currentTime);\r\n      \r\n      const videoFrame = new VideoFrame(this.canvas, {\r\n        timestamp: frame * frameDuration\r\n      });\r\n      \r\n      videoEncoder.encode(videoFrame, { keyFrame: frame % 30 === 0 });\r\n      videoFrame.close();\r\n    }\r\n\r\n    await videoEncoder.flush();\r\n    videoEncoder.close();\r\n\r\n    // –°–æ–∑–¥–∞–µ–º MP4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)\r\n    return new Blob(chunks, { type: `video/${this.settings.format}` });\r\n  }\r\n\r\n  async renderWithMediaRecorder() {\r\n    // –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± —Å MediaRecorder (–±–æ–ª—å—à–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)\r\n    const stream = this.canvas.captureStream(this.settings.fps);\r\n    \r\n    const options = {\r\n      mimeType: this.getMimeType(),\r\n      videoBitsPerSecond: this.settings.bitrate * 1000\r\n    };\r\n\r\n    const mediaRecorder = new MediaRecorder(stream, options);\r\n    const chunks = [];\r\n\r\n    mediaRecorder.ondataavailable = (event) => {\r\n      if (event.data.size > 0) {\r\n        chunks.push(event.data);\r\n      }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n      mediaRecorder.onstop = () => {\r\n        const blob = new Blob(chunks, { type: `video/${this.settings.format}` });\r\n        resolve(blob);\r\n      };\r\n\r\n      mediaRecorder.onerror = reject;\r\n\r\n      mediaRecorder.start();\r\n      \r\n      this.renderFrames().then(() => {\r\n        mediaRecorder.stop();\r\n      }).catch(reject);\r\n    });\r\n  }\r\n\r\n  getMimeType() {\r\n    const formats = {\r\n      mp4: 'video/mp4;codecs=h264',\r\n      webm: 'video/webm;codecs=vp9',\r\n      mov: 'video/mp4;codecs=h264'\r\n    };\r\n    \r\n    return formats[this.settings.format] || formats.mp4;\r\n  }\r\n\r\n  async renderFrames() {\r\n    const frameCount = Math.ceil(this.videoDuration * this.settings.fps);\r\n    const frameDuration = 1 / this.settings.fps;\r\n\r\n    for (let frame = 0; frame < frameCount; frame++) {\r\n      const currentTime = frame * frameDuration;\r\n      await this.renderFrame(currentTime);\r\n      \r\n      // –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä\r\n      await new Promise(resolve => requestAnimationFrame(resolve));\r\n    }\r\n  }\r\n\r\n  async renderFrame(currentTime) {\r\n    // –û—á–∏—â–∞–µ–º canvas —á–µ—Ä–Ω—ã–º —Ñ–æ–Ω–æ–º\r\n    this.ctx.fillStyle = '#000000';\r\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ —Å–ª–æ—è–º\r\n    const sortedItems = [...this.timelineItems].sort((a, b) => {\r\n      const order = { main: 1, audio: 2, overlay: 3 };\r\n      return order[a.trackType] - order[b.trackType];\r\n    });\r\n\r\n    // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\r\n    for (const item of sortedItems) {\r\n      if (this.isItemActiveAtTime(item, currentTime)) {\r\n        const relativeTime = currentTime - item.startTime;\r\n        await this.renderItem(item, relativeTime);\r\n      }\r\n    }\r\n  }\r\n\r\n  isItemActiveAtTime(item, currentTime) {\r\n    return currentTime >= item.startTime && \r\n           currentTime < item.startTime + item.duration;\r\n  }\r\n\r\n  async renderItem(item, relativeTime) {\r\n    switch (item.type) {\r\n      case 'video':\r\n        await this.renderVideo(item, relativeTime);\r\n        break;\r\n      case 'image':\r\n        await this.renderImage(item);\r\n        break;\r\n      case 'text':\r\n        await this.renderText(item);\r\n        break;\r\n      // –ê—É–¥–∏–æ –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ\r\n    }\r\n  }\r\n\r\n  async renderVideo(item, relativeTime) {\r\n    if (!item.videoElement) return;\r\n    \r\n    try {\r\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è\r\n      item.videoElement.currentTime = relativeTime;\r\n      \r\n      // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–¥—Ä–∞\r\n      await this.waitForVideoFrame(item.videoElement);\r\n      \r\n      // –†–µ–Ω–¥–µ—Ä–∏–º —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º\r\n      this.drawScaledMedia(item.videoElement);\r\n    } catch (error) {\r\n      console.warn('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤–∏–¥–µ–æ:', error);\r\n    }\r\n  }\r\n\r\n  async renderImage(item) {\r\n    if (!item.imageElement) return;\r\n    \r\n    try {\r\n      await this.waitForImageLoad(item.imageElement);\r\n      this.drawScaledMedia(item.imageElement);\r\n    } catch (error) {\r\n      console.warn('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);\r\n    }\r\n  }\r\n\r\n  async renderText(item) {\r\n    if (!item.text) return;\r\n    \r\n    this.ctx.fillStyle = item.color || '#ffffff';\r\n    this.ctx.font = `${item.fontSize || 24}px ${item.fontFamily || 'Arial'}`;\r\n    this.ctx.textAlign = item.textAlign || 'center';\r\n    \r\n    const x = this.canvas.width / 2;\r\n    const y = this.canvas.height / 2;\r\n    \r\n    this.ctx.fillText(item.text, x, y);\r\n  }\r\n\r\n  drawScaledMedia(mediaElement) {\r\n    // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –º–µ–¥–∏–∞ —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ —Ä–∞–∑–º–µ—Ä canvas\r\n    const canvasAspect = this.canvas.width / this.canvas.height;\r\n    const mediaAspect = mediaElement.videoWidth || mediaElement.naturalWidth || mediaElement.width;\r\n    const mediaHeight = mediaElement.videoHeight || mediaElement.naturalHeight || mediaElement.height;\r\n    const mediaAspectRatio = mediaAspect / mediaHeight;\r\n\r\n    let drawWidth, drawHeight, drawX, drawY;\r\n\r\n    if (mediaAspectRatio > canvasAspect) {\r\n      // –ú–µ–¥–∏–∞ —à–∏—Ä–µ canvas\r\n      drawWidth = this.canvas.width;\r\n      drawHeight = this.canvas.width / mediaAspectRatio;\r\n      drawX = 0;\r\n      drawY = (this.canvas.height - drawHeight) / 2;\r\n    } else {\r\n      // –ú–µ–¥–∏–∞ –≤—ã—à–µ canvas\r\n      drawHeight = this.canvas.height;\r\n      drawWidth = this.canvas.height * mediaAspectRatio;\r\n      drawX = (this.canvas.width - drawWidth) / 2;\r\n      drawY = 0;\r\n    }\r\n\r\n    this.ctx.drawImage(mediaElement, drawX, drawY, drawWidth, drawHeight);\r\n  }\r\n\r\n  async waitForVideoFrame(videoElement) {\r\n    return new Promise((resolve) => {\r\n      const checkReady = () => {\r\n        if (videoElement.readyState >= 2) {\r\n          resolve();\r\n        } else {\r\n          requestAnimationFrame(checkReady);\r\n        }\r\n      };\r\n      checkReady();\r\n    });\r\n  }\r\n\r\n  async waitForImageLoad(imageElement) {\r\n    return new Promise((resolve, reject) => {\r\n      if (imageElement.complete) {\r\n        resolve();\r\n      } else {\r\n        imageElement.onload = resolve;\r\n        imageElement.onerror = reject;\r\n      }\r\n    });\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}