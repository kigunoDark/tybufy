{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\FFmpegVideoExporter\\\\index.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { X, Download, Check, AlertCircle, Settings, Play, Film } from \"lucide-react\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst FFmpegVideoExporter = ({\n  isOpen,\n  onClose,\n  timelineItems = [],\n  videoDuration = 60,\n  overlayTransforms = {}\n}) => {\n  _s();\n  const [ffmpeg, setFfmpeg] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportProgress, setExportProgress] = useState(0);\n  const [exportStage, setExportStage] = useState(\"idle\");\n  const [error, setError] = useState(null);\n  const [exportedBlob, setExportedBlob] = useState(null);\n  const [previewFrame, setPreviewFrame] = useState(null);\n  const [exportSettings, setExportSettings] = useState({\n    resolution: \"1280x720\",\n    fps: 24,\n    duration: Math.min(videoDuration, 30),\n    includeAudio: true,\n    filename: `video_${Date.now()}`,\n    format: \"mp4\"\n  });\n  const canvasRef = useRef(null);\n  const previewCanvasRef = useRef(null);\n  const mediaCache = useRef(new Map());\n\n  // –†–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n  const calculateTotalDuration = () => {\n    if (timelineItems.length === 0) return videoDuration;\n    const maxEndTime = Math.max(...timelineItems.map(item => (item.startTime || 0) + (item.duration || 0)));\n    const calculatedDuration = Math.max(maxEndTime, videoDuration);\n    console.log(`‚è±Ô∏è –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${calculatedDuration.toFixed(2)}s`);\n    return calculatedDuration;\n  };\n\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg\n  useEffect(() => {\n    const initFFmpeg = async () => {\n      if (ffmpeg || !isOpen) return;\n      setIsLoading(true);\n      setExportStage(\"loading\");\n      setError(null);\n      try {\n        console.log(\"üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg...\");\n        const ffmpegModule = await import(\"@ffmpeg/ffmpeg\");\n        const utilModule = await import(\"@ffmpeg/util\");\n        const FFmpegClass = ffmpegModule.FFmpeg;\n        const fetchFile = utilModule.fetchFile;\n        const ffmpegInstance = new FFmpegClass();\n        await ffmpegInstance.load({\n          coreURL: \"https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.js\",\n          wasmURL: \"https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.wasm\"\n        });\n        ffmpegInstance.on(\"progress\", ({\n          progress\n        }) => {\n          if (isExporting) {\n            const adjustedProgress = 70 + Math.round(progress * 25);\n            setExportProgress(Math.min(adjustedProgress, 95));\n          }\n        });\n        window.fetchFile = fetchFile;\n        setFfmpeg(ffmpegInstance);\n        setExportStage(\"ready\");\n        console.log(\"‚úÖ FFmpeg –≥–æ—Ç–æ–≤\");\n      } catch (error) {\n        console.error(\"‚ùå –û—à–∏–±–∫–∞ FFmpeg:\", error);\n        setError(error.message);\n        setExportStage(\"error\");\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    if (isOpen) {\n      initFFmpeg();\n    }\n  }, [isOpen]);\n\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞\n  const loadMediaWithCache = async item => {\n    const cacheKey = `${item.id}_${item.url}`;\n    if (mediaCache.current.has(cacheKey)) {\n      return mediaCache.current.get(cacheKey);\n    }\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => reject(new Error(\"Timeout\")), 5000);\n      const isVideo = item.type === \"videos\" || item.trackType === \"main\";\n      if (isVideo) {\n        const video = document.createElement(\"video\");\n        if (!item.url.startsWith(\"blob:\")) {\n          video.crossOrigin = \"anonymous\";\n        }\n        video.muted = true;\n        video.preload = \"metadata\";\n        video.onloadedmetadata = () => {\n          clearTimeout(timeout);\n          mediaCache.current.set(cacheKey, video);\n          console.log(`‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name}`);\n          resolve(video);\n        };\n        video.onerror = () => {\n          clearTimeout(timeout);\n          reject(new Error(\"Video failed\"));\n        };\n        video.src = item.url;\n      } else {\n        const img = new Image();\n        if (!item.url.startsWith(\"blob:\")) {\n          img.crossOrigin = \"anonymous\";\n        }\n        img.onload = () => {\n          clearTimeout(timeout);\n          mediaCache.current.set(cacheKey, img);\n          console.log(`‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name}`);\n          resolve(img);\n        };\n        img.onerror = () => {\n          clearTimeout(timeout);\n          reject(new Error(\"Image failed\"));\n        };\n        img.src = item.url;\n      }\n    });\n  };\n\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä–∞\n  const renderFrame = async (ctx, currentTime, width, height) => {\n    ctx.fillStyle = \"#000000\";\n    ctx.fillRect(0, 0, width, height);\n    console.log(`üé¨ –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–¥—Ä –Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ ${currentTime.toFixed(1)}s`);\n\n    // –ê–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã\n    const activeItems = timelineItems.filter(item => {\n      const start = item.startTime || 0;\n      const end = start + (item.duration || 0);\n      const isActive = currentTime >= start && currentTime <= end;\n      const isNotAudio = item.trackType !== \"audio\";\n      console.log(`   üì∫ \"${item.name}\": ${start.toFixed(1)}s - ${end.toFixed(1)}s ‚Üí ${isActive ? \"‚úÖ –ê–ö–¢–ò–í–ï–ù\" : \"‚ùå –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω\"}`);\n      return isActive && isNotAudio;\n    });\n    console.log(`üìã –ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${activeItems.length}/${timelineItems.length}`);\n    if (activeItems.length === 0) {\n      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º—è –µ—Å–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n      ctx.fillStyle = \"#333333\";\n      ctx.fillRect(0, 0, width, height);\n      ctx.fillStyle = \"#ffffff\";\n      ctx.font = `${Math.min(48, width / 20)}px Arial`;\n      ctx.textAlign = \"center\";\n      ctx.textBaseline = \"middle\";\n      ctx.fillText(`–í—Ä–µ–º—è: ${currentTime.toFixed(1)}s`, width / 2, height / 2 - 30);\n      ctx.fillText(`–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤`, width / 2, height / 2 + 30);\n      return;\n    }\n\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: main —Å–Ω–∞—á–∞–ª–∞, overlay –ø–æ—Ç–æ–º\n    const sortedItems = activeItems.sort((a, b) => {\n      const layerOrder = {\n        main: 1,\n        overlay: 2,\n        audio: 0\n      };\n      return (layerOrder[a.trackType] || 1) - (layerOrder[b.trackType] || 1);\n    });\n\n    // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç\n    for (const item of sortedItems) {\n      if (item.trackType === \"audio\") continue;\n      try {\n        const element = await loadMediaWithCache(item);\n        if (!element) continue;\n        ctx.save();\n\n        // –í–∏–¥–µ–æ –≤—Ä–µ–º—è\n        if (element.tagName === \"VIDEO\") {\n          const relativeTime = currentTime - (item.startTime || 0);\n          const targetTime = Math.max(0, relativeTime);\n          if (Math.abs(element.currentTime - targetTime) > 0.1) {\n            element.currentTime = targetTime;\n            await new Promise(resolve => {\n              const checkReady = () => {\n                if (element.readyState >= 2) {\n                  resolve();\n                } else {\n                  setTimeout(checkReady, 10);\n                }\n              };\n              checkReady();\n              setTimeout(resolve, 200);\n            });\n          }\n        }\n        let drawX, drawY, drawWidth, drawHeight;\n        if (item.trackType === \"main\") {\n          // –û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ - –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ\n          const elementWidth = element.videoWidth || element.naturalWidth || element.width;\n          const elementHeight = element.videoHeight || element.naturalHeight || element.height;\n          if (elementWidth && elementHeight) {\n            const canvasRatio = width / height;\n            const elementRatio = elementWidth / elementHeight;\n            if (elementRatio > canvasRatio) {\n              drawWidth = width;\n              drawHeight = width / elementRatio;\n              drawX = 0;\n              drawY = (height - drawHeight) / 2;\n            } else {\n              drawHeight = height;\n              drawWidth = height * elementRatio;\n              drawX = (width - drawWidth) / 2;\n              drawY = 0;\n            }\n          } else {\n            drawX = 0;\n            drawY = 0;\n            drawWidth = width;\n            drawHeight = height;\n          }\n          console.log(`üì∫ –û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ: pos(${drawX.toFixed(0)}, ${drawY.toFixed(0)}) size(${drawWidth.toFixed(0)}x${drawHeight.toFixed(0)})`);\n        } else if (item.trackType === \"overlay\") {\n          // Overlay —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏\n          const overlayCoords = overlayTransforms[item.id];\n          if (overlayCoords) {\n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ VideoEditor\n            const baseX = 200 + (overlayCoords.x || 0);\n            const baseY = 50 + (overlayCoords.y || 0);\n            const scale = overlayCoords.scale || 1;\n            const opacity = overlayCoords.opacity || 1;\n\n            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø–æ–¥ —ç–∫—Å–ø–æ—Ä—Ç\n            const scaleX = width / 1920;\n            const scaleY = height / 1080;\n            drawX = baseX * scaleX;\n            drawY = baseY * scaleY;\n            drawWidth = 256 * scale * scaleX; // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä\n            drawHeight = 192 * scale * scaleY;\n            ctx.globalAlpha = opacity;\n            console.log(`üñºÔ∏è Overlay —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏: pos(${drawX.toFixed(0)}, ${drawY.toFixed(0)}) size(${drawWidth.toFixed(0)}x${drawHeight.toFixed(0)}) opacity(${opacity})`);\n          } else {\n            // Fallback –ø–æ–∑–∏—Ü–∏—è\n            const uiX = item.x || 0;\n            const uiY = item.y || 0;\n            const uiWidth = item.width || 200;\n            const uiHeight = item.height || 150;\n            const uiScale = item.scale || 1;\n            const scaleX = width / 1920;\n            const scaleY = height / 1080;\n            drawX = uiX * scaleX;\n            drawY = uiY * scaleY;\n            drawWidth = uiWidth * scaleX * uiScale;\n            drawHeight = uiHeight * scaleY * uiScale;\n            console.log(`üñºÔ∏è Overlay fallback: pos(${drawX.toFixed(0)}, ${drawY.toFixed(0)}) size(${drawWidth.toFixed(0)}x${drawHeight.toFixed(0)})`);\n          }\n        }\n\n        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å\n        if (item.rotation && item.rotation !== 0) {\n          const centerX = drawX + drawWidth / 2;\n          const centerY = drawY + drawHeight / 2;\n          ctx.translate(centerX, centerY);\n          ctx.rotate(item.rotation * Math.PI / 180);\n          ctx.translate(-centerX, -centerY);\n        }\n\n        // –†–∏—Å—É–µ–º —ç–ª–µ–º–µ–Ω—Ç\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = \"high\";\n        ctx.drawImage(element, drawX, drawY, drawWidth, drawHeight);\n        ctx.restore();\n      } catch (error) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ ${item.name}:`, error);\n      }\n    }\n  };\n\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ\n  const prepareAudio = async () => {\n    if (!exportSettings.includeAudio) return [];\n    const audioItems = timelineItems.filter(item => item.trackType === \"audio\");\n    const audioFiles = [];\n    for (let i = 0; i < Math.min(audioItems.length, 3); i++) {\n      const item = audioItems[i];\n      try {\n        const response = await fetch(item.url);\n        if (!response.ok) throw new Error(`HTTP ${response.status}`);\n        const blob = await response.blob();\n        audioFiles.push({\n          blob,\n          startTime: item.startTime || 0,\n          duration: item.duration || videoDuration,\n          name: item.name,\n          index: i\n        });\n        console.log(`‚úÖ –ê—É–¥–∏–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ: ${item.name}`);\n      } catch (error) {\n        console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ ${item.name}:`, error);\n      }\n    }\n    return audioFiles;\n  };\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–¥—Ä–æ–≤\n  const createFrames = async duration => {\n    const canvas = canvasRef.current;\n    if (!canvas) throw new Error(\"Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω\");\n    const ctx = canvas.getContext(\"2d\", {\n      alpha: false\n    });\n    const [width, height] = exportSettings.resolution.split(\"x\").map(Number);\n    canvas.width = width;\n    canvas.height = height;\n    console.log(`üéûÔ∏è –ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä–æ–≤: ${width}x${height}`);\n    const totalFrames = Math.ceil(duration * exportSettings.fps);\n    const frames = [];\n    const maxFrames = Math.min(totalFrames, 600);\n    for (let frame = 0; frame < maxFrames; frame++) {\n      const currentTime = frame / exportSettings.fps;\n      if (currentTime >= duration) break;\n      try {\n        ctx.fillStyle = \"#000000\";\n        ctx.fillRect(0, 0, width, height);\n        await renderFrame(ctx, currentTime, width, height);\n        const blob = await new Promise(resolve => {\n          const hasImages = timelineItems.some(item => item.type !== \"videos\" && item.trackType !== \"audio\");\n          if (hasImages) {\n            canvas.toBlob(resolve, \"image/png\");\n          } else {\n            canvas.toBlob(resolve, \"image/jpeg\", 0.85);\n          }\n        });\n        if (blob) {\n          frames.push(blob);\n          if (frame === 0) {\n            console.log(`üñºÔ∏è –ü–µ—Ä–≤—ã–π –∫–∞–¥—Ä: ${blob.type}, —Ä–∞–∑–º–µ—Ä: ${(blob.size / 1024).toFixed(1)}KB`);\n          }\n        }\n        const progress = 15 + Math.round(frame / maxFrames * 35);\n        setExportProgress(progress);\n        if (frame % 100 === 0) {\n          await new Promise(resolve => setTimeout(resolve, 1));\n        }\n      } catch (error) {\n        console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–¥—Ä–∞ ${frame}:`, error);\n        break;\n      }\n    }\n    console.log(`‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω: ${frames.length} –∫–∞–¥—Ä–æ–≤`);\n    return frames;\n  };\n\n  // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ\n  const encodeVideo = async (frames, audioFiles, duration) => {\n    if (!window.fetchFile || frames.length === 0) {\n      throw new Error(\"–ù–µ—Ç –∫–∞–¥—Ä–æ–≤ –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è\");\n    }\n    try {\n      const hasImages = timelineItems.some(item => item.type !== \"videos\" && item.trackType !== \"audio\");\n      console.log(`üì¶ –ö–æ–¥–∏—Ä—É–µ–º ${frames.length} –∫–∞–¥—Ä–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${hasImages}`);\n\n      // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–∞–¥—Ä—ã\n      for (let i = 0; i < frames.length; i++) {\n        const frameData = await window.fetchFile(frames[i]);\n        if (hasImages) {\n          const filename = `frame_${i.toString().padStart(6, \"0\")}.png`;\n          await ffmpeg.writeFile(filename, frameData);\n        } else {\n          const filename = `frame_${i.toString().padStart(6, \"0\")}.jpg`;\n          await ffmpeg.writeFile(filename, frameData);\n        }\n        if (i % 50 === 0) {\n          const progress = 60 + Math.round(i / frames.length * 10);\n          setExportProgress(progress);\n        }\n      }\n\n      // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∞—É–¥–∏–æ\n      for (let i = 0; i < audioFiles.length; i++) {\n        const audioFile = audioFiles[i];\n        const audioFileName = `audio_${i}.mp3`;\n        await ffmpeg.writeFile(audioFileName, await window.fetchFile(audioFile.blob));\n      }\n      setExportProgress(70);\n\n      // FFmpeg –∫–æ–º–∞–Ω–¥–∞\n      const args = [\"-framerate\", exportSettings.fps.toString()];\n      if (hasImages) {\n        args.push(\"-i\", \"frame_%06d.png\");\n      } else {\n        args.push(\"-i\", \"frame_%06d.jpg\");\n      }\n      args.push(\"-t\", Math.min(duration, frames.length / exportSettings.fps).toString());\n\n      // –ê—É–¥–∏–æ\n      if (audioFiles.length > 0) {\n        args.push(\"-i\", \"audio_0.mp3\");\n        if (audioFiles.length > 1) {\n          for (let i = 1; i < audioFiles.length; i++) {\n            args.push(\"-i\", `audio_${i}.mp3`);\n          }\n          const filterComplex = audioFiles.map((_, i) => `[${i + 1}:a]`).join(\"\") + `amix=inputs=${audioFiles.length}:duration=shortest:dropout_transition=0.5[aout]`;\n          args.push(\"-filter_complex\", filterComplex);\n          args.push(\"-map\", \"0:v\");\n          args.push(\"-map\", \"[aout]\");\n        } else {\n          args.push(\"-c:a\", \"aac\");\n          args.push(\"-b:a\", \"128k\");\n          args.push(\"-ar\", \"44100\");\n        }\n        args.push(\"-shortest\");\n      }\n\n      // –í–∏–¥–µ–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n      args.push(\"-c:v\", \"libx264\", \"-profile:v\", \"main\", \"-level\", \"3.1\", \"-preset\", \"medium\", \"-crf\", \"23\", \"-pix_fmt\", \"yuv420p\", \"-vf\", \"format=yuv420p,scale=trunc(iw/2)*2:trunc(ih/2)*2\", \"-movflags\", \"+faststart\", \"-tune\", hasImages ? \"stillimage\" : \"film\", \"output.mp4\");\n      console.log(\"üîß –ö–æ–º–∞–Ω–¥–∞ FFmpeg:\", args.join(\" \"));\n      await ffmpeg.exec(args);\n      setExportProgress(90);\n      const data = await ffmpeg.readFile(\"output.mp4\");\n      const videoBlob = new Blob([data.buffer], {\n        type: \"video/mp4\"\n      });\n\n      // –û—á–∏—Å—Ç–∫–∞\n      await cleanupTempFiles(frames.length, audioFiles.length);\n      return videoBlob;\n    } catch (error) {\n      try {\n        await cleanupTempFiles(frames.length, audioFiles.length);\n      } catch (e) {}\n      throw new Error(`–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`);\n    }\n  };\n\n  // –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤\n  const cleanupTempFiles = async (frameCount, audioCount) => {\n    for (let i = 0; i < frameCount; i++) {\n      try {\n        await ffmpeg.deleteFile(`frame_${i.toString().padStart(6, \"0\")}.png`);\n      } catch (e) {}\n      try {\n        await ffmpeg.deleteFile(`frame_${i.toString().padStart(6, \"0\")}.jpg`);\n      } catch (e) {}\n    }\n    for (let i = 0; i < audioCount; i++) {\n      try {\n        await ffmpeg.deleteFile(`audio_${i}.mp3`);\n      } catch (e) {}\n    }\n    try {\n      await ffmpeg.deleteFile(\"output.mp4\");\n    } catch (e) {}\n  };\n\n  // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞\n  const startExport = async () => {\n    if (!ffmpeg || isExporting || timelineItems.length === 0) return;\n    setIsExporting(true);\n    setExportProgress(0);\n    setExportStage(\"preparing\");\n    setError(null);\n    try {\n      console.log(\"üé¨ –ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç\");\n      const totalDuration = calculateTotalDuration();\n      const maxDuration = Math.min(totalDuration, 120);\n      const actualDuration = maxDuration;\n      setExportStage(\"rendering_frames\");\n      const frames = await createFrames(actualDuration);\n      setExportProgress(50);\n      setExportStage(\"processing_audio\");\n      const audioFiles = await prepareAudio();\n      setExportProgress(60);\n      setExportStage(\"encoding\");\n      const videoBlob = await encodeVideo(frames, audioFiles, actualDuration);\n      setExportProgress(95);\n      setExportStage(\"downloading\");\n      await downloadVideo(videoBlob);\n      setExportProgress(100);\n      setExportStage(\"completed\");\n      setExportedBlob(videoBlob);\n      setTimeout(() => {\n        setExportStage(\"ready\");\n        setExportProgress(0);\n      }, 3000);\n    } catch (error) {\n      console.error(\"‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:\", error);\n      setError(error.message);\n      setExportStage(\"error\");\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é\n  const generatePreviewFrame = async () => {\n    try {\n      const canvas = previewCanvasRef.current;\n      if (!canvas) return;\n      const ctx = canvas.getContext(\"2d\", {\n        alpha: false\n      });\n      const [width, height] = exportSettings.resolution.split(\"x\").map(Number);\n      canvas.width = width;\n      canvas.height = height;\n      ctx.fillStyle = \"#000000\";\n      ctx.fillRect(0, 0, width, height);\n      const totalDuration = calculateTotalDuration();\n      const previewTime = totalDuration / 4; // –ß–µ—Ç–≤–µ—Ä—Ç—å –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n\n      console.log(`üñºÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–≤—å—é –Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ ${previewTime.toFixed(1)}s`);\n      await renderFrame(ctx, previewTime, width, height);\n      canvas.toBlob(blob => {\n        if (blob) {\n          const url = URL.createObjectURL(blob);\n          setPreviewFrame(url);\n          console.log(`‚úÖ –ü—Ä–µ–≤—å—é —Å–æ–∑–¥–∞–Ω–æ: ${(blob.size / 1024).toFixed(1)}KB`);\n        }\n      }, \"image/png\");\n    } catch (error) {\n      console.warn(\"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é:\", error);\n    }\n  };\n  const downloadVideo = async blob => {\n    const filename = `${exportSettings.filename}.${exportSettings.format}`;\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é\n  useEffect(() => {\n    if (isOpen && timelineItems.length > 0 && exportStage === \"ready\") {\n      generatePreviewFrame();\n    }\n  }, [isOpen, timelineItems, exportSettings.resolution, exportStage]);\n  const getStageText = () => {\n    switch (exportStage) {\n      case \"loading\":\n        return \"–ó–∞–≥—Ä—É–∑–∫–∞ FFmpeg...\";\n      case \"preparing\":\n        return \"–ê–Ω–∞–ª–∏–∑ timeline...\";\n      case \"rendering_frames\":\n        return \"–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä–æ–≤...\";\n      case \"processing_audio\":\n        return \"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —Ç—Ä–µ–∫–æ–≤...\";\n      case \"encoding\":\n        return \"–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ...\";\n      case \"downloading\":\n        return \"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...\";\n      case \"completed\":\n        return \"‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è.\";\n      case \"error\":\n        return \"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞\";\n      case \"ready\":\n        return `–ì–æ—Ç–æ–≤ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É (${timelineItems.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)`;\n      default:\n        return \"–û–∂–∏–¥–∞–Ω–∏–µ...\";\n    }\n  };\n  const getStageIcon = () => {\n    switch (exportStage) {\n      case \"completed\":\n        return /*#__PURE__*/_jsxDEV(Check, {\n          size: 20,\n          className: \"text-green-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 664,\n          columnNumber: 32\n        }, this);\n      case \"error\":\n        return /*#__PURE__*/_jsxDEV(AlertCircle, {\n          size: 20,\n          className: \"text-red-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 665,\n          columnNumber: 28\n        }, this);\n      case \"ready\":\n        return /*#__PURE__*/_jsxDEV(Play, {\n          size: 20,\n          className: \"text-blue-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 666,\n          columnNumber: 28\n        }, this);\n      case \"loading\":\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-5 w-5 border-b-2 border-orange-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 667,\n          columnNumber: 30\n        }, this);\n      default:\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 668,\n          columnNumber: 23\n        }, this);\n    }\n  };\n  const canExport = ffmpeg && !isExporting && !isLoading && timelineItems.length > 0 && exportStage === \"ready\";\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[100vh] overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between p-6 border-b border-gray-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold text-gray-800 flex items-center\",\n          children: [/*#__PURE__*/_jsxDEV(Film, {\n            size: 24,\n            className: \"mr-3 text-blue-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 681,\n            columnNumber: 13\n          }, this), \"\\uD83C\\uDFAC \\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E \\u0441 overlay \\u0438 \\u0430\\u0443\\u0434\\u0438\\u043E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"p-2 hover:bg-gray-100 rounded-full transition-colors\",\n          disabled: isExporting,\n          children: /*#__PURE__*/_jsxDEV(X, {\n            size: 20\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 689,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 684,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 679,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6 space-y-6 max-h-[calc(95vh-140px)] overflow-y-auto\",\n        children: [timelineItems.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-red-50 border-2 border-red-300 rounded-xl p-6\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-start\",\n            children: [/*#__PURE__*/_jsxDEV(AlertCircle, {\n              size: 24,\n              className: \"text-red-600 mr-3 mt-0.5 flex-shrink-0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 697,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                className: \"font-bold text-red-800 text-lg mb-2\",\n                children: \"\\u274C \\u041D\\u0415\\u0422 \\u0414\\u0410\\u041D\\u041D\\u042B\\u0425 TIMELINE!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 699,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-red-700 mb-3\",\n                children: \"\\u041A\\u043E\\u043C\\u043F\\u043E\\u043D\\u0435\\u043D\\u0442 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430 \\u043D\\u0435 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0430\\u0435\\u0442 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0438\\u0437 timeline. \\u041F\\u0440\\u043E\\u0432\\u0435\\u0440\\u044C\\u0442\\u0435 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u0447\\u0443 \\u043F\\u0440\\u043E\\u043F\\u0441\\u043E\\u0432.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 700,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 698,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 696,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 695,\n          columnNumber: 13\n        }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-red-50 border border-red-200 rounded-xl p-4\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-start\",\n            children: [/*#__PURE__*/_jsxDEV(AlertCircle, {\n              size: 20,\n              className: \"text-red-600 mr-3 mt-0.5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 711,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                className: \"font-medium text-red-800\",\n                children: \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 713,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm text-red-600 mt-1\",\n                children: error\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 714,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 712,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 710,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `rounded-xl p-4 border ${exportStage === \"error\" ? \"bg-red-50 border-red-200\" : exportStage === \"completed\" ? \"bg-green-50 border-green-200\" : exportStage === \"loading\" ? \"bg-orange-50 border-orange-200\" : \"bg-blue-50 border-blue-200\"}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between mb-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center\",\n              children: [getStageIcon(), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: `ml-3 font-medium ${exportStage === \"error\" ? \"text-red-900\" : exportStage === \"completed\" ? \"text-green-900\" : exportStage === \"loading\" ? \"text-orange-900\" : \"text-blue-900\"}`,\n                children: getStageText()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 729,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 727,\n              columnNumber: 15\n            }, this), (isExporting || isLoading) && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `text-sm font-medium ${exportStage === \"loading\" ? \"text-orange-700\" : \"text-blue-700\"}`,\n              children: [exportProgress, \"%\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 739,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 726,\n            columnNumber: 13\n          }, this), (isExporting || isLoading) && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `w-full rounded-full h-2 ${exportStage === \"loading\" ? \"bg-orange-200\" : \"bg-blue-200\"}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `h-2 rounded-full transition-all duration-300 ${exportStage === \"loading\" ? \"bg-orange-600\" : \"bg-blue-600\"}`,\n              style: {\n                width: `${exportProgress}%`\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 750,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 747,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 720,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-50 rounded-xl p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-sm font-medium text-gray-700 mb-3 flex items-center\",\n            children: [/*#__PURE__*/_jsxDEV(Settings, {\n              size: 16,\n              className: \"mr-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 762,\n              columnNumber: 15\n            }, this), \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 761,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-xs font-medium text-gray-700 mb-1\",\n                children: \"\\u0420\\u0430\\u0437\\u0440\\u0435\\u0448\\u0435\\u043D\\u0438\\u0435\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 767,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                value: exportSettings.resolution,\n                onChange: e => setExportSettings(prev => ({\n                  ...prev,\n                  resolution: e.target.value\n                })),\n                className: \"w-full p-2 text-sm border border-gray-300 rounded-lg\",\n                disabled: isExporting || isLoading,\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"640x480\",\n                  children: \"480p (\\u0431\\u044B\\u0441\\u0442\\u0440\\u043E)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 774,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"1280x720\",\n                  children: \"720p (\\u0440\\u0435\\u043A\\u043E\\u043C\\u0435\\u043D\\u0434\\u0443\\u0435\\u0442\\u0441\\u044F)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 775,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"1920x1080\",\n                  children: \"1080p (\\u043C\\u0435\\u0434\\u043B\\u0435\\u043D\\u043D\\u043E)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 776,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 768,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 766,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-xs font-medium text-gray-700 mb-1\",\n                children: \"FPS\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 781,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                value: exportSettings.fps,\n                onChange: e => setExportSettings(prev => ({\n                  ...prev,\n                  fps: parseInt(e.target.value)\n                })),\n                className: \"w-full p-2 text-sm border border-gray-300 rounded-lg\",\n                disabled: isExporting || isLoading,\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"24\",\n                  children: \"24 FPS (\\u0441\\u0442\\u0430\\u043D\\u0434\\u0430\\u0440\\u0442)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 788,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"30\",\n                  children: \"30 FPS (\\u043F\\u043B\\u0430\\u0432\\u043D\\u043E)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 789,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"60\",\n                  children: \"60 FPS (\\u043E\\u0447\\u0435\\u043D\\u044C \\u043F\\u043B\\u0430\\u0432\\u043D\\u043E)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 790,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 782,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 780,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-xs font-medium text-gray-700 mb-1\",\n                children: \"\\u0412\\u043A\\u043B\\u044E\\u0447\\u0438\\u0442\\u044C \\u0430\\u0443\\u0434\\u0438\\u043E\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 795,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"flex items-center space-x-2\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: exportSettings.includeAudio,\n                  onChange: e => setExportSettings(prev => ({\n                    ...prev,\n                    includeAudio: e.target.checked\n                  })),\n                  disabled: isExporting || isLoading,\n                  className: \"rounded\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 797,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-sm\",\n                  children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0437\\u0432\\u0443\\u043A \\u0432 \\u0432\\u0438\\u0434\\u0435\\u043E\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 804,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 796,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 794,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-xs font-medium text-gray-700 mb-1\",\n                children: \"\\u0418\\u043C\\u044F \\u0444\\u0430\\u0439\\u043B\\u0430\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 809,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: exportSettings.filename,\n                onChange: e => setExportSettings(prev => ({\n                  ...prev,\n                  filename: e.target.value\n                })),\n                className: \"w-full p-2 text-sm border border-gray-300 rounded-lg\",\n                disabled: isExporting || isLoading\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 810,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 808,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 765,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 11\n        }, this), timelineItems.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-blue-50 border border-blue-200 rounded-xl p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"font-medium text-blue-800 mb-2\",\n            children: \"\\uD83D\\uDCCA \\u0414\\u0438\\u0430\\u0433\\u043D\\u043E\\u0441\\u0442\\u0438\\u043A\\u0430 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 823,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-blue-700 space-y-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u042D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432 timeline:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 825,\n                columnNumber: 20\n              }, this), \" \", timelineItems.length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 825,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u0418\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0439:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 826,\n                columnNumber: 20\n              }, this), \" \", timelineItems.filter(item => item.type !== \"videos\" && item.trackType !== \"audio\").length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 826,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u0412\\u0438\\u0434\\u0435\\u043E:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 827,\n                columnNumber: 20\n              }, this), \" \", timelineItems.filter(item => item.type === \"videos\").length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 827,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u0410\\u0443\\u0434\\u0438\\u043E:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 828,\n                columnNumber: 20\n              }, this), \" \", timelineItems.filter(item => item.trackType === \"audio\").length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 828,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u0420\\u0430\\u0441\\u0447\\u0435\\u0442\\u043D\\u0430\\u044F \\u0434\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 829,\n                columnNumber: 20\n              }, this), \" \", calculateTotalDuration().toFixed(1), \"s\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 829,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Overlay \\u043A\\u043E\\u043E\\u0440\\u0434\\u0438\\u043D\\u0430\\u0442:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 830,\n                columnNumber: 20\n              }, this), \" \", Object.keys(overlayTransforms).length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 830,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 824,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 822,\n          columnNumber: 13\n        }, this), exportStage === \"ready\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-50 rounded-xl p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-sm font-medium text-gray-700 mb-3\",\n            children: \"\\u041F\\u0440\\u0435\\u0432\\u044C\\u044E \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 837,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex gap-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-black rounded-lg aspect-video flex items-center justify-center overflow-hidden relative\",\n                children: [previewFrame ? /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: previewFrame,\n                  alt: \"Preview\",\n                  className: \"max-w-full max-h-full object-contain\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 842,\n                  columnNumber: 23\n                }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-white text-sm\",\n                  children: \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u043D\\u0438\\u0435 \\u043F\\u0440\\u0435\\u0432\\u044C\\u044E...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 844,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: generatePreviewFrame,\n                  className: \"absolute top-2 right-2 px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700\",\n                  children: \"\\u041E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u043F\\u0440\\u0435\\u0432\\u044C\\u044E\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 846,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 840,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 839,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-48 space-y-2 text-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-600\",\n                  children: \"\\u0420\\u0430\\u0437\\u0440\\u0435\\u0448\\u0435\\u043D\\u0438\\u0435:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 856,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"font-medium\",\n                  children: exportSettings.resolution\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 857,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 855,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-600\",\n                  children: \"FPS:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 860,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"font-medium\",\n                  children: exportSettings.fps\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 861,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 859,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-600\",\n                  children: \"\\u0410\\u0443\\u0434\\u0438\\u043E:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 864,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"font-medium\",\n                  children: exportSettings.includeAudio ? \"–í–∫–ª—é—á–µ–Ω–æ\" : \"–û—Ç–∫–ª—é—á–µ–Ω–æ\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 865,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 863,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-gray-600\",\n                  children: \"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 868,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"font-medium\",\n                  children: [Math.round(calculateTotalDuration()), \"s\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 869,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 867,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 854,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 838,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 693,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-xs text-gray-500\",\n          children: exportStage === \"ready\" && timelineItems.length > 0 ? `–ì–æ—Ç–æ–≤ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É ‚Ä¢ ${timelineItems.filter(i => i.trackType === \"audio\").length} –∞—É–¥–∏–æ ‚Ä¢ ${timelineItems.filter(item => item.type !== \"videos\" && item.trackType !== \"audio\").length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π` : exportStage === \"loading\" ? \"–ó–∞–≥—Ä—É–∑–∫–∞ FFmpeg...\" : \"–î–æ–±–∞–≤—å—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ —Ç–∞–π–º–ª–∞–π–Ω\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 878,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: onClose,\n            className: \"px-6 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\",\n            disabled: isExporting,\n            children: \"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 886,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: startExport,\n            disabled: !canExport,\n            className: `px-6 py-2 text-sm rounded-lg font-medium transition-all flex items-center ${!canExport ? \"bg-gray-300 text-gray-500 cursor-not-allowed\" : \"bg-green-600 text-white hover:bg-green-700 shadow-lg\"}`,\n            children: isExporting ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 904,\n                columnNumber: 19\n              }, this), \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442... \", exportProgress, \"%\"]\n            }, void 0, true) : isLoading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 909,\n                columnNumber: 19\n              }, this), \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Download, {\n                size: 16,\n                className: \"mr-2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 914,\n                columnNumber: 19\n              }, this), \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E\"]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 893,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 885,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 877,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        style: {\n          display: \"none\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 922,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: previewCanvasRef,\n        style: {\n          display: \"none\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 923,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 678,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 677,\n    columnNumber: 5\n  }, this);\n};\n_s(FFmpegVideoExporter, \"rv9m8LctIQlmIlq4bV0W1iuTpVk=\");\n_c = FFmpegVideoExporter;\nexport const useFFmpegExporter = () => {\n  _s2();\n  const [isExportModalOpen, setIsExportModalOpen] = useState(false);\n  const openExportModal = () => setIsExportModalOpen(true);\n  const closeExportModal = () => setIsExportModalOpen(false);\n  return {\n    isExportModalOpen,\n    openExportModal,\n    closeExportModal\n  };\n};\n_s2(useFFmpegExporter, \"Wfaj4kprhDIijrMYdBElG6JtIdM=\");\nexport default FFmpegVideoExporter;\nvar _c;\n$RefreshReg$(_c, \"FFmpegVideoExporter\");","map":{"version":3,"names":["React","useState","useRef","useEffect","X","Download","Check","AlertCircle","Settings","Play","Film","jsxDEV","_jsxDEV","Fragment","_Fragment","FFmpegVideoExporter","isOpen","onClose","timelineItems","videoDuration","overlayTransforms","_s","ffmpeg","setFfmpeg","isLoading","setIsLoading","isExporting","setIsExporting","exportProgress","setExportProgress","exportStage","setExportStage","error","setError","exportedBlob","setExportedBlob","previewFrame","setPreviewFrame","exportSettings","setExportSettings","resolution","fps","duration","Math","min","includeAudio","filename","Date","now","format","canvasRef","previewCanvasRef","mediaCache","Map","calculateTotalDuration","length","maxEndTime","max","map","item","startTime","calculatedDuration","console","log","toFixed","initFFmpeg","ffmpegModule","utilModule","FFmpegClass","FFmpeg","fetchFile","ffmpegInstance","load","coreURL","wasmURL","on","progress","adjustedProgress","round","window","message","loadMediaWithCache","cacheKey","id","url","current","has","get","Promise","resolve","reject","timeout","setTimeout","Error","isVideo","type","trackType","video","document","createElement","startsWith","crossOrigin","muted","preload","onloadedmetadata","clearTimeout","set","name","onerror","src","img","Image","onload","renderFrame","ctx","currentTime","width","height","fillStyle","fillRect","activeItems","filter","start","end","isActive","isNotAudio","font","textAlign","textBaseline","fillText","sortedItems","sort","a","b","layerOrder","main","overlay","audio","element","save","tagName","relativeTime","targetTime","abs","checkReady","readyState","drawX","drawY","drawWidth","drawHeight","elementWidth","videoWidth","naturalWidth","elementHeight","videoHeight","naturalHeight","canvasRatio","elementRatio","overlayCoords","baseX","x","baseY","y","scale","opacity","scaleX","scaleY","globalAlpha","uiX","uiY","uiWidth","uiHeight","uiScale","rotation","centerX","centerY","translate","rotate","PI","imageSmoothingEnabled","imageSmoothingQuality","drawImage","restore","prepareAudio","audioItems","audioFiles","i","response","fetch","ok","status","blob","push","index","warn","createFrames","canvas","getContext","alpha","split","Number","totalFrames","ceil","frames","maxFrames","frame","hasImages","some","toBlob","size","encodeVideo","frameData","toString","padStart","writeFile","audioFile","audioFileName","args","filterComplex","_","join","exec","data","readFile","videoBlob","Blob","buffer","cleanupTempFiles","e","frameCount","audioCount","deleteFile","startExport","totalDuration","maxDuration","actualDuration","downloadVideo","generatePreviewFrame","previewTime","URL","createObjectURL","href","download","body","appendChild","click","removeChild","revokeObjectURL","getStageText","getStageIcon","className","fileName","_jsxFileName","lineNumber","columnNumber","canExport","children","onClick","disabled","style","value","onChange","prev","target","parseInt","checked","Object","keys","alt","ref","display","_c","useFFmpegExporter","_s2","isExportModalOpen","setIsExportModalOpen","openExportModal","closeExportModal","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/FFmpegVideoExporter/index.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport {\r\n  X,\r\n  Download,\r\n  Check,\r\n  AlertCircle,\r\n  Settings,\r\n  Play,\r\n  Film,\r\n} from \"lucide-react\";\r\n\r\nconst FFmpegVideoExporter = ({\r\n  isOpen,\r\n  onClose,\r\n  timelineItems = [],\r\n  videoDuration = 60,\r\n  overlayTransforms = {},\r\n}) => {\r\n  const [ffmpeg, setFfmpeg] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [exportProgress, setExportProgress] = useState(0);\r\n  const [exportStage, setExportStage] = useState(\"idle\");\r\n  const [error, setError] = useState(null);\r\n  const [exportedBlob, setExportedBlob] = useState(null);\r\n  const [previewFrame, setPreviewFrame] = useState(null);\r\n\r\n  const [exportSettings, setExportSettings] = useState({\r\n    resolution: \"1280x720\",\r\n    fps: 24,\r\n    duration: Math.min(videoDuration, 30),\r\n    includeAudio: true,\r\n    filename: `video_${Date.now()}`,\r\n    format: \"mp4\",\r\n  });\r\n\r\n  const canvasRef = useRef(null);\r\n  const previewCanvasRef = useRef(null);\r\n  const mediaCache = useRef(new Map());\r\n\r\n  // –†–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\r\n  const calculateTotalDuration = () => {\r\n    if (timelineItems.length === 0) return videoDuration;\r\n\r\n    const maxEndTime = Math.max(\r\n      ...timelineItems.map(\r\n        (item) => (item.startTime || 0) + (item.duration || 0)\r\n      )\r\n    );\r\n\r\n    const calculatedDuration = Math.max(maxEndTime, videoDuration);\r\n    console.log(`‚è±Ô∏è –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${calculatedDuration.toFixed(2)}s`);\r\n    return calculatedDuration;\r\n  };\r\n\r\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg\r\n  useEffect(() => {\r\n    const initFFmpeg = async () => {\r\n      if (ffmpeg || !isOpen) return;\r\n\r\n      setIsLoading(true);\r\n      setExportStage(\"loading\");\r\n      setError(null);\r\n\r\n      try {\r\n        console.log(\"üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FFmpeg...\");\r\n\r\n        const ffmpegModule = await import(\"@ffmpeg/ffmpeg\");\r\n        const utilModule = await import(\"@ffmpeg/util\");\r\n\r\n        const FFmpegClass = ffmpegModule.FFmpeg;\r\n        const fetchFile = utilModule.fetchFile;\r\n\r\n        const ffmpegInstance = new FFmpegClass();\r\n\r\n        await ffmpegInstance.load({\r\n          coreURL: \"https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.js\",\r\n          wasmURL: \"https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.wasm\",\r\n        });\r\n\r\n        ffmpegInstance.on(\"progress\", ({ progress }) => {\r\n          if (isExporting) {\r\n            const adjustedProgress = 70 + Math.round(progress * 25);\r\n            setExportProgress(Math.min(adjustedProgress, 95));\r\n          }\r\n        });\r\n\r\n        window.fetchFile = fetchFile;\r\n        setFfmpeg(ffmpegInstance);\r\n        setExportStage(\"ready\");\r\n        console.log(\"‚úÖ FFmpeg –≥–æ—Ç–æ–≤\");\r\n      } catch (error) {\r\n        console.error(\"‚ùå –û—à–∏–±–∫–∞ FFmpeg:\", error);\r\n        setError(error.message);\r\n        setExportStage(\"error\");\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      initFFmpeg();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞\r\n  const loadMediaWithCache = async (item) => {\r\n    const cacheKey = `${item.id}_${item.url}`;\r\n    if (mediaCache.current.has(cacheKey)) {\r\n      return mediaCache.current.get(cacheKey);\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const timeout = setTimeout(() => reject(new Error(\"Timeout\")), 5000);\r\n      const isVideo = item.type === \"videos\" || item.trackType === \"main\";\r\n\r\n      if (isVideo) {\r\n        const video = document.createElement(\"video\");\r\n        if (!item.url.startsWith(\"blob:\")) {\r\n          video.crossOrigin = \"anonymous\";\r\n        }\r\n        video.muted = true;\r\n        video.preload = \"metadata\";\r\n        video.onloadedmetadata = () => {\r\n          clearTimeout(timeout);\r\n          mediaCache.current.set(cacheKey, video);\r\n          console.log(`‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name}`);\r\n          resolve(video);\r\n        };\r\n        video.onerror = () => {\r\n          clearTimeout(timeout);\r\n          reject(new Error(\"Video failed\"));\r\n        };\r\n        video.src = item.url;\r\n      } else {\r\n        const img = new Image();\r\n        if (!item.url.startsWith(\"blob:\")) {\r\n          img.crossOrigin = \"anonymous\";\r\n        }\r\n        img.onload = () => {\r\n          clearTimeout(timeout);\r\n          mediaCache.current.set(cacheKey, img);\r\n          console.log(`‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${item.name}`);\r\n          resolve(img);\r\n        };\r\n        img.onerror = () => {\r\n          clearTimeout(timeout);\r\n          reject(new Error(\"Image failed\"));\r\n        };\r\n        img.src = item.url;\r\n      }\r\n    });\r\n  };\r\n\r\n  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä–∞\r\n  const renderFrame = async (ctx, currentTime, width, height) => {\r\n    ctx.fillStyle = \"#000000\";\r\n    ctx.fillRect(0, 0, width, height);\r\n\r\n    console.log(`üé¨ –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–¥—Ä –Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ ${currentTime.toFixed(1)}s`);\r\n\r\n    // –ê–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã\r\n    const activeItems = timelineItems.filter((item) => {\r\n      const start = item.startTime || 0;\r\n      const end = start + (item.duration || 0);\r\n      const isActive = currentTime >= start && currentTime <= end;\r\n      const isNotAudio = item.trackType !== \"audio\";\r\n      \r\n      console.log(`   üì∫ \"${item.name}\": ${start.toFixed(1)}s - ${end.toFixed(1)}s ‚Üí ${isActive ? \"‚úÖ –ê–ö–¢–ò–í–ï–ù\" : \"‚ùå –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω\"}`);\r\n      return isActive && isNotAudio;\r\n    });\r\n\r\n    console.log(`üìã –ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${activeItems.length}/${timelineItems.length}`);\r\n\r\n    if (activeItems.length === 0) {\r\n      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º—è –µ—Å–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤\r\n      ctx.fillStyle = \"#333333\";\r\n      ctx.fillRect(0, 0, width, height);\r\n      ctx.fillStyle = \"#ffffff\";\r\n      ctx.font = `${Math.min(48, width / 20)}px Arial`;\r\n      ctx.textAlign = \"center\";\r\n      ctx.textBaseline = \"middle\";\r\n      ctx.fillText(`–í—Ä–µ–º—è: ${currentTime.toFixed(1)}s`, width / 2, height / 2 - 30);\r\n      ctx.fillText(`–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤`, width / 2, height / 2 + 30);\r\n      return;\r\n    }\r\n\r\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: main —Å–Ω–∞—á–∞–ª–∞, overlay –ø–æ—Ç–æ–º\r\n    const sortedItems = activeItems.sort((a, b) => {\r\n      const layerOrder = { main: 1, overlay: 2, audio: 0 };\r\n      return (layerOrder[a.trackType] || 1) - (layerOrder[b.trackType] || 1);\r\n    });\r\n\r\n    // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç\r\n    for (const item of sortedItems) {\r\n      if (item.trackType === \"audio\") continue;\r\n\r\n      try {\r\n        const element = await loadMediaWithCache(item);\r\n        if (!element) continue;\r\n\r\n        ctx.save();\r\n\r\n        // –í–∏–¥–µ–æ –≤—Ä–µ–º—è\r\n        if (element.tagName === \"VIDEO\") {\r\n          const relativeTime = currentTime - (item.startTime || 0);\r\n          const targetTime = Math.max(0, relativeTime);\r\n\r\n          if (Math.abs(element.currentTime - targetTime) > 0.1) {\r\n            element.currentTime = targetTime;\r\n            await new Promise((resolve) => {\r\n              const checkReady = () => {\r\n                if (element.readyState >= 2) {\r\n                  resolve();\r\n                } else {\r\n                  setTimeout(checkReady, 10);\r\n                }\r\n              };\r\n              checkReady();\r\n              setTimeout(resolve, 200);\r\n            });\r\n          }\r\n        }\r\n\r\n        let drawX, drawY, drawWidth, drawHeight;\r\n\r\n        if (item.trackType === \"main\") {\r\n          // –û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ - –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ\r\n          const elementWidth = element.videoWidth || element.naturalWidth || element.width;\r\n          const elementHeight = element.videoHeight || element.naturalHeight || element.height;\r\n          \r\n          if (elementWidth && elementHeight) {\r\n            const canvasRatio = width / height;\r\n            const elementRatio = elementWidth / elementHeight;\r\n\r\n            if (elementRatio > canvasRatio) {\r\n              drawWidth = width;\r\n              drawHeight = width / elementRatio;\r\n              drawX = 0;\r\n              drawY = (height - drawHeight) / 2;\r\n            } else {\r\n              drawHeight = height;\r\n              drawWidth = height * elementRatio;\r\n              drawX = (width - drawWidth) / 2;\r\n              drawY = 0;\r\n            }\r\n          } else {\r\n            drawX = 0;\r\n            drawY = 0;\r\n            drawWidth = width;\r\n            drawHeight = height;\r\n          }\r\n\r\n          console.log(`üì∫ –û—Å–Ω–æ–≤–Ω–æ–µ –≤–∏–¥–µ–æ: pos(${drawX.toFixed(0)}, ${drawY.toFixed(0)}) size(${drawWidth.toFixed(0)}x${drawHeight.toFixed(0)})`);\r\n          \r\n        } else if (item.trackType === \"overlay\") {\r\n          // Overlay —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏\r\n          const overlayCoords = overlayTransforms[item.id];\r\n          \r\n          if (overlayCoords) {\r\n            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ VideoEditor\r\n            const baseX = 200 + (overlayCoords.x || 0);\r\n            const baseY = 50 + (overlayCoords.y || 0);\r\n            const scale = overlayCoords.scale || 1;\r\n            const opacity = overlayCoords.opacity || 1;\r\n            \r\n            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø–æ–¥ —ç–∫—Å–ø–æ—Ä—Ç\r\n            const scaleX = width / 1920;\r\n            const scaleY = height / 1080;\r\n            \r\n            drawX = baseX * scaleX;\r\n            drawY = baseY * scaleY;\r\n            drawWidth = 256 * scale * scaleX; // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä\r\n            drawHeight = 192 * scale * scaleY;\r\n            \r\n            ctx.globalAlpha = opacity;\r\n            console.log(`üñºÔ∏è Overlay —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏: pos(${drawX.toFixed(0)}, ${drawY.toFixed(0)}) size(${drawWidth.toFixed(0)}x${drawHeight.toFixed(0)}) opacity(${opacity})`);\r\n          } else {\r\n            // Fallback –ø–æ–∑–∏—Ü–∏—è\r\n            const uiX = item.x || 0;\r\n            const uiY = item.y || 0;\r\n            const uiWidth = item.width || 200;\r\n            const uiHeight = item.height || 150;\r\n            const uiScale = item.scale || 1;\r\n\r\n            const scaleX = width / 1920;\r\n            const scaleY = height / 1080;\r\n\r\n            drawX = uiX * scaleX;\r\n            drawY = uiY * scaleY;\r\n            drawWidth = uiWidth * scaleX * uiScale;\r\n            drawHeight = uiHeight * scaleY * uiScale;\r\n            \r\n            console.log(`üñºÔ∏è Overlay fallback: pos(${drawX.toFixed(0)}, ${drawY.toFixed(0)}) size(${drawWidth.toFixed(0)}x${drawHeight.toFixed(0)})`);\r\n          }\r\n        }\r\n\r\n        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–≤–æ—Ä–æ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å\r\n        if (item.rotation && item.rotation !== 0) {\r\n          const centerX = drawX + drawWidth / 2;\r\n          const centerY = drawY + drawHeight / 2;\r\n          ctx.translate(centerX, centerY);\r\n          ctx.rotate((item.rotation * Math.PI) / 180);\r\n          ctx.translate(-centerX, -centerY);\r\n        }\r\n\r\n        // –†–∏—Å—É–µ–º —ç–ª–µ–º–µ–Ω—Ç\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = \"high\";\r\n        ctx.drawImage(element, drawX, drawY, drawWidth, drawHeight);\r\n\r\n        ctx.restore();\r\n        \r\n      } catch (error) {\r\n        console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ ${item.name}:`, error);\r\n      }\r\n    }\r\n  };\r\n\r\n  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ\r\n  const prepareAudio = async () => {\r\n    if (!exportSettings.includeAudio) return [];\r\n\r\n    const audioItems = timelineItems.filter(\r\n      (item) => item.trackType === \"audio\"\r\n    );\r\n\r\n    const audioFiles = [];\r\n\r\n    for (let i = 0; i < Math.min(audioItems.length, 3); i++) {\r\n      const item = audioItems[i];\r\n      try {\r\n        const response = await fetch(item.url);\r\n        if (!response.ok) throw new Error(`HTTP ${response.status}`);\r\n\r\n        const blob = await response.blob();\r\n        audioFiles.push({\r\n          blob,\r\n          startTime: item.startTime || 0,\r\n          duration: item.duration || videoDuration,\r\n          name: item.name,\r\n          index: i,\r\n        });\r\n        console.log(`‚úÖ –ê—É–¥–∏–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ: ${item.name}`);\r\n      } catch (error) {\r\n        console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ ${item.name}:`, error);\r\n      }\r\n    }\r\n\r\n    return audioFiles;\r\n  };\r\n\r\n  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–¥—Ä–æ–≤\r\n  const createFrames = async (duration) => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) throw new Error(\"Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω\");\r\n\r\n    const ctx = canvas.getContext(\"2d\", { alpha: false });\r\n    const [width, height] = exportSettings.resolution.split(\"x\").map(Number);\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    console.log(`üéûÔ∏è –ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä–æ–≤: ${width}x${height}`);\r\n\r\n    const totalFrames = Math.ceil(duration * exportSettings.fps);\r\n    const frames = [];\r\n    const maxFrames = Math.min(totalFrames, 600);\r\n\r\n    for (let frame = 0; frame < maxFrames; frame++) {\r\n      const currentTime = frame / exportSettings.fps;\r\n      if (currentTime >= duration) break;\r\n\r\n      try {\r\n        ctx.fillStyle = \"#000000\";\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        await renderFrame(ctx, currentTime, width, height);\r\n\r\n        const blob = await new Promise((resolve) => {\r\n          const hasImages = timelineItems.some(\r\n            (item) => item.type !== \"videos\" && item.trackType !== \"audio\"\r\n          );\r\n          \r\n          if (hasImages) {\r\n            canvas.toBlob(resolve, \"image/png\");\r\n          } else {\r\n            canvas.toBlob(resolve, \"image/jpeg\", 0.85);\r\n          }\r\n        });\r\n\r\n        if (blob) {\r\n          frames.push(blob);\r\n          if (frame === 0) {\r\n            console.log(`üñºÔ∏è –ü–µ—Ä–≤—ã–π –∫–∞–¥—Ä: ${blob.type}, —Ä–∞–∑–º–µ—Ä: ${(blob.size / 1024).toFixed(1)}KB`);\r\n          }\r\n        }\r\n\r\n        const progress = 15 + Math.round((frame / maxFrames) * 35);\r\n        setExportProgress(progress);\r\n\r\n        if (frame % 100 === 0) {\r\n          await new Promise((resolve) => setTimeout(resolve, 1));\r\n        }\r\n      } catch (error) {\r\n        console.error(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–¥—Ä–∞ ${frame}:`, error);\r\n        break;\r\n      }\r\n    }\r\n\r\n    console.log(`‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω: ${frames.length} –∫–∞–¥—Ä–æ–≤`);\r\n    return frames;\r\n  };\r\n\r\n  // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ\r\n  const encodeVideo = async (frames, audioFiles, duration) => {\r\n    if (!window.fetchFile || frames.length === 0) {\r\n      throw new Error(\"–ù–µ—Ç –∫–∞–¥—Ä–æ–≤ –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è\");\r\n    }\r\n\r\n    try {\r\n      const hasImages = timelineItems.some(\r\n        (item) => item.type !== \"videos\" && item.trackType !== \"audio\"\r\n      );\r\n\r\n      console.log(`üì¶ –ö–æ–¥–∏—Ä—É–µ–º ${frames.length} –∫–∞–¥—Ä–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${hasImages}`);\r\n\r\n      // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–∞–¥—Ä—ã\r\n      for (let i = 0; i < frames.length; i++) {\r\n        const frameData = await window.fetchFile(frames[i]);\r\n\r\n        if (hasImages) {\r\n          const filename = `frame_${i.toString().padStart(6, \"0\")}.png`;\r\n          await ffmpeg.writeFile(filename, frameData);\r\n        } else {\r\n          const filename = `frame_${i.toString().padStart(6, \"0\")}.jpg`;\r\n          await ffmpeg.writeFile(filename, frameData);\r\n        }\r\n\r\n        if (i % 50 === 0) {\r\n          const progress = 60 + Math.round((i / frames.length) * 10);\r\n          setExportProgress(progress);\r\n        }\r\n      }\r\n\r\n      // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∞—É–¥–∏–æ\r\n      for (let i = 0; i < audioFiles.length; i++) {\r\n        const audioFile = audioFiles[i];\r\n        const audioFileName = `audio_${i}.mp3`;\r\n        await ffmpeg.writeFile(audioFileName, await window.fetchFile(audioFile.blob));\r\n      }\r\n\r\n      setExportProgress(70);\r\n\r\n      // FFmpeg –∫–æ–º–∞–Ω–¥–∞\r\n      const args = [\"-framerate\", exportSettings.fps.toString()];\r\n\r\n      if (hasImages) {\r\n        args.push(\"-i\", \"frame_%06d.png\");\r\n      } else {\r\n        args.push(\"-i\", \"frame_%06d.jpg\");\r\n      }\r\n\r\n      args.push(\"-t\", Math.min(duration, frames.length / exportSettings.fps).toString());\r\n\r\n      // –ê—É–¥–∏–æ\r\n      if (audioFiles.length > 0) {\r\n        args.push(\"-i\", \"audio_0.mp3\");\r\n\r\n        if (audioFiles.length > 1) {\r\n          for (let i = 1; i < audioFiles.length; i++) {\r\n            args.push(\"-i\", `audio_${i}.mp3`);\r\n          }\r\n\r\n          const filterComplex =\r\n            audioFiles.map((_, i) => `[${i + 1}:a]`).join(\"\") +\r\n            `amix=inputs=${audioFiles.length}:duration=shortest:dropout_transition=0.5[aout]`;\r\n\r\n          args.push(\"-filter_complex\", filterComplex);\r\n          args.push(\"-map\", \"0:v\");\r\n          args.push(\"-map\", \"[aout]\");\r\n        } else {\r\n          args.push(\"-c:a\", \"aac\");\r\n          args.push(\"-b:a\", \"128k\");\r\n          args.push(\"-ar\", \"44100\");\r\n        }\r\n\r\n        args.push(\"-shortest\");\r\n      }\r\n\r\n      // –í–∏–¥–µ–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\r\n      args.push(\r\n        \"-c:v\", \"libx264\",\r\n        \"-profile:v\", \"main\",\r\n        \"-level\", \"3.1\",\r\n        \"-preset\", \"medium\",\r\n        \"-crf\", \"23\",\r\n        \"-pix_fmt\", \"yuv420p\",\r\n        \"-vf\", \"format=yuv420p,scale=trunc(iw/2)*2:trunc(ih/2)*2\",\r\n        \"-movflags\", \"+faststart\",\r\n        \"-tune\", hasImages ? \"stillimage\" : \"film\",\r\n        \"output.mp4\"\r\n      );\r\n\r\n      console.log(\"üîß –ö–æ–º–∞–Ω–¥–∞ FFmpeg:\", args.join(\" \"));\r\n\r\n      await ffmpeg.exec(args);\r\n\r\n      setExportProgress(90);\r\n\r\n      const data = await ffmpeg.readFile(\"output.mp4\");\r\n      const videoBlob = new Blob([data.buffer], { type: \"video/mp4\" });\r\n\r\n      // –û—á–∏—Å—Ç–∫–∞\r\n      await cleanupTempFiles(frames.length, audioFiles.length);\r\n      return videoBlob;\r\n    } catch (error) {\r\n      try {\r\n        await cleanupTempFiles(frames.length, audioFiles.length);\r\n      } catch (e) {}\r\n      throw new Error(`–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  // –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤\r\n  const cleanupTempFiles = async (frameCount, audioCount) => {\r\n    for (let i = 0; i < frameCount; i++) {\r\n      try {\r\n        await ffmpeg.deleteFile(`frame_${i.toString().padStart(6, \"0\")}.png`);\r\n      } catch (e) {}\r\n      try {\r\n        await ffmpeg.deleteFile(`frame_${i.toString().padStart(6, \"0\")}.jpg`);\r\n      } catch (e) {}\r\n    }\r\n\r\n    for (let i = 0; i < audioCount; i++) {\r\n      try {\r\n        await ffmpeg.deleteFile(`audio_${i}.mp3`);\r\n      } catch (e) {}\r\n    }\r\n\r\n    try {\r\n      await ffmpeg.deleteFile(\"output.mp4\");\r\n    } catch (e) {}\r\n  };\r\n\r\n  // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n  const startExport = async () => {\r\n    if (!ffmpeg || isExporting || timelineItems.length === 0) return;\r\n\r\n    setIsExporting(true);\r\n    setExportProgress(0);\r\n    setExportStage(\"preparing\");\r\n    setError(null);\r\n\r\n    try {\r\n      console.log(\"üé¨ –ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç\");\r\n\r\n      const totalDuration = calculateTotalDuration();\r\n      const maxDuration = Math.min(totalDuration, 120);\r\n      const actualDuration = maxDuration;\r\n\r\n      setExportStage(\"rendering_frames\");\r\n      const frames = await createFrames(actualDuration);\r\n      setExportProgress(50);\r\n\r\n      setExportStage(\"processing_audio\");\r\n      const audioFiles = await prepareAudio();\r\n      setExportProgress(60);\r\n\r\n      setExportStage(\"encoding\");\r\n      const videoBlob = await encodeVideo(frames, audioFiles, actualDuration);\r\n\r\n      setExportProgress(95);\r\n\r\n      setExportStage(\"downloading\");\r\n      await downloadVideo(videoBlob);\r\n      setExportProgress(100);\r\n\r\n      setExportStage(\"completed\");\r\n      setExportedBlob(videoBlob);\r\n      \r\n      setTimeout(() => {\r\n        setExportStage(\"ready\");\r\n        setExportProgress(0);\r\n      }, 3000);\r\n    } catch (error) {\r\n      console.error(\"‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:\", error);\r\n      setError(error.message);\r\n      setExportStage(\"error\");\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  };\r\n\r\n  // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é\r\n  const generatePreviewFrame = async () => {\r\n    try {\r\n      const canvas = previewCanvasRef.current;\r\n      if (!canvas) return;\r\n\r\n      const ctx = canvas.getContext(\"2d\", { alpha: false });\r\n      const [width, height] = exportSettings.resolution.split(\"x\").map(Number);\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n\r\n      ctx.fillStyle = \"#000000\";\r\n      ctx.fillRect(0, 0, width, height);\r\n\r\n      const totalDuration = calculateTotalDuration();\r\n      const previewTime = totalDuration / 4; // –ß–µ—Ç–≤–µ—Ä—Ç—å –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\r\n\r\n      console.log(`üñºÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–≤—å—é –Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ ${previewTime.toFixed(1)}s`);\r\n\r\n      await renderFrame(ctx, previewTime, width, height);\r\n\r\n      canvas.toBlob((blob) => {\r\n        if (blob) {\r\n          const url = URL.createObjectURL(blob);\r\n          setPreviewFrame(url);\r\n          console.log(`‚úÖ –ü—Ä–µ–≤—å—é —Å–æ–∑–¥–∞–Ω–æ: ${(blob.size / 1024).toFixed(1)}KB`);\r\n        }\r\n      }, \"image/png\");\r\n    } catch (error) {\r\n      console.warn(\"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é:\", error);\r\n    }\r\n  };\r\n\r\n  const downloadVideo = async (blob) => {\r\n    const filename = `${exportSettings.filename}.${exportSettings.format}`;\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = filename;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é\r\n  useEffect(() => {\r\n    if (isOpen && timelineItems.length > 0 && exportStage === \"ready\") {\r\n      generatePreviewFrame();\r\n    }\r\n  }, [isOpen, timelineItems, exportSettings.resolution, exportStage]);\r\n\r\n  const getStageText = () => {\r\n    switch (exportStage) {\r\n      case \"loading\": return \"–ó–∞–≥—Ä—É–∑–∫–∞ FFmpeg...\";\r\n      case \"preparing\": return \"–ê–Ω–∞–ª–∏–∑ timeline...\";\r\n      case \"rendering_frames\": return \"–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä–æ–≤...\";\r\n      case \"processing_audio\": return \"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —Ç—Ä–µ–∫–æ–≤...\";\r\n      case \"encoding\": return \"–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ...\";\r\n      case \"downloading\": return \"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞...\";\r\n      case \"completed\": return \"‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è.\";\r\n      case \"error\": return \"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞\";\r\n      case \"ready\": return `–ì–æ—Ç–æ–≤ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É (${timelineItems.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)`;\r\n      default: return \"–û–∂–∏–¥–∞–Ω–∏–µ...\";\r\n    }\r\n  };\r\n\r\n  const getStageIcon = () => {\r\n    switch (exportStage) {\r\n      case \"completed\": return <Check size={20} className=\"text-green-600\" />;\r\n      case \"error\": return <AlertCircle size={20} className=\"text-red-600\" />;\r\n      case \"ready\": return <Play size={20} className=\"text-blue-600\" />;\r\n      case \"loading\": return <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-orange-600\"></div>;\r\n      default: return <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600\"></div>;\r\n    }\r\n  };\r\n\r\n  const canExport = ffmpeg && !isExporting && !isLoading && timelineItems.length > 0 && exportStage === \"ready\";\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[100vh] overflow-hidden\">\r\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n          <h2 className=\"text-xl font-semibold text-gray-800 flex items-center\">\r\n            <Film size={24} className=\"mr-3 text-blue-600\" />\r\n            üé¨ –≠–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–µ–æ —Å overlay –∏ –∞—É–¥–∏–æ\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\r\n            disabled={isExporting}\r\n          >\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6 max-h-[calc(95vh-140px)] overflow-y-auto\">\r\n          {timelineItems.length === 0 && (\r\n            <div className=\"bg-red-50 border-2 border-red-300 rounded-xl p-6\">\r\n              <div className=\"flex items-start\">\r\n                <AlertCircle size={24} className=\"text-red-600 mr-3 mt-0.5 flex-shrink-0\" />\r\n                <div>\r\n                  <h4 className=\"font-bold text-red-800 text-lg mb-2\">‚ùå –ù–ï–¢ –î–ê–ù–ù–´–• TIMELINE!</h4>\r\n                  <p className=\"text-red-700 mb-3\">\r\n                    –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ timeline. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–¥–∞—á—É –ø—Ä–æ–ø—Å–æ–≤.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {error && (\r\n            <div className=\"bg-red-50 border border-red-200 rounded-xl p-4\">\r\n              <div className=\"flex items-start\">\r\n                <AlertCircle size={20} className=\"text-red-600 mr-3 mt-0.5\" />\r\n                <div>\r\n                  <h4 className=\"font-medium text-red-800\">–û—à–∏–±–∫–∞</h4>\r\n                  <p className=\"text-sm text-red-600 mt-1\">{error}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className={`rounded-xl p-4 border ${\r\n            exportStage === \"error\" ? \"bg-red-50 border-red-200\" :\r\n            exportStage === \"completed\" ? \"bg-green-50 border-green-200\" :\r\n            exportStage === \"loading\" ? \"bg-orange-50 border-orange-200\" :\r\n            \"bg-blue-50 border-blue-200\"\r\n          }`}>\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <div className=\"flex items-center\">\r\n                {getStageIcon()}\r\n                <span className={`ml-3 font-medium ${\r\n                  exportStage === \"error\" ? \"text-red-900\" :\r\n                  exportStage === \"completed\" ? \"text-green-900\" :\r\n                  exportStage === \"loading\" ? \"text-orange-900\" :\r\n                  \"text-blue-900\"\r\n                }`}>\r\n                  {getStageText()}\r\n                </span>\r\n              </div>\r\n              {(isExporting || isLoading) && (\r\n                <span className={`text-sm font-medium ${\r\n                  exportStage === \"loading\" ? \"text-orange-700\" : \"text-blue-700\"\r\n                }`}>\r\n                  {exportProgress}%\r\n                </span>\r\n              )}\r\n            </div>\r\n            {(isExporting || isLoading) && (\r\n              <div className={`w-full rounded-full h-2 ${\r\n                exportStage === \"loading\" ? \"bg-orange-200\" : \"bg-blue-200\"\r\n              }`}>\r\n                <div\r\n                  className={`h-2 rounded-full transition-all duration-300 ${\r\n                    exportStage === \"loading\" ? \"bg-orange-600\" : \"bg-blue-600\"\r\n                  }`}\r\n                  style={{ width: `${exportProgress}%` }}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 rounded-xl p-4\">\r\n            <h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center\">\r\n              <Settings size={16} className=\"mr-2\" />\r\n              –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞\r\n            </h3>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ</label>\r\n                <select\r\n                  value={exportSettings.resolution}\r\n                  onChange={(e) => setExportSettings(prev => ({ ...prev, resolution: e.target.value }))}\r\n                  className=\"w-full p-2 text-sm border border-gray-300 rounded-lg\"\r\n                  disabled={isExporting || isLoading}\r\n                >\r\n                  <option value=\"640x480\">480p (–±—ã—Å—Ç—Ä–æ)</option>\r\n                  <option value=\"1280x720\">720p (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>\r\n                  <option value=\"1920x1080\">1080p (–º–µ–¥–ª–µ–Ω–Ω–æ)</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">FPS</label>\r\n                <select\r\n                  value={exportSettings.fps}\r\n                  onChange={(e) => setExportSettings(prev => ({ ...prev, fps: parseInt(e.target.value) }))}\r\n                  className=\"w-full p-2 text-sm border border-gray-300 rounded-lg\"\r\n                  disabled={isExporting || isLoading}\r\n                >\r\n                  <option value=\"24\">24 FPS (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>\r\n                  <option value=\"30\">30 FPS (–ø–ª–∞–≤–Ω–æ)</option>\r\n                  <option value=\"60\">60 FPS (–æ—á–µ–Ω—å –ø–ª–∞–≤–Ω–æ)</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">–í–∫–ª—é—á–∏—Ç—å –∞—É–¥–∏–æ</label>\r\n                <label className=\"flex items-center space-x-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={exportSettings.includeAudio}\r\n                    onChange={(e) => setExportSettings(prev => ({ ...prev, includeAudio: e.target.checked }))}\r\n                    disabled={isExporting || isLoading}\r\n                    className=\"rounded\"\r\n                  />\r\n                  <span className=\"text-sm\">–î–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫ –≤ –≤–∏–¥–µ–æ</span>\r\n                </label>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">–ò–º—è —Ñ–∞–π–ª–∞</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={exportSettings.filename}\r\n                  onChange={(e) => setExportSettings(prev => ({ ...prev, filename: e.target.value }))}\r\n                  className=\"w-full p-2 text-sm border border-gray-300 rounded-lg\"\r\n                  disabled={isExporting || isLoading}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {timelineItems.length > 0 && (\r\n            <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-4\">\r\n              <h4 className=\"font-medium text-blue-800 mb-2\">üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h4>\r\n              <div className=\"text-xs text-blue-700 space-y-1\">\r\n                <p><strong>–≠–ª–µ–º–µ–Ω—Ç–æ–≤ timeline:</strong> {timelineItems.length}</p>\r\n                <p><strong>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</strong> {timelineItems.filter(item => item.type !== \"videos\" && item.trackType !== \"audio\").length}</p>\r\n                <p><strong>–í–∏–¥–µ–æ:</strong> {timelineItems.filter(item => item.type === \"videos\").length}</p>\r\n                <p><strong>–ê—É–¥–∏–æ:</strong> {timelineItems.filter(item => item.trackType === \"audio\").length}</p>\r\n                <p><strong>–†–∞—Å—á–µ—Ç–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {calculateTotalDuration().toFixed(1)}s</p>\r\n                <p><strong>Overlay –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</strong> {Object.keys(overlayTransforms).length}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {exportStage === \"ready\" && (\r\n            <div className=\"bg-gray-50 rounded-xl p-4\">\r\n              <h3 className=\"text-sm font-medium text-gray-700 mb-3\">–ü—Ä–µ–≤—å—é —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>\r\n              <div className=\"flex gap-4\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"bg-black rounded-lg aspect-video flex items-center justify-center overflow-hidden relative\">\r\n                    {previewFrame ? (\r\n                      <img src={previewFrame} alt=\"Preview\" className=\"max-w-full max-h-full object-contain\" />\r\n                    ) : (\r\n                      <div className=\"text-white text-sm\">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é...</div>\r\n                    )}\r\n                    <button\r\n                      onClick={generatePreviewFrame}\r\n                      className=\"absolute top-2 right-2 px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700\"\r\n                    >\r\n                      –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"w-48 space-y-2 text-sm\">\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-600\">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</span>\r\n                    <span className=\"font-medium\">{exportSettings.resolution}</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-600\">FPS:</span>\r\n                    <span className=\"font-medium\">{exportSettings.fps}</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-600\">–ê—É–¥–∏–æ:</span>\r\n                    <span className=\"font-medium\">{exportSettings.includeAudio ? \"–í–∫–ª—é—á–µ–Ω–æ\" : \"–û—Ç–∫–ª—é—á–µ–Ω–æ\"}</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-600\">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>\r\n                    <span className=\"font-medium\">{Math.round(calculateTotalDuration())}s</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50\">\r\n          <div className=\"text-xs text-gray-500\">\r\n            {exportStage === \"ready\" && timelineItems.length > 0\r\n              ? `–ì–æ—Ç–æ–≤ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É ‚Ä¢ ${timelineItems.filter(i => i.trackType === \"audio\").length} –∞—É–¥–∏–æ ‚Ä¢ ${timelineItems.filter(item => item.type !== \"videos\" && item.trackType !== \"audio\").length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`\r\n              : exportStage === \"loading\"\r\n              ? \"–ó–∞–≥—Ä—É–∑–∫–∞ FFmpeg...\"\r\n              : \"–î–æ–±–∞–≤—å—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ —Ç–∞–π–º–ª–∞–π–Ω\"}\r\n          </div>\r\n          <div className=\"flex space-x-3\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-6 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors\"\r\n              disabled={isExporting}\r\n            >\r\n              –ó–∞–∫—Ä—ã—Ç—å\r\n            </button>\r\n            <button\r\n              onClick={startExport}\r\n              disabled={!canExport}\r\n              className={`px-6 py-2 text-sm rounded-lg font-medium transition-all flex items-center ${\r\n                !canExport\r\n                  ? \"bg-gray-300 text-gray-500 cursor-not-allowed\"\r\n                  : \"bg-green-600 text-white hover:bg-green-700 shadow-lg\"\r\n              }`}\r\n            >\r\n              {isExporting ? (\r\n                <>\r\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                  –≠–∫—Å–ø–æ—Ä—Ç... {exportProgress}%\r\n                </>\r\n              ) : isLoading ? (\r\n                <>\r\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                  –ó–∞–≥—Ä—É–∑–∫–∞...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Download size={16} className=\"mr-2\" />\r\n                  –≠–∫—Å–ø–æ—Ä—Ç –≤–∏–¥–µ–æ\r\n                </>\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <canvas ref={canvasRef} style={{ display: \"none\" }} />\r\n        <canvas ref={previewCanvasRef} style={{ display: \"none\" }} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const useFFmpegExporter = () => {\r\n  const [isExportModalOpen, setIsExportModalOpen] = useState(false);\r\n\r\n  const openExportModal = () => setIsExportModalOpen(true);\r\n  const closeExportModal = () => setIsExportModalOpen(false);\r\n\r\n  return {\r\n    isExportModalOpen,\r\n    openExportModal,\r\n    closeExportModal,\r\n  };\r\n};\r\n\r\nexport default FFmpegVideoExporter;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}