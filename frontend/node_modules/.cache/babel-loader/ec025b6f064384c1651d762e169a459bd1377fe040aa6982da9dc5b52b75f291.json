{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\Timeline.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { Play, Pause, Square, Volume2, VolumeX, SkipBack, SkipForward, Maximize2, Settings } from \"lucide-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Timeline = ({\n  timelineItems,\n  currentTime,\n  videoDuration,\n  isPlaying,\n  setIsPlaying,\n  setCurrentTime,\n  formatTime,\n  seekTo\n}) => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const audioRefs = useRef(new Map()); // Для хранения аудио элементов\n  const imageCache = useRef(new Map()); // Кэш для загруженных изображений\n  const videoCache = useRef(new Map()); // Кэш для видео элементов\n  const animationFrameRef = useRef(null);\n  const [volume, setVolume] = useState(1);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [loadingAssets, setLoadingAssets] = useState(new Set());\n\n  // Получаем активные элементы на текущем времени\n  const getActiveItems = useCallback(() => {\n    return timelineItems.filter(item => {\n      const startTime = item.startTime;\n      const endTime = item.startTime + item.duration;\n      return currentTime >= startTime && currentTime < endTime;\n    });\n  }, [timelineItems, currentTime]);\n\n  // Отрисовка кадра\n  const renderFrame = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    const activeItems = getActiveItems();\n\n    // Очищаем canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Рисуем черный фон\n    ctx.fillStyle = '#000000';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Сортируем элементы по слоям (main сначала, потом overlay)\n    const sortedItems = activeItems.sort((a, b) => {\n      const layerOrder = {\n        main: 0,\n        overlay: 1,\n        audio: 2\n      };\n      return layerOrder[a.trackType] - layerOrder[b.trackType];\n    });\n    sortedItems.forEach(item => {\n      if (item.type === 'video') {\n        renderVideo(ctx, item, canvas);\n      } else if (item.type === 'image') {\n        renderImage(ctx, item, canvas);\n      }\n      // Аудио обрабатывается отдельно\n    });\n  }, [getActiveItems]);\n\n  // Отрисовка видео\n  const renderVideo = (ctx, item, canvas) => {\n    let video = videoCache.current.get(item.id);\n    if (!video) {\n      // Создаем новый видео элемент и кэшируем его\n      video = document.createElement('video');\n      video.src = item.url || item.src;\n      video.muted = true;\n      video.playsInline = true;\n      video.preload = 'metadata';\n      video.crossOrigin = 'anonymous';\n      video.addEventListener('loadedmetadata', () => {\n        console.log(`Видео \"${item.name}\" загружено:`, video.duration, 'сек');\n        setLoadingAssets(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(item.id);\n          return newSet;\n        });\n      });\n      video.addEventListener('error', e => {\n        console.error(`Ошибка загрузки видео \"${item.name}\":`, e);\n        setLoadingAssets(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(item.id);\n          return newSet;\n        });\n      });\n      videoCache.current.set(item.id, video);\n      setLoadingAssets(prev => new Set(prev).add(item.id));\n    }\n    if (video.readyState < 2) return; // Ждем загрузки метаданных\n\n    try {\n      // Вычисляем время внутри видео\n      const relativeTime = currentTime - item.startTime;\n      const clampedTime = Math.max(0, Math.min(relativeTime, video.duration || 0));\n\n      // Устанавливаем время только если разница существенная\n      if (Math.abs(video.currentTime - clampedTime) > 0.1) {\n        video.currentTime = clampedTime;\n      }\n\n      // Рисуем видео на весь canvas с сохранением пропорций\n      const videoAspect = video.videoWidth / video.videoHeight;\n      const canvasAspect = canvas.width / canvas.height;\n      let drawWidth, drawHeight, drawX, drawY;\n      if (videoAspect > canvasAspect) {\n        // Видео шире canvas\n        drawWidth = canvas.width;\n        drawHeight = canvas.width / videoAspect;\n        drawX = 0;\n        drawY = (canvas.height - drawHeight) / 2;\n      } else {\n        // Видео выше canvas\n        drawHeight = canvas.height;\n        drawWidth = canvas.height * videoAspect;\n        drawY = 0;\n        drawX = (canvas.width - drawWidth) / 2;\n      }\n      ctx.drawImage(video, drawX, drawY, drawWidth, drawHeight);\n    } catch (error) {\n      console.error('Ошибка отрисовки видео:', error);\n    }\n  };\n\n  // Отрисовка изображения\n  const renderImage = (ctx, item, canvas) => {\n    let img = imageCache.current.get(item.id);\n    if (!img) {\n      // Создаем новое изображение и кэшируем его\n      img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onload = () => {\n        console.log(`Изображение \"${item.name}\" загружено:`, img.width, 'x', img.height);\n        setLoadingAssets(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(item.id);\n          return newSet;\n        });\n        // Перерисовываем кадр после загрузки\n        renderFrame();\n      };\n      img.onerror = e => {\n        console.error(`Ошибка загрузки изображения \"${item.name}\":`, e);\n        setLoadingAssets(prev => {\n          const newSet = new Set(prev);\n          newSet.delete(item.id);\n          return newSet;\n        });\n      };\n      img.src = item.url || item.src;\n      imageCache.current.set(item.id, img);\n      setLoadingAssets(prev => new Set(prev).add(item.id));\n      return; // Выходим, изображение еще загружается\n    }\n    if (!img.complete) return; // Ждем завершения загрузки\n\n    try {\n      // Вычисляем размеры для сохранения пропорций\n      const imgAspect = img.width / img.height;\n      const canvasAspect = canvas.width / canvas.height;\n      let drawWidth, drawHeight, drawX, drawY;\n      if (imgAspect > canvasAspect) {\n        // Изображение шире canvas\n        drawWidth = canvas.width;\n        drawHeight = canvas.width / imgAspect;\n        drawX = 0;\n        drawY = (canvas.height - drawHeight) / 2;\n      } else {\n        // Изображение выше canvas\n        drawHeight = canvas.height;\n        drawWidth = canvas.height * imgAspect;\n        drawY = 0;\n        drawX = (canvas.width - drawWidth) / 2;\n      }\n\n      // Добавляем режимы наложения для overlay элементов\n      if (item.trackType === 'overlay') {\n        ctx.globalAlpha = item.opacity || 1; // Поддержка прозрачности\n        ctx.globalCompositeOperation = item.blendMode || 'source-over';\n      }\n      ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);\n\n      // Сбрасываем настройки наложения\n      if (item.trackType === 'overlay') {\n        ctx.globalAlpha = 1;\n        ctx.globalCompositeOperation = 'source-over';\n      }\n    } catch (error) {\n      console.error('Ошибка отрисовки изображения:', error);\n    }\n  };\n\n  // Предварительная загрузка ресурсов\n  const preloadAssets = useCallback(() => {\n    timelineItems.forEach(item => {\n      if (item.type === 'image' && !imageCache.current.has(item.id)) {\n        // Предварительно загружаем изображения\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onload = () => {\n          console.log(`Предварительно загружено изображение: ${item.name}`);\n        };\n        img.onerror = e => {\n          console.error(`Ошибка предварительной загрузки изображения ${item.name}:`, e);\n        };\n        img.src = item.url || item.src;\n        imageCache.current.set(item.id, img);\n      }\n      if (item.type === 'video' && !videoCache.current.has(item.id)) {\n        // Предварительно загружаем видео\n        const video = document.createElement('video');\n        video.src = item.url || item.src;\n        video.muted = true;\n        video.playsInline = true;\n        video.preload = 'metadata';\n        video.crossOrigin = 'anonymous';\n        video.onloadedmetadata = () => {\n          console.log(`Предварительно загружено видео: ${item.name}`);\n        };\n        video.onerror = e => {\n          console.error(`Ошибка предварительной загрузки видео ${item.name}:`, e);\n        };\n        videoCache.current.set(item.id, video);\n      }\n    });\n  }, [timelineItems]);\n\n  // Управление аудио\n  const manageAudio = useCallback(() => {\n    const activeItems = getActiveItems();\n    const audioItems = activeItems.filter(item => item.type === 'audio' || item.type === 'music');\n\n    // Останавливаем все аудио, которые не активны\n    audioRefs.current.forEach((audio, itemId) => {\n      const isActive = audioItems.some(item => item.id === itemId);\n      if (!isActive && !audio.paused) {\n        audio.pause();\n        audio.currentTime = 0;\n      }\n    });\n\n    // Управляем активными аудио\n    audioItems.forEach(item => {\n      let audio = audioRefs.current.get(item.id);\n      if (!audio) {\n        // Создаем новый аудио элемент\n        audio = new Audio();\n        audio.src = item.url || item.src;\n        audio.volume = isMuted ? 0 : volume;\n        audio.crossOrigin = 'anonymous';\n        audio.addEventListener('loadedmetadata', () => {\n          console.log(`Аудио \"${item.name}\" загружено:`, audio.duration, 'сек');\n        });\n        audio.addEventListener('error', e => {\n          console.error(`Ошибка загрузки аудио \"${item.name}\":`, e);\n        });\n        audioRefs.current.set(item.id, audio);\n      }\n      const relativeTime = currentTime - item.startTime;\n      const clampedTime = Math.max(0, Math.min(relativeTime, audio.duration || 0));\n      if (isPlaying && relativeTime >= 0 && relativeTime < item.duration) {\n        // Синхронизируем время только если разница существенная\n        if (Math.abs(audio.currentTime - clampedTime) > 0.2) {\n          audio.currentTime = clampedTime;\n        }\n        if (audio.paused) {\n          audio.play().catch(error => {\n            console.error('Ошибка воспроизведения аудио:', error);\n          });\n        }\n      } else {\n        if (!audio.paused) {\n          audio.pause();\n        }\n      }\n\n      // Обновляем громкость\n      audio.volume = isMuted ? 0 : volume;\n    });\n  }, [getActiveItems, currentTime, isPlaying, volume, isMuted]);\n\n  // Анимационная петля для обновления времени при воспроизведении\n  const updateTime = useCallback(() => {\n    if (isPlaying && currentTime < videoDuration) {\n      setCurrentTime(prev => Math.min(prev + 1 / 60, videoDuration)); // 60 FPS\n      animationFrameRef.current = requestAnimationFrame(updateTime);\n    }\n  }, [isPlaying, currentTime, videoDuration, setCurrentTime]);\n\n  // Управление воспроизведением\n  const togglePlayPause = () => {\n    setIsPlaying(!isPlaying);\n  };\n  const stopPlayback = () => {\n    setIsPlaying(false);\n    setCurrentTime(0);\n  };\n  const skipBackward = () => {\n    seekTo(Math.max(0, currentTime - 10));\n  };\n  const skipForward = () => {\n    seekTo(Math.min(videoDuration, currentTime + 10));\n  };\n  const toggleMute = () => {\n    setIsMuted(!isMuted);\n  };\n  const handleVolumeChange = e => {\n    const newVolume = parseFloat(e.target.value);\n    setVolume(newVolume);\n    setIsMuted(newVolume === 0);\n  };\n  const toggleFullscreen = () => {\n    if (!document.fullscreenElement) {\n      var _canvasRef$current;\n      (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.requestFullscreen();\n      setIsFullscreen(true);\n    } else {\n      document.exitFullscreen();\n      setIsFullscreen(false);\n    }\n  };\n\n  // Эффекты\n  useEffect(() => {\n    renderFrame();\n  }, [renderFrame]);\n  useEffect(() => {\n    manageAudio();\n  }, [manageAudio]);\n\n  // Предварительная загрузка ресурсов при изменении элементов таймлайна\n  useEffect(() => {\n    preloadAssets();\n  }, [preloadAssets]);\n  useEffect(() => {\n    if (isPlaying) {\n      animationFrameRef.current = requestAnimationFrame(updateTime);\n    } else {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    }\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [isPlaying, updateTime]);\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    return () => {\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\n    };\n  }, []);\n\n  // Cleanup при размонтировании\n  useEffect(() => {\n    return () => {\n      // Останавливаем все аудио\n      audioRefs.current.forEach(audio => {\n        audio.pause();\n        audio.currentTime = 0;\n        audio.src = ''; // Освобождаем ресурсы\n      });\n      audioRefs.current.clear();\n\n      // Очищаем кэш видео\n      videoCache.current.forEach(video => {\n        video.pause();\n        video.currentTime = 0;\n        video.src = ''; // Освобождаем ресурсы\n      });\n      videoCache.current.clear();\n\n      // Очищаем кэш изображений\n      imageCache.current.clear();\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, []);\n  const activeItems = getActiveItems();\n  const hasVideoContent = activeItems.some(item => item.type === 'video' || item.type === 'image');\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white rounded-2xl shadow-sm border-2 border-gray-200 overflow-hidden\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-gray-50 p-4 border-b border-gray-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          className: \"text-gray-800 font-semibold flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(Play, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Video Preview\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 449,\n            columnNumber: 13\n          }, this), activeItems.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-blue-600 text-sm\",\n            children: [\"- \\u0410\\u043A\\u0442\\u0438\\u0432\\u043D\\u043E: \", activeItems.length, \" \\u044D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442(\\u043E\\u0432)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 15\n          }, this), loadingAssets.size > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-orange-600 text-sm animate-pulse\",\n            children: [\"- \\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430: \", loadingAssets.size, \" \\u0444\\u0430\\u0439\\u043B(\\u043E\\u0432)...\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 456,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-600\",\n            children: [formatTime(currentTime), \" / \", formatTime(videoDuration)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 463,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: toggleFullscreen,\n            className: \"p-2 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: \"\\u041F\\u043E\\u043B\\u043D\\u043E\\u044D\\u043A\\u0440\\u0430\\u043D\\u043D\\u044B\\u0439 \\u0440\\u0435\\u0436\\u0438\\u043C\",\n            children: /*#__PURE__*/_jsxDEV(Maximize2, {\n              size: 16\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 471,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 466,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"relative bg-black\",\n      style: {\n        aspectRatio: '16/9'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        className: \"w-full h-full object-contain\",\n        width: 1920,\n        height: 1080\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 9\n      }, this), !hasVideoContent && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 flex items-center justify-center text-gray-400\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: [/*#__PURE__*/_jsxDEV(Play, {\n            size: 48,\n            className: \"mx-auto mb-4 opacity-50\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 493,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-medium\",\n            children: \"\\u041F\\u0435\\u0440\\u0435\\u0442\\u0430\\u0449\\u0438\\u0442\\u0435 \\u0432\\u0438\\u0434\\u0435\\u043E \\u0438\\u043B\\u0438 \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F \\u043D\\u0430 \\u0442\\u0430\\u0439\\u043C\\u043B\\u0430\\u0439\\u043D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm\",\n            children: \"\\u0434\\u043B\\u044F \\u043D\\u0430\\u0447\\u0430\\u043B\\u0430 \\u0440\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u044F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 492,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 11\n      }, this), loadingAssets.size > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-4 left-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-2 h-2 bg-white rounded-full animate-spin\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 503,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \", loadingAssets.size]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 504,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 11\n      }, this), isPlaying && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-4 right-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-2 h-2 bg-white rounded-full animate-pulse\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 511,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\u0412 \\u042D\\u0424\\u0418\\u0420\\u0415\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 512,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 478,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-gray-50 p-4 border-t border-gray-200\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: skipBackward,\n            className: \"p-2 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: \"\\u041D\\u0430\\u0437\\u0430\\u0434 \\u043D\\u0430 10 \\u0441\\u0435\\u043A\",\n            children: /*#__PURE__*/_jsxDEV(SkipBack, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 527,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 522,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: togglePlayPause,\n            className: `p-3 rounded-full transition-colors ${isPlaying ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-blue-500 text-white hover:bg-blue-600'}`,\n            title: isPlaying ? 'Пауза' : 'Воспроизвести',\n            children: isPlaying ? /*#__PURE__*/_jsxDEV(Pause, {\n              size: 24\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 539,\n              columnNumber: 28\n            }, this) : /*#__PURE__*/_jsxDEV(Play, {\n              size: 24\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 539,\n              columnNumber: 50\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 530,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: stopPlayback,\n            className: \"p-2 text-gray-600 hover:text-red-600 transition-colors\",\n            title: \"\\u041E\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C\",\n            children: /*#__PURE__*/_jsxDEV(Square, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 547,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: skipForward,\n            className: \"p-2 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: \"\\u0412\\u043F\\u0435\\u0440\\u0435\\u0434 \\u043D\\u0430 10 \\u0441\\u0435\\u043A\",\n            children: /*#__PURE__*/_jsxDEV(SkipForward, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 555,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 550,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 521,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: toggleMute,\n            className: \"p-2 text-gray-600 hover:text-blue-600 transition-colors\",\n            title: isMuted ? 'Включить звук' : 'Выключить звук',\n            children: isMuted ? /*#__PURE__*/_jsxDEV(VolumeX, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 566,\n              columnNumber: 26\n            }, this) : /*#__PURE__*/_jsxDEV(Volume2, {\n              size: 20\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 566,\n              columnNumber: 50\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 561,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"range\",\n            min: \"0\",\n            max: \"1\",\n            step: \"0.1\",\n            value: isMuted ? 0 : volume,\n            onChange: handleVolumeChange,\n            className: \"w-20 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer\",\n            title: \"\\u0413\\u0440\\u043E\\u043C\\u043A\\u043E\\u0441\\u0442\\u044C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 569,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-600 min-w-8\",\n            children: [Math.round((isMuted ? 0 : volume) * 100), \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 580,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 560,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 519,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative w-full h-2 bg-gray-200 rounded-full overflow-hidden\",\n          children: [loadingAssets.size > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute left-0 top-0 h-full bg-orange-200 rounded-full animate-pulse\",\n            style: {\n              width: '100%'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 591,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute left-0 top-0 h-full bg-blue-500 transition-all duration-150 rounded-full\",\n            style: {\n              width: `${currentTime / videoDuration * 100}%`\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"range\",\n            min: \"0\",\n            max: videoDuration,\n            step: \"0.1\",\n            value: currentTime,\n            onChange: e => seekTo(parseFloat(e.target.value)),\n            className: \"absolute inset-0 w-full h-full opacity-0 cursor-pointer\",\n            title: \"\\u041F\\u043E\\u0437\\u0438\\u0446\\u0438\\u044F \\u0432\\u043E\\u0441\\u043F\\u0440\\u043E\\u0438\\u0437\\u0432\\u0435\\u0434\\u0435\\u043D\\u0438\\u044F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 602,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 588,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative w-full h-1 mt-1\",\n          children: timelineItems.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `absolute top-0 h-full opacity-60 ${item.type === 'video' ? 'bg-blue-400' : item.type === 'audio' || item.type === 'music' ? 'bg-green-400' : 'bg-purple-400'}`,\n            style: {\n              left: `${item.startTime / videoDuration * 100}%`,\n              width: `${item.duration / videoDuration * 100}%`\n            },\n            title: `${item.name} (${formatTime(item.startTime)} - ${formatTime(item.startTime + item.duration)})`\n          }, item.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 617,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 615,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 587,\n        columnNumber: 9\n      }, this), activeItems.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-3 space-y-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-wrap gap-2\",\n          children: activeItems.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ${item.type === 'video' ? 'bg-blue-100 text-blue-700' : item.type === 'audio' || item.type === 'music' ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: item.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 647,\n              columnNumber: 19\n            }, this), loadingAssets.has(item.id) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-2 h-2 bg-current rounded-full animate-pulse\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 649,\n              columnNumber: 21\n            }, this)]\n          }, item.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 639,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 637,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between text-xs text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"\\u041A\\u044D\\u0448: \", imageCache.current.size, \" \\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0439, \", videoCache.current.size, \" \\u0432\\u0438\\u0434\\u0435\\u043E, \", audioRefs.current.size, \" \\u0430\\u0443\\u0434\\u0438\\u043E\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 657,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"FPS: \", isPlaying ? '60' : '0', \" | \\u0420\\u0430\\u0437\\u043C\\u0435\\u0440: 1920x1080\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 660,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 656,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 636,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 518,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 443,\n    columnNumber: 5\n  }, this);\n};\n_s(Timeline, \"+3RMqoo9jpK649P1bsaig1u7RXU=\");\n_c = Timeline;\nvar _c;\n$RefreshReg$(_c, \"Timeline\");","map":{"version":3,"names":["useState","useRef","useEffect","useCallback","Play","Pause","Square","Volume2","VolumeX","SkipBack","SkipForward","Maximize2","Settings","jsxDEV","_jsxDEV","Timeline","timelineItems","currentTime","videoDuration","isPlaying","setIsPlaying","setCurrentTime","formatTime","seekTo","_s","videoRef","canvasRef","audioRefs","Map","imageCache","videoCache","animationFrameRef","volume","setVolume","isMuted","setIsMuted","isFullscreen","setIsFullscreen","loadingAssets","setLoadingAssets","Set","getActiveItems","filter","item","startTime","endTime","duration","renderFrame","canvas","current","ctx","getContext","activeItems","clearRect","width","height","fillStyle","fillRect","sortedItems","sort","a","b","layerOrder","main","overlay","audio","trackType","forEach","type","renderVideo","renderImage","video","get","id","document","createElement","src","url","muted","playsInline","preload","crossOrigin","addEventListener","console","log","name","prev","newSet","delete","e","error","set","add","readyState","relativeTime","clampedTime","Math","max","min","abs","videoAspect","videoWidth","videoHeight","canvasAspect","drawWidth","drawHeight","drawX","drawY","drawImage","img","Image","onload","onerror","complete","imgAspect","globalAlpha","opacity","globalCompositeOperation","blendMode","preloadAssets","has","onloadedmetadata","manageAudio","audioItems","itemId","isActive","some","paused","pause","Audio","play","catch","updateTime","requestAnimationFrame","togglePlayPause","stopPlayback","skipBackward","skipForward","toggleMute","handleVolumeChange","newVolume","parseFloat","target","value","toggleFullscreen","fullscreenElement","_canvasRef$current","requestFullscreen","exitFullscreen","cancelAnimationFrame","handleFullscreenChange","removeEventListener","clear","hasVideoContent","className","children","size","fileName","_jsxFileName","lineNumber","columnNumber","length","onClick","title","style","aspectRatio","ref","step","onChange","round","map","left","_c","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/Timeline.jsx"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport {\r\n  Play,\r\n  Pause,\r\n  Square,\r\n  Volume2,\r\n  VolumeX,\r\n  SkipBack,\r\n  SkipForward,\r\n  Maximize2,\r\n  Settings,\r\n} from \"lucide-react\";\r\n\r\nexport const Timeline = ({\r\n  timelineItems,\r\n  currentTime,\r\n  videoDuration,\r\n  isPlaying,\r\n  setIsPlaying,\r\n  setCurrentTime,\r\n  formatTime,\r\n  seekTo,\r\n}) => {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const audioRefs = useRef(new Map()); // Для хранения аудио элементов\r\n  const imageCache = useRef(new Map()); // Кэш для загруженных изображений\r\n  const videoCache = useRef(new Map()); // Кэш для видео элементов\r\n  const animationFrameRef = useRef(null);\r\n  \r\n  const [volume, setVolume] = useState(1);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [loadingAssets, setLoadingAssets] = useState(new Set());\r\n  \r\n  // Получаем активные элементы на текущем времени\r\n  const getActiveItems = useCallback(() => {\r\n    return timelineItems.filter(item => {\r\n      const startTime = item.startTime;\r\n      const endTime = item.startTime + item.duration;\r\n      return currentTime >= startTime && currentTime < endTime;\r\n    });\r\n  }, [timelineItems, currentTime]);\r\n\r\n  // Отрисовка кадра\r\n  const renderFrame = useCallback(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    const activeItems = getActiveItems();\r\n    \r\n    // Очищаем canvas\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    \r\n    // Рисуем черный фон\r\n    ctx.fillStyle = '#000000';\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    \r\n    // Сортируем элементы по слоям (main сначала, потом overlay)\r\n    const sortedItems = activeItems.sort((a, b) => {\r\n      const layerOrder = { main: 0, overlay: 1, audio: 2 };\r\n      return layerOrder[a.trackType] - layerOrder[b.trackType];\r\n    });\r\n    \r\n    sortedItems.forEach(item => {\r\n      if (item.type === 'video') {\r\n        renderVideo(ctx, item, canvas);\r\n      } else if (item.type === 'image') {\r\n        renderImage(ctx, item, canvas);\r\n      }\r\n      // Аудио обрабатывается отдельно\r\n    });\r\n  }, [getActiveItems]);\r\n\r\n  // Отрисовка видео\r\n  const renderVideo = (ctx, item, canvas) => {\r\n    let video = videoCache.current.get(item.id);\r\n    \r\n    if (!video) {\r\n      // Создаем новый видео элемент и кэшируем его\r\n      video = document.createElement('video');\r\n      video.src = item.url || item.src;\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      video.preload = 'metadata';\r\n      video.crossOrigin = 'anonymous';\r\n      \r\n      video.addEventListener('loadedmetadata', () => {\r\n        console.log(`Видео \"${item.name}\" загружено:`, video.duration, 'сек');\r\n        setLoadingAssets(prev => {\r\n          const newSet = new Set(prev);\r\n          newSet.delete(item.id);\r\n          return newSet;\r\n        });\r\n      });\r\n      \r\n      video.addEventListener('error', (e) => {\r\n        console.error(`Ошибка загрузки видео \"${item.name}\":`, e);\r\n        setLoadingAssets(prev => {\r\n          const newSet = new Set(prev);\r\n          newSet.delete(item.id);\r\n          return newSet;\r\n        });\r\n      });\r\n      \r\n      videoCache.current.set(item.id, video);\r\n      setLoadingAssets(prev => new Set(prev).add(item.id));\r\n    }\r\n    \r\n    if (video.readyState < 2) return; // Ждем загрузки метаданных\r\n    \r\n    try {\r\n      // Вычисляем время внутри видео\r\n      const relativeTime = currentTime - item.startTime;\r\n      const clampedTime = Math.max(0, Math.min(relativeTime, video.duration || 0));\r\n      \r\n      // Устанавливаем время только если разница существенная\r\n      if (Math.abs(video.currentTime - clampedTime) > 0.1) {\r\n        video.currentTime = clampedTime;\r\n      }\r\n      \r\n      // Рисуем видео на весь canvas с сохранением пропорций\r\n      const videoAspect = video.videoWidth / video.videoHeight;\r\n      const canvasAspect = canvas.width / canvas.height;\r\n      \r\n      let drawWidth, drawHeight, drawX, drawY;\r\n      \r\n      if (videoAspect > canvasAspect) {\r\n        // Видео шире canvas\r\n        drawWidth = canvas.width;\r\n        drawHeight = canvas.width / videoAspect;\r\n        drawX = 0;\r\n        drawY = (canvas.height - drawHeight) / 2;\r\n      } else {\r\n        // Видео выше canvas\r\n        drawHeight = canvas.height;\r\n        drawWidth = canvas.height * videoAspect;\r\n        drawY = 0;\r\n        drawX = (canvas.width - drawWidth) / 2;\r\n      }\r\n      \r\n      ctx.drawImage(video, drawX, drawY, drawWidth, drawHeight);\r\n    } catch (error) {\r\n      console.error('Ошибка отрисовки видео:', error);\r\n    }\r\n  };\r\n\r\n  // Отрисовка изображения\r\n  const renderImage = (ctx, item, canvas) => {\r\n    let img = imageCache.current.get(item.id);\r\n    \r\n    if (!img) {\r\n      // Создаем новое изображение и кэшируем его\r\n      img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      img.onload = () => {\r\n        console.log(`Изображение \"${item.name}\" загружено:`, img.width, 'x', img.height);\r\n        setLoadingAssets(prev => {\r\n          const newSet = new Set(prev);\r\n          newSet.delete(item.id);\r\n          return newSet;\r\n        });\r\n        // Перерисовываем кадр после загрузки\r\n        renderFrame();\r\n      };\r\n      \r\n      img.onerror = (e) => {\r\n        console.error(`Ошибка загрузки изображения \"${item.name}\":`, e);\r\n        setLoadingAssets(prev => {\r\n          const newSet = new Set(prev);\r\n          newSet.delete(item.id);\r\n          return newSet;\r\n        });\r\n      };\r\n      \r\n      img.src = item.url || item.src;\r\n      imageCache.current.set(item.id, img);\r\n      setLoadingAssets(prev => new Set(prev).add(item.id));\r\n      return; // Выходим, изображение еще загружается\r\n    }\r\n    \r\n    if (!img.complete) return; // Ждем завершения загрузки\r\n    \r\n    try {\r\n      // Вычисляем размеры для сохранения пропорций\r\n      const imgAspect = img.width / img.height;\r\n      const canvasAspect = canvas.width / canvas.height;\r\n      \r\n      let drawWidth, drawHeight, drawX, drawY;\r\n      \r\n      if (imgAspect > canvasAspect) {\r\n        // Изображение шире canvas\r\n        drawWidth = canvas.width;\r\n        drawHeight = canvas.width / imgAspect;\r\n        drawX = 0;\r\n        drawY = (canvas.height - drawHeight) / 2;\r\n      } else {\r\n        // Изображение выше canvas\r\n        drawHeight = canvas.height;\r\n        drawWidth = canvas.height * imgAspect;\r\n        drawY = 0;\r\n        drawX = (canvas.width - drawWidth) / 2;\r\n      }\r\n      \r\n      // Добавляем режимы наложения для overlay элементов\r\n      if (item.trackType === 'overlay') {\r\n        ctx.globalAlpha = item.opacity || 1; // Поддержка прозрачности\r\n        ctx.globalCompositeOperation = item.blendMode || 'source-over';\r\n      }\r\n      \r\n      ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);\r\n      \r\n      // Сбрасываем настройки наложения\r\n      if (item.trackType === 'overlay') {\r\n        ctx.globalAlpha = 1;\r\n        ctx.globalCompositeOperation = 'source-over';\r\n      }\r\n    } catch (error) {\r\n      console.error('Ошибка отрисовки изображения:', error);\r\n    }\r\n  };\r\n\r\n  // Предварительная загрузка ресурсов\r\n  const preloadAssets = useCallback(() => {\r\n    timelineItems.forEach(item => {\r\n      if (item.type === 'image' && !imageCache.current.has(item.id)) {\r\n        // Предварительно загружаем изображения\r\n        const img = new Image();\r\n        img.crossOrigin = 'anonymous';\r\n        img.onload = () => {\r\n          console.log(`Предварительно загружено изображение: ${item.name}`);\r\n        };\r\n        img.onerror = (e) => {\r\n          console.error(`Ошибка предварительной загрузки изображения ${item.name}:`, e);\r\n        };\r\n        img.src = item.url || item.src;\r\n        imageCache.current.set(item.id, img);\r\n      }\r\n      \r\n      if (item.type === 'video' && !videoCache.current.has(item.id)) {\r\n        // Предварительно загружаем видео\r\n        const video = document.createElement('video');\r\n        video.src = item.url || item.src;\r\n        video.muted = true;\r\n        video.playsInline = true;\r\n        video.preload = 'metadata';\r\n        video.crossOrigin = 'anonymous';\r\n        video.onloadedmetadata = () => {\r\n          console.log(`Предварительно загружено видео: ${item.name}`);\r\n        };\r\n        video.onerror = (e) => {\r\n          console.error(`Ошибка предварительной загрузки видео ${item.name}:`, e);\r\n        };\r\n        videoCache.current.set(item.id, video);\r\n      }\r\n    });\r\n  }, [timelineItems]);\r\n\r\n  // Управление аудио\r\n  const manageAudio = useCallback(() => {\r\n    const activeItems = getActiveItems();\r\n    const audioItems = activeItems.filter(item => \r\n      item.type === 'audio' || item.type === 'music'\r\n    );\r\n    \r\n    // Останавливаем все аудио, которые не активны\r\n    audioRefs.current.forEach((audio, itemId) => {\r\n      const isActive = audioItems.some(item => item.id === itemId);\r\n      if (!isActive && !audio.paused) {\r\n        audio.pause();\r\n        audio.currentTime = 0;\r\n      }\r\n    });\r\n    \r\n    // Управляем активными аудио\r\n    audioItems.forEach(item => {\r\n      let audio = audioRefs.current.get(item.id);\r\n      \r\n      if (!audio) {\r\n        // Создаем новый аудио элемент\r\n        audio = new Audio();\r\n        audio.src = item.url || item.src;\r\n        audio.volume = isMuted ? 0 : volume;\r\n        audio.crossOrigin = 'anonymous';\r\n        \r\n        audio.addEventListener('loadedmetadata', () => {\r\n          console.log(`Аудио \"${item.name}\" загружено:`, audio.duration, 'сек');\r\n        });\r\n        \r\n        audio.addEventListener('error', (e) => {\r\n          console.error(`Ошибка загрузки аудио \"${item.name}\":`, e);\r\n        });\r\n        \r\n        audioRefs.current.set(item.id, audio);\r\n      }\r\n      \r\n      const relativeTime = currentTime - item.startTime;\r\n      const clampedTime = Math.max(0, Math.min(relativeTime, audio.duration || 0));\r\n      \r\n      if (isPlaying && relativeTime >= 0 && relativeTime < item.duration) {\r\n        // Синхронизируем время только если разница существенная\r\n        if (Math.abs(audio.currentTime - clampedTime) > 0.2) {\r\n          audio.currentTime = clampedTime;\r\n        }\r\n        \r\n        if (audio.paused) {\r\n          audio.play().catch(error => {\r\n            console.error('Ошибка воспроизведения аудио:', error);\r\n          });\r\n        }\r\n      } else {\r\n        if (!audio.paused) {\r\n          audio.pause();\r\n        }\r\n      }\r\n      \r\n      // Обновляем громкость\r\n      audio.volume = isMuted ? 0 : volume;\r\n    });\r\n  }, [getActiveItems, currentTime, isPlaying, volume, isMuted]);\r\n\r\n  // Анимационная петля для обновления времени при воспроизведении\r\n  const updateTime = useCallback(() => {\r\n    if (isPlaying && currentTime < videoDuration) {\r\n      setCurrentTime(prev => Math.min(prev + 1/60, videoDuration)); // 60 FPS\r\n      animationFrameRef.current = requestAnimationFrame(updateTime);\r\n    }\r\n  }, [isPlaying, currentTime, videoDuration, setCurrentTime]);\r\n\r\n  // Управление воспроизведением\r\n  const togglePlayPause = () => {\r\n    setIsPlaying(!isPlaying);\r\n  };\r\n\r\n  const stopPlayback = () => {\r\n    setIsPlaying(false);\r\n    setCurrentTime(0);\r\n  };\r\n\r\n  const skipBackward = () => {\r\n    seekTo(Math.max(0, currentTime - 10));\r\n  };\r\n\r\n  const skipForward = () => {\r\n    seekTo(Math.min(videoDuration, currentTime + 10));\r\n  };\r\n\r\n  const toggleMute = () => {\r\n    setIsMuted(!isMuted);\r\n  };\r\n\r\n  const handleVolumeChange = (e) => {\r\n    const newVolume = parseFloat(e.target.value);\r\n    setVolume(newVolume);\r\n    setIsMuted(newVolume === 0);\r\n  };\r\n\r\n  const toggleFullscreen = () => {\r\n    if (!document.fullscreenElement) {\r\n      canvasRef.current?.requestFullscreen();\r\n      setIsFullscreen(true);\r\n    } else {\r\n      document.exitFullscreen();\r\n      setIsFullscreen(false);\r\n    }\r\n  };\r\n\r\n  // Эффекты\r\n  useEffect(() => {\r\n    renderFrame();\r\n  }, [renderFrame]);\r\n\r\n  useEffect(() => {\r\n    manageAudio();\r\n  }, [manageAudio]);\r\n\r\n  // Предварительная загрузка ресурсов при изменении элементов таймлайна\r\n  useEffect(() => {\r\n    preloadAssets();\r\n  }, [preloadAssets]);\r\n\r\n  useEffect(() => {\r\n    if (isPlaying) {\r\n      animationFrameRef.current = requestAnimationFrame(updateTime);\r\n    } else {\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, [isPlaying, updateTime]);\r\n\r\n  useEffect(() => {\r\n    const handleFullscreenChange = () => {\r\n      setIsFullscreen(!!document.fullscreenElement);\r\n    };\r\n\r\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n    };\r\n  }, []);\r\n\r\n  // Cleanup при размонтировании\r\n  useEffect(() => {\r\n    return () => {\r\n      // Останавливаем все аудио\r\n      audioRefs.current.forEach(audio => {\r\n        audio.pause();\r\n        audio.currentTime = 0;\r\n        audio.src = ''; // Освобождаем ресурсы\r\n      });\r\n      audioRefs.current.clear();\r\n      \r\n      // Очищаем кэш видео\r\n      videoCache.current.forEach(video => {\r\n        video.pause();\r\n        video.currentTime = 0;\r\n        video.src = ''; // Освобождаем ресурсы\r\n      });\r\n      videoCache.current.clear();\r\n      \r\n      // Очищаем кэш изображений\r\n      imageCache.current.clear();\r\n      \r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const activeItems = getActiveItems();\r\n  const hasVideoContent = activeItems.some(item => item.type === 'video' || item.type === 'image');\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-2xl shadow-sm border-2 border-gray-200 overflow-hidden\">\r\n      {/* Заголовок */}\r\n      <div className=\"bg-gray-50 p-4 border-b border-gray-200\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h4 className=\"text-gray-800 font-semibold flex items-center space-x-2\">\r\n            <Play size={18} />\r\n            <span>Video Preview</span>\r\n            {activeItems.length > 0 && (\r\n              <span className=\"text-blue-600 text-sm\">\r\n                - Активно: {activeItems.length} элемент(ов)\r\n              </span>\r\n            )}\r\n            {loadingAssets.size > 0 && (\r\n              <span className=\"text-orange-600 text-sm animate-pulse\">\r\n                - Загрузка: {loadingAssets.size} файл(ов)...\r\n              </span>\r\n            )}\r\n          </h4>\r\n          \r\n          <div className=\"flex items-center space-x-2\">\r\n            <span className=\"text-sm text-gray-600\">\r\n              {formatTime(currentTime)} / {formatTime(videoDuration)}\r\n            </span>\r\n            <button\r\n              onClick={toggleFullscreen}\r\n              className=\"p-2 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title=\"Полноэкранный режим\"\r\n            >\r\n              <Maximize2 size={16} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Область видео */}\r\n      <div className=\"relative bg-black\" style={{ aspectRatio: '16/9' }}>\r\n        {/* Скрытые элементы для получения кадров уже не нужны, используем кэш */}\r\n        \r\n        {/* Canvas для отрисовки */}\r\n        <canvas\r\n          ref={canvasRef}\r\n          className=\"w-full h-full object-contain\"\r\n          width={1920}\r\n          height={1080}\r\n        />\r\n        \r\n        {/* Заглушка если нет контента */}\r\n        {!hasVideoContent && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center text-gray-400\">\r\n            <div className=\"text-center\">\r\n              <Play size={48} className=\"mx-auto mb-4 opacity-50\" />\r\n              <p className=\"text-lg font-medium\">Перетащите видео или изображения на таймлайн</p>\r\n              <p className=\"text-sm\">для начала редактирования</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Индикатор загрузки */}\r\n        {loadingAssets.size > 0 && (\r\n          <div className=\"absolute top-4 left-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-2\">\r\n            <div className=\"w-2 h-2 bg-white rounded-full animate-spin\"></div>\r\n            <span>Загрузка {loadingAssets.size}</span>\r\n          </div>\r\n        )}\r\n\r\n        {/* Индикатор воспроизведения */}\r\n        {isPlaying && (\r\n          <div className=\"absolute top-4 right-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-2\">\r\n            <div className=\"w-2 h-2 bg-white rounded-full animate-pulse\"></div>\r\n            <span>В ЭФИРЕ</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Панель управления */}\r\n      <div className=\"bg-gray-50 p-4 border-t border-gray-200\">\r\n        <div className=\"flex items-center justify-between\">\r\n          {/* Основные кнопки */}\r\n          <div className=\"flex items-center space-x-3\">\r\n            <button\r\n              onClick={skipBackward}\r\n              className=\"p-2 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title=\"Назад на 10 сек\"\r\n            >\r\n              <SkipBack size={20} />\r\n            </button>\r\n            \r\n            <button\r\n              onClick={togglePlayPause}\r\n              className={`p-3 rounded-full transition-colors ${\r\n                isPlaying \r\n                  ? 'bg-red-500 text-white hover:bg-red-600' \r\n                  : 'bg-blue-500 text-white hover:bg-blue-600'\r\n              }`}\r\n              title={isPlaying ? 'Пауза' : 'Воспроизвести'}\r\n            >\r\n              {isPlaying ? <Pause size={24} /> : <Play size={24} />}\r\n            </button>\r\n            \r\n            <button\r\n              onClick={stopPlayback}\r\n              className=\"p-2 text-gray-600 hover:text-red-600 transition-colors\"\r\n              title=\"Остановить\"\r\n            >\r\n              <Square size={20} />\r\n            </button>\r\n            \r\n            <button\r\n              onClick={skipForward}\r\n              className=\"p-2 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title=\"Вперед на 10 сек\"\r\n            >\r\n              <SkipForward size={20} />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Громкость */}\r\n          <div className=\"flex items-center space-x-3\">\r\n            <button\r\n              onClick={toggleMute}\r\n              className=\"p-2 text-gray-600 hover:text-blue-600 transition-colors\"\r\n              title={isMuted ? 'Включить звук' : 'Выключить звук'}\r\n            >\r\n              {isMuted ? <VolumeX size={20} /> : <Volume2 size={20} />}\r\n            </button>\r\n            \r\n            <input\r\n              type=\"range\"\r\n              min=\"0\"\r\n              max=\"1\"\r\n              step=\"0.1\"\r\n              value={isMuted ? 0 : volume}\r\n              onChange={handleVolumeChange}\r\n              className=\"w-20 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\r\n              title=\"Громкость\"\r\n            />\r\n            \r\n            <span className=\"text-sm text-gray-600 min-w-8\">\r\n              {Math.round((isMuted ? 0 : volume) * 100)}%\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Прогресс бар */}\r\n        <div className=\"mt-4\">\r\n          <div className=\"relative w-full h-2 bg-gray-200 rounded-full overflow-hidden\">\r\n            {/* Буферизация (если есть загружающиеся элементы) */}\r\n            {loadingAssets.size > 0 && (\r\n              <div className=\"absolute left-0 top-0 h-full bg-orange-200 rounded-full animate-pulse\" \r\n                   style={{ width: '100%' }} />\r\n            )}\r\n            \r\n            {/* Прогресс воспроизведения */}\r\n            <div\r\n              className=\"absolute left-0 top-0 h-full bg-blue-500 transition-all duration-150 rounded-full\"\r\n              style={{ width: `${(currentTime / videoDuration) * 100}%` }}\r\n            />\r\n            \r\n            {/* Интерактивный слайдер */}\r\n            <input\r\n              type=\"range\"\r\n              min=\"0\"\r\n              max={videoDuration}\r\n              step=\"0.1\"\r\n              value={currentTime}\r\n              onChange={(e) => seekTo(parseFloat(e.target.value))}\r\n              className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n              title=\"Позиция воспроизведения\"\r\n            />\r\n          </div>\r\n          \r\n          {/* Маркеры активных элементов на прогресс-баре */}\r\n          <div className=\"relative w-full h-1 mt-1\">\r\n            {timelineItems.map(item => (\r\n              <div\r\n                key={item.id}\r\n                className={`absolute top-0 h-full opacity-60 ${\r\n                  item.type === 'video' ? 'bg-blue-400' :\r\n                  item.type === 'audio' || item.type === 'music' ? 'bg-green-400' :\r\n                  'bg-purple-400'\r\n                }`}\r\n                style={{\r\n                  left: `${(item.startTime / videoDuration) * 100}%`,\r\n                  width: `${(item.duration / videoDuration) * 100}%`,\r\n                }}\r\n                title={`${item.name} (${formatTime(item.startTime)} - ${formatTime(item.startTime + item.duration)})`}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Информация об активных элементах */}\r\n        {activeItems.length > 0 && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {activeItems.map(item => (\r\n                <div\r\n                  key={item.id}\r\n                  className={`px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ${\r\n                    item.type === 'video' ? 'bg-blue-100 text-blue-700' :\r\n                    item.type === 'audio' || item.type === 'music' ? 'bg-green-100 text-green-700' :\r\n                    'bg-purple-100 text-purple-700'\r\n                  }`}\r\n                >\r\n                  <span>{item.name}</span>\r\n                  {loadingAssets.has(item.id) && (\r\n                    <div className=\"w-2 h-2 bg-current rounded-full animate-pulse\" />\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n            \r\n            {/* Статистика */}\r\n            <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n              <span>\r\n                Кэш: {imageCache.current.size} изображений, {videoCache.current.size} видео, {audioRefs.current.size} аудио\r\n              </span>\r\n              <span>\r\n                FPS: {isPlaying ? '60' : '0'} | Размер: 1920x1080\r\n              </span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}