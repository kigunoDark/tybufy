{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\Timeline\\\\EnhancedTimelineCanvas.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useCallback, useMemo } from \"react\";\nimport { Zap, Settings, BarChart3 } from \"lucide-react\";\nimport { DropPreview } from \"./DropPreview\";\nimport { TimelineItem } from \"./TimelineItem\";\nimport { TimelineRuler } from \"./TimelineRuler\";\nimport OptimizedFFmpegExporter from \"./OptimizedFFmpegExporter\";\nimport TimelineDataAdapter from \"../utils/timelineDataAdapter/\";\nimport { ExportPresetManager, DeviceCapabilities } from \"../utils/ExportOptimizationUtils\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const EnhancedTimelineCanvas = ({\n  timelineRef,\n  timelineScrollRef,\n  tracks,\n  timelineItems,\n  selectedTimelineItem,\n  draggedTimelineItem,\n  copiedItem,\n  dropPreview,\n  getTimelineWidth,\n  getPixelsPerSecond,\n  getTrackColor,\n  getTimelineItemStyle,\n  getDropPreviewStyle,\n  videoDuration,\n  timelineZoom,\n  currentTime,\n  formatTime,\n  onScroll,\n  onDragOver,\n  onDrop,\n  onDragLeave,\n  onClick,\n  onDoubleClick,\n  onTimelineItemSelect,\n  onTimelineItemDragStart,\n  onTimelineItemDragEnd,\n  onResizeStart\n}) => {\n  _s();\n  var _exportData$items3, _exportData$items4, _exportData$items5, _exportData$items6, _exportData$bounds, _getRecommendedSettin;\n  // Состояния для экспорта\n  const [isExportModalOpen, setIsExportModalOpen] = useState(false);\n  const [exportPreview, setExportPreview] = useState(null);\n  const [deviceCapabilities, setDeviceCapabilities] = useState(null);\n\n  // Мемоизированные данные для экспорта\n  const exportData = useMemo(() => {\n    if (timelineItems.length === 0) return null;\n    try {\n      console.log('🔄 Подготовка данных для экспорта...');\n\n      // Конвертируем данные timeline в формат экспорта\n      const convertedItems = TimelineDataAdapter.convertToExportFormat(timelineItems, tracks);\n\n      // Валидируем данные\n      const validation = TimelineDataAdapter.validateExportData(convertedItems);\n      if (!validation.isValid) {\n        console.warn('⚠️ Ошибки валидации экспорта:', validation.errors);\n      }\n\n      // Оптимизируем для экспорта\n      const optimizedItems = TimelineDataAdapter.optimizeForExport(convertedItems);\n\n      // Анализируем сложность\n      const complexity = TimelineDataAdapter.analyzeComplexity(optimizedItems);\n      return {\n        items: optimizedItems,\n        validation,\n        complexity,\n        bounds: TimelineDataAdapter.calculateTimelineBounds(optimizedItems),\n        groups: TimelineDataAdapter.groupByMediaType(optimizedItems)\n      };\n    } catch (error) {\n      console.error('❌ Ошибка подготовки данных экспорта:', error);\n      return null;\n    }\n  }, [timelineItems, tracks]);\n\n  // Инициализация возможностей устройства\n  React.useEffect(() => {\n    const capabilities = DeviceCapabilities.detect();\n    setDeviceCapabilities(capabilities);\n    console.log('📱 Определены возможности устройства:', capabilities);\n  }, []);\n\n  // Обработчики экспорта\n  const handleQuickExport = useCallback(() => {\n    var _exportData$items;\n    if (!(exportData !== null && exportData !== void 0 && (_exportData$items = exportData.items) !== null && _exportData$items !== void 0 && _exportData$items.length)) {\n      alert('Добавьте элементы в timeline для экспорта');\n      return;\n    }\n    console.log('⚡ Быстрый экспорт запущен');\n    setIsExportModalOpen(true);\n  }, [exportData]);\n  const handleExportWithSettings = useCallback(() => {\n    var _exportData$items2;\n    if (!(exportData !== null && exportData !== void 0 && (_exportData$items2 = exportData.items) !== null && _exportData$items2 !== void 0 && _exportData$items2.length)) {\n      alert('Добавьте элементы в timeline для экспорта');\n      return;\n    }\n    console.log('🛠️ Экспорт с настройками запущен');\n    setIsExportModalOpen(true);\n  }, [exportData]);\n  const closeExportModal = useCallback(() => {\n    setIsExportModalOpen(false);\n  }, []);\n\n  // Рекомендуемые настройки на основе анализа\n  const getRecommendedSettings = useCallback(() => {\n    if (!(exportData !== null && exportData !== void 0 && exportData.complexity) || !deviceCapabilities) return null;\n    const {\n      complexity\n    } = exportData;\n    const deviceSettings = DeviceCapabilities.getRecommendedSettings();\n    let recommendedPreset = 'balanced';\n\n    // Выбираем пресет на основе сложности и устройства\n    if (complexity.complexityLevel === 'simple' && deviceCapabilities.deviceClass === 'high') {\n      recommendedPreset = 'ultrafast';\n    } else if (complexity.complexityLevel === 'complex' || deviceCapabilities.deviceClass === 'low') {\n      recommendedPreset = 'quality';\n    } else if (deviceCapabilities.isMobile) {\n      recommendedPreset = 'mobile';\n    }\n    const presetSettings = ExportPresetManager.applyPreset(recommendedPreset, {\n      filename: `timeline_export_${Date.now()}`\n    });\n    return {\n      preset: recommendedPreset,\n      settings: presetSettings,\n      reason: this.getRecommendationReason(complexity, deviceCapabilities, recommendedPreset)\n    };\n  }, [exportData, deviceCapabilities]);\n  const getRecommendationReason = (complexity, device, preset) => {\n    const reasons = [];\n    if (preset === 'ultrafast') {\n      reasons.push('Простой timeline');\n      reasons.push('Мощное устройство');\n    } else if (preset === 'mobile') {\n      reasons.push('Мобильное устройство');\n    } else if (preset === 'quality') {\n      if (complexity.complexityLevel === 'complex') {\n        reasons.push('Сложный timeline с эффектами');\n      }\n      if (device.deviceClass === 'low') {\n        reasons.push('Ограниченные ресурсы устройства');\n      }\n    } else {\n      reasons.push('Сбалансированные настройки');\n    }\n    return reasons.join(', ');\n  };\n\n  // Статистика timeline для отображения\n  const timelineStats = useMemo(() => {\n    if (!exportData) return null;\n    const {\n      items,\n      bounds,\n      groups,\n      complexity\n    } = exportData;\n    return {\n      totalItems: items.length,\n      duration: bounds.duration.toFixed(1),\n      videoItems: groups.videos.length,\n      imageItems: groups.images.length,\n      audioItems: groups.audio.length,\n      overlayItems: complexity.overlayItems,\n      maxConcurrentItems: complexity.maxConcurrentItems,\n      complexityLevel: complexity.complexityLevel,\n      hasEffects: complexity.hasTransparency || complexity.hasRotation || complexity.hasScaling\n    };\n  }, [exportData]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-col h-full\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-gray-50 border-b border-gray-200 px-4 py-2 flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-600\",\n            children: timelineStats ? /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\uD83D\\uDCCA \", timelineStats.totalItems, \" \\u044D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432 \\u2022 \", timelineStats.duration, \"\\u0441 \\u2022\", timelineStats.videoItems, \"\\uD83C\\uDFAC \", timelineStats.imageItems, \"\\uD83D\\uDDBC\\uFE0F \", timelineStats.audioItems, \"\\uD83C\\uDFB5\", timelineStats.hasEffects && ' • ✨ Эффекты']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 17\n            }, this) : 'Добавьте элементы в timeline'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 13\n          }, this), (exportData === null || exportData === void 0 ? void 0 : exportData.complexity) && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `px-2 py-1 rounded text-xs font-medium ${exportData.complexity.complexityLevel === 'simple' ? 'bg-green-100 text-green-800' : exportData.complexity.complexityLevel === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`,\n            children: exportData.complexity.complexityLevel === 'simple' ? '🟢 Простой' : exportData.complexity.complexityLevel === 'medium' ? '🟡 Средний' : '🔴 Сложный'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [(() => {\n            const recommended = getRecommendedSettings();\n            return recommended && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs text-gray-500 mr-4\",\n              children: [\"\\uD83D\\uDCA1 \\u0420\\u0435\\u043A\\u043E\\u043C\\u0435\\u043D\\u0434\\u0443\\u0435\\u0442\\u0441\\u044F: \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"font-medium\",\n                children: recommended.preset\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 219,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 220,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-400\",\n                children: recommended.reason\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 218,\n              columnNumber: 17\n            }, this);\n          })(), timelineStats && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded flex items-center\",\n            children: [/*#__PURE__*/_jsxDEV(BarChart3, {\n              size: 12,\n              className: \"mr-1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 17\n            }, this), \"\\u041C\\u0430\\u043A\\u0441. \\u043E\\u0434\\u043D\\u043E\\u0432\\u0440\\u0435\\u043C\\u0435\\u043D\\u043D\\u043E: \", timelineStats.maxConcurrentItems]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleQuickExport,\n            disabled: !(exportData !== null && exportData !== void 0 && (_exportData$items3 = exportData.items) !== null && _exportData$items3 !== void 0 && _exportData$items3.length),\n            className: `px-3 py-1.5 text-sm rounded-lg font-medium transition-all flex items-center ${!(exportData !== null && exportData !== void 0 && (_exportData$items4 = exportData.items) !== null && _exportData$items4 !== void 0 && _exportData$items4.length) ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-yellow-500 to-orange-500 text-white hover:from-yellow-600 hover:to-orange-600 shadow-sm'}`,\n            children: [/*#__PURE__*/_jsxDEV(Zap, {\n              size: 14,\n              className: \"mr-1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 15\n            }, this), \"\\u0411\\u044B\\u0441\\u0442\\u0440\\u044B\\u0439 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleExportWithSettings,\n            disabled: !(exportData !== null && exportData !== void 0 && (_exportData$items5 = exportData.items) !== null && _exportData$items5 !== void 0 && _exportData$items5.length),\n            className: `px-3 py-1.5 text-sm rounded-lg font-medium transition-all flex items-center ${!(exportData !== null && exportData !== void 0 && (_exportData$items6 = exportData.items) !== null && _exportData$items6 !== void 0 && _exportData$items6.length) ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700 shadow-sm'}`,\n            children: [/*#__PURE__*/_jsxDEV(Settings, {\n              size: 14,\n              className: \"mr-1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 15\n            }, this), \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: el => {\n          timelineRef.current = el;\n          timelineScrollRef.current = el;\n        },\n        className: \"flex-1 relative overflow-auto bg-white\",\n        onScroll: onScroll,\n        onDragOver: onDragOver,\n        onDrop: onDrop,\n        onDragLeave: onDragLeave,\n        style: {\n          overflowX: \"auto\",\n          overflowY: \"auto\",\n          scrollbarWidth: \"thin\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: `${getTimelineWidth()}px`,\n            minHeight: \"100%\",\n            position: \"relative\"\n          },\n          onClick: onClick,\n          onDoubleClick: onDoubleClick,\n          children: [/*#__PURE__*/_jsxDEV(TimelineRuler, {\n            videoDuration: videoDuration,\n            timelineZoom: timelineZoom,\n            currentTime: currentTime,\n            formatTime: formatTime,\n            getPixelsPerSecond: getPixelsPerSecond,\n            getTimelineWidth: getTimelineWidth\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative flex-1\",\n            style: {\n              height: `${(tracks.overlays.length + tracks.main.length + tracks.audio.length) * 60}px`,\n              minHeight: \"100%\"\n            },\n            children: [timelineItems.map(item => /*#__PURE__*/_jsxDEV(TimelineItem, {\n              item: item,\n              isSelected: (selectedTimelineItem === null || selectedTimelineItem === void 0 ? void 0 : selectedTimelineItem.id) === item.id,\n              isDragged: (draggedTimelineItem === null || draggedTimelineItem === void 0 ? void 0 : draggedTimelineItem.id) === item.id,\n              isCopied: (copiedItem === null || copiedItem === void 0 ? void 0 : copiedItem.id) === item.id,\n              getTrackColor: getTrackColor,\n              getTimelineItemStyle: getTimelineItemStyle,\n              onSelect: onTimelineItemSelect,\n              onDragStart: onTimelineItemDragStart,\n              onDragEnd: onTimelineItemDragEnd,\n              onResizeStart: onResizeStart\n            }, item.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 17\n            }, this)), /*#__PURE__*/_jsxDEV(DropPreview, {\n              dropPreview: dropPreview,\n              getTrackColor: getTrackColor,\n              getDropPreviewStyle: getDropPreviewStyle\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-gray-50 border-t border-gray-200 px-4 py-2 text-xs text-gray-500\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-4\",\n            children: deviceCapabilities && /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\uD83D\\uDCF1 \", deviceCapabilities.isMobile ? 'Мобильное' : 'Десктоп', \" \\u0443\\u0441\\u0442\\u0440\\u043E\\u0439\\u0441\\u0442\\u0432\\u043E \\u2022\", deviceCapabilities.cores, \" \\u044F\\u0434\\u0435\\u0440 \\u2022 \", deviceCapabilities.deviceClass]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 13\n          }, this), (exportData === null || exportData === void 0 ? void 0 : exportData.validation) && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [exportData.validation.warnings.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-orange-600\",\n              children: [\"\\u26A0\\uFE0F \", exportData.validation.warnings.length, \" \\u043F\\u0440\\u0435\\u0434\\u0443\\u043F\\u0440\\u0435\\u0436\\u0434\\u0435\\u043D\\u0438\\u0439\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 350,\n              columnNumber: 19\n            }, this), exportData.validation.errors.length > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-red-600\",\n              children: [\"\\u274C \", exportData.validation.errors.length, \" \\u043E\\u0448\\u0438\\u0431\\u043E\\u043A\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 355,\n              columnNumber: 19\n            }, this), exportData.validation.isValid && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-green-600\",\n              children: \"\\u2705 \\u0413\\u043E\\u0442\\u043E\\u0432 \\u043A \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0443\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 360,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 336,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(OptimizedFFmpegExporter, {\n      isOpen: isExportModalOpen,\n      onClose: closeExportModal,\n      timelineItems: (exportData === null || exportData === void 0 ? void 0 : exportData.items) || [],\n      videoDuration: (exportData === null || exportData === void 0 ? void 0 : (_exportData$bounds = exportData.bounds) === null || _exportData$bounds === void 0 ? void 0 : _exportData$bounds.duration) || videoDuration,\n      initialSettings: (_getRecommendedSettin = getRecommendedSettings()) === null || _getRecommendedSettin === void 0 ? void 0 : _getRecommendedSettin.settings,\n      complexity: exportData === null || exportData === void 0 ? void 0 : exportData.complexity,\n      deviceCapabilities: deviceCapabilities\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(EnhancedTimelineCanvas, \"nVRFB4LlHLoZ1WUues7+wohHWmE=\");\n_c = EnhancedTimelineCanvas;\nvar _c;\n$RefreshReg$(_c, \"EnhancedTimelineCanvas\");","map":{"version":3,"names":["React","useState","useCallback","useMemo","Zap","Settings","BarChart3","DropPreview","TimelineItem","TimelineRuler","OptimizedFFmpegExporter","TimelineDataAdapter","ExportPresetManager","DeviceCapabilities","jsxDEV","_jsxDEV","Fragment","_Fragment","EnhancedTimelineCanvas","timelineRef","timelineScrollRef","tracks","timelineItems","selectedTimelineItem","draggedTimelineItem","copiedItem","dropPreview","getTimelineWidth","getPixelsPerSecond","getTrackColor","getTimelineItemStyle","getDropPreviewStyle","videoDuration","timelineZoom","currentTime","formatTime","onScroll","onDragOver","onDrop","onDragLeave","onClick","onDoubleClick","onTimelineItemSelect","onTimelineItemDragStart","onTimelineItemDragEnd","onResizeStart","_s","_exportData$items3","_exportData$items4","_exportData$items5","_exportData$items6","_exportData$bounds","_getRecommendedSettin","isExportModalOpen","setIsExportModalOpen","exportPreview","setExportPreview","deviceCapabilities","setDeviceCapabilities","exportData","length","console","log","convertedItems","convertToExportFormat","validation","validateExportData","isValid","warn","errors","optimizedItems","optimizeForExport","complexity","analyzeComplexity","items","bounds","calculateTimelineBounds","groups","groupByMediaType","error","useEffect","capabilities","detect","handleQuickExport","_exportData$items","alert","handleExportWithSettings","_exportData$items2","closeExportModal","getRecommendedSettings","deviceSettings","recommendedPreset","complexityLevel","deviceClass","isMobile","presetSettings","applyPreset","filename","Date","now","preset","settings","reason","getRecommendationReason","device","reasons","push","join","timelineStats","totalItems","duration","toFixed","videoItems","videos","imageItems","images","audioItems","audio","overlayItems","maxConcurrentItems","hasEffects","hasTransparency","hasRotation","hasScaling","children","className","fileName","_jsxFileName","lineNumber","columnNumber","recommended","size","disabled","ref","el","current","style","overflowX","overflowY","scrollbarWidth","width","minHeight","position","height","overlays","main","map","item","isSelected","id","isDragged","isCopied","onSelect","onDragStart","onDragEnd","cores","warnings","isOpen","onClose","initialSettings","_c","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/Timeline/EnhancedTimelineCanvas.jsx"],"sourcesContent":["import React, { useState, useCallback, useMemo } from \"react\";\r\nimport { Zap, Settings, BarChart3 } from \"lucide-react\";\r\n\r\nimport { DropPreview } from \"./DropPreview\";\r\nimport { TimelineItem } from \"./TimelineItem\";\r\nimport { TimelineRuler } from \"./TimelineRuler\";\r\nimport OptimizedFFmpegExporter from \"./OptimizedFFmpegExporter\";\r\nimport TimelineDataAdapter from \"../utils/timelineDataAdapter/\";\r\nimport { ExportPresetManager, DeviceCapabilities } from \"../utils/ExportOptimizationUtils\";\r\n\r\nexport const EnhancedTimelineCanvas = ({\r\n  timelineRef,\r\n  timelineScrollRef,\r\n  tracks,\r\n  timelineItems,\r\n  selectedTimelineItem,\r\n  draggedTimelineItem,\r\n  copiedItem,\r\n  dropPreview,\r\n  getTimelineWidth,\r\n  getPixelsPerSecond,\r\n  getTrackColor,\r\n  getTimelineItemStyle,\r\n  getDropPreviewStyle,\r\n  videoDuration,\r\n  timelineZoom,\r\n  currentTime,\r\n  formatTime,\r\n  onScroll,\r\n  onDragOver,\r\n  onDrop,\r\n  onDragLeave,\r\n  onClick,\r\n  onDoubleClick,\r\n  onTimelineItemSelect,\r\n  onTimelineItemDragStart,\r\n  onTimelineItemDragEnd,\r\n  onResizeStart,\r\n}) => {\r\n  // Состояния для экспорта\r\n  const [isExportModalOpen, setIsExportModalOpen] = useState(false);\r\n  const [exportPreview, setExportPreview] = useState(null);\r\n  const [deviceCapabilities, setDeviceCapabilities] = useState(null);\r\n\r\n  // Мемоизированные данные для экспорта\r\n  const exportData = useMemo(() => {\r\n    if (timelineItems.length === 0) return null;\r\n\r\n    try {\r\n      console.log('🔄 Подготовка данных для экспорта...');\r\n      \r\n      // Конвертируем данные timeline в формат экспорта\r\n      const convertedItems = TimelineDataAdapter.convertToExportFormat(timelineItems, tracks);\r\n      \r\n      // Валидируем данные\r\n      const validation = TimelineDataAdapter.validateExportData(convertedItems);\r\n      if (!validation.isValid) {\r\n        console.warn('⚠️ Ошибки валидации экспорта:', validation.errors);\r\n      }\r\n      \r\n      // Оптимизируем для экспорта\r\n      const optimizedItems = TimelineDataAdapter.optimizeForExport(convertedItems);\r\n      \r\n      // Анализируем сложность\r\n      const complexity = TimelineDataAdapter.analyzeComplexity(optimizedItems);\r\n      \r\n      return {\r\n        items: optimizedItems,\r\n        validation,\r\n        complexity,\r\n        bounds: TimelineDataAdapter.calculateTimelineBounds(optimizedItems),\r\n        groups: TimelineDataAdapter.groupByMediaType(optimizedItems)\r\n      };\r\n    } catch (error) {\r\n      console.error('❌ Ошибка подготовки данных экспорта:', error);\r\n      return null;\r\n    }\r\n  }, [timelineItems, tracks]);\r\n\r\n  // Инициализация возможностей устройства\r\n  React.useEffect(() => {\r\n    const capabilities = DeviceCapabilities.detect();\r\n    setDeviceCapabilities(capabilities);\r\n    console.log('📱 Определены возможности устройства:', capabilities);\r\n  }, []);\r\n\r\n  // Обработчики экспорта\r\n  const handleQuickExport = useCallback(() => {\r\n    if (!exportData?.items?.length) {\r\n      alert('Добавьте элементы в timeline для экспорта');\r\n      return;\r\n    }\r\n\r\n    console.log('⚡ Быстрый экспорт запущен');\r\n    setIsExportModalOpen(true);\r\n  }, [exportData]);\r\n\r\n  const handleExportWithSettings = useCallback(() => {\r\n    if (!exportData?.items?.length) {\r\n      alert('Добавьте элементы в timeline для экспорта');\r\n      return;\r\n    }\r\n\r\n    console.log('🛠️ Экспорт с настройками запущен');\r\n    setIsExportModalOpen(true);\r\n  }, [exportData]);\r\n\r\n  const closeExportModal = useCallback(() => {\r\n    setIsExportModalOpen(false);\r\n  }, []);\r\n\r\n  // Рекомендуемые настройки на основе анализа\r\n  const getRecommendedSettings = useCallback(() => {\r\n    if (!exportData?.complexity || !deviceCapabilities) return null;\r\n\r\n    const { complexity } = exportData;\r\n    const deviceSettings = DeviceCapabilities.getRecommendedSettings();\r\n    \r\n    let recommendedPreset = 'balanced';\r\n    \r\n    // Выбираем пресет на основе сложности и устройства\r\n    if (complexity.complexityLevel === 'simple' && deviceCapabilities.deviceClass === 'high') {\r\n      recommendedPreset = 'ultrafast';\r\n    } else if (complexity.complexityLevel === 'complex' || deviceCapabilities.deviceClass === 'low') {\r\n      recommendedPreset = 'quality';\r\n    } else if (deviceCapabilities.isMobile) {\r\n      recommendedPreset = 'mobile';\r\n    }\r\n\r\n    const presetSettings = ExportPresetManager.applyPreset(recommendedPreset, {\r\n      filename: `timeline_export_${Date.now()}`\r\n    });\r\n\r\n    return {\r\n      preset: recommendedPreset,\r\n      settings: presetSettings,\r\n      reason: this.getRecommendationReason(complexity, deviceCapabilities, recommendedPreset)\r\n    };\r\n  }, [exportData, deviceCapabilities]);\r\n\r\n  const getRecommendationReason = (complexity, device, preset) => {\r\n    const reasons = [];\r\n    \r\n    if (preset === 'ultrafast') {\r\n      reasons.push('Простой timeline');\r\n      reasons.push('Мощное устройство');\r\n    } else if (preset === 'mobile') {\r\n      reasons.push('Мобильное устройство');\r\n    } else if (preset === 'quality') {\r\n      if (complexity.complexityLevel === 'complex') {\r\n        reasons.push('Сложный timeline с эффектами');\r\n      }\r\n      if (device.deviceClass === 'low') {\r\n        reasons.push('Ограниченные ресурсы устройства');\r\n      }\r\n    } else {\r\n      reasons.push('Сбалансированные настройки');\r\n    }\r\n    \r\n    return reasons.join(', ');\r\n  };\r\n\r\n  // Статистика timeline для отображения\r\n  const timelineStats = useMemo(() => {\r\n    if (!exportData) return null;\r\n\r\n    const { items, bounds, groups, complexity } = exportData;\r\n\r\n    return {\r\n      totalItems: items.length,\r\n      duration: bounds.duration.toFixed(1),\r\n      videoItems: groups.videos.length,\r\n      imageItems: groups.images.length,\r\n      audioItems: groups.audio.length,\r\n      overlayItems: complexity.overlayItems,\r\n      maxConcurrentItems: complexity.maxConcurrentItems,\r\n      complexityLevel: complexity.complexityLevel,\r\n      hasEffects: complexity.hasTransparency || complexity.hasRotation || complexity.hasScaling\r\n    };\r\n  }, [exportData]);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex flex-col h-full\">\r\n        {/* Панель экспорта */}\r\n        <div className=\"bg-gray-50 border-b border-gray-200 px-4 py-2 flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            <div className=\"text-sm text-gray-600\">\r\n              {timelineStats ? (\r\n                <span>\r\n                  📊 {timelineStats.totalItems} элементов • {timelineStats.duration}с • \r\n                  {timelineStats.videoItems}🎬 {timelineStats.imageItems}🖼️ {timelineStats.audioItems}🎵\r\n                  {timelineStats.hasEffects && ' • ✨ Эффекты'}\r\n                </span>\r\n              ) : (\r\n                'Добавьте элементы в timeline'\r\n              )}\r\n            </div>\r\n            \r\n            {exportData?.complexity && (\r\n              <div className={`px-2 py-1 rounded text-xs font-medium ${\r\n                exportData.complexity.complexityLevel === 'simple' ? 'bg-green-100 text-green-800' :\r\n                exportData.complexity.complexityLevel === 'medium' ? 'bg-yellow-100 text-yellow-800' :\r\n                'bg-red-100 text-red-800'\r\n              }`}>\r\n                {exportData.complexity.complexityLevel === 'simple' ? '🟢 Простой' :\r\n                 exportData.complexity.complexityLevel === 'medium' ? '🟡 Средний' :\r\n                 '🔴 Сложный'}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"flex items-center space-x-2\">\r\n            {/* Рекомендуемые настройки */}\r\n            {(() => {\r\n              const recommended = getRecommendedSettings();\r\n              return recommended && (\r\n                <div className=\"text-xs text-gray-500 mr-4\">\r\n                  💡 Рекомендуется: <span className=\"font-medium\">{recommended.preset}</span>\r\n                  <br />\r\n                  <span className=\"text-gray-400\">{recommended.reason}</span>\r\n                </div>\r\n              );\r\n            })()}\r\n\r\n            {/* Кнопка статистики */}\r\n            {timelineStats && (\r\n              <div className=\"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded flex items-center\">\r\n                <BarChart3 size={12} className=\"mr-1\" />\r\n                Макс. одновременно: {timelineStats.maxConcurrentItems}\r\n              </div>\r\n            )}\r\n\r\n            {/* Кнопки экспорта */}\r\n            <button\r\n              onClick={handleQuickExport}\r\n              disabled={!exportData?.items?.length}\r\n              className={`px-3 py-1.5 text-sm rounded-lg font-medium transition-all flex items-center ${\r\n                !exportData?.items?.length\r\n                  ? 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n                  : 'bg-gradient-to-r from-yellow-500 to-orange-500 text-white hover:from-yellow-600 hover:to-orange-600 shadow-sm'\r\n              }`}\r\n            >\r\n              <Zap size={14} className=\"mr-1\" />\r\n              Быстрый экспорт\r\n            </button>\r\n\r\n            <button\r\n              onClick={handleExportWithSettings}\r\n              disabled={!exportData?.items?.length}\r\n              className={`px-3 py-1.5 text-sm rounded-lg font-medium transition-all flex items-center ${\r\n                !exportData?.items?.length\r\n                  ? 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n                  : 'bg-blue-600 text-white hover:bg-blue-700 shadow-sm'\r\n              }`}\r\n            >\r\n              <Settings size={14} className=\"mr-1\" />\r\n              Настройки\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Основной timeline canvas */}\r\n        <div\r\n          ref={(el) => {\r\n            timelineRef.current = el;\r\n            timelineScrollRef.current = el;\r\n          }}\r\n          className=\"flex-1 relative overflow-auto bg-white\"\r\n          onScroll={onScroll}\r\n          onDragOver={onDragOver}\r\n          onDrop={onDrop}\r\n          onDragLeave={onDragLeave}\r\n          style={{\r\n            overflowX: \"auto\",\r\n            overflowY: \"auto\",\r\n            scrollbarWidth: \"thin\",\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              width: `${getTimelineWidth()}px`,\r\n              minHeight: \"100%\",\r\n              position: \"relative\",\r\n            }}\r\n            onClick={onClick}\r\n            onDoubleClick={onDoubleClick}\r\n          >\r\n            <TimelineRuler\r\n              videoDuration={videoDuration}\r\n              timelineZoom={timelineZoom}\r\n              currentTime={currentTime}\r\n              formatTime={formatTime}\r\n              getPixelsPerSecond={getPixelsPerSecond}\r\n              getTimelineWidth={getTimelineWidth}\r\n            />\r\n\r\n            <div\r\n              className=\"relative flex-1\"\r\n              style={{\r\n                height: `${\r\n                  (tracks.overlays.length +\r\n                    tracks.main.length +\r\n                    tracks.audio.length) *\r\n                  60\r\n                }px`,\r\n                minHeight: \"100%\",\r\n              }}\r\n            >\r\n              {timelineItems.map((item) => (\r\n                <TimelineItem\r\n                  key={item.id}\r\n                  item={item}\r\n                  isSelected={selectedTimelineItem?.id === item.id}\r\n                  isDragged={draggedTimelineItem?.id === item.id}\r\n                  isCopied={copiedItem?.id === item.id}\r\n                  getTrackColor={getTrackColor}\r\n                  getTimelineItemStyle={getTimelineItemStyle}\r\n                  onSelect={onTimelineItemSelect}\r\n                  onDragStart={onTimelineItemDragStart}\r\n                  onDragEnd={onTimelineItemDragEnd}\r\n                  onResizeStart={onResizeStart}\r\n                />\r\n              ))}\r\n\r\n              <DropPreview\r\n                dropPreview={dropPreview}\r\n                getTrackColor={getTrackColor}\r\n                getDropPreviewStyle={getDropPreviewStyle}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Нижняя панель с дополнительной информацией */}\r\n        <div className=\"bg-gray-50 border-t border-gray-200 px-4 py-2 text-xs text-gray-500\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              {deviceCapabilities && (\r\n                <span>\r\n                  📱 {deviceCapabilities.isMobile ? 'Мобильное' : 'Десктоп'} устройство • \r\n                  {deviceCapabilities.cores} ядер • {deviceCapabilities.deviceClass}\r\n                </span>\r\n              )}\r\n            </div>\r\n            \r\n            {exportData?.validation && (\r\n              <div className=\"flex items-center space-x-2\">\r\n                {exportData.validation.warnings.length > 0 && (\r\n                  <span className=\"text-orange-600\">\r\n                    ⚠️ {exportData.validation.warnings.length} предупреждений\r\n                  </span>\r\n                )}\r\n                {exportData.validation.errors.length > 0 && (\r\n                  <span className=\"text-red-600\">\r\n                    ❌ {exportData.validation.errors.length} ошибок\r\n                  </span>\r\n                )}\r\n                {exportData.validation.isValid && (\r\n                  <span className=\"text-green-600\">✅ Готов к экспорту</span>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Модал экспорта */}\r\n      <OptimizedFFmpegExporter\r\n        isOpen={isExportModalOpen}\r\n        onClose={closeExportModal}\r\n        timelineItems={exportData?.items || []}\r\n        videoDuration={exportData?.bounds?.duration || videoDuration}\r\n        initialSettings={getRecommendedSettings()?.settings}\r\n        complexity={exportData?.complexity}\r\n        deviceCapabilities={deviceCapabilities}\r\n      />\r\n    </>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}