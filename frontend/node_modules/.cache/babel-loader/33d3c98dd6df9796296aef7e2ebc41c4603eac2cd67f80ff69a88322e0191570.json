{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\VideoExportModal.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport { X, Download, Check, AlertCircle } from \"lucide-react\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const VideoExportModal = ({\n  isOpen,\n  onClose,\n  timelineItems,\n  tracks,\n  videoDuration,\n  onExport\n}) => {\n  _s();\n  const [exportSettings, setExportSettings] = useState({\n    resolution: \"1920x1080\",\n    fps: 30,\n    bitrate: 5000,\n    format: \"mp4\",\n    quality: \"high\"\n  });\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportProgress, setExportProgress] = useState(0);\n  const [exportStatus, setExportStatus] = useState(\"idle\");\n  const [estimatedTime, setEstimatedTime] = useState(null);\n\n  // 🔧 ИСПРАВЛЕНО: Вынесли опции в константы, чтобы они не пересоздавались каждый рендер\n  const resolutionOptions = [{\n    value: \"3840x2160\",\n    label: \"4K (3840×2160)\",\n    size: \"2160p\"\n  }, {\n    value: \"1920x1080\",\n    label: \"Full HD (1920×1080)\",\n    size: \"1080p\"\n  }, {\n    value: \"1280x720\",\n    label: \"HD (1280×720)\",\n    size: \"720p\"\n  }, {\n    value: \"854x480\",\n    label: \"SD (854×480)\",\n    size: \"480p\"\n  }];\n  const fpsOptions = [24, 30, 60];\n  const qualityOptions = [{\n    value: \"low\",\n    label: \"Низкое качество\",\n    bitrate: 1000\n  }, {\n    value: \"medium\",\n    label: \"Среднее качество\",\n    bitrate: 3000\n  }, {\n    value: \"high\",\n    label: \"Высокое качество\",\n    bitrate: 5000\n  }, {\n    value: \"ultra\",\n    label: \"Ультра качество\",\n    bitrate: 10000\n  }];\n  const formatOptions = [{\n    value: \"mp4\",\n    label: \"MP4 (H.264)\",\n    extension: \".mp4\"\n  }, {\n    value: \"webm\",\n    label: \"WebM (VP9)\",\n    extension: \".webm\"\n  }, {\n    value: \"mov\",\n    label: \"QuickTime (MOV)\",\n    extension: \".mov\"\n  }];\n\n  // 🔧 ИСПРАВЛЕНО: Добавили правильные зависимости и убрали qualityOptions из deps\n  useEffect(() => {\n    if (exportSettings.quality) {\n      const quality = qualityOptions.find(q => q.value === exportSettings.quality);\n      if (quality && quality.bitrate !== exportSettings.bitrate) {\n        setExportSettings(prev => ({\n          ...prev,\n          bitrate: quality.bitrate\n        }));\n      }\n    }\n  }, [exportSettings.quality]); // Убрали qualityOptions из зависимостей\n\n  // 🔧 ИСПРАВЛЕНО: Оптимизировали расчет времени\n  useEffect(() => {\n    if (videoDuration && exportSettings.fps && timelineItems) {\n      const complexity = timelineItems.filter(item => item.trackType === \"overlay\").length;\n      const multiplier = 2 + complexity * 0.5;\n      const newEstimatedTime = Math.ceil(videoDuration * multiplier);\n\n      // Обновляем только если значение действительно изменилось\n      if (newEstimatedTime !== estimatedTime) {\n        setEstimatedTime(newEstimatedTime);\n      }\n    }\n  }, [videoDuration, exportSettings.fps, timelineItems.length, estimatedTime]); // Изменили timelineItems на timelineItems.length\n\n  const getFileSize = () => {\n    if (!videoDuration) return \"~\";\n    const sizeInMB = exportSettings.bitrate * videoDuration * 1000 / (8 * 1024 * 1024);\n    if (sizeInMB < 1024) {\n      return `~${sizeInMB.toFixed(0)} МБ`;\n    } else {\n      return `~${(sizeInMB / 1024).toFixed(1)} ГБ`;\n    }\n  };\n  const handleExport = async () => {\n    if (!timelineItems || timelineItems.length === 0) {\n      alert('Нет элементов для экспорта!');\n      return;\n    }\n    setIsExporting(true);\n    setExportStatus(\"processing\");\n    setExportProgress(0);\n    try {\n      await simulateVideoExport();\n      setExportStatus(\"success\");\n    } catch (error) {\n      console.error(\"Export failed:\", error);\n      setExportStatus(\"error\");\n    } finally {\n      setIsExporting(false);\n    }\n  };\n  const simulateVideoExport = async () => {\n    const totalSteps = 100;\n    const stepDuration = estimatedTime * 1000 / totalSteps;\n    for (let i = 0; i <= totalSteps; i++) {\n      setExportProgress(i);\n      const delay = stepDuration * (1 + Math.sin(i / 20) * 0.3);\n      await new Promise(resolve => setTimeout(resolve, delay));\n      if (i === totalSteps) {\n        await actualVideoExport();\n      }\n    }\n  };\n  const actualVideoExport = async () => {\n    try {\n      const videoExporter = new VideoExporter({\n        timelineItems,\n        tracks,\n        videoDuration,\n        settings: exportSettings\n      });\n      const exportedVideoBlob = await videoExporter.render();\n      downloadVideo(exportedVideoBlob);\n    } catch (error) {\n      console.error('Ошибка при экспорте:', error);\n      throw error;\n    }\n  };\n  const downloadVideo = blob => {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n\n    // Определяем правильное расширение\n    let extension = exportSettings.format;\n    if (blob.type.includes('webm')) {\n      extension = 'webm';\n    } else if (blob.type.includes('mp4')) {\n      extension = 'mp4';\n    }\n    a.download = `edited_video_${Date.now()}.${extension}`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  // 🔧 ИСПРАВЛЕНО: Сброс состояния при закрытии модалки\n  const handleClose = () => {\n    if (!isExporting) {\n      setExportStatus(\"idle\");\n      setExportProgress(0);\n      onClose();\n    }\n  };\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between p-6 border-b border-gray-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold text-gray-800 flex items-center\",\n          children: [/*#__PURE__*/_jsxDEV(Download, {\n            size: 24,\n            className: \"mr-2 text-blue-600\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this), \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleClose,\n          className: \"p-2 hover:bg-gray-100 rounded-full transition-colors\",\n          disabled: isExporting,\n          children: /*#__PURE__*/_jsxDEV(X, {\n            size: 20\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6 space-y-6 max-h-[calc(90vh-120px)] overflow-y-auto\",\n        children: [exportStatus !== \"idle\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `p-4 rounded-xl ${exportStatus === \"processing\" ? \"bg-blue-50 border border-blue-200\" : exportStatus === \"success\" ? \"bg-green-50 border border-green-200\" : \"bg-red-50 border border-red-200\"}`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center\",\n            children: [exportStatus === \"processing\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600 mr-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex-1\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex justify-between text-sm text-blue-700 mb-2\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 208,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: [exportProgress, \"%\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 209,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 207,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-full bg-blue-200 rounded-full h-2\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"bg-blue-600 h-2 rounded-full transition-all duration-300\",\n                    style: {\n                      width: `${exportProgress}%`\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 212,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 211,\n                  columnNumber: 23\n                }, this), estimatedTime && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-xs text-blue-600 mt-2\",\n                  children: [\"\\u041E\\u0441\\u0442\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u0440\\u0438\\u043C\\u0435\\u0440\\u043D\\u043E:\", \" \", Math.max(0, Math.ceil(estimatedTime * (100 - exportProgress) / 100)), \" \", \"\\u0441\\u0435\\u043A\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 218,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true), exportStatus === \"success\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Check, {\n                size: 20,\n                className: \"text-green-600 mr-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-green-700 font-medium\",\n                children: \"\\u0412\\u0438\\u0434\\u0435\\u043E \\u0443\\u0441\\u043F\\u0435\\u0448\\u043D\\u043E \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u043E!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true), exportStatus === \"error\" && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(AlertCircle, {\n                size: 20,\n                className: \"text-red-600 mr-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-red-700 font-medium\",\n                children: \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u043F\\u0440\\u0438 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0435 \\u0432\\u0438\\u0434\\u0435\\u043E\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-cols-1 md:grid-cols-2 gap-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-2\",\n              children: \"\\u0420\\u0430\\u0437\\u0440\\u0435\\u0448\\u0435\\u043D\\u0438\\u0435\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: exportSettings.resolution,\n              onChange: e => setExportSettings(prev => ({\n                ...prev,\n                resolution: e.target.value\n              })),\n              className: \"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\",\n              disabled: isExporting,\n              children: resolutionOptions.map(option => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: option.value,\n                children: option.label\n              }, option.value, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 259,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-2\",\n              children: \"\\u0427\\u0430\\u0441\\u0442\\u043E\\u0442\\u0430 \\u043A\\u0430\\u0434\\u0440\\u043E\\u0432 (FPS)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: exportSettings.fps,\n              onChange: e => setExportSettings(prev => ({\n                ...prev,\n                fps: parseInt(e.target.value)\n              })),\n              className: \"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\",\n              disabled: isExporting,\n              children: fpsOptions.map(fps => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: fps,\n                children: [fps, \" FPS\"]\n              }, fps, true, {\n                fileName: _jsxFileName,\n                lineNumber: 294,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-2\",\n              children: \"\\u041A\\u0430\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: exportSettings.quality,\n              onChange: e => setExportSettings(prev => ({\n                ...prev,\n                quality: e.target.value\n              })),\n              className: \"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\",\n              disabled: isExporting,\n              children: qualityOptions.map(quality => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: quality.value,\n                children: [quality.label, \" (\", quality.bitrate, \" kbps)\"]\n              }, quality.value, true, {\n                fileName: _jsxFileName,\n                lineNumber: 317,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"block text-sm font-medium text-gray-700 mb-2\",\n              children: \"\\u0424\\u043E\\u0440\\u043C\\u0430\\u0442\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: exportSettings.format,\n              onChange: e => setExportSettings(prev => ({\n                ...prev,\n                format: e.target.value\n              })),\n              className: \"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\",\n              disabled: isExporting,\n              children: formatOptions.map(format => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: format.value,\n                children: format.label\n              }, format.value, false, {\n                fileName: _jsxFileName,\n                lineNumber: 340,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-50 rounded-xl p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"font-medium text-gray-800 mb-3\",\n            children: \"\\u0418\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044F \\u043E\\u0431 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0435\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 349,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-4 text-sm\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-600\",\n                children: \"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 354,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"ml-2 font-medium\",\n                children: [Math.round(videoDuration), \"\\u0441\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 355,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 353,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-600\",\n                children: \"\\u0420\\u0430\\u0437\\u043C\\u0435\\u0440 \\u0444\\u0430\\u0439\\u043B\\u0430:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 360,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"ml-2 font-medium\",\n                children: getFileSize()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-600\",\n                children: \"\\u0411\\u0438\\u0442\\u0440\\u0435\\u0439\\u0442:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 364,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"ml-2 font-medium\",\n                children: [exportSettings.bitrate, \" kbps\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 365,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 363,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-600\",\n                children: \"\\u0412\\u0440\\u0435\\u043C\\u044F \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 370,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"ml-2 font-medium\",\n                children: [\"~\", estimatedTime, \"\\u0441\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 371,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-50 rounded-xl p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"font-medium text-gray-800 mb-3\",\n            children: [\"\\u042D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442\\u044B \\u0434\\u043B\\u044F \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430 (\", (timelineItems === null || timelineItems === void 0 ? void 0 : timelineItems.length) || 0, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-2 max-h-32 overflow-y-auto\",\n            children: timelineItems && timelineItems.length > 0 ? timelineItems.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-between text-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-700 truncate\",\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 387,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: `px-2 py-1 rounded text-xs flex-shrink-0 ml-2 ${item.trackType === \"main\" ? \"bg-blue-100 text-blue-700\" : item.trackType === \"audio\" ? \"bg-green-100 text-green-700\" : \"bg-purple-100 text-purple-700\"}`,\n                children: item.trackType\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 388,\n                columnNumber: 21\n              }, this)]\n            }, item.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 383,\n              columnNumber: 19\n            }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-gray-500 text-sm text-center py-4\",\n              children: \"\\u041D\\u0435\\u0442 \\u044D\\u043B\\u0435\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432 \\u0434\\u043B\\u044F \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-end space-x-3 p-6 border-t border-gray-200\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleClose,\n          className: \"px-6 py-2 text-gray-600 hover:text-gray-800 transition-colors\",\n          disabled: isExporting,\n          children: \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleExport,\n          disabled: isExporting || !timelineItems || timelineItems.length === 0,\n          className: `px-6 py-3 rounded-xl font-medium transition-all flex items-center ${isExporting || !timelineItems || timelineItems.length === 0 ? \"bg-gray-300 text-gray-500 cursor-not-allowed\" : \"bg-blue-600 text-white hover:bg-blue-700 hover:shadow-lg\"}`,\n          children: isExporting ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 429,\n              columnNumber: 17\n            }, this), \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442...\"]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(Download, {\n              size: 16,\n              className: \"mr-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 434,\n              columnNumber: 17\n            }, this), \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 5\n  }, this);\n};\n\n// 🔧 ИСПРАВЛЕННЫЙ VideoExporter класс\n_s(VideoExportModal, \"/oD81cKCIxVUBwvk7mGAXZ4GqR8=\");\n_c = VideoExportModal;\nclass VideoExporter {\n  constructor({\n    timelineItems,\n    tracks,\n    videoDuration,\n    settings\n  }) {\n    this.timelineItems = timelineItems;\n    this.tracks = tracks;\n    this.videoDuration = videoDuration;\n    this.settings = settings;\n    this.canvas = document.createElement(\"canvas\");\n    this.ctx = this.canvas.getContext(\"2d\");\n    const [width, height] = settings.resolution.split(\"x\").map(Number);\n    this.canvas.width = width;\n    this.canvas.height = height;\n  }\n  async render() {\n    try {\n      const stream = this.canvas.captureStream(this.settings.fps);\n      const options = {\n        mimeType: this.getMimeType(),\n        videoBitsPerSecond: this.settings.bitrate * 1000\n      };\n      const mediaRecorder = new MediaRecorder(stream, options);\n      const chunks = [];\n      mediaRecorder.ondataavailable = event => {\n        if (event.data.size > 0) {\n          chunks.push(event.data);\n        }\n      };\n      return new Promise((resolve, reject) => {\n        mediaRecorder.onstop = () => {\n          const blob = new Blob(chunks, {\n            type: `video/${this.settings.format}`\n          });\n          resolve(blob);\n        };\n        mediaRecorder.onerror = reject;\n        mediaRecorder.start(100); // Записываем данные каждые 100мс\n\n        this.renderFrames().then(() => {\n          setTimeout(() => {\n            mediaRecorder.stop();\n          }, 100);\n        }).catch(reject);\n      });\n    } catch (error) {\n      console.error('Ошибка настройки записи:', error);\n      throw error;\n    }\n  }\n  getMimeType() {\n    // Проверяем поддержку разных форматов\n    const testTypes = ['video/webm;codecs=vp9', 'video/webm;codecs=vp8', 'video/mp4;codecs=h264', 'video/webm'];\n    for (const type of testTypes) {\n      if (MediaRecorder.isTypeSupported(type)) {\n        return type;\n      }\n    }\n    return 'video/webm'; // fallback\n  }\n  async renderFrames() {\n    const frameCount = Math.ceil(this.videoDuration * this.settings.fps);\n    const frameDuration = 1000 / this.settings.fps; // в миллисекундах\n\n    for (let frame = 0; frame < frameCount; frame++) {\n      const currentTime = frame / this.settings.fps;\n      await this.renderFrame(currentTime);\n\n      // Ждем между кадрами для плавности\n      await new Promise(resolve => setTimeout(resolve, frameDuration / 10));\n    }\n  }\n  async renderFrame(currentTime) {\n    // Черный фон\n    this.ctx.fillStyle = \"#000000\";\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\n    // Сортируем элементы по слоям\n    const sortedItems = [...this.timelineItems].sort((a, b) => {\n      const order = {\n        main: 1,\n        audio: 2,\n        overlay: 3\n      };\n      return order[a.trackType] - order[b.trackType];\n    });\n\n    // Рендерим активные элементы\n    for (const item of sortedItems) {\n      if (this.isItemActive(item, currentTime)) {\n        await this.renderItem(item, currentTime - item.startTime);\n      }\n    }\n  }\n  isItemActive(item, currentTime) {\n    return currentTime >= item.startTime && currentTime < item.startTime + item.duration;\n  }\n  async renderItem(item, relativeTime) {\n    try {\n      this.ctx.save();\n      switch (item.type) {\n        case \"video\":\n          await this.renderVideo(item, relativeTime);\n          break;\n        case \"image\":\n          await this.renderImage(item);\n          break;\n        case \"text\":\n          this.renderText(item.text || item.name || 'Text');\n          break;\n      }\n    } catch (error) {\n      console.warn('Ошибка рендеринга элемента:', error);\n      // Рендерим placeholder\n      this.renderPlaceholder(item.name || 'Элемент');\n    } finally {\n      this.ctx.restore();\n    }\n  }\n  async renderVideo(item, relativeTime) {\n    if (!item.videoElement) return;\n    try {\n      item.videoElement.currentTime = relativeTime;\n      await this.waitForVideoFrame(item.videoElement);\n      this.drawScaled(item.videoElement);\n    } catch (error) {\n      console.warn('Ошибка рендеринга видео:', error);\n    }\n  }\n  async renderImage(item) {\n    if (!item.imageElement) return;\n    try {\n      await this.waitForImageLoad(item.imageElement);\n      this.drawScaled(item.imageElement);\n    } catch (error) {\n      console.warn('Ошибка рендеринга изображения:', error);\n    }\n  }\n  renderText(text) {\n    this.ctx.fillStyle = \"#ffffff\";\n    this.ctx.font = \"48px Arial\";\n    this.ctx.textAlign = \"center\";\n    this.ctx.textBaseline = \"middle\";\n    const x = this.canvas.width / 2;\n    const y = this.canvas.height / 2;\n\n    // Обводка\n    this.ctx.strokeStyle = \"#000000\";\n    this.ctx.lineWidth = 4;\n    this.ctx.strokeText(text, x, y);\n\n    // Текст\n    this.ctx.fillText(text, x, y);\n  }\n  renderPlaceholder(text) {\n    this.ctx.fillStyle = \"#333333\";\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    this.ctx.fillStyle = \"#ffffff\";\n    this.ctx.font = \"24px Arial\";\n    this.ctx.textAlign = \"center\";\n    this.ctx.fillText(text, this.canvas.width / 2, this.canvas.height / 2);\n  }\n  drawScaled(element) {\n    const canvasRatio = this.canvas.width / this.canvas.height;\n    const elementWidth = element.videoWidth || element.naturalWidth || element.width;\n    const elementHeight = element.videoHeight || element.naturalHeight || element.height;\n    if (!elementWidth || !elementHeight) return;\n    const elementRatio = elementWidth / elementHeight;\n    let drawWidth, drawHeight, drawX, drawY;\n    if (elementRatio > canvasRatio) {\n      drawWidth = this.canvas.width;\n      drawHeight = this.canvas.width / elementRatio;\n      drawX = 0;\n      drawY = (this.canvas.height - drawHeight) / 2;\n    } else {\n      drawHeight = this.canvas.height;\n      drawWidth = this.canvas.height * elementRatio;\n      drawX = (this.canvas.width - drawWidth) / 2;\n      drawY = 0;\n    }\n    this.ctx.drawImage(element, drawX, drawY, drawWidth, drawHeight);\n  }\n  async waitForVideoFrame(videoElement) {\n    return new Promise(resolve => {\n      const checkReady = () => {\n        if (videoElement.readyState >= 2) {\n          resolve();\n        } else {\n          setTimeout(checkReady, 10);\n        }\n      };\n      checkReady();\n    });\n  }\n  async waitForImageLoad(imageElement) {\n    return new Promise((resolve, reject) => {\n      if (imageElement.complete && imageElement.naturalWidth > 0) {\n        resolve();\n      } else {\n        const onLoad = () => {\n          imageElement.removeEventListener('load', onLoad);\n          imageElement.removeEventListener('error', onError);\n          resolve();\n        };\n        const onError = () => {\n          imageElement.removeEventListener('load', onLoad);\n          imageElement.removeEventListener('error', onError);\n          reject(new Error('Не удалось загрузить изображение'));\n        };\n        imageElement.addEventListener('load', onLoad);\n        imageElement.addEventListener('error', onError);\n      }\n    });\n  }\n}\n\n// 🔧 ИСПРАВЛЕННЫЙ хук для использования экспорта\nexport const useVideoExporter = () => {\n  _s2();\n  const [isExportModalOpen, setIsExportModalOpen] = useState(false);\n  const openExportModal = () => setIsExportModalOpen(true);\n  const closeExportModal = () => setIsExportModalOpen(false);\n  return {\n    isExportModalOpen,\n    openExportModal,\n    closeExportModal\n  };\n};\n_s2(useVideoExporter, \"Wfaj4kprhDIijrMYdBElG6JtIdM=\");\nvar _c;\n$RefreshReg$(_c, \"VideoExportModal\");","map":{"version":3,"names":["useState","useEffect","X","Download","Check","AlertCircle","jsxDEV","_jsxDEV","Fragment","_Fragment","VideoExportModal","isOpen","onClose","timelineItems","tracks","videoDuration","onExport","_s","exportSettings","setExportSettings","resolution","fps","bitrate","format","quality","isExporting","setIsExporting","exportProgress","setExportProgress","exportStatus","setExportStatus","estimatedTime","setEstimatedTime","resolutionOptions","value","label","size","fpsOptions","qualityOptions","formatOptions","extension","find","q","prev","complexity","filter","item","trackType","length","multiplier","newEstimatedTime","Math","ceil","getFileSize","sizeInMB","toFixed","handleExport","alert","simulateVideoExport","error","console","totalSteps","stepDuration","i","delay","sin","Promise","resolve","setTimeout","actualVideoExport","videoExporter","VideoExporter","settings","exportedVideoBlob","render","downloadVideo","blob","url","URL","createObjectURL","a","document","createElement","href","type","includes","download","Date","now","body","appendChild","click","removeChild","revokeObjectURL","handleClose","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","style","width","max","onChange","e","target","map","option","parseInt","round","name","id","_c","constructor","canvas","ctx","getContext","height","split","Number","stream","captureStream","options","mimeType","getMimeType","videoBitsPerSecond","mediaRecorder","MediaRecorder","chunks","ondataavailable","event","data","push","reject","onstop","Blob","onerror","start","renderFrames","then","stop","catch","testTypes","isTypeSupported","frameCount","frameDuration","frame","currentTime","renderFrame","fillStyle","fillRect","sortedItems","sort","b","order","main","audio","overlay","isItemActive","renderItem","startTime","duration","relativeTime","save","renderVideo","renderImage","renderText","text","warn","renderPlaceholder","restore","videoElement","waitForVideoFrame","drawScaled","imageElement","waitForImageLoad","font","textAlign","textBaseline","x","y","strokeStyle","lineWidth","strokeText","fillText","element","canvasRatio","elementWidth","videoWidth","naturalWidth","elementHeight","videoHeight","naturalHeight","elementRatio","drawWidth","drawHeight","drawX","drawY","drawImage","checkReady","readyState","complete","onLoad","removeEventListener","onError","Error","addEventListener","useVideoExporter","_s2","isExportModalOpen","setIsExportModalOpen","openExportModal","closeExportModal","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/VideoExportModal.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { X, Download, Check, AlertCircle } from \"lucide-react\";\r\n\r\nexport const VideoExportModal = ({\r\n  isOpen,\r\n  onClose,\r\n  timelineItems,\r\n  tracks,\r\n  videoDuration,\r\n  onExport,\r\n}) => {\r\n  const [exportSettings, setExportSettings] = useState({\r\n    resolution: \"1920x1080\",\r\n    fps: 30,\r\n    bitrate: 5000,\r\n    format: \"mp4\",\r\n    quality: \"high\",\r\n  });\r\n\r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [exportProgress, setExportProgress] = useState(0);\r\n  const [exportStatus, setExportStatus] = useState(\"idle\");\r\n  const [estimatedTime, setEstimatedTime] = useState(null);\r\n\r\n  // 🔧 ИСПРАВЛЕНО: Вынесли опции в константы, чтобы они не пересоздавались каждый рендер\r\n  const resolutionOptions = [\r\n    { value: \"3840x2160\", label: \"4K (3840×2160)\", size: \"2160p\" },\r\n    { value: \"1920x1080\", label: \"Full HD (1920×1080)\", size: \"1080p\" },\r\n    { value: \"1280x720\", label: \"HD (1280×720)\", size: \"720p\" },\r\n    { value: \"854x480\", label: \"SD (854×480)\", size: \"480p\" },\r\n  ];\r\n\r\n  const fpsOptions = [24, 30, 60];\r\n  \r\n  const qualityOptions = [\r\n    { value: \"low\", label: \"Низкое качество\", bitrate: 1000 },\r\n    { value: \"medium\", label: \"Среднее качество\", bitrate: 3000 },\r\n    { value: \"high\", label: \"Высокое качество\", bitrate: 5000 },\r\n    { value: \"ultra\", label: \"Ультра качество\", bitrate: 10000 },\r\n  ];\r\n\r\n  const formatOptions = [\r\n    { value: \"mp4\", label: \"MP4 (H.264)\", extension: \".mp4\" },\r\n    { value: \"webm\", label: \"WebM (VP9)\", extension: \".webm\" },\r\n    { value: \"mov\", label: \"QuickTime (MOV)\", extension: \".mov\" },\r\n  ];\r\n\r\n  // 🔧 ИСПРАВЛЕНО: Добавили правильные зависимости и убрали qualityOptions из deps\r\n  useEffect(() => {\r\n    if (exportSettings.quality) {\r\n      const quality = qualityOptions.find(\r\n        (q) => q.value === exportSettings.quality\r\n      );\r\n      if (quality && quality.bitrate !== exportSettings.bitrate) {\r\n        setExportSettings((prev) => ({ ...prev, bitrate: quality.bitrate }));\r\n      }\r\n    }\r\n  }, [exportSettings.quality]); // Убрали qualityOptions из зависимостей\r\n\r\n  // 🔧 ИСПРАВЛЕНО: Оптимизировали расчет времени\r\n  useEffect(() => {\r\n    if (videoDuration && exportSettings.fps && timelineItems) {\r\n      const complexity = timelineItems.filter(\r\n        (item) => item.trackType === \"overlay\"\r\n      ).length;\r\n      const multiplier = 2 + complexity * 0.5;\r\n      const newEstimatedTime = Math.ceil(videoDuration * multiplier);\r\n      \r\n      // Обновляем только если значение действительно изменилось\r\n      if (newEstimatedTime !== estimatedTime) {\r\n        setEstimatedTime(newEstimatedTime);\r\n      }\r\n    }\r\n  }, [videoDuration, exportSettings.fps, timelineItems.length, estimatedTime]); // Изменили timelineItems на timelineItems.length\r\n\r\n  const getFileSize = () => {\r\n    if (!videoDuration) return \"~\";\r\n\r\n    const sizeInMB =\r\n      (exportSettings.bitrate * videoDuration * 1000) / (8 * 1024 * 1024);\r\n\r\n    if (sizeInMB < 1024) {\r\n      return `~${sizeInMB.toFixed(0)} МБ`;\r\n    } else {\r\n      return `~${(sizeInMB / 1024).toFixed(1)} ГБ`;\r\n    }\r\n  };\r\n\r\n  const handleExport = async () => {\r\n    if (!timelineItems || timelineItems.length === 0) {\r\n      alert('Нет элементов для экспорта!');\r\n      return;\r\n    }\r\n\r\n    setIsExporting(true);\r\n    setExportStatus(\"processing\");\r\n    setExportProgress(0);\r\n\r\n    try {\r\n      await simulateVideoExport();\r\n      setExportStatus(\"success\");\r\n    } catch (error) {\r\n      console.error(\"Export failed:\", error);\r\n      setExportStatus(\"error\");\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  };\r\n\r\n  const simulateVideoExport = async () => {\r\n    const totalSteps = 100;\r\n    const stepDuration = (estimatedTime * 1000) / totalSteps;\r\n\r\n    for (let i = 0; i <= totalSteps; i++) {\r\n      setExportProgress(i);\r\n\r\n      const delay = stepDuration * (1 + Math.sin(i / 20) * 0.3);\r\n      await new Promise((resolve) => setTimeout(resolve, delay));\r\n\r\n      if (i === totalSteps) {\r\n        await actualVideoExport();\r\n      }\r\n    }\r\n  };\r\n\r\n  const actualVideoExport = async () => {\r\n    try {\r\n      const videoExporter = new VideoExporter({\r\n        timelineItems,\r\n        tracks,\r\n        videoDuration,\r\n        settings: exportSettings,\r\n      });\r\n\r\n      const exportedVideoBlob = await videoExporter.render();\r\n      downloadVideo(exportedVideoBlob);\r\n    } catch (error) {\r\n      console.error('Ошибка при экспорте:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const downloadVideo = (blob) => {\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    \r\n    // Определяем правильное расширение\r\n    let extension = exportSettings.format;\r\n    if (blob.type.includes('webm')) {\r\n      extension = 'webm';\r\n    } else if (blob.type.includes('mp4')) {\r\n      extension = 'mp4';\r\n    }\r\n    \r\n    a.download = `edited_video_${Date.now()}.${extension}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  // 🔧 ИСПРАВЛЕНО: Сброс состояния при закрытии модалки\r\n  const handleClose = () => {\r\n    if (!isExporting) {\r\n      setExportStatus(\"idle\");\r\n      setExportProgress(0);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden\">\r\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\r\n          <h2 className=\"text-xl font-semibold text-gray-800 flex items-center\">\r\n            <Download size={24} className=\"mr-2 text-blue-600\" />\r\n            Экспорт видео\r\n          </h2>\r\n          <button\r\n            onClick={handleClose}\r\n            className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\r\n            disabled={isExporting}\r\n          >\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6 max-h-[calc(90vh-120px)] overflow-y-auto\">\r\n          {exportStatus !== \"idle\" && (\r\n            <div\r\n              className={`p-4 rounded-xl ${\r\n                exportStatus === \"processing\"\r\n                  ? \"bg-blue-50 border border-blue-200\"\r\n                  : exportStatus === \"success\"\r\n                  ? \"bg-green-50 border border-green-200\"\r\n                  : \"bg-red-50 border border-red-200\"\r\n              }`}\r\n            >\r\n              <div className=\"flex items-center\">\r\n                {exportStatus === \"processing\" && (\r\n                  <>\r\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600 mr-3\"></div>\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex justify-between text-sm text-blue-700 mb-2\">\r\n                        <span>Экспорт видео...</span>\r\n                        <span>{exportProgress}%</span>\r\n                      </div>\r\n                      <div className=\"w-full bg-blue-200 rounded-full h-2\">\r\n                        <div\r\n                          className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\r\n                          style={{ width: `${exportProgress}%` }}\r\n                        ></div>\r\n                      </div>\r\n                      {estimatedTime && (\r\n                        <div className=\"text-xs text-blue-600 mt-2\">\r\n                          Осталось примерно:{\" \"}\r\n                          {Math.max(\r\n                            0,\r\n                            Math.ceil(\r\n                              (estimatedTime * (100 - exportProgress)) / 100\r\n                            )\r\n                          )}{\" \"}\r\n                          сек\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                {exportStatus === \"success\" && (\r\n                  <>\r\n                    <Check size={20} className=\"text-green-600 mr-3\" />\r\n                    <span className=\"text-green-700 font-medium\">\r\n                      Видео успешно экспортировано!\r\n                    </span>\r\n                  </>\r\n                )}\r\n\r\n                {exportStatus === \"error\" && (\r\n                  <>\r\n                    <AlertCircle size={20} className=\"text-red-600 mr-3\" />\r\n                    <span className=\"text-red-700 font-medium\">\r\n                      Ошибка при экспорте видео\r\n                    </span>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Разрешение\r\n              </label>\r\n              <select\r\n                value={exportSettings.resolution}\r\n                onChange={(e) =>\r\n                  setExportSettings((prev) => ({\r\n                    ...prev,\r\n                    resolution: e.target.value,\r\n                  }))\r\n                }\r\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                disabled={isExporting}\r\n              >\r\n                {resolutionOptions.map((option) => (\r\n                  <option key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Частота кадров (FPS)\r\n              </label>\r\n              <select\r\n                value={exportSettings.fps}\r\n                onChange={(e) =>\r\n                  setExportSettings((prev) => ({\r\n                    ...prev,\r\n                    fps: parseInt(e.target.value),\r\n                  }))\r\n                }\r\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                disabled={isExporting}\r\n              >\r\n                {fpsOptions.map((fps) => (\r\n                  <option key={fps} value={fps}>\r\n                    {fps} FPS\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Качество\r\n              </label>\r\n              <select\r\n                value={exportSettings.quality}\r\n                onChange={(e) =>\r\n                  setExportSettings((prev) => ({\r\n                    ...prev,\r\n                    quality: e.target.value,\r\n                  }))\r\n                }\r\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                disabled={isExporting}\r\n              >\r\n                {qualityOptions.map((quality) => (\r\n                  <option key={quality.value} value={quality.value}>\r\n                    {quality.label} ({quality.bitrate} kbps)\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                Формат\r\n              </label>\r\n              <select\r\n                value={exportSettings.format}\r\n                onChange={(e) =>\r\n                  setExportSettings((prev) => ({\r\n                    ...prev,\r\n                    format: e.target.value,\r\n                  }))\r\n                }\r\n                className=\"w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                disabled={isExporting}\r\n              >\r\n                {formatOptions.map((format) => (\r\n                  <option key={format.value} value={format.value}>\r\n                    {format.label}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 rounded-xl p-4\">\r\n            <h4 className=\"font-medium text-gray-800 mb-3\">\r\n              Информация об экспорте\r\n            </h4>\r\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n              <div>\r\n                <span className=\"text-gray-600\">Длительность:</span>\r\n                <span className=\"ml-2 font-medium\">\r\n                  {Math.round(videoDuration)}с\r\n                </span>\r\n              </div>\r\n              <div>\r\n                <span className=\"text-gray-600\">Размер файла:</span>\r\n                <span className=\"ml-2 font-medium\">{getFileSize()}</span>\r\n              </div>\r\n              <div>\r\n                <span className=\"text-gray-600\">Битрейт:</span>\r\n                <span className=\"ml-2 font-medium\">\r\n                  {exportSettings.bitrate} kbps\r\n                </span>\r\n              </div>\r\n              <div>\r\n                <span className=\"text-gray-600\">Время экспорта:</span>\r\n                <span className=\"ml-2 font-medium\">~{estimatedTime}с</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 rounded-xl p-4\">\r\n            <h4 className=\"font-medium text-gray-800 mb-3\">\r\n              Элементы для экспорта ({timelineItems?.length || 0})\r\n            </h4>\r\n            <div className=\"space-y-2 max-h-32 overflow-y-auto\">\r\n              {timelineItems && timelineItems.length > 0 ? (\r\n                timelineItems.map((item) => (\r\n                  <div\r\n                    key={item.id}\r\n                    className=\"flex items-center justify-between text-sm\"\r\n                  >\r\n                    <span className=\"text-gray-700 truncate\">{item.name}</span>\r\n                    <span\r\n                      className={`px-2 py-1 rounded text-xs flex-shrink-0 ml-2 ${\r\n                        item.trackType === \"main\"\r\n                          ? \"bg-blue-100 text-blue-700\"\r\n                          : item.trackType === \"audio\"\r\n                          ? \"bg-green-100 text-green-700\"\r\n                          : \"bg-purple-100 text-purple-700\"\r\n                      }`}\r\n                    >\r\n                      {item.trackType}\r\n                    </span>\r\n                  </div>\r\n                ))\r\n              ) : (\r\n                <div className=\"text-gray-500 text-sm text-center py-4\">\r\n                  Нет элементов для экспорта\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end space-x-3 p-6 border-t border-gray-200\">\r\n          <button\r\n            onClick={handleClose}\r\n            className=\"px-6 py-2 text-gray-600 hover:text-gray-800 transition-colors\"\r\n            disabled={isExporting}\r\n          >\r\n            Отмена\r\n          </button>\r\n          <button\r\n            onClick={handleExport}\r\n            disabled={isExporting || !timelineItems || timelineItems.length === 0}\r\n            className={`px-6 py-3 rounded-xl font-medium transition-all flex items-center ${\r\n              isExporting || !timelineItems || timelineItems.length === 0\r\n                ? \"bg-gray-300 text-gray-500 cursor-not-allowed\"\r\n                : \"bg-blue-600 text-white hover:bg-blue-700 hover:shadow-lg\"\r\n            }`}\r\n          >\r\n            {isExporting ? (\r\n              <>\r\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                Экспорт...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Download size={16} className=\"mr-2\" />\r\n                Экспортировать\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// 🔧 ИСПРАВЛЕННЫЙ VideoExporter класс\r\nclass VideoExporter {\r\n  constructor({ timelineItems, tracks, videoDuration, settings }) {\r\n    this.timelineItems = timelineItems;\r\n    this.tracks = tracks;\r\n    this.videoDuration = videoDuration;\r\n    this.settings = settings;\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.ctx = this.canvas.getContext(\"2d\");\r\n\r\n    const [width, height] = settings.resolution.split(\"x\").map(Number);\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n  }\r\n\r\n  async render() {\r\n    try {\r\n      const stream = this.canvas.captureStream(this.settings.fps);\r\n      \r\n      const options = {\r\n        mimeType: this.getMimeType(),\r\n        videoBitsPerSecond: this.settings.bitrate * 1000,\r\n      };\r\n\r\n      const mediaRecorder = new MediaRecorder(stream, options);\r\n      const chunks = [];\r\n\r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          chunks.push(event.data);\r\n        }\r\n      };\r\n\r\n      return new Promise((resolve, reject) => {\r\n        mediaRecorder.onstop = () => {\r\n          const blob = new Blob(chunks, {\r\n            type: `video/${this.settings.format}`,\r\n          });\r\n          resolve(blob);\r\n        };\r\n\r\n        mediaRecorder.onerror = reject;\r\n\r\n        mediaRecorder.start(100); // Записываем данные каждые 100мс\r\n\r\n        this.renderFrames()\r\n          .then(() => {\r\n            setTimeout(() => {\r\n              mediaRecorder.stop();\r\n            }, 100);\r\n          })\r\n          .catch(reject);\r\n      });\r\n    } catch (error) {\r\n      console.error('Ошибка настройки записи:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  getMimeType() {\r\n    // Проверяем поддержку разных форматов\r\n    const testTypes = [\r\n      'video/webm;codecs=vp9',\r\n      'video/webm;codecs=vp8',\r\n      'video/mp4;codecs=h264',\r\n      'video/webm'\r\n    ];\r\n    \r\n    for (const type of testTypes) {\r\n      if (MediaRecorder.isTypeSupported(type)) {\r\n        return type;\r\n      }\r\n    }\r\n    \r\n    return 'video/webm'; // fallback\r\n  }\r\n\r\n  async renderFrames() {\r\n    const frameCount = Math.ceil(this.videoDuration * this.settings.fps);\r\n    const frameDuration = 1000 / this.settings.fps; // в миллисекундах\r\n\r\n    for (let frame = 0; frame < frameCount; frame++) {\r\n      const currentTime = frame / this.settings.fps;\r\n      await this.renderFrame(currentTime);\r\n\r\n      // Ждем между кадрами для плавности\r\n      await new Promise((resolve) => setTimeout(resolve, frameDuration / 10));\r\n    }\r\n  }\r\n\r\n  async renderFrame(currentTime) {\r\n    // Черный фон\r\n    this.ctx.fillStyle = \"#000000\";\r\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    // Сортируем элементы по слоям\r\n    const sortedItems = [...this.timelineItems].sort((a, b) => {\r\n      const order = { main: 1, audio: 2, overlay: 3 };\r\n      return order[a.trackType] - order[b.trackType];\r\n    });\r\n\r\n    // Рендерим активные элементы\r\n    for (const item of sortedItems) {\r\n      if (this.isItemActive(item, currentTime)) {\r\n        await this.renderItem(item, currentTime - item.startTime);\r\n      }\r\n    }\r\n  }\r\n\r\n  isItemActive(item, currentTime) {\r\n    return currentTime >= item.startTime && \r\n           currentTime < item.startTime + item.duration;\r\n  }\r\n\r\n  async renderItem(item, relativeTime) {\r\n    try {\r\n      this.ctx.save();\r\n      \r\n      switch (item.type) {\r\n        case \"video\":\r\n          await this.renderVideo(item, relativeTime);\r\n          break;\r\n        case \"image\":\r\n          await this.renderImage(item);\r\n          break;\r\n        case \"text\":\r\n          this.renderText(item.text || item.name || 'Text');\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.warn('Ошибка рендеринга элемента:', error);\r\n      // Рендерим placeholder\r\n      this.renderPlaceholder(item.name || 'Элемент');\r\n    } finally {\r\n      this.ctx.restore();\r\n    }\r\n  }\r\n\r\n  async renderVideo(item, relativeTime) {\r\n    if (!item.videoElement) return;\r\n\r\n    try {\r\n      item.videoElement.currentTime = relativeTime;\r\n      await this.waitForVideoFrame(item.videoElement);\r\n      this.drawScaled(item.videoElement);\r\n    } catch (error) {\r\n      console.warn('Ошибка рендеринга видео:', error);\r\n    }\r\n  }\r\n\r\n  async renderImage(item) {\r\n    if (!item.imageElement) return;\r\n\r\n    try {\r\n      await this.waitForImageLoad(item.imageElement);\r\n      this.drawScaled(item.imageElement);\r\n    } catch (error) {\r\n      console.warn('Ошибка рендеринга изображения:', error);\r\n    }\r\n  }\r\n\r\n  renderText(text) {\r\n    this.ctx.fillStyle = \"#ffffff\";\r\n    this.ctx.font = \"48px Arial\";\r\n    this.ctx.textAlign = \"center\";\r\n    this.ctx.textBaseline = \"middle\";\r\n    \r\n    const x = this.canvas.width / 2;\r\n    const y = this.canvas.height / 2;\r\n    \r\n    // Обводка\r\n    this.ctx.strokeStyle = \"#000000\";\r\n    this.ctx.lineWidth = 4;\r\n    this.ctx.strokeText(text, x, y);\r\n    \r\n    // Текст\r\n    this.ctx.fillText(text, x, y);\r\n  }\r\n\r\n  renderPlaceholder(text) {\r\n    this.ctx.fillStyle = \"#333333\";\r\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    \r\n    this.ctx.fillStyle = \"#ffffff\";\r\n    this.ctx.font = \"24px Arial\";\r\n    this.ctx.textAlign = \"center\";\r\n    this.ctx.fillText(text, this.canvas.width / 2, this.canvas.height / 2);\r\n  }\r\n\r\n  drawScaled(element) {\r\n    const canvasRatio = this.canvas.width / this.canvas.height;\r\n    const elementWidth = element.videoWidth || element.naturalWidth || element.width;\r\n    const elementHeight = element.videoHeight || element.naturalHeight || element.height;\r\n    \r\n    if (!elementWidth || !elementHeight) return;\r\n    \r\n    const elementRatio = elementWidth / elementHeight;\r\n\r\n    let drawWidth, drawHeight, drawX, drawY;\r\n\r\n    if (elementRatio > canvasRatio) {\r\n      drawWidth = this.canvas.width;\r\n      drawHeight = this.canvas.width / elementRatio;\r\n      drawX = 0;\r\n      drawY = (this.canvas.height - drawHeight) / 2;\r\n    } else {\r\n      drawHeight = this.canvas.height;\r\n      drawWidth = this.canvas.height * elementRatio;\r\n      drawX = (this.canvas.width - drawWidth) / 2;\r\n      drawY = 0;\r\n    }\r\n\r\n    this.ctx.drawImage(element, drawX, drawY, drawWidth, drawHeight);\r\n  }\r\n\r\n  async waitForVideoFrame(videoElement) {\r\n    return new Promise((resolve) => {\r\n      const checkReady = () => {\r\n        if (videoElement.readyState >= 2) {\r\n          resolve();\r\n        } else {\r\n          setTimeout(checkReady, 10);\r\n        }\r\n      };\r\n      checkReady();\r\n    });\r\n  }\r\n\r\n  async waitForImageLoad(imageElement) {\r\n    return new Promise((resolve, reject) => {\r\n      if (imageElement.complete && imageElement.naturalWidth > 0) {\r\n        resolve();\r\n      } else {\r\n        const onLoad = () => {\r\n          imageElement.removeEventListener('load', onLoad);\r\n          imageElement.removeEventListener('error', onError);\r\n          resolve();\r\n        };\r\n        \r\n        const onError = () => {\r\n          imageElement.removeEventListener('load', onLoad);\r\n          imageElement.removeEventListener('error', onError);\r\n          reject(new Error('Не удалось загрузить изображение'));\r\n        };\r\n        \r\n        imageElement.addEventListener('load', onLoad);\r\n        imageElement.addEventListener('error', onError);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n// 🔧 ИСПРАВЛЕННЫЙ хук для использования экспорта\r\nexport const useVideoExporter = () => {\r\n  const [isExportModalOpen, setIsExportModalOpen] = useState(false);\r\n\r\n  const openExportModal = () => setIsExportModalOpen(true);\r\n  const closeExportModal = () => setIsExportModalOpen(false);\r\n\r\n  return {\r\n    isExportModalOpen,\r\n    openExportModal,\r\n    closeExportModal,\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}