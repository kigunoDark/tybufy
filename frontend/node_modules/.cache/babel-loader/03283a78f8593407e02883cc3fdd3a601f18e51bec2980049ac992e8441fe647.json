{"ast":null,"code":"var _jsxFileName = \"C:\\\\Scriptify\\\\ai-content-studio\\\\frontend\\\\src\\\\components\\\\VideoEditor\\\\VideoEditor.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useState, useRef, useEffect, useCallback } from \"react\";\nimport { MediaLibrary } from \"../MediaLibrary\";\nimport { Timeline } from \"../Timeline\";\nimport { Play, Pause, Volume2, SkipBack, SkipForward, Download, VolumeX, Film, X, Settings, Check, AlertCircle, Loader2, Zap, HardDrive, Cpu } from \"lucide-react\";\n\n// Компонент экспорта видео\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst VideoExporter = ({\n  isOpen,\n  onClose,\n  timelineItems,\n  videoDuration,\n  tracks\n}) => {\n  _s();\n  const [exportSettings, setExportSettings] = useState({\n    resolution: '1920x1080',\n    fps: 30,\n    quality: 'high',\n    format: 'mp4',\n    bitrate: 8000,\n    audioQuality: 192\n  });\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportProgress, setExportProgress] = useState(0);\n  const [exportStatus, setExportStatus] = useState('');\n  const [exportedBlob, setExportedBlob] = useState(null);\n  const [exportError, setExportError] = useState(null);\n  const [estimatedSize, setEstimatedSize] = useState(0);\n  const [exportMethod, setExportMethod] = useState('canvas'); // 'webcodecs' или 'canvas'\n\n  const canvasRef = useRef(null);\n  const videoRef = useRef(null);\n\n  // Проверка поддержки WebCodecs\n  const supportsWebCodecs = typeof VideoEncoder !== 'undefined' && typeof VideoDecoder !== 'undefined';\n\n  // Расчет примерного размера файла\n  const calculateEstimatedSize = useCallback(() => {\n    const [width, height] = exportSettings.resolution.split('x').map(Number);\n    const duration = videoDuration;\n    const bitrate = exportSettings.bitrate * 1000; // kbps to bps\n\n    // Примерный расчет размера в MB\n    const sizeBytes = bitrate * duration / 8;\n    const sizeMB = sizeBytes / (1024 * 1024);\n    setEstimatedSize(Math.round(sizeMB * 10) / 10);\n  }, [exportSettings, videoDuration]);\n  React.useEffect(() => {\n    calculateEstimatedSize();\n  }, [calculateEstimatedSize]);\n\n  // Получение контента временной шкалы для определенного времени\n  const getTimelineContentAtTime = useCallback(time => {\n    const currentItems = timelineItems.filter(item => time >= item.startTime && time < item.startTime + item.duration);\n    return {\n      mainVideo: currentItems.find(item => item.trackType === 'main' && item.type.includes('video')),\n      overlays: currentItems.filter(item => item.trackType === 'overlay'),\n      audio: currentItems.filter(item => item.trackType === 'audio'),\n      images: currentItems.filter(item => item.type.includes('image'))\n    };\n  }, [timelineItems]);\n\n  // Создание canvas с композицией кадра\n  const renderFrameToCanvas = useCallback(async (time, canvas, ctx) => {\n    const [width, height] = exportSettings.resolution.split('x').map(Number);\n    canvas.width = width;\n    canvas.height = height;\n\n    // Очистка canvas\n    ctx.fillStyle = '#000000';\n    ctx.fillRect(0, 0, width, height);\n    const content = getTimelineContentAtTime(time);\n    try {\n      // Отрисовка основного видео\n      if (content.mainVideo) {\n        const video = document.createElement('video');\n        video.src = content.mainVideo.url;\n        video.currentTime = time - content.mainVideo.startTime;\n        video.crossOrigin = 'anonymous';\n        await new Promise(resolve => {\n          const handleCanPlay = () => {\n            video.removeEventListener('canplay', handleCanPlay);\n            resolve();\n          };\n          video.addEventListener('canplay', handleCanPlay);\n          if (video.readyState >= 3) {\n            resolve();\n          }\n        });\n        ctx.drawImage(video, 0, 0, width, height);\n      }\n\n      // Отрисовка изображений как основного контента\n      if (!content.mainVideo && content.images.length > 0) {\n        const image = new Image();\n        image.crossOrigin = 'anonymous';\n        image.src = content.images[0].url;\n        await new Promise((resolve, reject) => {\n          image.onload = resolve;\n          image.onerror = reject;\n        });\n\n        // Подгонка изображения под размер canvas\n        const imgAspect = image.width / image.height;\n        const canvasAspect = width / height;\n        let drawWidth, drawHeight, drawX, drawY;\n        if (imgAspect > canvasAspect) {\n          drawWidth = width;\n          drawHeight = width / imgAspect;\n          drawX = 0;\n          drawY = (height - drawHeight) / 2;\n        } else {\n          drawWidth = height * imgAspect;\n          drawHeight = height;\n          drawX = (width - drawWidth) / 2;\n          drawY = 0;\n        }\n        ctx.drawImage(image, drawX, drawY, drawWidth, drawHeight);\n      }\n\n      // Отрисовка оверлеев\n      for (const overlay of content.overlays) {\n        if (overlay.type.includes('image')) {\n          const img = new Image();\n          img.crossOrigin = 'anonymous';\n          img.src = overlay.url;\n          await new Promise((resolve, reject) => {\n            img.onload = resolve;\n            img.onerror = () => resolve(); // Пропускаем ошибки загрузки\n          });\n\n          // Позиция оверлея (упрощенная - в реальном приложении учитывайте трансформации)\n          const overlayWidth = 200;\n          const overlayHeight = 150;\n          const x = 100;\n          const y = 50;\n          ctx.globalAlpha = overlay.opacity || 1;\n          ctx.drawImage(img, x, y, overlayWidth, overlayHeight);\n          ctx.globalAlpha = 1;\n        }\n      }\n    } catch (error) {\n      console.error('Ошибка отрисовки кадра:', error);\n    }\n  }, [exportSettings, getTimelineContentAtTime]);\n\n  // Экспорт через Canvas + MediaRecorder\n  const exportWithCanvas = useCallback(async () => {\n    setExportStatus('Подготовка записи...');\n    const [width, height] = exportSettings.resolution.split('x').map(Number);\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    canvas.width = width;\n    canvas.height = height;\n    const stream = canvas.captureStream(exportSettings.fps);\n\n    // Попробуем разные форматы\n    let mimeType = 'video/webm;codecs=vp9';\n    if (!MediaRecorder.isTypeSupported(mimeType)) {\n      mimeType = 'video/webm;codecs=vp8';\n      if (!MediaRecorder.isTypeSupported(mimeType)) {\n        mimeType = 'video/webm';\n      }\n    }\n    const mediaRecorder = new MediaRecorder(stream, {\n      mimeType,\n      videoBitsPerSecond: exportSettings.bitrate * 1000\n    });\n    const chunks = [];\n    mediaRecorder.ondataavailable = event => {\n      if (event.data.size > 0) {\n        chunks.push(event.data);\n      }\n    };\n    return new Promise((resolve, reject) => {\n      mediaRecorder.onstop = () => {\n        const blob = new Blob(chunks, {\n          type: mimeType\n        });\n        resolve(blob);\n      };\n      mediaRecorder.onerror = reject;\n      mediaRecorder.start();\n      let currentFrame = 0;\n      const totalFrames = Math.ceil(videoDuration * exportSettings.fps);\n      const renderFrame = async () => {\n        if (currentFrame >= totalFrames) {\n          mediaRecorder.stop();\n          return;\n        }\n        const time = currentFrame / exportSettings.fps;\n        await renderFrameToCanvas(time, canvas, ctx);\n        currentFrame++;\n        const progress = currentFrame / totalFrames * 100;\n        setExportProgress(progress);\n        setExportStatus(`Обработка кадра ${currentFrame} из ${totalFrames}`);\n\n        // Небольшая задержка для обновления UI\n        setTimeout(renderFrame, 1000 / exportSettings.fps);\n      };\n      renderFrame();\n    });\n  }, [exportSettings, videoDuration, renderFrameToCanvas]);\n\n  // Основная функция экспорта\n  const handleExport = useCallback(async () => {\n    setIsExporting(true);\n    setExportProgress(0);\n    setExportError(null);\n    setExportedBlob(null);\n    try {\n      const blob = await exportWithCanvas();\n      setExportedBlob(blob);\n      setExportStatus('Экспорт завершен!');\n      setExportProgress(100);\n    } catch (error) {\n      console.error('Ошибка экспорта:', error);\n      setExportError(error.message || 'Неизвестная ошибка');\n      setExportStatus('Ошибка экспорта');\n    } finally {\n      setIsExporting(false);\n    }\n  }, [exportWithCanvas]);\n\n  // Скачивание файла\n  const downloadVideo = useCallback(() => {\n    if (!exportedBlob) return;\n    const url = URL.createObjectURL(exportedBlob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `video-export-${Date.now()}.webm`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }, [exportedBlob]);\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center\",\n              children: /*#__PURE__*/_jsxDEV(Download, {\n                size: 20\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 295,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"text-xl font-bold\",\n                children: \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 298,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-blue-100 text-sm\",\n                children: \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0439\\u0442\\u0435 \\u0444\\u0438\\u043D\\u0430\\u043B\\u044C\\u043D\\u0443\\u044E \\u0432\\u0435\\u0440\\u0441\\u0438\\u044E \\u0432\\u0430\\u0448\\u0435\\u0433\\u043E \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u0430\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: onClose,\n            className: \"w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors\",\n            children: /*#__PURE__*/_jsxDEV(X, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6 overflow-y-auto max-h-[calc(90vh-120px)]\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-cols-1 lg:grid-cols-2 gap-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-gray-50 rounded-xl p-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"font-semibold text-gray-900 mb-4 flex items-center\",\n                children: [/*#__PURE__*/_jsxDEV(Settings, {\n                  className: \"mr-2\",\n                  size: 18\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 317,\n                  columnNumber: 19\n                }, this), \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 316,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"space-y-4\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                    className: \"block text-sm font-medium text-gray-700 mb-2\",\n                    children: \"\\u0420\\u0430\\u0437\\u0440\\u0435\\u0448\\u0435\\u043D\\u0438\\u0435\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 324,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                    value: exportSettings.resolution,\n                    onChange: e => setExportSettings(prev => ({\n                      ...prev,\n                      resolution: e.target.value\n                    })),\n                    className: \"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\",\n                    children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                      value: \"1920x1080\",\n                      children: \"Full HD (1920\\xD71080)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 332,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                      value: \"1280x720\",\n                      children: \"HD (1280\\xD7720)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 333,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                      value: \"854x480\",\n                      children: \"SD (854\\xD7480)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 334,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                      value: \"640x360\",\n                      children: \"Low (640\\xD7360)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 335,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 327,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 323,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                    className: \"block text-sm font-medium text-gray-700 mb-2\",\n                    children: \"\\u0427\\u0430\\u0441\\u0442\\u043E\\u0442\\u0430 \\u043A\\u0430\\u0434\\u0440\\u043E\\u0432 (FPS)\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 341,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                    value: exportSettings.fps,\n                    onChange: e => setExportSettings(prev => ({\n                      ...prev,\n                      fps: parseInt(e.target.value)\n                    })),\n                    className: \"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\",\n                    children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                      value: 30,\n                      children: \"30 FPS\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 349,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                      value: 24,\n                      children: \"24 FPS (Cinematic)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 350,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                      value: 15,\n                      children: \"15 FPS (Low)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 351,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 344,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 340,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                    className: \"block text-sm font-medium text-gray-700 mb-2\",\n                    children: \"\\u041A\\u0430\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 357,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"grid grid-cols-3 gap-2\",\n                    children: [{\n                      value: 'low',\n                      label: 'Низкое',\n                      bitrate: 2000\n                    }, {\n                      value: 'medium',\n                      label: 'Среднее',\n                      bitrate: 5000\n                    }, {\n                      value: 'high',\n                      label: 'Высокое',\n                      bitrate: 8000\n                    }].map(quality => /*#__PURE__*/_jsxDEV(\"button\", {\n                      onClick: () => setExportSettings(prev => ({\n                        ...prev,\n                        quality: quality.value,\n                        bitrate: quality.bitrate\n                      })),\n                      className: `p-2 rounded-lg text-sm font-medium transition-colors ${exportSettings.quality === quality.value ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`,\n                      children: quality.label\n                    }, quality.value, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 366,\n                      columnNumber: 25\n                    }, this))\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 360,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 356,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-blue-50 rounded-xl p-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"font-semibold text-gray-900 mb-3 flex items-center\",\n                children: [/*#__PURE__*/_jsxDEV(HardDrive, {\n                  className: \"mr-2\",\n                  size: 18\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 390,\n                  columnNumber: 19\n                }, this), \"\\u0418\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044F \\u043E \\u0444\\u0430\\u0439\\u043B\\u0435\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"grid grid-cols-2 gap-4 text-sm\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-gray-600\",\n                    children: \"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 395,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"font-medium\",\n                    children: [Math.round(videoDuration), \"\\u0441\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 396,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 394,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-gray-600\",\n                    children: \"\\u0420\\u0430\\u0437\\u0440\\u0435\\u0448\\u0435\\u043D\\u0438\\u0435:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 399,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"font-medium\",\n                    children: exportSettings.resolution\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 400,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 398,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-gray-600\",\n                    children: \"\\u0411\\u0438\\u0442\\u0440\\u0435\\u0439\\u0442:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 403,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"font-medium\",\n                    children: [exportSettings.bitrate, \" kbps\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 404,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 402,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-gray-600\",\n                    children: \"\\u041F\\u0440\\u0438\\u043C\\u0435\\u0440\\u043D\\u044B\\u0439 \\u0440\\u0430\\u0437\\u043C\\u0435\\u0440:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 407,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"font-medium\",\n                    children: [estimatedSize, \" MB\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 408,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 406,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 393,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-gray-50 rounded-xl p-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"font-semibold text-gray-900 mb-4 flex items-center\",\n                children: [/*#__PURE__*/_jsxDEV(Film, {\n                  className: \"mr-2\",\n                  size: 18\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 419,\n                  columnNumber: 19\n                }, this), \"\\u041F\\u0440\\u0435\\u0432\\u044C\\u044E \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u0430\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-black rounded-lg aspect-video flex items-center justify-center text-white text-sm relative\",\n                children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n                  ref: canvasRef,\n                  className: \"max-w-full max-h-full rounded-lg\",\n                  style: {\n                    display: exportedBlob ? 'none' : 'block'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 424,\n                  columnNumber: 19\n                }, this), exportedBlob && /*#__PURE__*/_jsxDEV(\"video\", {\n                  ref: videoRef,\n                  src: URL.createObjectURL(exportedBlob),\n                  controls: true,\n                  className: \"max-w-full max-h-full rounded-lg\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 430,\n                  columnNumber: 21\n                }, this), !exportedBlob && !isExporting && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-center\",\n                  children: [/*#__PURE__*/_jsxDEV(Film, {\n                    size: 48,\n                    className: \"mx-auto mb-2 opacity-50\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 439,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: \"\\u041F\\u0440\\u0435\\u0432\\u044C\\u044E \\u043F\\u043E\\u044F\\u0432\\u0438\\u0442\\u0441\\u044F \\u043F\\u043E\\u0441\\u043B\\u0435 \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\\u0430\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 440,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 438,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 423,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 15\n            }, this), (isExporting || exportedBlob || exportError) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-gray-50 rounded-xl p-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"font-semibold text-gray-900 mb-4\",\n                children: isExporting ? 'Экспорт в процессе...' : exportError ? 'Ошибка' : 'Экспорт завершен'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 19\n              }, this), isExporting && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"space-y-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-full bg-gray-200 rounded-full h-3\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-300\",\n                    style: {\n                      width: `${exportProgress}%`\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 456,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 455,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center justify-between text-sm\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-gray-600\",\n                    children: exportStatus\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 462,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"font-medium\",\n                    children: [Math.round(exportProgress), \"%\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 463,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 461,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center text-blue-600\",\n                  children: [/*#__PURE__*/_jsxDEV(Loader2, {\n                    className: \"animate-spin mr-2\",\n                    size: 16\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 466,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"text-sm\",\n                    children: \"\\u041E\\u0431\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0430...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 467,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 465,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 454,\n                columnNumber: 21\n              }, this), exportedBlob && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"space-y-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center text-green-600\",\n                  children: [/*#__PURE__*/_jsxDEV(Check, {\n                    className: \"mr-2\",\n                    size: 20\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 475,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"font-medium\",\n                    children: \"\\u0412\\u0438\\u0434\\u0435\\u043E \\u0433\\u043E\\u0442\\u043E\\u0432\\u043E \\u043A \\u0441\\u043A\\u0430\\u0447\\u0438\\u0432\\u0430\\u043D\\u0438\\u044E!\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 476,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 474,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: downloadVideo,\n                  className: \"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-4 rounded-lg font-medium transition-all flex items-center justify-center space-x-2\",\n                  children: [/*#__PURE__*/_jsxDEV(Download, {\n                    size: 20\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 482,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"\\u0421\\u043A\\u0430\\u0447\\u0430\\u0442\\u044C \\u0432\\u0438\\u0434\\u0435\\u043E\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 483,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 478,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 473,\n                columnNumber: 21\n              }, this), exportError && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"space-y-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center text-red-600\",\n                  children: [/*#__PURE__*/_jsxDEV(AlertCircle, {\n                    className: \"mr-2\",\n                    size: 20\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 491,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"font-medium\",\n                    children: [\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430: \", exportError]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 492,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 490,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handleExport,\n                  className: \"w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-medium transition-colors\",\n                  children: \"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u043E\\u0432\\u0430\\u0442\\u044C \\u0441\\u043D\\u043E\\u0432\\u0430\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 494,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 489,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 448,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-between items-center mt-6 pt-6 border-t border-gray-200\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: onClose,\n            className: \"px-6 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors\",\n            children: \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 509,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex space-x-3\",\n            children: !exportedBlob && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleExport,\n              disabled: isExporting,\n              className: \"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 text-white rounded-lg font-medium transition-all flex items-center space-x-2 disabled:cursor-not-allowed\",\n              children: isExporting ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Loader2, {\n                  className: \"animate-spin\",\n                  size: 18\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 525,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 526,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Download, {\n                  size: 18\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 530,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"\\u041D\\u0430\\u0447\\u0430\\u0442\\u044C \\u044D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 531,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 518,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 516,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 508,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoExporter, \"VWAIg1C5YEBginqY9fVugfW3GUE=\");\n_c = VideoExporter;\nconst VideoEditor = ({\n  mediaLibrary,\n  setMediaLibrary\n}) => {\n  _s2();\n  const [timelineItems, setTimelineItems] = useState([]);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [videoDuration, setVideoDuration] = useState(60);\n  const [selectedTimelineItem, setSelectedTimelineItem] = useState(null);\n  const [timelineZoom, setTimelineZoom] = useState(1);\n  const [activeTab, setActiveTab] = useState(\"videos\");\n  const [volume, setVolume] = useState(1);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentVideoSource, setCurrentVideoSource] = useState(null);\n  const [draggedItem, setDraggedItem] = useState(null);\n  const [draggedTimelineItem, setDraggedTimelineItem] = useState(null);\n  const [dropPreview, setDropPreview] = useState(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [isTimelineDragging, setIsTimelineDragging] = useState(false);\n  const [copiedItem, setCopiedItem] = useState(null);\n  const [showExportModal, setShowExportModal] = useState(false);\n\n  // Состояния для resize\n  const [isResizing, setIsResizing] = useState(false);\n\n  // Состояния для управления overlays на видео\n  const [selectedOverlay, setSelectedOverlay] = useState(null);\n  const [overlayTransforms, setOverlayTransforms] = useState({});\n  const [isDraggingOverlay, setIsDraggingOverlay] = useState(false);\n  const [isResizingOverlay, setIsResizingOverlay] = useState(false);\n  const [overlayDragStart, setOverlayDragStart] = useState({\n    x: 0,\n    y: 0\n  });\n  const [resizeOverlayHandle, setResizeOverlayHandle] = useState(null);\n  const [initialOverlayTransform, setInitialOverlayTransform] = useState(null);\n\n  // Модальное окно помощи\n  const [showHelp, setShowHelp] = useState(false);\n\n  // ✅ НОВОЕ: Состояние для умной функции добавления из Timeline\n  const [smartAddFunction, setSmartAddFunction] = useState(null);\n\n  // Треки\n  const [tracks, setTracks] = useState({\n    overlays: [{\n      id: \"overlay-1\",\n      name: \"Overlay 1\",\n      type: \"overlay\"\n    }, {\n      id: \"overlay-2\",\n      name: \"Overlay 2\",\n      type: \"overlay\"\n    }],\n    main: [{\n      id: \"main-video\",\n      name: \"Main Video\",\n      type: \"main\"\n    }],\n    audio: [{\n      id: \"audio-1\",\n      name: \"Audio 1\",\n      type: \"audio\"\n    }, {\n      id: \"audio-2\",\n      name: \"Audio 2\",\n      type: \"audio\"\n    }]\n  });\n  const intervalRef = useRef(null);\n  const audioElementsRef = useRef(new Map());\n  const videoRef = useRef(null);\n  const videoContainerRef = useRef(null);\n  const formatTime = seconds => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    const ms = Math.floor(seconds % 1 * 100);\n    return timelineZoom > 5 ? `${mins}:${secs.toString().padStart(2, \"0\")}.${ms.toString().padStart(2, \"0\")}` : `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n  const handlePlayPause = () => {\n    setIsPlaying(!isPlaying);\n  };\n  const seekTo = time => {\n    const newTime = Math.max(0, Math.min(videoDuration, time));\n    setCurrentTime(newTime);\n    const content = getCurrentTimelineContent();\n    content.audio.forEach(audioItem => {\n      const audioElement = audioElementsRef.current.get(audioItem.id);\n      if (audioElement) {\n        const relativeTime = newTime - audioItem.startTime;\n        audioElement.currentTime = Math.max(0, relativeTime);\n      }\n    });\n  };\n  const getCurrentTimelineContent = useCallback(() => {\n    const currentItems = timelineItems.filter(item => currentTime >= item.startTime && currentTime < item.startTime + item.duration);\n    return {\n      mainVideo: currentItems.find(item => item.trackType === \"main\" && item.type === \"videos\"),\n      overlays: currentItems.filter(item => item.trackType === \"overlay\"),\n      audio: currentItems.filter(item => item.trackType === \"audio\")\n    };\n  }, [currentTime, timelineItems]);\n  const createAudioElement = useCallback(audioItem => {\n    if (!audioElementsRef.current.has(audioItem.id)) {\n      const audio = document.createElement(\"audio\");\n      audio.src = audioItem.url;\n      audio.volume = (audioItem.volume || 1) * volume;\n      audio.muted = isMuted;\n      audio.preload = \"metadata\";\n      audioElementsRef.current.set(audioItem.id, audio);\n    }\n    return audioElementsRef.current.get(audioItem.id);\n  }, [volume, isMuted]);\n  const syncAudioTime = useCallback((audioItem, relativeTime) => {\n    const audioElement = audioElementsRef.current.get(audioItem.id);\n    if (audioElement) {\n      const timeDiff = Math.abs(audioElement.currentTime - relativeTime);\n      if (timeDiff > 0.2) {\n        audioElement.currentTime = Math.max(0, relativeTime);\n      }\n    }\n  }, []);\n  const checkCollision = useCallback((newItem, excludeId = null) => {\n    return timelineItems.some(item => {\n      if (item.id === excludeId) return false;\n      if (item.trackId !== newItem.trackId) return false;\n      const itemStart = item.startTime;\n      const itemEnd = item.startTime + item.duration;\n      const newStart = newItem.startTime;\n      const newEnd = newItem.startTime + newItem.duration;\n      return newStart < itemEnd && newEnd > itemStart;\n    });\n  }, [timelineItems]);\n  const insertWithRipple = useCallback((trackId, insertTime, duration, excludeId = null) => {\n    const trackItems = timelineItems.filter(item => item.trackId === trackId && item.id !== excludeId).sort((a, b) => a.startTime - b.startTime);\n    if (trackItems.length === 0) {\n      return {\n        time: Math.max(0, insertTime),\n        shouldRipple: false,\n        affectedItems: []\n      };\n    }\n    let insertPosition = insertTime;\n    let shouldRipple = false;\n    let affectedItems = [];\n    const blockAtPosition = trackItems.find(item => insertTime >= item.startTime && insertTime < item.startTime + item.duration);\n    if (blockAtPosition) {\n      insertPosition = blockAtPosition.startTime;\n      shouldRipple = true;\n      affectedItems = trackItems.filter(item => item.startTime >= insertPosition);\n    } else {\n      const blocksToShift = trackItems.filter(item => item.startTime >= insertTime);\n      if (blocksToShift.length > 0) {\n        const nextBlock = blocksToShift[0];\n        const availableSpace = nextBlock.startTime - insertTime;\n        if (availableSpace >= duration) {\n          insertPosition = insertTime;\n          shouldRipple = false;\n        } else {\n          insertPosition = insertTime;\n          shouldRipple = true;\n          affectedItems = blocksToShift;\n        }\n      } else {\n        insertPosition = insertTime;\n        shouldRipple = false;\n      }\n    }\n    return {\n      time: Math.max(0, insertPosition),\n      shouldRipple,\n      affectedItems,\n      shiftAmount: shouldRipple ? duration : 0\n    };\n  }, [timelineItems]);\n  const applyRippleEffect = useCallback((affectedItems, shiftAmount) => {\n    if (!affectedItems.length || shiftAmount <= 0) return;\n    setTimelineItems(prev => prev.map(item => {\n      const affectedItem = affectedItems.find(affected => affected.id === item.id);\n      if (affectedItem) {\n        return {\n          ...item,\n          startTime: item.startTime + shiftAmount\n        };\n      }\n      return item;\n    }));\n    if (affectedItems.length > 0) {\n      const maxEndTime = Math.max(...affectedItems.map(item => item.startTime + item.duration + shiftAmount));\n      if (maxEndTime > videoDuration) {\n        setVideoDuration(maxEndTime + 10);\n      }\n    }\n  }, [videoDuration]);\n  const findNextAvailablePosition = useCallback((trackId, duration, preferredStart = 0) => {\n    const trackItems = timelineItems.filter(item => item.trackId === trackId).sort((a, b) => a.startTime - b.startTime);\n    console.log(`🔍 Ищем место для длительности ${duration} на треке ${trackId}`);\n\n    // Если трек пустой\n    if (trackItems.length === 0) {\n      console.log(`✅ Трек пустой, размещаем в позицию: 0`);\n      return 0;\n    }\n\n    // ✅ ИСПРАВЛЕНО: размещаем сразу после последнего элемента + небольшой отступ\n    const lastItem = trackItems[trackItems.length - 1];\n    const nextPosition = lastItem.startTime + lastItem.duration + 0.1; // отступ 0.1 сек\n\n    console.log(`✅ Последний элемент \"${lastItem.name}\" заканчивается в ${lastItem.startTime + lastItem.duration}`);\n    console.log(`✅ Размещаем новый элемент в позицию: ${nextPosition}`);\n    return nextPosition;\n  }, [timelineItems]);\n  const removeFromTimeline = itemId => {\n    const audioElement = audioElementsRef.current.get(itemId);\n    if (audioElement) {\n      audioElement.pause();\n      audioElement.src = \"\";\n      audioElementsRef.current.delete(itemId);\n    }\n    setTimelineItems(prev => prev.filter(item => item.id !== itemId));\n    setSelectedTimelineItem(null);\n  };\n\n  // Функции для управления overlays\n  const getOverlayTransform = useCallback(overlayId => {\n    return overlayTransforms[overlayId] || {\n      x: 0,\n      y: 0,\n      scale: 1,\n      opacity: 1\n    };\n  }, [overlayTransforms]);\n  const updateOverlayTransform = useCallback((overlayId, updates) => {\n    setOverlayTransforms(prev => ({\n      ...prev,\n      [overlayId]: {\n        ...getOverlayTransform(overlayId),\n        ...updates\n      }\n    }));\n  }, [getOverlayTransform]);\n  const handleOverlayMouseDown = useCallback((e, overlay) => {\n    if (e.target.closest(\".resize-handle\")) return;\n    e.preventDefault();\n    e.stopPropagation();\n    setSelectedOverlay(overlay);\n    setIsDraggingOverlay(true);\n    const container = videoContainerRef.current;\n    if (!container) return;\n    const containerRect = container.getBoundingClientRect();\n    const overlayElement = e.currentTarget;\n    const overlayRect = overlayElement.getBoundingClientRect();\n    setOverlayDragStart({\n      x: e.clientX - overlayRect.left,\n      y: e.clientY - overlayRect.top,\n      containerX: containerRect.left,\n      containerY: containerRect.top\n    });\n  }, []);\n  const handleOverlayResizeStart = useCallback((e, overlay, handle) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setSelectedOverlay(overlay);\n    setIsResizingOverlay(true);\n    setResizeOverlayHandle(handle);\n    const currentTransform = getOverlayTransform(overlay.id);\n    setInitialOverlayTransform(currentTransform);\n    setOverlayDragStart({\n      x: e.clientX,\n      y: e.clientY,\n      startScale: currentTransform.scale,\n      startX: currentTransform.x,\n      startY: currentTransform.y\n    });\n  }, [getOverlayTransform]);\n  const handleOverlayMouseMove = useCallback(e => {\n    if (!selectedOverlay) return;\n    if (isDraggingOverlay) {\n      const container = videoContainerRef.current;\n      if (!container) return;\n      const rect = container.getBoundingClientRect();\n      const overlaySize = 128 * getOverlayTransform(selectedOverlay.id).scale;\n      const newX = e.clientX - overlayDragStart.containerX - overlayDragStart.x;\n      const newY = e.clientY - overlayDragStart.containerY - overlayDragStart.y;\n      const padding = 5;\n      const limitedX = Math.max(padding, Math.min(rect.width - overlaySize - padding, newX));\n      const limitedY = Math.max(padding, Math.min(rect.height - overlaySize - padding, newY));\n      const baseX = 200;\n      const baseY = 50 + selectedOverlay.index * 120;\n      updateOverlayTransform(selectedOverlay.id, {\n        x: limitedX - baseX,\n        y: limitedY - baseY\n      });\n    } else if (isResizingOverlay && overlayDragStart.startScale !== undefined && resizeOverlayHandle) {\n      const deltaX = e.clientX - overlayDragStart.x;\n      const deltaY = e.clientY - overlayDragStart.y;\n      let scaleFactor = 1;\n      const sensitivity = 0.005;\n      switch (resizeOverlayHandle) {\n        case \"nw\":\n          scaleFactor = 1 - (deltaX + deltaY) * sensitivity;\n          break;\n        case \"ne\":\n          scaleFactor = 1 + (deltaX - deltaY) * sensitivity;\n          break;\n        case \"sw\":\n          scaleFactor = 1 + (-deltaX + deltaY) * sensitivity;\n          break;\n        case \"se\":\n          scaleFactor = 1 + (deltaX + deltaY) * sensitivity;\n          break;\n        default:\n          break;\n      }\n      const newScale = Math.max(0.2, Math.min(4, overlayDragStart.startScale * scaleFactor));\n      updateOverlayTransform(selectedOverlay.id, {\n        scale: newScale\n      });\n    }\n  }, [selectedOverlay, isDraggingOverlay, isResizingOverlay, overlayDragStart, updateOverlayTransform, getOverlayTransform, resizeOverlayHandle]);\n  const handleOverlayMouseUp = useCallback(() => {\n    setIsDraggingOverlay(false);\n    setIsResizingOverlay(false);\n    setResizeOverlayHandle(null);\n    setInitialOverlayTransform(null);\n  }, []);\n  const handleOverlayWheel = useCallback((e, overlayId) => {\n    if (!e.ctrlKey) return;\n    e.preventDefault();\n    e.stopPropagation();\n    const transform = getOverlayTransform(overlayId);\n    const scaleDelta = e.deltaY > 0 ? -0.05 : 0.05;\n    const newScale = Math.max(0.2, Math.min(4, transform.scale + scaleDelta));\n    updateOverlayTransform(overlayId, {\n      scale: newScale\n    });\n  }, [getOverlayTransform, updateOverlayTransform]);\n\n  // Функции для работы с элементами таймлайна\n  const splitTimelineItem = useCallback(() => {\n    if (!selectedTimelineItem) return;\n    const item = selectedTimelineItem;\n    const splitTime = currentTime;\n    if (splitTime <= item.startTime || splitTime >= item.startTime + item.duration) {\n      return;\n    }\n    const firstPartDuration = splitTime - item.startTime;\n    const secondPartStart = splitTime;\n    const secondPartDuration = item.duration - firstPartDuration;\n    const secondPart = {\n      ...item,\n      id: Date.now() + Math.random(),\n      startTime: secondPartStart,\n      duration: secondPartDuration\n    };\n    const updatedFirstPart = {\n      ...item,\n      duration: firstPartDuration\n    };\n    setTimelineItems(prev => prev.map(timelineItem => timelineItem.id === item.id ? updatedFirstPart : timelineItem).concat(secondPart));\n    setSelectedTimelineItem(null);\n  }, [selectedTimelineItem, currentTime]);\n  const copyTimelineItem = useCallback(() => {\n    if (!selectedTimelineItem) return;\n    setCopiedItem(selectedTimelineItem);\n  }, [selectedTimelineItem]);\n  const pasteTimelineItem = useCallback(() => {\n    var _insertResult$affecte;\n    if (!copiedItem) return;\n    const targetTrackId = copiedItem.trackId;\n    const insertResult = insertWithRipple(targetTrackId, currentTime, copiedItem.duration);\n    if (insertResult.shouldRipple && ((_insertResult$affecte = insertResult.affectedItems) === null || _insertResult$affecte === void 0 ? void 0 : _insertResult$affecte.length) > 0) {\n      applyRippleEffect(insertResult.affectedItems, copiedItem.duration);\n    }\n    const newItem = {\n      ...copiedItem,\n      id: Date.now() + Math.random(),\n      startTime: insertResult.time\n    };\n    setTimelineItems(prev => [...prev, newItem]);\n    const newEndTime = newItem.startTime + newItem.duration;\n    if (newEndTime > videoDuration) {\n      setVideoDuration(newEndTime + 10);\n    }\n    setSelectedTimelineItem(newItem);\n  }, [copiedItem, currentTime, insertWithRipple, applyRippleEffect, videoDuration]);\n  const deleteSelectedItem = useCallback(() => {\n    if (!selectedTimelineItem) return;\n    removeFromTimeline(selectedTimelineItem.id);\n  }, [selectedTimelineItem]);\n  const addToTimeline = useCallback((mediaItem, startTime = null, targetTrackId = null) => {\n    if (!mediaItem || !mediaItem.name || !mediaItem.type) {\n      return;\n    }\n    console.log(targetTrackId);\n    let trackId, trackType;\n    if (mediaItem.type === \"videos\" || mediaItem.type === \"video\") {\n      trackId = \"main-video\";\n      trackType = \"main\";\n    } else if (mediaItem.type === \"images\" || mediaItem.type === \"image\") {\n      trackId = \"overlay-1\";\n      trackType = \"overlay\";\n    } else if (mediaItem.type === \"audios\" || mediaItem.type === \"audio\") {\n      trackId = \"audio-1\";\n      trackType = \"audio\";\n    } else {\n      return;\n    }\n    const duration = mediaItem.duration || (mediaItem.type.includes(\"image\") ? 5 : 10);\n    setTimelineItems(prevItems => {\n      const trackItems = prevItems.filter(item => item.trackId === trackId).sort((a, b) => a.startTime - b.startTime);\n\n      // Вычисляем позицию для нового элемента\n      let newStartTime;\n      if (startTime !== null) {\n        newStartTime = startTime;\n      } else if (trackItems.length === 0) {\n        newStartTime = 0;\n      } else {\n        // Размещаем сразу после последнего элемента\n        const lastItem = trackItems[trackItems.length - 1];\n        newStartTime = lastItem.startTime + lastItem.duration;\n      }\n\n      // Создаем новый элемент\n      const newTimelineItem = {\n        id: Date.now() + Math.random(),\n        mediaId: mediaItem.id,\n        type: mediaItem.type,\n        name: mediaItem.name,\n        url: mediaItem.url,\n        startTime: newStartTime,\n        duration: duration,\n        trackId: trackId,\n        trackType: trackType,\n        volume: 1,\n        opacity: 1\n      };\n      return [...prevItems, newTimelineItem];\n    });\n    const estimatedEndTime = (startTime || 0) + duration;\n    if (estimatedEndTime > videoDuration) {\n      setVideoDuration(estimatedEndTime + 10);\n    }\n  }, [videoDuration]);\n  const handleMediaLibraryClick = item => {\n    if (!item || !item.name || !item.type) {\n      return;\n    }\n    if (smartAddFunction) {\n      smartAddFunction(item);\n    } else {\n      addToTimeline(item);\n    }\n  };\n\n  // Эффекты для управления overlays\n  useEffect(() => {\n    if (isDraggingOverlay || isResizingOverlay) {\n      document.addEventListener(\"mousemove\", handleOverlayMouseMove);\n      document.addEventListener(\"mouseup\", handleOverlayMouseUp);\n      document.body.style.cursor = isDraggingOverlay ? \"grabbing\" : \"nw-resize\";\n      return () => {\n        document.removeEventListener(\"mousemove\", handleOverlayMouseMove);\n        document.removeEventListener(\"mouseup\", handleOverlayMouseUp);\n        document.body.style.cursor = \"\";\n      };\n    }\n  }, [isDraggingOverlay, isResizingOverlay, handleOverlayMouseMove, handleOverlayMouseUp]);\n\n  // Основные эффекты\n  useEffect(() => {\n    const content = getCurrentTimelineContent();\n    if (content.mainVideo && content.mainVideo.url !== currentVideoSource) {\n      setCurrentVideoSource(content.mainVideo.url);\n      if (videoRef.current) {\n        const relativeTime = currentTime - content.mainVideo.startTime;\n        videoRef.current.currentTime = Math.max(0, relativeTime);\n      }\n    } else if (!content.mainVideo && content.overlays.find(o => o.type === \"image\")) {\n      const firstImage = content.overlays.find(o => o.type === \"image\");\n      setCurrentVideoSource(firstImage.url);\n    } else if (!content.mainVideo && !content.overlays.find(o => o.type === \"image\")) {\n      setCurrentVideoSource(null);\n    }\n    const currentAudioIds = new Set(content.audio.map(item => item.id));\n    audioElementsRef.current.forEach((audioElement, id) => {\n      if (!currentAudioIds.has(id)) {\n        if (!audioElement.paused) {\n          audioElement.pause();\n        }\n      }\n    });\n    content.audio.forEach(audioItem => {\n      const audioElement = createAudioElement(audioItem);\n      const relativeTime = currentTime - audioItem.startTime;\n      audioElement.volume = (audioItem.volume || 1) * volume;\n      audioElement.muted = isMuted;\n      if (isPlaying && relativeTime >= 0) {\n        syncAudioTime(audioItem, relativeTime);\n        if (audioElement.paused) {\n          audioElement.play().catch(console.error);\n        }\n      } else {\n        if (!audioElement.paused) {\n          audioElement.pause();\n        }\n      }\n    });\n  }, [currentTime, timelineItems, getCurrentTimelineContent, isPlaying, volume, isMuted, createAudioElement, syncAudioTime, currentVideoSource]);\n  useEffect(() => {\n    if (isPlaying) {\n      intervalRef.current = setInterval(() => {\n        setCurrentTime(prev => {\n          const newTime = prev + 0.1;\n          if (newTime >= videoDuration) {\n            setIsPlaying(false);\n            return videoDuration;\n          }\n          return newTime;\n        });\n      }, 100);\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    }\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [isPlaying, videoDuration]);\n  useEffect(() => {\n    if (videoRef.current && currentVideoSource) {\n      const content = getCurrentTimelineContent();\n      if (content.mainVideo) {\n        const relativeTime = currentTime - content.mainVideo.startTime;\n        const timeDiff = Math.abs(videoRef.current.currentTime - relativeTime);\n        if (timeDiff > 0.5) {\n          videoRef.current.currentTime = Math.max(0, relativeTime);\n        }\n        if (isPlaying && videoRef.current.paused) {\n          videoRef.current.play().catch(console.error);\n        } else if (!isPlaying && !videoRef.current.paused) {\n          videoRef.current.pause();\n        }\n      }\n    }\n  }, [currentTime, currentVideoSource, getCurrentTimelineContent, isPlaying]);\n  useEffect(() => {\n    const currentAudioIds = new Set(timelineItems.filter(item => item.type === \"audio\").map(item => item.id));\n    audioElementsRef.current.forEach((audioElement, id) => {\n      if (!currentAudioIds.has(id)) {\n        audioElement.pause();\n        audioElement.src = \"\";\n        audioElementsRef.current.delete(id);\n      }\n    });\n  }, [timelineItems]);\n\n  // Обработка клавиатурных шорткатов\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if (e.target.tagName === \"INPUT\" || e.target.tagName === \"TEXTAREA\") {\n        return;\n      }\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\n        e.preventDefault();\n        deleteSelectedItem();\n      }\n      if (e.ctrlKey && e.key === \"b\") {\n        e.preventDefault();\n        splitTimelineItem();\n      }\n      if (e.ctrlKey && e.key === \"c\") {\n        e.preventDefault();\n        copyTimelineItem();\n      }\n      if (e.ctrlKey && e.key === \"v\") {\n        e.preventDefault();\n        pasteTimelineItem();\n      }\n      if (e.key === \" \" || e.code === \"Space\") {\n        e.preventDefault();\n        setIsPlaying(prev => !prev);\n      }\n      if (e.key === \"ArrowLeft\") {\n        e.preventDefault();\n        const step = e.ctrlKey ? 5 : e.shiftKey ? 1 : 0.1;\n        seekTo(Math.max(0, currentTime - step));\n      }\n      if (e.key === \"ArrowRight\") {\n        e.preventDefault();\n        const step = e.ctrlKey ? 5 : e.shiftKey ? 1 : 0.1;\n        seekTo(Math.min(videoDuration, currentTime + step));\n      }\n      if (e.key === \"?\" || e.shiftKey && e.key === \"/\") {\n        e.preventDefault();\n        setShowHelp(true);\n      }\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        if (showHelp) {\n          setShowHelp(false);\n        } else if (selectedOverlay) {\n          setSelectedOverlay(null);\n        }\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [selectedTimelineItem, copiedItem, currentTime, videoDuration, showHelp, selectedOverlay, deleteSelectedItem, splitTimelineItem, copyTimelineItem, pasteTimelineItem, seekTo]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex h-screen w-full gap-4 p-4 bg-gray-100 overflow-hidden\",\n    children: [/*#__PURE__*/_jsxDEV(MediaLibrary, {\n      mediaLibrary: mediaLibrary,\n      setMediaLibrary: setMediaLibrary,\n      activeTab: activeTab,\n      setActiveTab: setActiveTab,\n      draggedItem: draggedItem,\n      setDraggedItem: setDraggedItem,\n      isDragging: isDragging,\n      setIsDragging: setIsDragging,\n      addToTimeline: handleMediaLibraryClick // ✅ ИСПОЛЬЗУЕМ УМНУЮ ФУНКЦИЮ\n      ,\n      formatTime: formatTime\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1384,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex flex-col gap-4 min-w-0 overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        ref: videoContainerRef,\n        className: \"flex-1 bg-black rounded-2xl relative overflow-hidden shadow-sm min-h-0\",\n        title: \"Video Preview - Click overlays to select, drag to move, Ctrl+scroll to resize, use opacity slider\",\n        children: [currentVideoSource ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative w-full h-full\",\n          onClick: e => {\n            if (e.target === e.currentTarget) {\n              setSelectedOverlay(null);\n            }\n          },\n          children: [getCurrentTimelineContent().mainVideo ? /*#__PURE__*/_jsxDEV(\"video\", {\n            ref: videoRef,\n            src: currentVideoSource,\n            className: \"w-full h-full object-contain rounded-2xl\",\n            muted: isMuted\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1414,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"img\", {\n            src: currentVideoSource,\n            alt: \"Timeline content\",\n            className: \"w-full h-full object-contain rounded-2xl\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1421,\n            columnNumber: 17\n          }, this), getCurrentTimelineContent().overlays.map((item, index) => {\n            const transform = getOverlayTransform(item.id);\n            const isSelected = (selectedOverlay === null || selectedOverlay === void 0 ? void 0 : selectedOverlay.id) === item.id;\n            const isDraggingThis = isDraggingOverlay && isSelected;\n            const isResizingThis = isResizingOverlay && isSelected;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `absolute select-none ${isSelected ? \"ring-2 ring-blue-400 ring-opacity-75 shadow-xl\" : \"hover:ring-2 hover:ring-blue-300 hover:ring-opacity-50\"} ${isDraggingThis ? \"cursor-grabbing z-50\" : isResizingThis ? \"cursor-nw-resize\" : \"cursor-grab hover:shadow-lg\"}`,\n              style: {\n                left: `${200 + transform.x}px`,\n                top: `${50 + index * 120 + transform.y}px`,\n                width: `${128 * transform.scale}px`,\n                height: `${96 * transform.scale}px`,\n                opacity: transform.opacity,\n                zIndex: isSelected ? 1000 : 10 + index,\n                transform: isDraggingThis ? \"scale(1.02)\" : \"scale(1)\",\n                transition: isDraggingThis || isResizingThis ? \"none\" : \"transform 0.2s ease, box-shadow 0.2s ease\"\n              },\n              onMouseDown: e => handleOverlayMouseDown(e, {\n                ...item,\n                index\n              }),\n              onWheel: e => handleOverlayWheel(e, item.id),\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `relative w-full h-full border-2 rounded-lg overflow-hidden shadow-lg group ${isSelected ? \"border-blue-400\" : \"border-white hover:border-blue-300\"}`,\n                style: {\n                  transition: isDraggingThis || isResizingThis ? \"none\" : \"border-color 0.2s ease\"\n                },\n                children: [item.type === \"video\" ? /*#__PURE__*/_jsxDEV(\"video\", {\n                  src: item.url,\n                  className: \"w-full h-full object-cover pointer-events-none\",\n                  muted: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1480,\n                  columnNumber: 25\n                }, this) : /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: item.url,\n                  alt: item.name,\n                  className: \"w-full h-full object-cover pointer-events-none\",\n                  draggable: false\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1486,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: `absolute inset-0 bg-blue-500 bg-opacity-0 hover:bg-opacity-10 ${isSelected ? \"bg-opacity-10\" : \"\"}`,\n                  style: {\n                    transition: isDraggingThis || isResizingThis ? \"none\" : \"background-color 0.2s ease\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1494,\n                  columnNumber: 23\n                }, this), isSelected && /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `resize-handle absolute -top-2 -left-2 w-4 h-4 bg-blue-500 rounded-full cursor-nw-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${isResizingThis && resizeOverlayHandle === \"nw\" ? \"scale-150 bg-red-500\" : \"\"}`,\n                    onMouseDown: e => handleOverlayResizeStart(e, item, \"nw\"),\n                    style: {\n                      transition: isDraggingThis || isResizingThis ? \"none\" : \"all 0.2s ease\"\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1509,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `resize-handle absolute -top-2 -right-2 w-4 h-4 bg-blue-500 rounded-full cursor-ne-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${isResizingThis && resizeOverlayHandle === \"ne\" ? \"scale-150 bg-red-500\" : \"\"}`,\n                    onMouseDown: e => handleOverlayResizeStart(e, item, \"ne\"),\n                    style: {\n                      transition: isDraggingThis || isResizingThis ? \"none\" : \"all 0.2s ease\"\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1525,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `resize-handle absolute -bottom-2 -left-2 w-4 h-4 bg-blue-500 rounded-full cursor-sw-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${isResizingThis && resizeOverlayHandle === \"sw\" ? \"scale-150 bg-red-500\" : \"\"}`,\n                    onMouseDown: e => handleOverlayResizeStart(e, item, \"sw\"),\n                    style: {\n                      transition: isDraggingThis || isResizingThis ? \"none\" : \"all 0.2s ease\"\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1541,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `resize-handle absolute -bottom-2 -right-2 w-4 h-4 bg-blue-500 rounded-full cursor-se-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${isResizingThis && resizeOverlayHandle === \"se\" ? \"scale-150 bg-red-500\" : \"\"}`,\n                    onMouseDown: e => handleOverlayResizeStart(e, item, \"se\"),\n                    style: {\n                      transition: isDraggingThis || isResizingThis ? \"none\" : \"all 0.2s ease\"\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1557,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-blue-500 rounded-full opacity-60 pointer-events-none\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1574,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"absolute -bottom-12 left-0 right-0 bg-black/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/20 shadow-lg\",\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex items-center space-x-2\",\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-white text-xs font-medium min-w-fit\",\n                        children: \"Opacity:\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1579,\n                        columnNumber: 31\n                      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"range\",\n                        min: \"0.1\",\n                        max: \"1\",\n                        step: \"0.05\",\n                        value: transform.opacity,\n                        onChange: e => updateOverlayTransform(item.id, {\n                          opacity: parseFloat(e.target.value)\n                        }),\n                        className: \"flex-1 h-2 accent-blue-500 cursor-pointer\",\n                        onMouseDown: e => e.stopPropagation()\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1582,\n                        columnNumber: 31\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-white text-xs min-w-8 text-right font-mono\",\n                        children: [Math.round(transform.opacity * 100), \"%\"]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1596,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1578,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1577,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: `absolute top-1 left-1 bg-black/70 text-white text-xs px-2 py-1 rounded pointer-events-none ${isSelected ? \"opacity-100\" : \"opacity-0 group-hover:opacity-100\"}`,\n                  style: {\n                    transition: isDraggingThis || isResizingThis ? \"none\" : \"opacity 0.2s ease\"\n                  },\n                  children: [item.name, \" \\u2022 \", Math.round(transform.scale * 100), \"% \\u2022\", \" \", Math.round(transform.opacity * 100), \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1604,\n                  columnNumber: 23\n                }, this), isSelected && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"absolute -top-0.5 -left-0.5 -right-0.5 -bottom-0.5 border-2 border-blue-400 rounded-lg pointer-events-none animate-pulse\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1622,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1466,\n                columnNumber: 21\n              }, this)\n            }, item.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1435,\n              columnNumber: 19\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1405,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full h-full flex items-center justify-center text-white\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-20 h-20 bg-gray-800 rounded-2xl flex items-center justify-center mx-auto mb-4\",\n              children: /*#__PURE__*/_jsxDEV(Film, {\n                size: 40,\n                className: \"opacity-50\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1633,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1632,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xl opacity-75 font-medium\",\n              children: \"No content at current time\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1635,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm opacity-50 mb-4\",\n              children: \"Drag media to timeline tracks to start editing\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1638,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs opacity-40 space-y-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"\\uD83D\\uDCA1 Overlays are interactive \\u2022 Ripple mode enabled\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1642,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Press\", \" \", /*#__PURE__*/_jsxDEV(\"kbd\", {\n                  className: \"px-1 py-0.5 bg-gray-700 rounded text-xs\",\n                  children: \"?\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1645,\n                  columnNumber: 21\n                }, this), \" \", \"for help & shortcuts\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1643,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1641,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1631,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1630,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-black/60 backdrop-blur-md rounded-2xl p-4\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => seekTo(Math.max(0, currentTime - 10)),\n              className: \"text-white hover:text-blue-400 transition-colors p-1 rounded-lg hover:bg-white/10\",\n              title: \"Skip back 10 seconds\",\n              children: /*#__PURE__*/_jsxDEV(SkipBack, {\n                size: 20\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1662,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1657,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handlePlayPause,\n              className: \"w-12 h-12 bg-white/20 hover:bg-white/30 rounded-2xl flex items-center justify-center text-white transition-all hover:scale-105\",\n              title: \"Play/Pause (Space)\",\n              children: isPlaying ? /*#__PURE__*/_jsxDEV(Pause, {\n                size: 24\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1669,\n                columnNumber: 30\n              }, this) : /*#__PURE__*/_jsxDEV(Play, {\n                size: 24\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1669,\n                columnNumber: 52\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1664,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => seekTo(Math.min(videoDuration, currentTime + 10)),\n              className: \"text-white hover:text-blue-400 transition-colors p-1 rounded-lg hover:bg-white/10\",\n              title: \"Skip forward 10 seconds\",\n              children: /*#__PURE__*/_jsxDEV(SkipForward, {\n                size: 20\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1678,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1671,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setIsMuted(!isMuted),\n                className: \"text-white hover:text-blue-400 transition-colors p-1 rounded-lg hover:bg-white/10\",\n                title: \"Toggle mute\",\n                children: isMuted ? /*#__PURE__*/_jsxDEV(VolumeX, {\n                  size: 20\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1686,\n                  columnNumber: 30\n                }, this) : /*#__PURE__*/_jsxDEV(Volume2, {\n                  size: 20\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1686,\n                  columnNumber: 54\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1681,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"range\",\n                min: \"0\",\n                max: \"1\",\n                step: \"0.1\",\n                value: volume,\n                onChange: e => setVolume(parseFloat(e.target.value)),\n                className: \"w-24 accent-blue-500\",\n                title: \"Volume control\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1688,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1680,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-white text-sm font-medium min-w-0\",\n              title: \"Current time / Total duration\",\n              children: [formatTime(currentTime), \" / \", formatTime(videoDuration)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1699,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1656,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1655,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1399,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Timeline, {\n        timelineItems: timelineItems,\n        setTimelineItems: setTimelineItems,\n        currentTime: currentTime,\n        videoDuration: videoDuration,\n        setVideoDuration: setVideoDuration,\n        selectedTimelineItem: selectedTimelineItem,\n        setSelectedTimelineItem: setSelectedTimelineItem,\n        timelineZoom: timelineZoom,\n        setTimelineZoom: setTimelineZoom,\n        tracks: tracks,\n        setTracks: setTracks,\n        draggedItem: draggedItem,\n        draggedTimelineItem: draggedTimelineItem,\n        setDraggedTimelineItem: setDraggedTimelineItem,\n        dropPreview: dropPreview,\n        setDropPreview: setDropPreview,\n        isDragging: isDragging,\n        isTimelineDragging: isTimelineDragging,\n        setIsTimelineDragging: setIsTimelineDragging,\n        isResizing: isResizing,\n        setIsResizing: setIsResizing,\n        copiedItem: copiedItem,\n        formatTime: formatTime,\n        seekTo: seekTo,\n        splitTimelineItem: splitTimelineItem,\n        copyTimelineItem: copyTimelineItem,\n        pasteTimelineItem: pasteTimelineItem,\n        deleteSelectedItem: deleteSelectedItem,\n        addToTimeline: addToTimeline,\n        insertWithRipple: insertWithRipple,\n        applyRippleEffect: applyRippleEffect,\n        removeFromTimeline: removeFromTimeline,\n        onSmartAddToTimeline: func => {\n          setSmartAddFunction(() => func);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1709,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowExportModal(true),\n        className: \"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-medium transition-all hover:scale-105 shadow-lg\",\n        children: [/*#__PURE__*/_jsxDEV(Download, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1751,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\u042D\\u043A\\u0441\\u043F\\u043E\\u0440\\u0442 \\u0432\\u0438\\u0434\\u0435\\u043E\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1752,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1747,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1397,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(VideoExporter, {\n      isOpen: showExportModal,\n      onClose: () => setShowExportModal(false),\n      timelineItems: timelineItems,\n      videoDuration: videoDuration,\n      tracks: tracks\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1757,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1382,\n    columnNumber: 5\n  }, this);\n};\n_s2(VideoEditor, \"pKIaTAXEXIHhscQXLV/nM8TbBTU=\");\n_c2 = VideoEditor;\nexport default VideoEditor;\nvar _c, _c2;\n$RefreshReg$(_c, \"VideoExporter\");\n$RefreshReg$(_c2, \"VideoEditor\");","map":{"version":3,"names":["useState","useRef","useEffect","useCallback","MediaLibrary","Timeline","Play","Pause","Volume2","SkipBack","SkipForward","Download","VolumeX","Film","X","Settings","Check","AlertCircle","Loader2","Zap","HardDrive","Cpu","jsxDEV","_jsxDEV","Fragment","_Fragment","VideoExporter","isOpen","onClose","timelineItems","videoDuration","tracks","_s","exportSettings","setExportSettings","resolution","fps","quality","format","bitrate","audioQuality","isExporting","setIsExporting","exportProgress","setExportProgress","exportStatus","setExportStatus","exportedBlob","setExportedBlob","exportError","setExportError","estimatedSize","setEstimatedSize","exportMethod","setExportMethod","canvasRef","videoRef","supportsWebCodecs","VideoEncoder","VideoDecoder","calculateEstimatedSize","width","height","split","map","Number","duration","sizeBytes","sizeMB","Math","round","React","getTimelineContentAtTime","time","currentItems","filter","item","startTime","mainVideo","find","trackType","type","includes","overlays","audio","images","renderFrameToCanvas","canvas","ctx","fillStyle","fillRect","content","video","document","createElement","src","url","currentTime","crossOrigin","Promise","resolve","handleCanPlay","removeEventListener","addEventListener","readyState","drawImage","length","image","Image","reject","onload","onerror","imgAspect","canvasAspect","drawWidth","drawHeight","drawX","drawY","overlay","img","overlayWidth","overlayHeight","x","y","globalAlpha","opacity","error","console","exportWithCanvas","current","getContext","stream","captureStream","mimeType","MediaRecorder","isTypeSupported","mediaRecorder","videoBitsPerSecond","chunks","ondataavailable","event","data","size","push","onstop","blob","Blob","start","currentFrame","totalFrames","ceil","renderFrame","stop","progress","setTimeout","handleExport","message","downloadVideo","URL","createObjectURL","a","href","download","Date","now","body","appendChild","click","removeChild","revokeObjectURL","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","value","onChange","e","prev","target","parseInt","label","ref","style","display","controls","disabled","_c","VideoEditor","mediaLibrary","setMediaLibrary","_s2","setTimelineItems","setCurrentTime","setVideoDuration","selectedTimelineItem","setSelectedTimelineItem","timelineZoom","setTimelineZoom","activeTab","setActiveTab","volume","setVolume","isMuted","setIsMuted","isPlaying","setIsPlaying","currentVideoSource","setCurrentVideoSource","draggedItem","setDraggedItem","draggedTimelineItem","setDraggedTimelineItem","dropPreview","setDropPreview","isDragging","setIsDragging","isTimelineDragging","setIsTimelineDragging","copiedItem","setCopiedItem","showExportModal","setShowExportModal","isResizing","setIsResizing","selectedOverlay","setSelectedOverlay","overlayTransforms","setOverlayTransforms","isDraggingOverlay","setIsDraggingOverlay","isResizingOverlay","setIsResizingOverlay","overlayDragStart","setOverlayDragStart","resizeOverlayHandle","setResizeOverlayHandle","initialOverlayTransform","setInitialOverlayTransform","showHelp","setShowHelp","smartAddFunction","setSmartAddFunction","setTracks","id","name","main","intervalRef","audioElementsRef","Map","videoContainerRef","formatTime","seconds","mins","floor","secs","ms","toString","padStart","handlePlayPause","seekTo","newTime","max","min","getCurrentTimelineContent","forEach","audioItem","audioElement","get","relativeTime","createAudioElement","has","muted","preload","set","syncAudioTime","timeDiff","abs","checkCollision","newItem","excludeId","some","trackId","itemStart","itemEnd","newStart","newEnd","insertWithRipple","insertTime","trackItems","sort","b","shouldRipple","affectedItems","insertPosition","blockAtPosition","blocksToShift","nextBlock","availableSpace","shiftAmount","applyRippleEffect","affectedItem","affected","maxEndTime","findNextAvailablePosition","preferredStart","log","lastItem","nextPosition","removeFromTimeline","itemId","pause","delete","getOverlayTransform","overlayId","scale","updateOverlayTransform","updates","handleOverlayMouseDown","closest","preventDefault","stopPropagation","container","containerRect","getBoundingClientRect","overlayElement","currentTarget","overlayRect","clientX","left","clientY","top","containerX","containerY","handleOverlayResizeStart","handle","currentTransform","startScale","startX","startY","handleOverlayMouseMove","rect","overlaySize","newX","newY","padding","limitedX","limitedY","baseX","baseY","index","undefined","deltaX","deltaY","scaleFactor","sensitivity","newScale","handleOverlayMouseUp","handleOverlayWheel","ctrlKey","transform","scaleDelta","splitTimelineItem","splitTime","firstPartDuration","secondPartStart","secondPartDuration","secondPart","random","updatedFirstPart","timelineItem","concat","copyTimelineItem","pasteTimelineItem","_insertResult$affecte","targetTrackId","insertResult","newEndTime","deleteSelectedItem","addToTimeline","mediaItem","prevItems","newStartTime","newTimelineItem","mediaId","estimatedEndTime","handleMediaLibraryClick","cursor","o","firstImage","currentAudioIds","Set","paused","play","catch","setInterval","clearInterval","handleKeyDown","tagName","key","code","step","shiftKey","window","title","alt","isSelected","isDraggingThis","isResizingThis","zIndex","transition","onMouseDown","onWheel","draggable","parseFloat","onSmartAddToTimeline","func","_c2","$RefreshReg$"],"sources":["C:/Scriptify/ai-content-studio/frontend/src/components/VideoEditor/VideoEditor.jsx"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { MediaLibrary } from \"../MediaLibrary\";\r\nimport { Timeline } from \"../Timeline\";\r\n\r\nimport {\r\n  Play,\r\n  Pause,\r\n  Volume2,\r\n  SkipBack,\r\n  SkipForward,\r\n  Download,\r\n  VolumeX,\r\n  Film,\r\n  X,\r\n  Settings,\r\n  Check,\r\n  AlertCircle,\r\n  Loader2,\r\n  Zap,\r\n  HardDrive,\r\n  Cpu,\r\n} from \"lucide-react\";\r\n\r\n// Компонент экспорта видео\r\nconst VideoExporter = ({ \r\n  isOpen, \r\n  onClose, \r\n  timelineItems, \r\n  videoDuration, \r\n  tracks \r\n}) => {\r\n  const [exportSettings, setExportSettings] = useState({\r\n    resolution: '1920x1080',\r\n    fps: 30,\r\n    quality: 'high',\r\n    format: 'mp4',\r\n    bitrate: 8000,\r\n    audioQuality: 192\r\n  });\r\n  \r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [exportProgress, setExportProgress] = useState(0);\r\n  const [exportStatus, setExportStatus] = useState('');\r\n  const [exportedBlob, setExportedBlob] = useState(null);\r\n  const [exportError, setExportError] = useState(null);\r\n  const [estimatedSize, setEstimatedSize] = useState(0);\r\n  const [exportMethod, setExportMethod] = useState('canvas'); // 'webcodecs' или 'canvas'\r\n\r\n  const canvasRef = useRef(null);\r\n  const videoRef = useRef(null);\r\n\r\n  // Проверка поддержки WebCodecs\r\n  const supportsWebCodecs = typeof VideoEncoder !== 'undefined' && typeof VideoDecoder !== 'undefined';\r\n\r\n  // Расчет примерного размера файла\r\n  const calculateEstimatedSize = useCallback(() => {\r\n    const [width, height] = exportSettings.resolution.split('x').map(Number);\r\n    const duration = videoDuration;\r\n    const bitrate = exportSettings.bitrate * 1000; // kbps to bps\r\n    \r\n    // Примерный расчет размера в MB\r\n    const sizeBytes = (bitrate * duration) / 8;\r\n    const sizeMB = sizeBytes / (1024 * 1024);\r\n    \r\n    setEstimatedSize(Math.round(sizeMB * 10) / 10);\r\n  }, [exportSettings, videoDuration]);\r\n\r\n  React.useEffect(() => {\r\n    calculateEstimatedSize();\r\n  }, [calculateEstimatedSize]);\r\n\r\n  // Получение контента временной шкалы для определенного времени\r\n  const getTimelineContentAtTime = useCallback((time) => {\r\n    const currentItems = timelineItems.filter(\r\n      item => time >= item.startTime && time < item.startTime + item.duration\r\n    );\r\n\r\n    return {\r\n      mainVideo: currentItems.find(item => item.trackType === 'main' && item.type.includes('video')),\r\n      overlays: currentItems.filter(item => item.trackType === 'overlay'),\r\n      audio: currentItems.filter(item => item.trackType === 'audio'),\r\n      images: currentItems.filter(item => item.type.includes('image'))\r\n    };\r\n  }, [timelineItems]);\r\n\r\n  // Создание canvas с композицией кадра\r\n  const renderFrameToCanvas = useCallback(async (time, canvas, ctx) => {\r\n    const [width, height] = exportSettings.resolution.split('x').map(Number);\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    \r\n    // Очистка canvas\r\n    ctx.fillStyle = '#000000';\r\n    ctx.fillRect(0, 0, width, height);\r\n\r\n    const content = getTimelineContentAtTime(time);\r\n    \r\n    try {\r\n      // Отрисовка основного видео\r\n      if (content.mainVideo) {\r\n        const video = document.createElement('video');\r\n        video.src = content.mainVideo.url;\r\n        video.currentTime = time - content.mainVideo.startTime;\r\n        video.crossOrigin = 'anonymous';\r\n        \r\n        await new Promise((resolve) => {\r\n          const handleCanPlay = () => {\r\n            video.removeEventListener('canplay', handleCanPlay);\r\n            resolve();\r\n          };\r\n          video.addEventListener('canplay', handleCanPlay);\r\n          if (video.readyState >= 3) {\r\n            resolve();\r\n          }\r\n        });\r\n        \r\n        ctx.drawImage(video, 0, 0, width, height);\r\n      }\r\n\r\n      // Отрисовка изображений как основного контента\r\n      if (!content.mainVideo && content.images.length > 0) {\r\n        const image = new Image();\r\n        image.crossOrigin = 'anonymous';\r\n        image.src = content.images[0].url;\r\n        \r\n        await new Promise((resolve, reject) => {\r\n          image.onload = resolve;\r\n          image.onerror = reject;\r\n        });\r\n        \r\n        // Подгонка изображения под размер canvas\r\n        const imgAspect = image.width / image.height;\r\n        const canvasAspect = width / height;\r\n        \r\n        let drawWidth, drawHeight, drawX, drawY;\r\n        \r\n        if (imgAspect > canvasAspect) {\r\n          drawWidth = width;\r\n          drawHeight = width / imgAspect;\r\n          drawX = 0;\r\n          drawY = (height - drawHeight) / 2;\r\n        } else {\r\n          drawWidth = height * imgAspect;\r\n          drawHeight = height;\r\n          drawX = (width - drawWidth) / 2;\r\n          drawY = 0;\r\n        }\r\n        \r\n        ctx.drawImage(image, drawX, drawY, drawWidth, drawHeight);\r\n      }\r\n\r\n      // Отрисовка оверлеев\r\n      for (const overlay of content.overlays) {\r\n        if (overlay.type.includes('image')) {\r\n          const img = new Image();\r\n          img.crossOrigin = 'anonymous';\r\n          img.src = overlay.url;\r\n          \r\n          await new Promise((resolve, reject) => {\r\n            img.onload = resolve;\r\n            img.onerror = () => resolve(); // Пропускаем ошибки загрузки\r\n          });\r\n\r\n          // Позиция оверлея (упрощенная - в реальном приложении учитывайте трансформации)\r\n          const overlayWidth = 200;\r\n          const overlayHeight = 150;\r\n          const x = 100;\r\n          const y = 50;\r\n          \r\n          ctx.globalAlpha = overlay.opacity || 1;\r\n          ctx.drawImage(img, x, y, overlayWidth, overlayHeight);\r\n          ctx.globalAlpha = 1;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Ошибка отрисовки кадра:', error);\r\n    }\r\n  }, [exportSettings, getTimelineContentAtTime]);\r\n\r\n  // Экспорт через Canvas + MediaRecorder\r\n  const exportWithCanvas = useCallback(async () => {\r\n    setExportStatus('Подготовка записи...');\r\n    \r\n    const [width, height] = exportSettings.resolution.split('x').map(Number);\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    const stream = canvas.captureStream(exportSettings.fps);\r\n    \r\n    // Попробуем разные форматы\r\n    let mimeType = 'video/webm;codecs=vp9';\r\n    if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n      mimeType = 'video/webm;codecs=vp8';\r\n      if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n        mimeType = 'video/webm';\r\n      }\r\n    }\r\n\r\n    const mediaRecorder = new MediaRecorder(stream, {\r\n      mimeType,\r\n      videoBitsPerSecond: exportSettings.bitrate * 1000\r\n    });\r\n\r\n    const chunks = [];\r\n    \r\n    mediaRecorder.ondataavailable = (event) => {\r\n      if (event.data.size > 0) {\r\n        chunks.push(event.data);\r\n      }\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n      mediaRecorder.onstop = () => {\r\n        const blob = new Blob(chunks, { type: mimeType });\r\n        resolve(blob);\r\n      };\r\n\r\n      mediaRecorder.onerror = reject;\r\n\r\n      mediaRecorder.start();\r\n      \r\n      let currentFrame = 0;\r\n      const totalFrames = Math.ceil(videoDuration * exportSettings.fps);\r\n      \r\n      const renderFrame = async () => {\r\n        if (currentFrame >= totalFrames) {\r\n          mediaRecorder.stop();\r\n          return;\r\n        }\r\n\r\n        const time = currentFrame / exportSettings.fps;\r\n        await renderFrameToCanvas(time, canvas, ctx);\r\n        \r\n        currentFrame++;\r\n        const progress = (currentFrame / totalFrames) * 100;\r\n        setExportProgress(progress);\r\n        setExportStatus(`Обработка кадра ${currentFrame} из ${totalFrames}`);\r\n\r\n        // Небольшая задержка для обновления UI\r\n        setTimeout(renderFrame, 1000 / exportSettings.fps);\r\n      };\r\n\r\n      renderFrame();\r\n    });\r\n  }, [exportSettings, videoDuration, renderFrameToCanvas]);\r\n\r\n  // Основная функция экспорта\r\n  const handleExport = useCallback(async () => {\r\n    setIsExporting(true);\r\n    setExportProgress(0);\r\n    setExportError(null);\r\n    setExportedBlob(null);\r\n\r\n    try {\r\n      const blob = await exportWithCanvas();\r\n      setExportedBlob(blob);\r\n      setExportStatus('Экспорт завершен!');\r\n      setExportProgress(100);\r\n    } catch (error) {\r\n      console.error('Ошибка экспорта:', error);\r\n      setExportError(error.message || 'Неизвестная ошибка');\r\n      setExportStatus('Ошибка экспорта');\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  }, [exportWithCanvas]);\r\n\r\n  // Скачивание файла\r\n  const downloadVideo = useCallback(() => {\r\n    if (!exportedBlob) return;\r\n\r\n    const url = URL.createObjectURL(exportedBlob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `video-export-${Date.now()}.webm`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  }, [exportedBlob]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden\">\r\n        {/* Header */}\r\n        <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center\">\r\n                <Download size={20} />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-bold\">Экспорт видео</h2>\r\n                <p className=\"text-blue-100 text-sm\">Создайте финальную версию вашего проекта</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-colors\"\r\n            >\r\n              <X size={18} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-120px)]\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Настройки экспорта */}\r\n            <div className=\"space-y-6\">\r\n              <div className=\"bg-gray-50 rounded-xl p-4\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center\">\r\n                  <Settings className=\"mr-2\" size={18} />\r\n                  Настройки экспорта\r\n                </h3>\r\n                \r\n                <div className=\"space-y-4\">\r\n                  {/* Разрешение */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Разрешение\r\n                    </label>\r\n                    <select\r\n                      value={exportSettings.resolution}\r\n                      onChange={(e) => setExportSettings(prev => ({ ...prev, resolution: e.target.value }))}\r\n                      className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    >\r\n                      <option value=\"1920x1080\">Full HD (1920×1080)</option>\r\n                      <option value=\"1280x720\">HD (1280×720)</option>\r\n                      <option value=\"854x480\">SD (854×480)</option>\r\n                      <option value=\"640x360\">Low (640×360)</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  {/* FPS */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Частота кадров (FPS)\r\n                    </label>\r\n                    <select\r\n                      value={exportSettings.fps}\r\n                      onChange={(e) => setExportSettings(prev => ({ ...prev, fps: parseInt(e.target.value) }))}\r\n                      className=\"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    >\r\n                      <option value={30}>30 FPS</option>\r\n                      <option value={24}>24 FPS (Cinematic)</option>\r\n                      <option value={15}>15 FPS (Low)</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  {/* Качество */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                      Качество\r\n                    </label>\r\n                    <div className=\"grid grid-cols-3 gap-2\">\r\n                      {[\r\n                        { value: 'low', label: 'Низкое', bitrate: 2000 },\r\n                        { value: 'medium', label: 'Среднее', bitrate: 5000 },\r\n                        { value: 'high', label: 'Высокое', bitrate: 8000 },\r\n                      ].map((quality) => (\r\n                        <button\r\n                          key={quality.value}\r\n                          onClick={() => setExportSettings(prev => ({ \r\n                            ...prev, \r\n                            quality: quality.value, \r\n                            bitrate: quality.bitrate \r\n                          }))}\r\n                          className={`p-2 rounded-lg text-sm font-medium transition-colors ${\r\n                            exportSettings.quality === quality.value\r\n                              ? 'bg-blue-600 text-white'\r\n                              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n                          }`}\r\n                        >\r\n                          {quality.label}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Информация о файле */}\r\n              <div className=\"bg-blue-50 rounded-xl p-4\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\r\n                  <HardDrive className=\"mr-2\" size={18} />\r\n                  Информация о файле\r\n                </h3>\r\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                  <div>\r\n                    <span className=\"text-gray-600\">Длительность:</span>\r\n                    <div className=\"font-medium\">{Math.round(videoDuration)}с</div>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600\">Разрешение:</span>\r\n                    <div className=\"font-medium\">{exportSettings.resolution}</div>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600\">Битрейт:</span>\r\n                    <div className=\"font-medium\">{exportSettings.bitrate} kbps</div>\r\n                  </div>\r\n                  <div>\r\n                    <span className=\"text-gray-600\">Примерный размер:</span>\r\n                    <div className=\"font-medium\">{estimatedSize} MB</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Превью и прогресс */}\r\n            <div className=\"space-y-6\">\r\n              {/* Превью */}\r\n              <div className=\"bg-gray-50 rounded-xl p-4\">\r\n                <h3 className=\"font-semibold text-gray-900 mb-4 flex items-center\">\r\n                  <Film className=\"mr-2\" size={18} />\r\n                  Превью проекта\r\n                </h3>\r\n                \r\n                <div className=\"bg-black rounded-lg aspect-video flex items-center justify-center text-white text-sm relative\">\r\n                  <canvas \r\n                    ref={canvasRef}\r\n                    className=\"max-w-full max-h-full rounded-lg\"\r\n                    style={{ display: exportedBlob ? 'none' : 'block' }}\r\n                  />\r\n                  {exportedBlob && (\r\n                    <video\r\n                      ref={videoRef}\r\n                      src={URL.createObjectURL(exportedBlob)}\r\n                      controls\r\n                      className=\"max-w-full max-h-full rounded-lg\"\r\n                    />\r\n                  )}\r\n                  {!exportedBlob && !isExporting && (\r\n                    <div className=\"text-center\">\r\n                      <Film size={48} className=\"mx-auto mb-2 opacity-50\" />\r\n                      <p>Превью появится после экспорта</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Прогресс экспорта */}\r\n              {(isExporting || exportedBlob || exportError) && (\r\n                <div className=\"bg-gray-50 rounded-xl p-4\">\r\n                  <h3 className=\"font-semibold text-gray-900 mb-4\">\r\n                    {isExporting ? 'Экспорт в процессе...' : exportError ? 'Ошибка' : 'Экспорт завершен'}\r\n                  </h3>\r\n                  \r\n                  {isExporting && (\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-3\">\r\n                        <div \r\n                          className=\"bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-300\"\r\n                          style={{ width: `${exportProgress}%` }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex items-center justify-between text-sm\">\r\n                        <span className=\"text-gray-600\">{exportStatus}</span>\r\n                        <span className=\"font-medium\">{Math.round(exportProgress)}%</span>\r\n                      </div>\r\n                      <div className=\"flex items-center text-blue-600\">\r\n                        <Loader2 className=\"animate-spin mr-2\" size={16} />\r\n                        <span className=\"text-sm\">Обработка...</span>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {exportedBlob && (\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"flex items-center text-green-600\">\r\n                        <Check className=\"mr-2\" size={20} />\r\n                        <span className=\"font-medium\">Видео готово к скачиванию!</span>\r\n                      </div>\r\n                      <button\r\n                        onClick={downloadVideo}\r\n                        className=\"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-4 rounded-lg font-medium transition-all flex items-center justify-center space-x-2\"\r\n                      >\r\n                        <Download size={20} />\r\n                        <span>Скачать видео</span>\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n\r\n                  {exportError && (\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"flex items-center text-red-600\">\r\n                        <AlertCircle className=\"mr-2\" size={20} />\r\n                        <span className=\"font-medium\">Произошла ошибка: {exportError}</span>\r\n                      </div>\r\n                      <button\r\n                        onClick={handleExport}\r\n                        className=\"w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-medium transition-colors\"\r\n                      >\r\n                        Попробовать снова\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Кнопки действий */}\r\n          <div className=\"flex justify-between items-center mt-6 pt-6 border-t border-gray-200\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-6 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors\"\r\n            >\r\n              Отмена\r\n            </button>\r\n            \r\n            <div className=\"flex space-x-3\">\r\n              {!exportedBlob && (\r\n                <button\r\n                  onClick={handleExport}\r\n                  disabled={isExporting}\r\n                  className=\"px-8 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 text-white rounded-lg font-medium transition-all flex items-center space-x-2 disabled:cursor-not-allowed\"\r\n                >\r\n                  {isExporting ? (\r\n                    <>\r\n                      <Loader2 className=\"animate-spin\" size={18} />\r\n                      <span>Экспорт...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Download size={18} />\r\n                      <span>Начать экспорт</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst VideoEditor = ({ mediaLibrary, setMediaLibrary }) => {\r\n  const [timelineItems, setTimelineItems] = useState([]);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [videoDuration, setVideoDuration] = useState(60);\r\n  const [selectedTimelineItem, setSelectedTimelineItem] = useState(null);\r\n  const [timelineZoom, setTimelineZoom] = useState(1);\r\n  const [activeTab, setActiveTab] = useState(\"videos\");\r\n  const [volume, setVolume] = useState(1);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [currentVideoSource, setCurrentVideoSource] = useState(null);\r\n  const [draggedItem, setDraggedItem] = useState(null);\r\n  const [draggedTimelineItem, setDraggedTimelineItem] = useState(null);\r\n  const [dropPreview, setDropPreview] = useState(null);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [isTimelineDragging, setIsTimelineDragging] = useState(false);\r\n  const [copiedItem, setCopiedItem] = useState(null);\r\n  const [showExportModal, setShowExportModal] = useState(false);\r\n\r\n  // Состояния для resize\r\n  const [isResizing, setIsResizing] = useState(false);\r\n\r\n  // Состояния для управления overlays на видео\r\n  const [selectedOverlay, setSelectedOverlay] = useState(null);\r\n  const [overlayTransforms, setOverlayTransforms] = useState({});\r\n  const [isDraggingOverlay, setIsDraggingOverlay] = useState(false);\r\n  const [isResizingOverlay, setIsResizingOverlay] = useState(false);\r\n  const [overlayDragStart, setOverlayDragStart] = useState({ x: 0, y: 0 });\r\n  const [resizeOverlayHandle, setResizeOverlayHandle] = useState(null);\r\n  const [initialOverlayTransform, setInitialOverlayTransform] = useState(null);\r\n\r\n  // Модальное окно помощи\r\n  const [showHelp, setShowHelp] = useState(false);\r\n\r\n  // ✅ НОВОЕ: Состояние для умной функции добавления из Timeline\r\n  const [smartAddFunction, setSmartAddFunction] = useState(null);\r\n\r\n  // Треки\r\n  const [tracks, setTracks] = useState({\r\n    overlays: [\r\n      { id: \"overlay-1\", name: \"Overlay 1\", type: \"overlay\" },\r\n      { id: \"overlay-2\", name: \"Overlay 2\", type: \"overlay\" },\r\n    ],\r\n    main: [{ id: \"main-video\", name: \"Main Video\", type: \"main\" }],\r\n    audio: [\r\n      { id: \"audio-1\", name: \"Audio 1\", type: \"audio\" },\r\n      { id: \"audio-2\", name: \"Audio 2\", type: \"audio\" },\r\n    ],\r\n  });\r\n\r\n  const intervalRef = useRef(null);\r\n  const audioElementsRef = useRef(new Map());\r\n  const videoRef = useRef(null);\r\n  const videoContainerRef = useRef(null);\r\n\r\n  const formatTime = (seconds) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    const ms = Math.floor((seconds % 1) * 100);\r\n    return timelineZoom > 5\r\n      ? `${mins}:${secs.toString().padStart(2, \"0\")}.${ms\r\n          .toString()\r\n          .padStart(2, \"0\")}`\r\n      : `${mins}:${secs.toString().padStart(2, \"0\")}`;\r\n  };\r\n\r\n  const handlePlayPause = () => {\r\n    setIsPlaying(!isPlaying);\r\n  };\r\n\r\n  const seekTo = (time) => {\r\n    const newTime = Math.max(0, Math.min(videoDuration, time));\r\n    setCurrentTime(newTime);\r\n\r\n    const content = getCurrentTimelineContent();\r\n    content.audio.forEach((audioItem) => {\r\n      const audioElement = audioElementsRef.current.get(audioItem.id);\r\n      if (audioElement) {\r\n        const relativeTime = newTime - audioItem.startTime;\r\n        audioElement.currentTime = Math.max(0, relativeTime);\r\n      }\r\n    });\r\n  };\r\n\r\n  const getCurrentTimelineContent = useCallback(() => {\r\n    const currentItems = timelineItems.filter(\r\n      (item) =>\r\n        currentTime >= item.startTime &&\r\n        currentTime < item.startTime + item.duration\r\n    );\r\n\r\n    return {\r\n      mainVideo: currentItems.find(\r\n        (item) => item.trackType === \"main\" && item.type === \"videos\"\r\n      ),\r\n      overlays: currentItems.filter((item) => item.trackType === \"overlay\"),\r\n      audio: currentItems.filter((item) => item.trackType === \"audio\"),\r\n    };\r\n  }, [currentTime, timelineItems]);\r\n\r\n  const createAudioElement = useCallback(\r\n    (audioItem) => {\r\n      if (!audioElementsRef.current.has(audioItem.id)) {\r\n        const audio = document.createElement(\"audio\");\r\n        audio.src = audioItem.url;\r\n        audio.volume = (audioItem.volume || 1) * volume;\r\n        audio.muted = isMuted;\r\n        audio.preload = \"metadata\";\r\n        audioElementsRef.current.set(audioItem.id, audio);\r\n      }\r\n      return audioElementsRef.current.get(audioItem.id);\r\n    },\r\n    [volume, isMuted]\r\n  );\r\n\r\n  const syncAudioTime = useCallback((audioItem, relativeTime) => {\r\n    const audioElement = audioElementsRef.current.get(audioItem.id);\r\n    if (audioElement) {\r\n      const timeDiff = Math.abs(audioElement.currentTime - relativeTime);\r\n      if (timeDiff > 0.2) {\r\n        audioElement.currentTime = Math.max(0, relativeTime);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const checkCollision = useCallback(\r\n    (newItem, excludeId = null) => {\r\n      return timelineItems.some((item) => {\r\n        if (item.id === excludeId) return false;\r\n        if (item.trackId !== newItem.trackId) return false;\r\n\r\n        const itemStart = item.startTime;\r\n        const itemEnd = item.startTime + item.duration;\r\n        const newStart = newItem.startTime;\r\n        const newEnd = newItem.startTime + newItem.duration;\r\n\r\n        return newStart < itemEnd && newEnd > itemStart;\r\n      });\r\n    },\r\n    [timelineItems]\r\n  );\r\n\r\n  const insertWithRipple = useCallback(\r\n    (trackId, insertTime, duration, excludeId = null) => {\r\n      const trackItems = timelineItems\r\n        .filter((item) => item.trackId === trackId && item.id !== excludeId)\r\n        .sort((a, b) => a.startTime - b.startTime);\r\n\r\n      if (trackItems.length === 0) {\r\n        return {\r\n          time: Math.max(0, insertTime),\r\n          shouldRipple: false,\r\n          affectedItems: [],\r\n        };\r\n      }\r\n\r\n      let insertPosition = insertTime;\r\n      let shouldRipple = false;\r\n      let affectedItems = [];\r\n\r\n      const blockAtPosition = trackItems.find(\r\n        (item) =>\r\n          insertTime >= item.startTime &&\r\n          insertTime < item.startTime + item.duration\r\n      );\r\n\r\n      if (blockAtPosition) {\r\n        insertPosition = blockAtPosition.startTime;\r\n        shouldRipple = true;\r\n        affectedItems = trackItems.filter(\r\n          (item) => item.startTime >= insertPosition\r\n        );\r\n      } else {\r\n        const blocksToShift = trackItems.filter(\r\n          (item) => item.startTime >= insertTime\r\n        );\r\n\r\n        if (blocksToShift.length > 0) {\r\n          const nextBlock = blocksToShift[0];\r\n          const availableSpace = nextBlock.startTime - insertTime;\r\n\r\n          if (availableSpace >= duration) {\r\n            insertPosition = insertTime;\r\n            shouldRipple = false;\r\n          } else {\r\n            insertPosition = insertTime;\r\n            shouldRipple = true;\r\n            affectedItems = blocksToShift;\r\n          }\r\n        } else {\r\n          insertPosition = insertTime;\r\n          shouldRipple = false;\r\n        }\r\n      }\r\n\r\n      return {\r\n        time: Math.max(0, insertPosition),\r\n        shouldRipple,\r\n        affectedItems,\r\n        shiftAmount: shouldRipple ? duration : 0,\r\n      };\r\n    },\r\n    [timelineItems]\r\n  );\r\n\r\n  const applyRippleEffect = useCallback(\r\n    (affectedItems, shiftAmount) => {\r\n      if (!affectedItems.length || shiftAmount <= 0) return;\r\n\r\n      setTimelineItems((prev) =>\r\n        prev.map((item) => {\r\n          const affectedItem = affectedItems.find(\r\n            (affected) => affected.id === item.id\r\n          );\r\n          if (affectedItem) {\r\n            return {\r\n              ...item,\r\n              startTime: item.startTime + shiftAmount,\r\n            };\r\n          }\r\n          return item;\r\n        })\r\n      );\r\n\r\n      if (affectedItems.length > 0) {\r\n        const maxEndTime = Math.max(\r\n          ...affectedItems.map(\r\n            (item) => item.startTime + item.duration + shiftAmount\r\n          )\r\n        );\r\n        if (maxEndTime > videoDuration) {\r\n          setVideoDuration(maxEndTime + 10);\r\n        }\r\n      }\r\n    },\r\n    [videoDuration]\r\n  );\r\n\r\n  const findNextAvailablePosition = useCallback(\r\n    (trackId, duration, preferredStart = 0) => {\r\n      const trackItems = timelineItems\r\n        .filter((item) => item.trackId === trackId)\r\n        .sort((a, b) => a.startTime - b.startTime);\r\n\r\n      console.log(\r\n        `🔍 Ищем место для длительности ${duration} на треке ${trackId}`\r\n      );\r\n\r\n      // Если трек пустой\r\n      if (trackItems.length === 0) {\r\n        console.log(`✅ Трек пустой, размещаем в позицию: 0`);\r\n        return 0;\r\n      }\r\n\r\n      // ✅ ИСПРАВЛЕНО: размещаем сразу после последнего элемента + небольшой отступ\r\n      const lastItem = trackItems[trackItems.length - 1];\r\n      const nextPosition = lastItem.startTime + lastItem.duration + 0.1; // отступ 0.1 сек\r\n\r\n      console.log(\r\n        `✅ Последний элемент \"${lastItem.name}\" заканчивается в ${\r\n          lastItem.startTime + lastItem.duration\r\n        }`\r\n      );\r\n      console.log(`✅ Размещаем новый элемент в позицию: ${nextPosition}`);\r\n      return nextPosition;\r\n    },\r\n    [timelineItems]\r\n  );\r\n\r\n  const removeFromTimeline = (itemId) => {\r\n    const audioElement = audioElementsRef.current.get(itemId);\r\n    if (audioElement) {\r\n      audioElement.pause();\r\n      audioElement.src = \"\";\r\n      audioElementsRef.current.delete(itemId);\r\n    }\r\n\r\n    setTimelineItems((prev) => prev.filter((item) => item.id !== itemId));\r\n    setSelectedTimelineItem(null);\r\n  };\r\n\r\n  // Функции для управления overlays\r\n  const getOverlayTransform = useCallback(\r\n    (overlayId) => {\r\n      return (\r\n        overlayTransforms[overlayId] || { x: 0, y: 0, scale: 1, opacity: 1 }\r\n      );\r\n    },\r\n    [overlayTransforms]\r\n  );\r\n\r\n  const updateOverlayTransform = useCallback(\r\n    (overlayId, updates) => {\r\n      setOverlayTransforms((prev) => ({\r\n        ...prev,\r\n        [overlayId]: { ...getOverlayTransform(overlayId), ...updates },\r\n      }));\r\n    },\r\n    [getOverlayTransform]\r\n  );\r\n\r\n  const handleOverlayMouseDown = useCallback((e, overlay) => {\r\n    if (e.target.closest(\".resize-handle\")) return;\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    setSelectedOverlay(overlay);\r\n    setIsDraggingOverlay(true);\r\n\r\n    const container = videoContainerRef.current;\r\n    if (!container) return;\r\n\r\n    const containerRect = container.getBoundingClientRect();\r\n    const overlayElement = e.currentTarget;\r\n    const overlayRect = overlayElement.getBoundingClientRect();\r\n\r\n    setOverlayDragStart({\r\n      x: e.clientX - overlayRect.left,\r\n      y: e.clientY - overlayRect.top,\r\n      containerX: containerRect.left,\r\n      containerY: containerRect.top,\r\n    });\r\n  }, []);\r\n\r\n  const handleOverlayResizeStart = useCallback(\r\n    (e, overlay, handle) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      setSelectedOverlay(overlay);\r\n      setIsResizingOverlay(true);\r\n      setResizeOverlayHandle(handle);\r\n\r\n      const currentTransform = getOverlayTransform(overlay.id);\r\n      setInitialOverlayTransform(currentTransform);\r\n\r\n      setOverlayDragStart({\r\n        x: e.clientX,\r\n        y: e.clientY,\r\n        startScale: currentTransform.scale,\r\n        startX: currentTransform.x,\r\n        startY: currentTransform.y,\r\n      });\r\n    },\r\n    [getOverlayTransform]\r\n  );\r\n\r\n  const handleOverlayMouseMove = useCallback(\r\n    (e) => {\r\n      if (!selectedOverlay) return;\r\n\r\n      if (isDraggingOverlay) {\r\n        const container = videoContainerRef.current;\r\n        if (!container) return;\r\n\r\n        const rect = container.getBoundingClientRect();\r\n        const overlaySize = 128 * getOverlayTransform(selectedOverlay.id).scale;\r\n\r\n        const newX =\r\n          e.clientX - overlayDragStart.containerX - overlayDragStart.x;\r\n        const newY =\r\n          e.clientY - overlayDragStart.containerY - overlayDragStart.y;\r\n\r\n        const padding = 5;\r\n        const limitedX = Math.max(\r\n          padding,\r\n          Math.min(rect.width - overlaySize - padding, newX)\r\n        );\r\n        const limitedY = Math.max(\r\n          padding,\r\n          Math.min(rect.height - overlaySize - padding, newY)\r\n        );\r\n\r\n        const baseX = 200;\r\n        const baseY = 50 + selectedOverlay.index * 120;\r\n\r\n        updateOverlayTransform(selectedOverlay.id, {\r\n          x: limitedX - baseX,\r\n          y: limitedY - baseY,\r\n        });\r\n      } else if (\r\n        isResizingOverlay &&\r\n        overlayDragStart.startScale !== undefined &&\r\n        resizeOverlayHandle\r\n      ) {\r\n        const deltaX = e.clientX - overlayDragStart.x;\r\n        const deltaY = e.clientY - overlayDragStart.y;\r\n\r\n        let scaleFactor = 1;\r\n        const sensitivity = 0.005;\r\n\r\n        switch (resizeOverlayHandle) {\r\n          case \"nw\":\r\n            scaleFactor = 1 - (deltaX + deltaY) * sensitivity;\r\n            break;\r\n          case \"ne\":\r\n            scaleFactor = 1 + (deltaX - deltaY) * sensitivity;\r\n            break;\r\n          case \"sw\":\r\n            scaleFactor = 1 + (-deltaX + deltaY) * sensitivity;\r\n            break;\r\n          case \"se\":\r\n            scaleFactor = 1 + (deltaX + deltaY) * sensitivity;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n\r\n        const newScale = Math.max(\r\n          0.2,\r\n          Math.min(4, overlayDragStart.startScale * scaleFactor)\r\n        );\r\n\r\n        updateOverlayTransform(selectedOverlay.id, {\r\n          scale: newScale,\r\n        });\r\n      }\r\n    },\r\n    [\r\n      selectedOverlay,\r\n      isDraggingOverlay,\r\n      isResizingOverlay,\r\n      overlayDragStart,\r\n      updateOverlayTransform,\r\n      getOverlayTransform,\r\n      resizeOverlayHandle,\r\n    ]\r\n  );\r\n\r\n  const handleOverlayMouseUp = useCallback(() => {\r\n    setIsDraggingOverlay(false);\r\n    setIsResizingOverlay(false);\r\n    setResizeOverlayHandle(null);\r\n    setInitialOverlayTransform(null);\r\n  }, []);\r\n\r\n  const handleOverlayWheel = useCallback(\r\n    (e, overlayId) => {\r\n      if (!e.ctrlKey) return;\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      const transform = getOverlayTransform(overlayId);\r\n      const scaleDelta = e.deltaY > 0 ? -0.05 : 0.05;\r\n      const newScale = Math.max(0.2, Math.min(4, transform.scale + scaleDelta));\r\n\r\n      updateOverlayTransform(overlayId, { scale: newScale });\r\n    },\r\n    [getOverlayTransform, updateOverlayTransform]\r\n  );\r\n\r\n  // Функции для работы с элементами таймлайна\r\n  const splitTimelineItem = useCallback(() => {\r\n    if (!selectedTimelineItem) return;\r\n\r\n    const item = selectedTimelineItem;\r\n    const splitTime = currentTime;\r\n\r\n    if (\r\n      splitTime <= item.startTime ||\r\n      splitTime >= item.startTime + item.duration\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const firstPartDuration = splitTime - item.startTime;\r\n    const secondPartStart = splitTime;\r\n    const secondPartDuration = item.duration - firstPartDuration;\r\n\r\n    const secondPart = {\r\n      ...item,\r\n      id: Date.now() + Math.random(),\r\n      startTime: secondPartStart,\r\n      duration: secondPartDuration,\r\n    };\r\n\r\n    const updatedFirstPart = {\r\n      ...item,\r\n      duration: firstPartDuration,\r\n    };\r\n\r\n    setTimelineItems((prev) =>\r\n      prev\r\n        .map((timelineItem) =>\r\n          timelineItem.id === item.id ? updatedFirstPart : timelineItem\r\n        )\r\n        .concat(secondPart)\r\n    );\r\n\r\n    setSelectedTimelineItem(null);\r\n  }, [selectedTimelineItem, currentTime]);\r\n\r\n  const copyTimelineItem = useCallback(() => {\r\n    if (!selectedTimelineItem) return;\r\n    setCopiedItem(selectedTimelineItem);\r\n  }, [selectedTimelineItem]);\r\n\r\n  const pasteTimelineItem = useCallback(() => {\r\n    if (!copiedItem) return;\r\n\r\n    const targetTrackId = copiedItem.trackId;\r\n    const insertResult = insertWithRipple(\r\n      targetTrackId,\r\n      currentTime,\r\n      copiedItem.duration\r\n    );\r\n\r\n    if (insertResult.shouldRipple && insertResult.affectedItems?.length > 0) {\r\n      applyRippleEffect(insertResult.affectedItems, copiedItem.duration);\r\n    }\r\n\r\n    const newItem = {\r\n      ...copiedItem,\r\n      id: Date.now() + Math.random(),\r\n      startTime: insertResult.time,\r\n    };\r\n\r\n    setTimelineItems((prev) => [...prev, newItem]);\r\n\r\n    const newEndTime = newItem.startTime + newItem.duration;\r\n    if (newEndTime > videoDuration) {\r\n      setVideoDuration(newEndTime + 10);\r\n    }\r\n\r\n    setSelectedTimelineItem(newItem);\r\n  }, [\r\n    copiedItem,\r\n    currentTime,\r\n    insertWithRipple,\r\n    applyRippleEffect,\r\n    videoDuration,\r\n  ]);\r\n\r\n  const deleteSelectedItem = useCallback(() => {\r\n    if (!selectedTimelineItem) return;\r\n    removeFromTimeline(selectedTimelineItem.id);\r\n  }, [selectedTimelineItem]);\r\n\r\n  const addToTimeline = useCallback(\r\n    (mediaItem, startTime = null, targetTrackId = null) => {\r\n      if (!mediaItem || !mediaItem.name || !mediaItem.type) {\r\n        return;\r\n      }\r\n      console.log(targetTrackId);\r\n\r\n      let trackId, trackType;\r\n\r\n      if (mediaItem.type === \"videos\" || mediaItem.type === \"video\") {\r\n        trackId = \"main-video\";\r\n        trackType = \"main\";\r\n      } else if (mediaItem.type === \"images\" || mediaItem.type === \"image\") {\r\n        trackId = \"overlay-1\";\r\n        trackType = \"overlay\";\r\n      } else if (mediaItem.type === \"audios\" || mediaItem.type === \"audio\") {\r\n        trackId = \"audio-1\";\r\n        trackType = \"audio\";\r\n      } else {\r\n        return;\r\n      }\r\n\r\n      const duration =\r\n        mediaItem.duration || (mediaItem.type.includes(\"image\") ? 5 : 10);\r\n\r\n      setTimelineItems((prevItems) => {\r\n        const trackItems = prevItems\r\n          .filter((item) => item.trackId === trackId)\r\n          .sort((a, b) => a.startTime - b.startTime);\r\n\r\n        // Вычисляем позицию для нового элемента\r\n        let newStartTime;\r\n        if (startTime !== null) {\r\n          newStartTime = startTime;\r\n        } else if (trackItems.length === 0) {\r\n          newStartTime = 0;\r\n        } else {\r\n          // Размещаем сразу после последнего элемента\r\n          const lastItem = trackItems[trackItems.length - 1];\r\n          newStartTime = lastItem.startTime + lastItem.duration;\r\n        }\r\n\r\n        // Создаем новый элемент\r\n        const newTimelineItem = {\r\n          id: Date.now() + Math.random(),\r\n          mediaId: mediaItem.id,\r\n          type: mediaItem.type,\r\n          name: mediaItem.name,\r\n          url: mediaItem.url,\r\n          startTime: newStartTime,\r\n          duration: duration,\r\n          trackId: trackId,\r\n          trackType: trackType,\r\n          volume: 1,\r\n          opacity: 1,\r\n        };\r\n\r\n        return [...prevItems, newTimelineItem];\r\n      });\r\n\r\n      const estimatedEndTime = (startTime || 0) + duration;\r\n      if (estimatedEndTime > videoDuration) {\r\n        setVideoDuration(estimatedEndTime + 10);\r\n      }\r\n    },\r\n    [videoDuration]\r\n  );\r\n\r\n  const handleMediaLibraryClick = (item) => {\r\n    if (!item || !item.name || !item.type) {\r\n      return;\r\n    }\r\n\r\n    if (smartAddFunction) {\r\n      smartAddFunction(item);\r\n    } else {\r\n      addToTimeline(item);\r\n    }\r\n  };\r\n\r\n  // Эффекты для управления overlays\r\n  useEffect(() => {\r\n    if (isDraggingOverlay || isResizingOverlay) {\r\n      document.addEventListener(\"mousemove\", handleOverlayMouseMove);\r\n      document.addEventListener(\"mouseup\", handleOverlayMouseUp);\r\n      document.body.style.cursor = isDraggingOverlay ? \"grabbing\" : \"nw-resize\";\r\n\r\n      return () => {\r\n        document.removeEventListener(\"mousemove\", handleOverlayMouseMove);\r\n        document.removeEventListener(\"mouseup\", handleOverlayMouseUp);\r\n        document.body.style.cursor = \"\";\r\n      };\r\n    }\r\n  }, [\r\n    isDraggingOverlay,\r\n    isResizingOverlay,\r\n    handleOverlayMouseMove,\r\n    handleOverlayMouseUp,\r\n  ]);\r\n\r\n  // Основные эффекты\r\n  useEffect(() => {\r\n    const content = getCurrentTimelineContent();\r\n\r\n    if (content.mainVideo && content.mainVideo.url !== currentVideoSource) {\r\n      setCurrentVideoSource(content.mainVideo.url);\r\n      if (videoRef.current) {\r\n        const relativeTime = currentTime - content.mainVideo.startTime;\r\n        videoRef.current.currentTime = Math.max(0, relativeTime);\r\n      }\r\n    } else if (\r\n      !content.mainVideo &&\r\n      content.overlays.find((o) => o.type === \"image\")\r\n    ) {\r\n      const firstImage = content.overlays.find((o) => o.type === \"image\");\r\n      setCurrentVideoSource(firstImage.url);\r\n    } else if (\r\n      !content.mainVideo &&\r\n      !content.overlays.find((o) => o.type === \"image\")\r\n    ) {\r\n      setCurrentVideoSource(null);\r\n    }\r\n\r\n    const currentAudioIds = new Set(content.audio.map((item) => item.id));\r\n\r\n    audioElementsRef.current.forEach((audioElement, id) => {\r\n      if (!currentAudioIds.has(id)) {\r\n        if (!audioElement.paused) {\r\n          audioElement.pause();\r\n        }\r\n      }\r\n    });\r\n\r\n    content.audio.forEach((audioItem) => {\r\n      const audioElement = createAudioElement(audioItem);\r\n      const relativeTime = currentTime - audioItem.startTime;\r\n\r\n      audioElement.volume = (audioItem.volume || 1) * volume;\r\n      audioElement.muted = isMuted;\r\n\r\n      if (isPlaying && relativeTime >= 0) {\r\n        syncAudioTime(audioItem, relativeTime);\r\n        if (audioElement.paused) {\r\n          audioElement.play().catch(console.error);\r\n        }\r\n      } else {\r\n        if (!audioElement.paused) {\r\n          audioElement.pause();\r\n        }\r\n      }\r\n    });\r\n  }, [\r\n    currentTime,\r\n    timelineItems,\r\n    getCurrentTimelineContent,\r\n    isPlaying,\r\n    volume,\r\n    isMuted,\r\n    createAudioElement,\r\n    syncAudioTime,\r\n    currentVideoSource,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (isPlaying) {\r\n      intervalRef.current = setInterval(() => {\r\n        setCurrentTime((prev) => {\r\n          const newTime = prev + 0.1;\r\n          if (newTime >= videoDuration) {\r\n            setIsPlaying(false);\r\n            return videoDuration;\r\n          }\r\n          return newTime;\r\n        });\r\n      }, 100);\r\n    } else {\r\n      if (intervalRef.current) {\r\n        clearInterval(intervalRef.current);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (intervalRef.current) {\r\n        clearInterval(intervalRef.current);\r\n      }\r\n    };\r\n  }, [isPlaying, videoDuration]);\r\n\r\n  useEffect(() => {\r\n    if (videoRef.current && currentVideoSource) {\r\n      const content = getCurrentTimelineContent();\r\n      if (content.mainVideo) {\r\n        const relativeTime = currentTime - content.mainVideo.startTime;\r\n        const timeDiff = Math.abs(videoRef.current.currentTime - relativeTime);\r\n\r\n        if (timeDiff > 0.5) {\r\n          videoRef.current.currentTime = Math.max(0, relativeTime);\r\n        }\r\n\r\n        if (isPlaying && videoRef.current.paused) {\r\n          videoRef.current.play().catch(console.error);\r\n        } else if (!isPlaying && !videoRef.current.paused) {\r\n          videoRef.current.pause();\r\n        }\r\n      }\r\n    }\r\n  }, [currentTime, currentVideoSource, getCurrentTimelineContent, isPlaying]);\r\n\r\n  useEffect(() => {\r\n    const currentAudioIds = new Set(\r\n      timelineItems\r\n        .filter((item) => item.type === \"audio\")\r\n        .map((item) => item.id)\r\n    );\r\n\r\n    audioElementsRef.current.forEach((audioElement, id) => {\r\n      if (!currentAudioIds.has(id)) {\r\n        audioElement.pause();\r\n        audioElement.src = \"\";\r\n        audioElementsRef.current.delete(id);\r\n      }\r\n    });\r\n  }, [timelineItems]);\r\n\r\n  // Обработка клавиатурных шорткатов\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (e.target.tagName === \"INPUT\" || e.target.tagName === \"TEXTAREA\") {\r\n        return;\r\n      }\r\n\r\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\r\n        e.preventDefault();\r\n        deleteSelectedItem();\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === \"b\") {\r\n        e.preventDefault();\r\n        splitTimelineItem();\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === \"c\") {\r\n        e.preventDefault();\r\n        copyTimelineItem();\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === \"v\") {\r\n        e.preventDefault();\r\n        pasteTimelineItem();\r\n      }\r\n\r\n      if (e.key === \" \" || e.code === \"Space\") {\r\n        e.preventDefault();\r\n        setIsPlaying((prev) => !prev);\r\n      }\r\n\r\n      if (e.key === \"ArrowLeft\") {\r\n        e.preventDefault();\r\n        const step = e.ctrlKey ? 5 : e.shiftKey ? 1 : 0.1;\r\n        seekTo(Math.max(0, currentTime - step));\r\n      }\r\n      if (e.key === \"ArrowRight\") {\r\n        e.preventDefault();\r\n        const step = e.ctrlKey ? 5 : e.shiftKey ? 1 : 0.1;\r\n        seekTo(Math.min(videoDuration, currentTime + step));\r\n      }\r\n\r\n      if (e.key === \"?\" || (e.shiftKey && e.key === \"/\")) {\r\n        e.preventDefault();\r\n        setShowHelp(true);\r\n      }\r\n\r\n      if (e.key === \"Escape\") {\r\n        e.preventDefault();\r\n        if (showHelp) {\r\n          setShowHelp(false);\r\n        } else if (selectedOverlay) {\r\n          setSelectedOverlay(null);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [\r\n    selectedTimelineItem,\r\n    copiedItem,\r\n    currentTime,\r\n    videoDuration,\r\n    showHelp,\r\n    selectedOverlay,\r\n    deleteSelectedItem,\r\n    splitTimelineItem,\r\n    copyTimelineItem,\r\n    pasteTimelineItem,\r\n    seekTo,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"flex h-screen w-full gap-4 p-4 bg-gray-100 overflow-hidden\">\r\n      {/* Media Library Component */}\r\n      <MediaLibrary\r\n        mediaLibrary={mediaLibrary}\r\n        setMediaLibrary={setMediaLibrary}\r\n        activeTab={activeTab}\r\n        setActiveTab={setActiveTab}\r\n        draggedItem={draggedItem}\r\n        setDraggedItem={setDraggedItem}\r\n        isDragging={isDragging}\r\n        setIsDragging={setIsDragging}\r\n        addToTimeline={handleMediaLibraryClick} // ✅ ИСПОЛЬЗУЕМ УМНУЮ ФУНКЦИЮ\r\n        formatTime={formatTime}\r\n      />\r\n\r\n      <div className=\"flex-1 flex flex-col gap-4 min-w-0 overflow-hidden\">\r\n        {/* Video Preview */}\r\n        <div\r\n          ref={videoContainerRef}\r\n          className=\"flex-1 bg-black rounded-2xl relative overflow-hidden shadow-sm min-h-0\"\r\n          title=\"Video Preview - Click overlays to select, drag to move, Ctrl+scroll to resize, use opacity slider\"\r\n        >\r\n          {currentVideoSource ? (\r\n            <div\r\n              className=\"relative w-full h-full\"\r\n              onClick={(e) => {\r\n                if (e.target === e.currentTarget) {\r\n                  setSelectedOverlay(null);\r\n                }\r\n              }}\r\n            >\r\n              {getCurrentTimelineContent().mainVideo ? (\r\n                <video\r\n                  ref={videoRef}\r\n                  src={currentVideoSource}\r\n                  className=\"w-full h-full object-contain rounded-2xl\"\r\n                  muted={isMuted}\r\n                />\r\n              ) : (\r\n                <img\r\n                  src={currentVideoSource}\r\n                  alt=\"Timeline content\"\r\n                  className=\"w-full h-full object-contain rounded-2xl\"\r\n                />\r\n              )}\r\n\r\n              {getCurrentTimelineContent().overlays.map((item, index) => {\r\n                const transform = getOverlayTransform(item.id);\r\n                const isSelected = selectedOverlay?.id === item.id;\r\n                const isDraggingThis = isDraggingOverlay && isSelected;\r\n                const isResizingThis = isResizingOverlay && isSelected;\r\n\r\n                return (\r\n                  <div\r\n                    key={item.id}\r\n                    className={`absolute select-none ${\r\n                      isSelected\r\n                        ? \"ring-2 ring-blue-400 ring-opacity-75 shadow-xl\"\r\n                        : \"hover:ring-2 hover:ring-blue-300 hover:ring-opacity-50\"\r\n                    } ${\r\n                      isDraggingThis\r\n                        ? \"cursor-grabbing z-50\"\r\n                        : isResizingThis\r\n                        ? \"cursor-nw-resize\"\r\n                        : \"cursor-grab hover:shadow-lg\"\r\n                    }`}\r\n                    style={{\r\n                      left: `${200 + transform.x}px`,\r\n                      top: `${50 + index * 120 + transform.y}px`,\r\n                      width: `${128 * transform.scale}px`,\r\n                      height: `${96 * transform.scale}px`,\r\n                      opacity: transform.opacity,\r\n                      zIndex: isSelected ? 1000 : 10 + index,\r\n                      transform: isDraggingThis ? \"scale(1.02)\" : \"scale(1)\",\r\n                      transition:\r\n                        isDraggingThis || isResizingThis\r\n                          ? \"none\"\r\n                          : \"transform 0.2s ease, box-shadow 0.2s ease\",\r\n                    }}\r\n                    onMouseDown={(e) =>\r\n                      handleOverlayMouseDown(e, { ...item, index })\r\n                    }\r\n                    onWheel={(e) => handleOverlayWheel(e, item.id)}\r\n                  >\r\n                    <div\r\n                      className={`relative w-full h-full border-2 rounded-lg overflow-hidden shadow-lg group ${\r\n                        isSelected\r\n                          ? \"border-blue-400\"\r\n                          : \"border-white hover:border-blue-300\"\r\n                      }`}\r\n                      style={{\r\n                        transition:\r\n                          isDraggingThis || isResizingThis\r\n                            ? \"none\"\r\n                            : \"border-color 0.2s ease\",\r\n                      }}\r\n                    >\r\n                      {item.type === \"video\" ? (\r\n                        <video\r\n                          src={item.url}\r\n                          className=\"w-full h-full object-cover pointer-events-none\"\r\n                          muted\r\n                        />\r\n                      ) : (\r\n                        <img\r\n                          src={item.url}\r\n                          alt={item.name}\r\n                          className=\"w-full h-full object-cover pointer-events-none\"\r\n                          draggable={false}\r\n                        />\r\n                      )}\r\n\r\n                      <div\r\n                        className={`absolute inset-0 bg-blue-500 bg-opacity-0 hover:bg-opacity-10 ${\r\n                          isSelected ? \"bg-opacity-10\" : \"\"\r\n                        }`}\r\n                        style={{\r\n                          transition:\r\n                            isDraggingThis || isResizingThis\r\n                              ? \"none\"\r\n                              : \"background-color 0.2s ease\",\r\n                        }}\r\n                      ></div>\r\n\r\n                      {isSelected && (\r\n                        <>\r\n                          {/* Resize handles */}\r\n                          <div\r\n                            className={`resize-handle absolute -top-2 -left-2 w-4 h-4 bg-blue-500 rounded-full cursor-nw-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${\r\n                              isResizingThis && resizeOverlayHandle === \"nw\"\r\n                                ? \"scale-150 bg-red-500\"\r\n                                : \"\"\r\n                            }`}\r\n                            onMouseDown={(e) =>\r\n                              handleOverlayResizeStart(e, item, \"nw\")\r\n                            }\r\n                            style={{\r\n                              transition:\r\n                                isDraggingThis || isResizingThis\r\n                                  ? \"none\"\r\n                                  : \"all 0.2s ease\",\r\n                            }}\r\n                          ></div>\r\n                          <div\r\n                            className={`resize-handle absolute -top-2 -right-2 w-4 h-4 bg-blue-500 rounded-full cursor-ne-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${\r\n                              isResizingThis && resizeOverlayHandle === \"ne\"\r\n                                ? \"scale-150 bg-red-500\"\r\n                                : \"\"\r\n                            }`}\r\n                            onMouseDown={(e) =>\r\n                              handleOverlayResizeStart(e, item, \"ne\")\r\n                            }\r\n                            style={{\r\n                              transition:\r\n                                isDraggingThis || isResizingThis\r\n                                  ? \"none\"\r\n                                  : \"all 0.2s ease\",\r\n                            }}\r\n                          ></div>\r\n                          <div\r\n                            className={`resize-handle absolute -bottom-2 -left-2 w-4 h-4 bg-blue-500 rounded-full cursor-sw-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${\r\n                              isResizingThis && resizeOverlayHandle === \"sw\"\r\n                                ? \"scale-150 bg-red-500\"\r\n                                : \"\"\r\n                            }`}\r\n                            onMouseDown={(e) =>\r\n                              handleOverlayResizeStart(e, item, \"sw\")\r\n                            }\r\n                            style={{\r\n                              transition:\r\n                                isDraggingThis || isResizingThis\r\n                                  ? \"none\"\r\n                                  : \"all 0.2s ease\",\r\n                            }}\r\n                          ></div>\r\n                          <div\r\n                            className={`resize-handle absolute -bottom-2 -right-2 w-4 h-4 bg-blue-500 rounded-full cursor-se-resize opacity-90 hover:opacity-100 hover:scale-125 shadow-md border-2 border-white ${\r\n                              isResizingThis && resizeOverlayHandle === \"se\"\r\n                                ? \"scale-150 bg-red-500\"\r\n                                : \"\"\r\n                            }`}\r\n                            onMouseDown={(e) =>\r\n                              handleOverlayResizeStart(e, item, \"se\")\r\n                            }\r\n                            style={{\r\n                              transition:\r\n                                isDraggingThis || isResizingThis\r\n                                  ? \"none\"\r\n                                  : \"all 0.2s ease\",\r\n                            }}\r\n                          ></div>\r\n\r\n                          <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-blue-500 rounded-full opacity-60 pointer-events-none\"></div>\r\n\r\n                          {/* Opacity slider */}\r\n                          <div className=\"absolute -bottom-12 left-0 right-0 bg-black/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/20 shadow-lg\">\r\n                            <div className=\"flex items-center space-x-2\">\r\n                              <span className=\"text-white text-xs font-medium min-w-fit\">\r\n                                Opacity:\r\n                              </span>\r\n                              <input\r\n                                type=\"range\"\r\n                                min=\"0.1\"\r\n                                max=\"1\"\r\n                                step=\"0.05\"\r\n                                value={transform.opacity}\r\n                                onChange={(e) =>\r\n                                  updateOverlayTransform(item.id, {\r\n                                    opacity: parseFloat(e.target.value),\r\n                                  })\r\n                                }\r\n                                className=\"flex-1 h-2 accent-blue-500 cursor-pointer\"\r\n                                onMouseDown={(e) => e.stopPropagation()}\r\n                              />\r\n                              <span className=\"text-white text-xs min-w-8 text-right font-mono\">\r\n                                {Math.round(transform.opacity * 100)}%\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n\r\n                      <div\r\n                        className={`absolute top-1 left-1 bg-black/70 text-white text-xs px-2 py-1 rounded pointer-events-none ${\r\n                          isSelected\r\n                            ? \"opacity-100\"\r\n                            : \"opacity-0 group-hover:opacity-100\"\r\n                        }`}\r\n                        style={{\r\n                          transition:\r\n                            isDraggingThis || isResizingThis\r\n                              ? \"none\"\r\n                              : \"opacity 0.2s ease\",\r\n                        }}\r\n                      >\r\n                        {item.name} • {Math.round(transform.scale * 100)}% •{\" \"}\r\n                        {Math.round(transform.opacity * 100)}%\r\n                      </div>\r\n\r\n                      {isSelected && (\r\n                        <div className=\"absolute -top-0.5 -left-0.5 -right-0.5 -bottom-0.5 border-2 border-blue-400 rounded-lg pointer-events-none animate-pulse\"></div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : (\r\n            <div className=\"w-full h-full flex items-center justify-center text-white\">\r\n              <div className=\"text-center\">\r\n                <div className=\"w-20 h-20 bg-gray-800 rounded-2xl flex items-center justify-center mx-auto mb-4\">\r\n                  <Film size={40} className=\"opacity-50\" />\r\n                </div>\r\n                <p className=\"text-xl opacity-75 font-medium\">\r\n                  No content at current time\r\n                </p>\r\n                <p className=\"text-sm opacity-50 mb-4\">\r\n                  Drag media to timeline tracks to start editing\r\n                </p>\r\n                <div className=\"text-xs opacity-40 space-y-1\">\r\n                  <p>💡 Overlays are interactive • Ripple mode enabled</p>\r\n                  <p>\r\n                    Press{\" \"}\r\n                    <kbd className=\"px-1 py-0.5 bg-gray-700 rounded text-xs\">\r\n                      ?\r\n                    </kbd>{\" \"}\r\n                    for help & shortcuts\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-black/60 backdrop-blur-md rounded-2xl p-4\">\r\n            <div className=\"flex items-center space-x-6\">\r\n              <button\r\n                onClick={() => seekTo(Math.max(0, currentTime - 10))}\r\n                className=\"text-white hover:text-blue-400 transition-colors p-1 rounded-lg hover:bg-white/10\"\r\n                title=\"Skip back 10 seconds\"\r\n              >\r\n                <SkipBack size={20} />\r\n              </button>\r\n              <button\r\n                onClick={handlePlayPause}\r\n                className=\"w-12 h-12 bg-white/20 hover:bg-white/30 rounded-2xl flex items-center justify-center text-white transition-all hover:scale-105\"\r\n                title=\"Play/Pause (Space)\"\r\n              >\r\n                {isPlaying ? <Pause size={24} /> : <Play size={24} />}\r\n              </button>\r\n              <button\r\n                onClick={() =>\r\n                  seekTo(Math.min(videoDuration, currentTime + 10))\r\n                }\r\n                className=\"text-white hover:text-blue-400 transition-colors p-1 rounded-lg hover:bg-white/10\"\r\n                title=\"Skip forward 10 seconds\"\r\n              >\r\n                <SkipForward size={20} />\r\n              </button>\r\n              <div className=\"flex items-center space-x-3\">\r\n                <button\r\n                  onClick={() => setIsMuted(!isMuted)}\r\n                  className=\"text-white hover:text-blue-400 transition-colors p-1 rounded-lg hover:bg-white/10\"\r\n                  title=\"Toggle mute\"\r\n                >\r\n                  {isMuted ? <VolumeX size={20} /> : <Volume2 size={20} />}\r\n                </button>\r\n                <input\r\n                  type=\"range\"\r\n                  min=\"0\"\r\n                  max=\"1\"\r\n                  step=\"0.1\"\r\n                  value={volume}\r\n                  onChange={(e) => setVolume(parseFloat(e.target.value))}\r\n                  className=\"w-24 accent-blue-500\"\r\n                  title=\"Volume control\"\r\n                />\r\n              </div>\r\n              <span\r\n                className=\"text-white text-sm font-medium min-w-0\"\r\n                title=\"Current time / Total duration\"\r\n              >\r\n                {formatTime(currentTime)} / {formatTime(videoDuration)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <Timeline\r\n          timelineItems={timelineItems}\r\n          setTimelineItems={setTimelineItems}\r\n          currentTime={currentTime}\r\n          videoDuration={videoDuration}\r\n          setVideoDuration={setVideoDuration}\r\n          selectedTimelineItem={selectedTimelineItem}\r\n          setSelectedTimelineItem={setSelectedTimelineItem}\r\n          timelineZoom={timelineZoom}\r\n          setTimelineZoom={setTimelineZoom}\r\n          tracks={tracks}\r\n          setTracks={setTracks}\r\n          draggedItem={draggedItem}\r\n          draggedTimelineItem={draggedTimelineItem}\r\n          setDraggedTimelineItem={setDraggedTimelineItem}\r\n          dropPreview={dropPreview}\r\n          setDropPreview={setDropPreview}\r\n          isDragging={isDragging}\r\n          isTimelineDragging={isTimelineDragging}\r\n          setIsTimelineDragging={setIsTimelineDragging}\r\n          isResizing={isResizing}\r\n          setIsResizing={setIsResizing}\r\n          copiedItem={copiedItem}\r\n          formatTime={formatTime}\r\n          seekTo={seekTo}\r\n          splitTimelineItem={splitTimelineItem}\r\n          copyTimelineItem={copyTimelineItem}\r\n          pasteTimelineItem={pasteTimelineItem}\r\n          deleteSelectedItem={deleteSelectedItem}\r\n          addToTimeline={addToTimeline}\r\n          insertWithRipple={insertWithRipple}\r\n          applyRippleEffect={applyRippleEffect}\r\n          removeFromTimeline={removeFromTimeline}\r\n          onSmartAddToTimeline={(func) => {\r\n            setSmartAddFunction(() => func);\r\n          }}\r\n        />\r\n        \r\n        <button\r\n          onClick={() => setShowExportModal(true)}\r\n          className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-medium transition-all hover:scale-105 shadow-lg\"\r\n        >\r\n          <Download size={18} />\r\n          <span>Экспорт видео</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Export Modal */}\r\n      <VideoExporter\r\n        isOpen={showExportModal}\r\n        onClose={() => setShowExportModal(false)}\r\n        timelineItems={timelineItems}\r\n        videoDuration={videoDuration}\r\n        tracks={tracks}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoEditor;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}